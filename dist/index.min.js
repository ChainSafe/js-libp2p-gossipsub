(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.ChainsafeLibp2PGossipsub = factory()}(typeof self !== 'undefined' ? self : this, function () {
"use strict";var ChainsafeLibp2PGossipsub=(()=>{var Fl=Object.create;var Ss=Object.defineProperty;var Ul=Object.getOwnPropertyDescriptor;var Kl=Object.getOwnPropertyNames;var zl=Object.getPrototypeOf,ql=Object.prototype.hasOwnProperty;var hc=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,r)=>(typeof require<"u"?require:e)[r]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+t+'" is not supported')});var k=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Ne=(t,e)=>{for(var r in e)Ss(t,r,{get:e[r],enumerable:!0})},lc=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Kl(e))!ql.call(t,s)&&s!==r&&Ss(t,s,{get:()=>e[s],enumerable:!(n=Ul(e,s))||n.enumerable});return t};var U=(t,e,r)=>(r=t!=null?Fl(zl(t)):{},lc(e||!t||!t.__esModule?Ss(r,"default",{value:t,enumerable:!0}):r,t)),Vl=t=>lc(Ss({},"__esModule",{value:!0}),t);var Be=k((f2,gc)=>{"use strict";function dc(t,e){for(let r in e)Object.defineProperty(t,r,{value:e[r],enumerable:!0,configurable:!0});return t}function jl(t,e,r){if(!t||typeof t=="string")throw new TypeError("Please pass an Error to err-code");r||(r={}),typeof e=="object"&&(r=e,e=""),e&&(r.code=e);try{return dc(t,r)}catch{r.message=t.message,r.stack=t.stack;let s=function(){};return s.prototype=Object.create(Object.getPrototypeOf(t)),dc(new s,r)}}gc.exports=jl});var ao=k((rv,Lc)=>{"use strict";Lc.exports=Jp;function Jp(t,e){for(var r=new Array(arguments.length-1),n=0,s=2,i=!0;s<arguments.length;)r[n++]=arguments[s++];return new Promise(function(a,f){r[n]=function(c){if(i)if(i=!1,c)f(c);else{for(var h=new Array(arguments.length-1),l=0;l<h.length;)h[l++]=arguments[l];a.apply(null,h)}};try{t.apply(e||null,r)}catch(u){i&&(i=!1,f(u))}})}});var co=k(Uc=>{"use strict";var Cs=Uc;Cs.length=function(e){var r=e.length;if(!r)return 0;for(var n=0;--r%4>1&&e.charAt(r)==="=";)++n;return Math.ceil(e.length*3)/4-n};var Qr=new Array(64),Fc=new Array(123);for(at=0;at<64;)Fc[Qr[at]=at<26?at+65:at<52?at+71:at<62?at-4:at-59|43]=at++;var at;Cs.encode=function(e,r,n){for(var s=null,i=[],o=0,a=0,f;r<n;){var u=e[r++];switch(a){case 0:i[o++]=Qr[u>>2],f=(u&3)<<4,a=1;break;case 1:i[o++]=Qr[f|u>>4],f=(u&15)<<2,a=2;break;case 2:i[o++]=Qr[f|u>>6],i[o++]=Qr[u&63],a=0;break}o>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,i)),o=0)}return a&&(i[o++]=Qr[f],i[o++]=61,a===1&&(i[o++]=61)),s?(o&&s.push(String.fromCharCode.apply(String,i.slice(0,o))),s.join("")):String.fromCharCode.apply(String,i.slice(0,o))};var Oc="invalid encoding";Cs.decode=function(e,r,n){for(var s=n,i=0,o,a=0;a<e.length;){var f=e.charCodeAt(a++);if(f===61&&i>1)break;if((f=Fc[f])===void 0)throw Error(Oc);switch(i){case 0:o=f,i=1;break;case 1:r[n++]=o<<2|(f&48)>>4,o=f,i=2;break;case 2:r[n++]=(o&15)<<4|(f&60)>>2,o=f,i=3;break;case 3:r[n++]=(o&3)<<6|f,i=0;break}}if(i===1)throw Error(Oc);return n-s};Cs.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var uo=k((sv,Kc)=>{"use strict";Kc.exports=As;function As(){this._listeners={}}As.prototype.on=function(e,r,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:r,ctx:n||this}),this};As.prototype.off=function(e,r){if(e===void 0)this._listeners={};else if(r===void 0)this._listeners[e]=[];else for(var n=this._listeners[e],s=0;s<n.length;)n[s].fn===r?n.splice(s,1):++s;return this};As.prototype.emit=function(e){var r=this._listeners[e];if(r){for(var n=[],s=1;s<arguments.length;)n.push(arguments[s++]);for(s=0;s<r.length;)r[s].fn.apply(r[s++].ctx,n)}return this}});var fo=k((iv,Wc)=>{"use strict";Wc.exports=zc(zc);function zc(t){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),r=new Uint8Array(e.buffer),n=r[3]===128;function s(f,u,c){e[0]=f,u[c]=r[0],u[c+1]=r[1],u[c+2]=r[2],u[c+3]=r[3]}function i(f,u,c){e[0]=f,u[c]=r[3],u[c+1]=r[2],u[c+2]=r[1],u[c+3]=r[0]}t.writeFloatLE=n?s:i,t.writeFloatBE=n?i:s;function o(f,u){return r[0]=f[u],r[1]=f[u+1],r[2]=f[u+2],r[3]=f[u+3],e[0]}function a(f,u){return r[3]=f[u],r[2]=f[u+1],r[1]=f[u+2],r[0]=f[u+3],e[0]}t.readFloatLE=n?o:a,t.readFloatBE=n?a:o}():function(){function e(n,s,i,o){var a=s<0?1:0;if(a&&(s=-s),s===0)n(1/s>0?0:2147483648,i,o);else if(isNaN(s))n(2143289344,i,o);else if(s>34028234663852886e22)n((a<<31|2139095040)>>>0,i,o);else if(s<11754943508222875e-54)n((a<<31|Math.round(s/1401298464324817e-60))>>>0,i,o);else{var f=Math.floor(Math.log(s)/Math.LN2),u=Math.round(s*Math.pow(2,-f)*8388608)&8388607;n((a<<31|f+127<<23|u)>>>0,i,o)}}t.writeFloatLE=e.bind(null,qc),t.writeFloatBE=e.bind(null,Vc);function r(n,s,i){var o=n(s,i),a=(o>>31)*2+1,f=o>>>23&255,u=o&8388607;return f===255?u?NaN:a*(1/0):f===0?a*1401298464324817e-60*u:a*Math.pow(2,f-150)*(u+8388608)}t.readFloatLE=r.bind(null,Gc),t.readFloatBE=r.bind(null,Hc)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),r=new Uint8Array(e.buffer),n=r[7]===128;function s(f,u,c){e[0]=f,u[c]=r[0],u[c+1]=r[1],u[c+2]=r[2],u[c+3]=r[3],u[c+4]=r[4],u[c+5]=r[5],u[c+6]=r[6],u[c+7]=r[7]}function i(f,u,c){e[0]=f,u[c]=r[7],u[c+1]=r[6],u[c+2]=r[5],u[c+3]=r[4],u[c+4]=r[3],u[c+5]=r[2],u[c+6]=r[1],u[c+7]=r[0]}t.writeDoubleLE=n?s:i,t.writeDoubleBE=n?i:s;function o(f,u){return r[0]=f[u],r[1]=f[u+1],r[2]=f[u+2],r[3]=f[u+3],r[4]=f[u+4],r[5]=f[u+5],r[6]=f[u+6],r[7]=f[u+7],e[0]}function a(f,u){return r[7]=f[u],r[6]=f[u+1],r[5]=f[u+2],r[4]=f[u+3],r[3]=f[u+4],r[2]=f[u+5],r[1]=f[u+6],r[0]=f[u+7],e[0]}t.readDoubleLE=n?o:a,t.readDoubleBE=n?a:o}():function(){function e(n,s,i,o,a,f){var u=o<0?1:0;if(u&&(o=-o),o===0)n(0,a,f+s),n(1/o>0?0:2147483648,a,f+i);else if(isNaN(o))n(0,a,f+s),n(2146959360,a,f+i);else if(o>17976931348623157e292)n(0,a,f+s),n((u<<31|2146435072)>>>0,a,f+i);else{var c;if(o<22250738585072014e-324)c=o/5e-324,n(c>>>0,a,f+s),n((u<<31|c/4294967296)>>>0,a,f+i);else{var h=Math.floor(Math.log(o)/Math.LN2);h===1024&&(h=1023),c=o*Math.pow(2,-h),n(c*4503599627370496>>>0,a,f+s),n((u<<31|h+1023<<20|c*1048576&1048575)>>>0,a,f+i)}}}t.writeDoubleLE=e.bind(null,qc,0,4),t.writeDoubleBE=e.bind(null,Vc,4,0);function r(n,s,i,o,a){var f=n(o,a+s),u=n(o,a+i),c=(u>>31)*2+1,h=u>>>20&2047,l=4294967296*(u&1048575)+f;return h===2047?l?NaN:c*(1/0):h===0?c*5e-324*l:c*Math.pow(2,h-1075)*(l+4503599627370496)}t.readDoubleLE=r.bind(null,Gc,0,4),t.readDoubleBE=r.bind(null,Hc,4,0)}(),t}function qc(t,e,r){e[r]=t&255,e[r+1]=t>>>8&255,e[r+2]=t>>>16&255,e[r+3]=t>>>24}function Vc(t,e,r){e[r]=t>>>24,e[r+1]=t>>>16&255,e[r+2]=t>>>8&255,e[r+3]=t&255}function Gc(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0}function Hc(t,e){return(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}});var ho=k((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(t){}return null}});var po=k(jc=>{"use strict";var lo=jc;lo.length=function(e){for(var r=0,n=0,s=0;s<e.length;++s)n=e.charCodeAt(s),n<128?r+=1:n<2048?r+=2:(n&64512)===55296&&(e.charCodeAt(s+1)&64512)===56320?(++s,r+=4):r+=3;return r};lo.read=function(e,r,n){var s=n-r;if(s<1)return"";for(var i=null,o=[],a=0,f;r<n;)f=e[r++],f<128?o[a++]=f:f>191&&f<224?o[a++]=(f&31)<<6|e[r++]&63:f>239&&f<365?(f=((f&7)<<18|(e[r++]&63)<<12|(e[r++]&63)<<6|e[r++]&63)-65536,o[a++]=55296+(f>>10),o[a++]=56320+(f&1023)):o[a++]=(f&15)<<12|(e[r++]&63)<<6|e[r++]&63,a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),a=0);return i?(a&&i.push(String.fromCharCode.apply(String,o.slice(0,a))),i.join("")):String.fromCharCode.apply(String,o.slice(0,a))};lo.write=function(e,r,n){for(var s=n,i,o,a=0;a<e.length;++a)i=e.charCodeAt(a),i<128?r[n++]=i:i<2048?(r[n++]=i>>6|192,r[n++]=i&63|128):(i&64512)===55296&&((o=e.charCodeAt(a+1))&64512)===56320?(i=65536+((i&1023)<<10)+(o&1023),++a,r[n++]=i>>18|240,r[n++]=i>>12&63|128,r[n++]=i>>6&63|128,r[n++]=i&63|128):(r[n++]=i>>12|224,r[n++]=i>>6&63|128,r[n++]=i&63|128);return n-s}});var go=k((av,$c)=>{"use strict";$c.exports=ed;function ed(t,e,r){var n=r||8192,s=n>>>1,i=null,o=n;return function(f){if(f<1||f>s)return t(f);o+f>n&&(i=t(n),o=0);var u=e.call(i,o,o+=f);return o&7&&(o=(o|7)+1),u}}});var Yc=k((cv,Zc)=>{"use strict";Zc.exports=Te;var Ln=Sr();function Te(t,e){this.lo=t>>>0,this.hi=e>>>0}var wr=Te.zero=new Te(0,0);wr.toNumber=function(){return 0};wr.zzEncode=wr.zzDecode=function(){return this};wr.length=function(){return 1};var td=Te.zeroHash="\0\0\0\0\0\0\0\0";Te.fromNumber=function(e){if(e===0)return wr;var r=e<0;r&&(e=-e);var n=e>>>0,s=(e-n)/4294967296>>>0;return r&&(s=~s>>>0,n=~n>>>0,++n>4294967295&&(n=0,++s>4294967295&&(s=0))),new Te(n,s)};Te.from=function(e){if(typeof e=="number")return Te.fromNumber(e);if(Ln.isString(e))if(Ln.Long)e=Ln.Long.fromString(e);else return Te.fromNumber(parseInt(e,10));return e.low||e.high?new Te(e.low>>>0,e.high>>>0):wr};Te.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var r=~this.lo+1>>>0,n=~this.hi>>>0;return r||(n=n+1>>>0),-(r+n*4294967296)}return this.lo+this.hi*4294967296};Te.prototype.toLong=function(e){return Ln.Long?new Ln.Long(this.lo|0,this.hi|0,Boolean(e)):{low:this.lo|0,high:this.hi|0,unsigned:Boolean(e)}};var er=String.prototype.charCodeAt;Te.fromHash=function(e){return e===td?wr:new Te((er.call(e,0)|er.call(e,1)<<8|er.call(e,2)<<16|er.call(e,3)<<24)>>>0,(er.call(e,4)|er.call(e,5)<<8|er.call(e,6)<<16|er.call(e,7)<<24)>>>0)};Te.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};Te.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};Te.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};Te.prototype.length=function(){var e=this.lo,r=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?r===0?e<16384?e<128?1:2:e<2097152?3:4:r<16384?r<128?5:6:r<2097152?7:8:n<128?9:10}});var Sr=k(yo=>{"use strict";var M=yo;M.asPromise=ao();M.base64=co();M.EventEmitter=uo();M.float=fo();M.inquire=ho();M.utf8=po();M.pool=go();M.LongBits=Yc();M.isNode=Boolean(typeof globalThis<"u"&&globalThis&&globalThis.process&&globalThis.process.versions&&globalThis.process.versions.node);M.global=M.isNode&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||yo;M.emptyArray=Object.freeze?Object.freeze([]):[];M.emptyObject=Object.freeze?Object.freeze({}):{};M.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};M.isString=function(e){return typeof e=="string"||e instanceof String};M.isObject=function(e){return e&&typeof e=="object"};M.isset=M.isSet=function(e,r){var n=e[r];return n!=null&&e.hasOwnProperty(r)?typeof n!="object"||(Array.isArray(n)?n.length:Object.keys(n).length)>0:!1};M.Buffer=function(){try{var t=M.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch{return null}}();M._Buffer_from=null;M._Buffer_allocUnsafe=null;M.newBuffer=function(e){return typeof e=="number"?M.Buffer?M._Buffer_allocUnsafe(e):new M.Array(e):M.Buffer?M._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};M.Array=typeof Uint8Array<"u"?Uint8Array:Array;M.Long=M.global.dcodeIO&&M.global.dcodeIO.Long||M.global.Long||M.inquire("long");M.key2Re=/^true|false|0|1$/;M.key32Re=/^-?(?:0|[1-9][0-9]*)$/;M.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;M.longToHash=function(e){return e?M.LongBits.from(e).toHash():M.LongBits.zeroHash};M.longFromHash=function(e,r){var n=M.LongBits.fromHash(e);return M.Long?M.Long.fromBits(n.lo,n.hi,r):n.toNumber(Boolean(r))};function Qc(t,e,r){for(var n=Object.keys(e),s=0;s<n.length;++s)(t[n[s]]===void 0||!r)&&(t[n[s]]=e[n[s]]);return t}M.merge=Qc;M.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function Xc(t){function e(r,n){if(!(this instanceof e))return new e(r,n);Object.defineProperty(this,"message",{get:function(){return r}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),n&&Qc(this,n)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get(){return t},set:void 0,enumerable:!1,configurable:!0},toString:{value(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}M.newError=Xc;M.ProtocolError=Xc("ProtocolError");M.oneOfGetter=function(e){for(var r={},n=0;n<e.length;++n)r[e[n]]=1;return function(){for(var s=Object.keys(this),i=s.length-1;i>-1;--i)if(r[s[i]]===1&&this[s[i]]!==void 0&&this[s[i]]!==null)return s[i]}};M.oneOfSetter=function(e){return function(r){for(var n=0;n<e.length;++n)e[n]!==r&&delete this[e[n]]}};M.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};M._configure=function(){var t=M.Buffer;if(!t){M._Buffer_from=M._Buffer_allocUnsafe=null;return}M._Buffer_from=t.from!==Uint8Array.from&&t.from||function(r,n){return new t(r,n)},M._Buffer_allocUnsafe=t.allocUnsafe||function(r){return new t(r)}}});var vo=k((fv,nu)=>{"use strict";nu.exports=we;var bt=Sr(),bo,tu=bt.LongBits,rd=bt.utf8;function ct(t,e){return RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}function we(t){this.buf=t,this.pos=0,this.len=t.length}var Jc=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new we(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new we(e);throw Error("illegal buffer")},ru=function(){return bt.Buffer?function(r){return(we.create=function(s){return bt.Buffer.isBuffer(s)?new bo(s):Jc(s)})(r)}:Jc};we.create=ru();we.prototype._slice=bt.Array.prototype.subarray||bt.Array.prototype.slice;we.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,ct(this,10);return e}}();we.prototype.int32=function(){return this.uint32()|0};we.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function mo(){var t=new tu(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(t.lo=(t.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(this.buf[this.pos]&127)<<28)>>>0,t.hi=(t.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return t;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw ct(this);if(t.lo=(t.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,t}if(this.len-this.pos>4){for(;e<5;++e)if(t.hi=(t.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw ct(this);if(t.hi=(t.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}we.prototype.bool=function(){return this.uint32()!==0};function Bs(t,e){return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0}we.prototype.fixed32=function(){if(this.pos+4>this.len)throw ct(this,4);return Bs(this.buf,this.pos+=4)};we.prototype.sfixed32=function(){if(this.pos+4>this.len)throw ct(this,4);return Bs(this.buf,this.pos+=4)|0};function eu(){if(this.pos+8>this.len)throw ct(this,8);return new tu(Bs(this.buf,this.pos+=4),Bs(this.buf,this.pos+=4))}we.prototype.float=function(){if(this.pos+4>this.len)throw ct(this,4);var e=bt.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};we.prototype.double=function(){if(this.pos+8>this.len)throw ct(this,4);var e=bt.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};we.prototype.bytes=function(){var e=this.uint32(),r=this.pos,n=this.pos+e;if(n>this.len)throw ct(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(r,n):r===n?new this.buf.constructor(0):this._slice.call(this.buf,r,n)};we.prototype.string=function(){var e=this.bytes();return rd.read(e,0,e.length)};we.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw ct(this,e);this.pos+=e}else do if(this.pos>=this.len)throw ct(this);while(this.buf[this.pos++]&128);return this};we.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(t=this.uint32()&7)!==4;)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this};we._configure=function(t){bo=t,we.create=ru(),bo._configure();var e=bt.Long?"toLong":"toNumber";bt.merge(we.prototype,{int64:function(){return mo.call(this)[e](!1)},uint64:function(){return mo.call(this)[e](!0)},sint64:function(){return mo.call(this).zzDecode()[e](!1)},fixed64:function(){return eu.call(this)[e](!0)},sfixed64:function(){return eu.call(this)[e](!1)}})}});var au=k((hv,ou)=>{"use strict";ou.exports=Er;var iu=vo();(Er.prototype=Object.create(iu.prototype)).constructor=Er;var su=Sr();function Er(t){iu.call(this,t)}Er._configure=function(){su.Buffer&&(Er.prototype._slice=su.Buffer.prototype.slice)};Er.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};Er._configure()});var Co=k((lv,hu)=>{"use strict";hu.exports=Z;var Xe=Sr(),xo,Ts=Xe.LongBits,cu=Xe.base64,uu=Xe.utf8;function On(t,e,r){this.fn=t,this.len=e,this.next=void 0,this.val=r}function So(){}function nd(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function Z(){this.len=0,this.head=new On(So,0,0),this.tail=this.head,this.states=null}var fu=function(){return Xe.Buffer?function(){return(Z.create=function(){return new xo})()}:function(){return new Z}};Z.create=fu();Z.alloc=function(e){return new Xe.Array(e)};Xe.Array!==Array&&(Z.alloc=Xe.pool(Z.alloc,Xe.Array.prototype.subarray));Z.prototype._push=function(e,r,n){return this.tail=this.tail.next=new On(e,r,n),this.len+=r,this};function Eo(t,e,r){e[r]=t&255}function sd(t,e,r){for(;t>127;)e[r++]=t&127|128,t>>>=7;e[r]=t}function Io(t,e){this.len=t,this.next=void 0,this.val=e}Io.prototype=Object.create(On.prototype);Io.prototype.fn=sd;Z.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new Io((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};Z.prototype.int32=function(e){return e<0?this._push(_o,10,Ts.fromNumber(e)):this.uint32(e)};Z.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function _o(t,e,r){for(;t.hi;)e[r++]=t.lo&127|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;t.lo>127;)e[r++]=t.lo&127|128,t.lo=t.lo>>>7;e[r++]=t.lo}Z.prototype.uint64=function(e){var r=Ts.from(e);return this._push(_o,r.length(),r)};Z.prototype.int64=Z.prototype.uint64;Z.prototype.sint64=function(e){var r=Ts.from(e).zzEncode();return this._push(_o,r.length(),r)};Z.prototype.bool=function(e){return this._push(Eo,1,e?1:0)};function wo(t,e,r){e[r]=t&255,e[r+1]=t>>>8&255,e[r+2]=t>>>16&255,e[r+3]=t>>>24}Z.prototype.fixed32=function(e){return this._push(wo,4,e>>>0)};Z.prototype.sfixed32=Z.prototype.fixed32;Z.prototype.fixed64=function(e){var r=Ts.from(e);return this._push(wo,4,r.lo)._push(wo,4,r.hi)};Z.prototype.sfixed64=Z.prototype.fixed64;Z.prototype.float=function(e){return this._push(Xe.float.writeFloatLE,4,e)};Z.prototype.double=function(e){return this._push(Xe.float.writeDoubleLE,8,e)};var id=Xe.Array.prototype.set?function(e,r,n){r.set(e,n)}:function(e,r,n){for(var s=0;s<e.length;++s)r[n+s]=e[s]};Z.prototype.bytes=function(e){var r=e.length>>>0;if(!r)return this._push(Eo,1,0);if(Xe.isString(e)){var n=Z.alloc(r=cu.length(e));cu.decode(e,n,0),e=n}return this.uint32(r)._push(id,r,e)};Z.prototype.string=function(e){var r=uu.length(e);return r?this.uint32(r)._push(uu.write,r,e):this._push(Eo,1,0)};Z.prototype.fork=function(){return this.states=new nd(this),this.head=this.tail=new On(So,0,0),this.len=0,this};Z.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new On(So,0,0),this.len=0),this};Z.prototype.ldelim=function(){var e=this.head,r=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=r,this.len+=n),this};Z.prototype.finish=function(){for(var e=this.head.next,r=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,r,n),n+=e.len,e=e.next;return r};Z._configure=function(t){xo=t,Z.create=fu(),xo._configure()}});var du=k((pv,pu)=>{"use strict";pu.exports=vt;var lu=Co();(vt.prototype=Object.create(lu.prototype)).constructor=vt;var tr=Sr();function vt(){lu.call(this)}vt._configure=function(){vt.alloc=tr._Buffer_allocUnsafe,vt.writeBytesBuffer=tr.Buffer&&tr.Buffer.prototype instanceof Uint8Array&&tr.Buffer.prototype.set.name==="set"?function(e,r,n){r.set(e,n)}:function(e,r,n){if(e.copy)e.copy(r,n,0,e.length);else for(var s=0;s<e.length;)r[n++]=e[s++]}};vt.prototype.bytes=function(e){tr.isString(e)&&(e=tr._Buffer_from(e,"base64"));var r=e.length>>>0;return this.uint32(r),r&&this._push(vt.writeBytesBuffer,r,e),this};function od(t,e,r){t.length<40?tr.utf8.write(t,e,r):e.utf8Write?e.utf8Write(t,r):e.write(t,r)}vt.prototype.string=function(e){var r=tr.Buffer.byteLength(e);return this.uint32(r),r&&this._push(od,r,e),this};vt._configure()});var te=k((Rv,vu)=>{vu.exports={options:{usePureJavaScript:!1}}});var Su=k((Dv,wu)=>{var ko={};wu.exports=ko;var xu={};ko.encode=function(t,e,r){if(typeof e!="string")throw new TypeError('"alphabet" must be a string.');if(r!==void 0&&typeof r!="number")throw new TypeError('"maxline" must be a number.');var n="";if(!(t instanceof Uint8Array))n=fd(t,e);else{var s=0,i=e.length,o=e.charAt(0),a=[0];for(s=0;s<t.length;++s){for(var f=0,u=t[s];f<a.length;++f)u+=a[f]<<8,a[f]=u%i,u=u/i|0;for(;u>0;)a.push(u%i),u=u/i|0}for(s=0;t[s]===0&&s<t.length-1;++s)n+=o;for(s=a.length-1;s>=0;--s)n+=e[a[s]]}if(r){var c=new RegExp(".{1,"+r+"}","g");n=n.match(c).join(`\r
`)}return n};ko.decode=function(t,e){if(typeof t!="string")throw new TypeError('"input" must be a string.');if(typeof e!="string")throw new TypeError('"alphabet" must be a string.');var r=xu[e];if(!r){r=xu[e]=[];for(var n=0;n<e.length;++n)r[e.charCodeAt(n)]=n}t=t.replace(/\s/g,"");for(var s=e.length,i=e.charAt(0),o=[0],n=0;n<t.length;n++){var a=r[t.charCodeAt(n)];if(a===void 0)return;for(var f=0,u=a;f<o.length;++f)u+=o[f]*s,o[f]=u&255,u>>=8;for(;u>0;)o.push(u&255),u>>=8}for(var c=0;t[c]===i&&c<t.length-1;++c)o.push(0);return typeof Buffer<"u"?Buffer.from(o.reverse()):new Uint8Array(o.reverse())};function fd(t,e){var r=0,n=e.length,s=e.charAt(0),i=[0];for(r=0;r<t.length();++r){for(var o=0,a=t.at(r);o<i.length;++o)a+=i[o]<<8,i[o]=a%n,a=a/n|0;for(;a>0;)i.push(a%n),a=a/n|0}var f="";for(r=0;t.at(r)===0&&r<t.length()-1;++r)f+=s;for(r=i.length-1;r>=0;--r)f+=e[i[r]];return f}});var Se=k((kv,Cu)=>{var Eu=te(),Iu=Su(),y=Cu.exports=Eu.util=Eu.util||{};(function(){if(typeof process<"u"&&process.nextTick&&!process.browser){y.nextTick=process.nextTick,typeof setImmediate=="function"?y.setImmediate=setImmediate:y.setImmediate=y.nextTick;return}if(typeof setImmediate=="function"){y.setImmediate=function(){return setImmediate.apply(void 0,arguments)},y.nextTick=function(a){return setImmediate(a)};return}if(y.setImmediate=function(a){setTimeout(a,0)},typeof window<"u"&&typeof window.postMessage=="function"){let a=function(f){if(f.source===window&&f.data===t){f.stopPropagation();var u=e.slice();e.length=0,u.forEach(function(c){c()})}};var o=a,t="forge.setImmediate",e=[];y.setImmediate=function(f){e.push(f),e.length===1&&window.postMessage(t,"*")},window.addEventListener("message",a,!0)}if(typeof MutationObserver<"u"){var r=Date.now(),n=!0,s=document.createElement("div"),e=[];new MutationObserver(function(){var f=e.slice();e.length=0,f.forEach(function(u){u()})}).observe(s,{attributes:!0});var i=y.setImmediate;y.setImmediate=function(f){Date.now()-r>15?(r=Date.now(),i(f)):(e.push(f),e.length===1&&s.setAttribute("a",n=!n))}}y.nextTick=y.setImmediate})();y.isNodejs=typeof process<"u"&&process.versions&&process.versions.node;y.globalScope=function(){return y.isNodejs?globalThis:typeof self>"u"?window:self}();y.isArray=Array.isArray||function(t){return Object.prototype.toString.call(t)==="[object Array]"};y.isArrayBuffer=function(t){return typeof ArrayBuffer<"u"&&t instanceof ArrayBuffer};y.isArrayBufferView=function(t){return t&&y.isArrayBuffer(t.buffer)&&t.byteLength!==void 0};function Fn(t){if(!(t===8||t===16||t===24||t===32))throw new Error("Only 8, 16, 24, or 32 bits supported: "+t)}y.ByteBuffer=Mo;function Mo(t){if(this.data="",this.read=0,typeof t=="string")this.data=t;else if(y.isArrayBuffer(t)||y.isArrayBufferView(t))if(typeof Buffer<"u"&&t instanceof Buffer)this.data=t.toString("binary");else{var e=new Uint8Array(t);try{this.data=String.fromCharCode.apply(null,e)}catch{for(var r=0;r<e.length;++r)this.putByte(e[r])}}else(t instanceof Mo||typeof t=="object"&&typeof t.data=="string"&&typeof t.read=="number")&&(this.data=t.data,this.read=t.read);this._constructedStringLength=0}y.ByteStringBuffer=Mo;var hd=4096;y.ByteStringBuffer.prototype._optimizeConstructedString=function(t){this._constructedStringLength+=t,this._constructedStringLength>hd&&(this.data.substr(0,1),this._constructedStringLength=0)};y.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read};y.ByteStringBuffer.prototype.isEmpty=function(){return this.length()<=0};y.ByteStringBuffer.prototype.putByte=function(t){return this.putBytes(String.fromCharCode(t))};y.ByteStringBuffer.prototype.fillWithByte=function(t,e){t=String.fromCharCode(t);for(var r=this.data;e>0;)e&1&&(r+=t),e>>>=1,e>0&&(t+=t);return this.data=r,this._optimizeConstructedString(e),this};y.ByteStringBuffer.prototype.putBytes=function(t){return this.data+=t,this._optimizeConstructedString(t.length),this};y.ByteStringBuffer.prototype.putString=function(t){return this.putBytes(y.encodeUtf8(t))};y.ByteStringBuffer.prototype.putInt16=function(t){return this.putBytes(String.fromCharCode(t>>8&255)+String.fromCharCode(t&255))};y.ByteStringBuffer.prototype.putInt24=function(t){return this.putBytes(String.fromCharCode(t>>16&255)+String.fromCharCode(t>>8&255)+String.fromCharCode(t&255))};y.ByteStringBuffer.prototype.putInt32=function(t){return this.putBytes(String.fromCharCode(t>>24&255)+String.fromCharCode(t>>16&255)+String.fromCharCode(t>>8&255)+String.fromCharCode(t&255))};y.ByteStringBuffer.prototype.putInt16Le=function(t){return this.putBytes(String.fromCharCode(t&255)+String.fromCharCode(t>>8&255))};y.ByteStringBuffer.prototype.putInt24Le=function(t){return this.putBytes(String.fromCharCode(t&255)+String.fromCharCode(t>>8&255)+String.fromCharCode(t>>16&255))};y.ByteStringBuffer.prototype.putInt32Le=function(t){return this.putBytes(String.fromCharCode(t&255)+String.fromCharCode(t>>8&255)+String.fromCharCode(t>>16&255)+String.fromCharCode(t>>24&255))};y.ByteStringBuffer.prototype.putInt=function(t,e){Fn(e);var r="";do e-=8,r+=String.fromCharCode(t>>e&255);while(e>0);return this.putBytes(r)};y.ByteStringBuffer.prototype.putSignedInt=function(t,e){return t<0&&(t+=2<<e-1),this.putInt(t,e)};y.ByteStringBuffer.prototype.putBuffer=function(t){return this.putBytes(t.getBytes())};y.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)};y.ByteStringBuffer.prototype.getInt16=function(){var t=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,t};y.ByteStringBuffer.prototype.getInt24=function(){var t=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,t};y.ByteStringBuffer.prototype.getInt32=function(){var t=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,t};y.ByteStringBuffer.prototype.getInt16Le=function(){var t=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,t};y.ByteStringBuffer.prototype.getInt24Le=function(){var t=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,t};y.ByteStringBuffer.prototype.getInt32Le=function(){var t=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,t};y.ByteStringBuffer.prototype.getInt=function(t){Fn(t);var e=0;do e=(e<<8)+this.data.charCodeAt(this.read++),t-=8;while(t>0);return e};y.ByteStringBuffer.prototype.getSignedInt=function(t){var e=this.getInt(t),r=2<<t-2;return e>=r&&(e-=r<<1),e};y.ByteStringBuffer.prototype.getBytes=function(t){var e;return t?(t=Math.min(this.length(),t),e=this.data.slice(this.read,this.read+t),this.read+=t):t===0?e="":(e=this.read===0?this.data:this.data.slice(this.read),this.clear()),e};y.ByteStringBuffer.prototype.bytes=function(t){return typeof t>"u"?this.data.slice(this.read):this.data.slice(this.read,this.read+t)};y.ByteStringBuffer.prototype.at=function(t){return this.data.charCodeAt(this.read+t)};y.ByteStringBuffer.prototype.setAt=function(t,e){return this.data=this.data.substr(0,this.read+t)+String.fromCharCode(e)+this.data.substr(this.read+t+1),this};y.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)};y.ByteStringBuffer.prototype.copy=function(){var t=y.createBuffer(this.data);return t.read=this.read,t};y.ByteStringBuffer.prototype.compact=function(){return this.read>0&&(this.data=this.data.slice(this.read),this.read=0),this};y.ByteStringBuffer.prototype.clear=function(){return this.data="",this.read=0,this};y.ByteStringBuffer.prototype.truncate=function(t){var e=Math.max(0,this.length()-t);return this.data=this.data.substr(this.read,e),this.read=0,this};y.ByteStringBuffer.prototype.toHex=function(){for(var t="",e=this.read;e<this.data.length;++e){var r=this.data.charCodeAt(e);r<16&&(t+="0"),t+=r.toString(16)}return t};y.ByteStringBuffer.prototype.toString=function(){return y.decodeUtf8(this.bytes())};function ld(t,e){e=e||{},this.read=e.readOffset||0,this.growSize=e.growSize||1024;var r=y.isArrayBuffer(t),n=y.isArrayBufferView(t);if(r||n){r?this.data=new DataView(t):this.data=new DataView(t.buffer,t.byteOffset,t.byteLength),this.write="writeOffset"in e?e.writeOffset:this.data.byteLength;return}this.data=new DataView(new ArrayBuffer(0)),this.write=0,t!=null&&this.putBytes(t),"writeOffset"in e&&(this.write=e.writeOffset)}y.DataBuffer=ld;y.DataBuffer.prototype.length=function(){return this.write-this.read};y.DataBuffer.prototype.isEmpty=function(){return this.length()<=0};y.DataBuffer.prototype.accommodate=function(t,e){if(this.length()>=t)return this;e=Math.max(e||this.growSize,t);var r=new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength),n=new Uint8Array(this.length()+e);return n.set(r),this.data=new DataView(n.buffer),this};y.DataBuffer.prototype.putByte=function(t){return this.accommodate(1),this.data.setUint8(this.write++,t),this};y.DataBuffer.prototype.fillWithByte=function(t,e){this.accommodate(e);for(var r=0;r<e;++r)this.data.setUint8(t);return this};y.DataBuffer.prototype.putBytes=function(t,e){if(y.isArrayBufferView(t)){var r=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),n=r.byteLength-r.byteOffset;this.accommodate(n);var s=new Uint8Array(this.data.buffer,this.write);return s.set(r),this.write+=n,this}if(y.isArrayBuffer(t)){var r=new Uint8Array(t);this.accommodate(r.byteLength);var s=new Uint8Array(this.data.buffer);return s.set(r,this.write),this.write+=r.byteLength,this}if(t instanceof y.DataBuffer||typeof t=="object"&&typeof t.read=="number"&&typeof t.write=="number"&&y.isArrayBufferView(t.data)){var r=new Uint8Array(t.data.byteLength,t.read,t.length());this.accommodate(r.byteLength);var s=new Uint8Array(t.data.byteLength,this.write);return s.set(r),this.write+=r.byteLength,this}if(t instanceof y.ByteStringBuffer&&(t=t.data,e="binary"),e=e||"binary",typeof t=="string"){var i;if(e==="hex")return this.accommodate(Math.ceil(t.length/2)),i=new Uint8Array(this.data.buffer,this.write),this.write+=y.binary.hex.decode(t,i,this.write),this;if(e==="base64")return this.accommodate(Math.ceil(t.length/4)*3),i=new Uint8Array(this.data.buffer,this.write),this.write+=y.binary.base64.decode(t,i,this.write),this;if(e==="utf8"&&(t=y.encodeUtf8(t),e="binary"),e==="binary"||e==="raw")return this.accommodate(t.length),i=new Uint8Array(this.data.buffer,this.write),this.write+=y.binary.raw.decode(i),this;if(e==="utf16")return this.accommodate(t.length*2),i=new Uint16Array(this.data.buffer,this.write),this.write+=y.text.utf16.encode(i),this;throw new Error("Invalid encoding: "+e)}throw Error("Invalid parameter: "+t)};y.DataBuffer.prototype.putBuffer=function(t){return this.putBytes(t),t.clear(),this};y.DataBuffer.prototype.putString=function(t){return this.putBytes(t,"utf16")};y.DataBuffer.prototype.putInt16=function(t){return this.accommodate(2),this.data.setInt16(this.write,t),this.write+=2,this};y.DataBuffer.prototype.putInt24=function(t){return this.accommodate(3),this.data.setInt16(this.write,t>>8&65535),this.data.setInt8(this.write,t>>16&255),this.write+=3,this};y.DataBuffer.prototype.putInt32=function(t){return this.accommodate(4),this.data.setInt32(this.write,t),this.write+=4,this};y.DataBuffer.prototype.putInt16Le=function(t){return this.accommodate(2),this.data.setInt16(this.write,t,!0),this.write+=2,this};y.DataBuffer.prototype.putInt24Le=function(t){return this.accommodate(3),this.data.setInt8(this.write,t>>16&255),this.data.setInt16(this.write,t>>8&65535,!0),this.write+=3,this};y.DataBuffer.prototype.putInt32Le=function(t){return this.accommodate(4),this.data.setInt32(this.write,t,!0),this.write+=4,this};y.DataBuffer.prototype.putInt=function(t,e){Fn(e),this.accommodate(e/8);do e-=8,this.data.setInt8(this.write++,t>>e&255);while(e>0);return this};y.DataBuffer.prototype.putSignedInt=function(t,e){return Fn(e),this.accommodate(e/8),t<0&&(t+=2<<e-1),this.putInt(t,e)};y.DataBuffer.prototype.getByte=function(){return this.data.getInt8(this.read++)};y.DataBuffer.prototype.getInt16=function(){var t=this.data.getInt16(this.read);return this.read+=2,t};y.DataBuffer.prototype.getInt24=function(){var t=this.data.getInt16(this.read)<<8^this.data.getInt8(this.read+2);return this.read+=3,t};y.DataBuffer.prototype.getInt32=function(){var t=this.data.getInt32(this.read);return this.read+=4,t};y.DataBuffer.prototype.getInt16Le=function(){var t=this.data.getInt16(this.read,!0);return this.read+=2,t};y.DataBuffer.prototype.getInt24Le=function(){var t=this.data.getInt8(this.read)^this.data.getInt16(this.read+1,!0)<<8;return this.read+=3,t};y.DataBuffer.prototype.getInt32Le=function(){var t=this.data.getInt32(this.read,!0);return this.read+=4,t};y.DataBuffer.prototype.getInt=function(t){Fn(t);var e=0;do e=(e<<8)+this.data.getInt8(this.read++),t-=8;while(t>0);return e};y.DataBuffer.prototype.getSignedInt=function(t){var e=this.getInt(t),r=2<<t-2;return e>=r&&(e-=r<<1),e};y.DataBuffer.prototype.getBytes=function(t){var e;return t?(t=Math.min(this.length(),t),e=this.data.slice(this.read,this.read+t),this.read+=t):t===0?e="":(e=this.read===0?this.data:this.data.slice(this.read),this.clear()),e};y.DataBuffer.prototype.bytes=function(t){return typeof t>"u"?this.data.slice(this.read):this.data.slice(this.read,this.read+t)};y.DataBuffer.prototype.at=function(t){return this.data.getUint8(this.read+t)};y.DataBuffer.prototype.setAt=function(t,e){return this.data.setUint8(t,e),this};y.DataBuffer.prototype.last=function(){return this.data.getUint8(this.write-1)};y.DataBuffer.prototype.copy=function(){return new y.DataBuffer(this)};y.DataBuffer.prototype.compact=function(){if(this.read>0){var t=new Uint8Array(this.data.buffer,this.read),e=new Uint8Array(t.byteLength);e.set(t),this.data=new DataView(e),this.write-=this.read,this.read=0}return this};y.DataBuffer.prototype.clear=function(){return this.data=new DataView(new ArrayBuffer(0)),this.read=this.write=0,this};y.DataBuffer.prototype.truncate=function(t){return this.write=Math.max(0,this.length()-t),this.read=Math.min(this.read,this.write),this};y.DataBuffer.prototype.toHex=function(){for(var t="",e=this.read;e<this.data.byteLength;++e){var r=this.data.getUint8(e);r<16&&(t+="0"),t+=r.toString(16)}return t};y.DataBuffer.prototype.toString=function(t){var e=new Uint8Array(this.data,this.read,this.length());if(t=t||"utf8",t==="binary"||t==="raw")return y.binary.raw.encode(e);if(t==="hex")return y.binary.hex.encode(e);if(t==="base64")return y.binary.base64.encode(e);if(t==="utf8")return y.text.utf8.decode(e);if(t==="utf16")return y.text.utf16.decode(e);throw new Error("Invalid encoding: "+t)};y.createBuffer=function(t,e){return e=e||"raw",t!==void 0&&e==="utf8"&&(t=y.encodeUtf8(t)),new y.ByteBuffer(t)};y.fillString=function(t,e){for(var r="";e>0;)e&1&&(r+=t),e>>>=1,e>0&&(t+=t);return r};y.xorBytes=function(t,e,r){for(var n="",s="",i="",o=0,a=0;r>0;--r,++o)s=t.charCodeAt(o)^e.charCodeAt(o),a>=10&&(n+=i,i="",a=0),i+=String.fromCharCode(s),++a;return n+=i,n};y.hexToBytes=function(t){var e="",r=0;for(t.length&!0&&(r=1,e+=String.fromCharCode(parseInt(t[0],16)));r<t.length;r+=2)e+=String.fromCharCode(parseInt(t.substr(r,2),16));return e};y.bytesToHex=function(t){return y.createBuffer(t).toHex()};y.int32ToBytes=function(t){return String.fromCharCode(t>>24&255)+String.fromCharCode(t>>16&255)+String.fromCharCode(t>>8&255)+String.fromCharCode(t&255)};var rr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",nr=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],_u="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";y.encode64=function(t,e){for(var r="",n="",s,i,o,a=0;a<t.length;)s=t.charCodeAt(a++),i=t.charCodeAt(a++),o=t.charCodeAt(a++),r+=rr.charAt(s>>2),r+=rr.charAt((s&3)<<4|i>>4),isNaN(i)?r+="==":(r+=rr.charAt((i&15)<<2|o>>6),r+=isNaN(o)?"=":rr.charAt(o&63)),e&&r.length>e&&(n+=r.substr(0,e)+`\r
`,r=r.substr(e));return n+=r,n};y.decode64=function(t){t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var e="",r,n,s,i,o=0;o<t.length;)r=nr[t.charCodeAt(o++)-43],n=nr[t.charCodeAt(o++)-43],s=nr[t.charCodeAt(o++)-43],i=nr[t.charCodeAt(o++)-43],e+=String.fromCharCode(r<<2|n>>4),s!==64&&(e+=String.fromCharCode((n&15)<<4|s>>2),i!==64&&(e+=String.fromCharCode((s&3)<<6|i)));return e};y.encodeUtf8=function(t){return unescape(encodeURIComponent(t))};y.decodeUtf8=function(t){return decodeURIComponent(escape(t))};y.binary={raw:{},hex:{},base64:{},base58:{},baseN:{encode:Iu.encode,decode:Iu.decode}};y.binary.raw.encode=function(t){return String.fromCharCode.apply(null,t)};y.binary.raw.decode=function(t,e,r){var n=e;n||(n=new Uint8Array(t.length)),r=r||0;for(var s=r,i=0;i<t.length;++i)n[s++]=t.charCodeAt(i);return e?s-r:n};y.binary.hex.encode=y.bytesToHex;y.binary.hex.decode=function(t,e,r){var n=e;n||(n=new Uint8Array(Math.ceil(t.length/2))),r=r||0;var s=0,i=r;for(t.length&1&&(s=1,n[i++]=parseInt(t[0],16));s<t.length;s+=2)n[i++]=parseInt(t.substr(s,2),16);return e?i-r:n};y.binary.base64.encode=function(t,e){for(var r="",n="",s,i,o,a=0;a<t.byteLength;)s=t[a++],i=t[a++],o=t[a++],r+=rr.charAt(s>>2),r+=rr.charAt((s&3)<<4|i>>4),isNaN(i)?r+="==":(r+=rr.charAt((i&15)<<2|o>>6),r+=isNaN(o)?"=":rr.charAt(o&63)),e&&r.length>e&&(n+=r.substr(0,e)+`\r
`,r=r.substr(e));return n+=r,n};y.binary.base64.decode=function(t,e,r){var n=e;n||(n=new Uint8Array(Math.ceil(t.length/4)*3)),t=t.replace(/[^A-Za-z0-9\+\/\=]/g,""),r=r||0;for(var s,i,o,a,f=0,u=r;f<t.length;)s=nr[t.charCodeAt(f++)-43],i=nr[t.charCodeAt(f++)-43],o=nr[t.charCodeAt(f++)-43],a=nr[t.charCodeAt(f++)-43],n[u++]=s<<2|i>>4,o!==64&&(n[u++]=(i&15)<<4|o>>2,a!==64&&(n[u++]=(o&3)<<6|a));return e?u-r:n.subarray(0,u)};y.binary.base58.encode=function(t,e){return y.binary.baseN.encode(t,_u,e)};y.binary.base58.decode=function(t,e){return y.binary.baseN.decode(t,_u,e)};y.text={utf8:{},utf16:{}};y.text.utf8.encode=function(t,e,r){t=y.encodeUtf8(t);var n=e;n||(n=new Uint8Array(t.length)),r=r||0;for(var s=r,i=0;i<t.length;++i)n[s++]=t.charCodeAt(i);return e?s-r:n};y.text.utf8.decode=function(t){return y.decodeUtf8(String.fromCharCode.apply(null,t))};y.text.utf16.encode=function(t,e,r){var n=e;n||(n=new Uint8Array(t.length*2));var s=new Uint16Array(n.buffer);r=r||0;for(var i=r,o=r,a=0;a<t.length;++a)s[o++]=t.charCodeAt(a),i+=2;return e?i-r:n};y.text.utf16.decode=function(t){return String.fromCharCode.apply(null,new Uint16Array(t.buffer))};y.deflate=function(t,e,r){if(e=y.decode64(t.deflate(y.encode64(e)).rval),r){var n=2,s=e.charCodeAt(1);s&32&&(n=6),e=e.substring(n,e.length-4)}return e};y.inflate=function(t,e,r){var n=t.inflate(y.encode64(e)).rval;return n===null?null:y.decode64(n)};var No=function(t,e,r){if(!t)throw new Error("WebStorage not available.");var n;if(r===null?n=t.removeItem(e):(r=y.encode64(JSON.stringify(r)),n=t.setItem(e,r)),typeof n<"u"&&n.rval!==!0){var s=new Error(n.error.message);throw s.id=n.error.id,s.name=n.error.name,s}},Lo=function(t,e){if(!t)throw new Error("WebStorage not available.");var r=t.getItem(e);if(t.init)if(r.rval===null){if(r.error){var n=new Error(r.error.message);throw n.id=r.error.id,n.name=r.error.name,n}r=null}else r=r.rval;return r!==null&&(r=JSON.parse(y.decode64(r))),r},pd=function(t,e,r,n){var s=Lo(t,e);s===null&&(s={}),s[r]=n,No(t,e,s)},dd=function(t,e,r){var n=Lo(t,e);return n!==null&&(n=r in n?n[r]:null),n},gd=function(t,e,r){var n=Lo(t,e);if(n!==null&&r in n){delete n[r];var s=!0;for(var i in n){s=!1;break}s&&(n=null),No(t,e,n)}},yd=function(t,e){No(t,e,null)},Ds=function(t,e,r){var n=null;typeof r>"u"&&(r=["web","flash"]);var s,i=!1,o=null;for(var a in r){s=r[a];try{if(s==="flash"||s==="both"){if(e[0]===null)throw new Error("Flash local storage not available.");n=t.apply(this,e),i=s==="flash"}(s==="web"||s==="both")&&(e[0]=localStorage,n=t.apply(this,e),i=!0)}catch(f){o=f}if(i)break}if(!i)throw o;return n};y.setItem=function(t,e,r,n,s){Ds(pd,arguments,s)};y.getItem=function(t,e,r,n){return Ds(dd,arguments,n)};y.removeItem=function(t,e,r,n){Ds(gd,arguments,n)};y.clearItems=function(t,e,r){Ds(yd,arguments,r)};y.isEmpty=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0};y.format=function(t){for(var e=/%./g,r,n,s=0,i=[],o=0;r=e.exec(t);){n=t.substring(o,e.lastIndex-2),n.length>0&&i.push(n),o=e.lastIndex;var a=r[0][1];switch(a){case"s":case"o":s<arguments.length?i.push(arguments[s+++1]):i.push("<?>");break;case"%":i.push("%");break;default:i.push("<%"+a+"?>")}}return i.push(t.substring(o)),i.join("")};y.formatNumber=function(t,e,r,n){var s=t,i=isNaN(e=Math.abs(e))?2:e,o=r===void 0?",":r,a=n===void 0?".":n,f=s<0?"-":"",u=parseInt(s=Math.abs(+s||0).toFixed(i),10)+"",c=u.length>3?u.length%3:0;return f+(c?u.substr(0,c)+a:"")+u.substr(c).replace(/(\d{3})(?=\d)/g,"$1"+a)+(i?o+Math.abs(s-u).toFixed(i).slice(2):"")};y.formatSize=function(t){return t>=1073741824?t=y.formatNumber(t/1073741824,2,".","")+" GiB":t>=1048576?t=y.formatNumber(t/1048576,2,".","")+" MiB":t>=1024?t=y.formatNumber(t/1024,0)+" KiB":t=y.formatNumber(t,0)+" bytes",t};y.bytesFromIP=function(t){return t.indexOf(".")!==-1?y.bytesFromIPv4(t):t.indexOf(":")!==-1?y.bytesFromIPv6(t):null};y.bytesFromIPv4=function(t){if(t=t.split("."),t.length!==4)return null;for(var e=y.createBuffer(),r=0;r<t.length;++r){var n=parseInt(t[r],10);if(isNaN(n))return null;e.putByte(n)}return e.getBytes()};y.bytesFromIPv6=function(t){var e=0;t=t.split(":").filter(function(o){return o.length===0&&++e,!0});for(var r=(8-t.length+e)*2,n=y.createBuffer(),s=0;s<8;++s){if(!t[s]||t[s].length===0){n.fillWithByte(0,r),r=0;continue}var i=y.hexToBytes(t[s]);i.length<2&&n.putByte(0),n.putBytes(i)}return n.getBytes()};y.bytesToIP=function(t){return t.length===4?y.bytesToIPv4(t):t.length===16?y.bytesToIPv6(t):null};y.bytesToIPv4=function(t){if(t.length!==4)return null;for(var e=[],r=0;r<t.length;++r)e.push(t.charCodeAt(r));return e.join(".")};y.bytesToIPv6=function(t){if(t.length!==16)return null;for(var e=[],r=[],n=0,s=0;s<t.length;s+=2){for(var i=y.bytesToHex(t[s]+t[s+1]);i[0]==="0"&&i!=="0";)i=i.substr(1);if(i==="0"){var o=r[r.length-1],a=e.length;!o||a!==o.end+1?r.push({start:a,end:a}):(o.end=a,o.end-o.start>r[n].end-r[n].start&&(n=r.length-1))}e.push(i)}if(r.length>0){var f=r[n];f.end-f.start>0&&(e.splice(f.start,f.end-f.start+1,""),f.start===0&&e.unshift(""),f.end===7&&e.push(""))}return e.join(":")};y.estimateCores=function(t,e){if(typeof t=="function"&&(e=t,t={}),t=t||{},"cores"in y&&!t.update)return e(null,y.cores);if(typeof navigator<"u"&&"hardwareConcurrency"in navigator&&navigator.hardwareConcurrency>0)return y.cores=navigator.hardwareConcurrency,e(null,y.cores);if(typeof Worker>"u")return y.cores=1,e(null,y.cores);if(typeof Blob>"u")return y.cores=2,e(null,y.cores);var r=URL.createObjectURL(new Blob(["(",function(){self.addEventListener("message",function(o){for(var a=Date.now(),f=a+4;Date.now()<f;);self.postMessage({st:a,et:f})})}.toString(),")()"],{type:"application/javascript"}));n([],5,16);function n(o,a,f){if(a===0){var u=Math.floor(o.reduce(function(c,h){return c+h},0)/o.length);return y.cores=Math.max(1,u),URL.revokeObjectURL(r),e(null,y.cores)}s(f,function(c,h){o.push(i(f,h)),n(o,a-1,f)})}function s(o,a){for(var f=[],u=[],c=0;c<o;++c){var h=new Worker(r);h.addEventListener("message",function(l){if(u.push(l.data),u.length===o){for(var d=0;d<o;++d)f[d].terminate();a(null,u)}}),f.push(h)}for(var c=0;c<o;++c)f[c].postMessage(c)}function i(o,a){for(var f=[],u=0;u<o;++u)for(var c=a[u],h=f[u]=[],l=0;l<o;++l)if(u!==l){var d=a[l];(c.st>d.st&&c.st<d.et||d.st>c.st&&d.st<c.et)&&h.push(l)}return f.reduce(function(p,g){return Math.max(p,g.length)},0)}}});var ks=k((Mv,Au)=>{var Un=te();Un.pki=Un.pki||{};var Oo=Au.exports=Un.pki.oids=Un.oids=Un.oids||{};function A(t,e){Oo[t]=e,Oo[e]=t}function ee(t,e){Oo[t]=e}A("1.2.840.113549.1.1.1","rsaEncryption");A("1.2.840.113549.1.1.4","md5WithRSAEncryption");A("1.2.840.113549.1.1.5","sha1WithRSAEncryption");A("1.2.840.113549.1.1.7","RSAES-OAEP");A("1.2.840.113549.1.1.8","mgf1");A("1.2.840.113549.1.1.9","pSpecified");A("1.2.840.113549.1.1.10","RSASSA-PSS");A("1.2.840.113549.1.1.11","sha256WithRSAEncryption");A("1.2.840.113549.1.1.12","sha384WithRSAEncryption");A("1.2.840.113549.1.1.13","sha512WithRSAEncryption");A("1.3.101.112","EdDSA25519");A("1.2.840.10040.4.3","dsa-with-sha1");A("1.3.14.3.2.7","desCBC");A("1.3.14.3.2.26","sha1");A("1.3.14.3.2.29","sha1WithRSASignature");A("2.16.840.1.101.3.4.2.1","sha256");A("2.16.840.1.101.3.4.2.2","sha384");A("2.16.840.1.101.3.4.2.3","sha512");A("2.16.840.1.101.3.4.2.4","sha224");A("2.16.840.1.101.3.4.2.5","sha512-224");A("2.16.840.1.101.3.4.2.6","sha512-256");A("1.2.840.113549.2.2","md2");A("1.2.840.113549.2.5","md5");A("1.2.840.113549.1.7.1","data");A("1.2.840.113549.1.7.2","signedData");A("1.2.840.113549.1.7.3","envelopedData");A("1.2.840.113549.1.7.4","signedAndEnvelopedData");A("1.2.840.113549.1.7.5","digestedData");A("1.2.840.113549.1.7.6","encryptedData");A("1.2.840.113549.1.9.1","emailAddress");A("1.2.840.113549.1.9.2","unstructuredName");A("1.2.840.113549.1.9.3","contentType");A("1.2.840.113549.1.9.4","messageDigest");A("1.2.840.113549.1.9.5","signingTime");A("1.2.840.113549.1.9.6","counterSignature");A("1.2.840.113549.1.9.7","challengePassword");A("1.2.840.113549.1.9.8","unstructuredAddress");A("1.2.840.113549.1.9.14","extensionRequest");A("1.2.840.113549.1.9.20","friendlyName");A("1.2.840.113549.1.9.21","localKeyId");A("1.2.840.113549.1.9.22.1","x509Certificate");A("1.2.840.113549.1.12.10.1.1","keyBag");A("1.2.840.113549.1.12.10.1.2","pkcs8ShroudedKeyBag");A("1.2.840.113549.1.12.10.1.3","certBag");A("1.2.840.113549.1.12.10.1.4","crlBag");A("1.2.840.113549.1.12.10.1.5","secretBag");A("1.2.840.113549.1.12.10.1.6","safeContentsBag");A("1.2.840.113549.1.5.13","pkcs5PBES2");A("1.2.840.113549.1.5.12","pkcs5PBKDF2");A("1.2.840.113549.1.12.1.1","pbeWithSHAAnd128BitRC4");A("1.2.840.113549.1.12.1.2","pbeWithSHAAnd40BitRC4");A("1.2.840.113549.1.12.1.3","pbeWithSHAAnd3-KeyTripleDES-CBC");A("1.2.840.113549.1.12.1.4","pbeWithSHAAnd2-KeyTripleDES-CBC");A("1.2.840.113549.1.12.1.5","pbeWithSHAAnd128BitRC2-CBC");A("1.2.840.113549.1.12.1.6","pbewithSHAAnd40BitRC2-CBC");A("1.2.840.113549.2.7","hmacWithSHA1");A("1.2.840.113549.2.8","hmacWithSHA224");A("1.2.840.113549.2.9","hmacWithSHA256");A("1.2.840.113549.2.10","hmacWithSHA384");A("1.2.840.113549.2.11","hmacWithSHA512");A("1.2.840.113549.3.7","des-EDE3-CBC");A("2.16.840.1.101.3.4.1.2","aes128-CBC");A("2.16.840.1.101.3.4.1.22","aes192-CBC");A("2.16.840.1.101.3.4.1.42","aes256-CBC");A("2.5.4.3","commonName");A("2.5.4.4","surname");A("2.5.4.5","serialNumber");A("2.5.4.6","countryName");A("2.5.4.7","localityName");A("2.5.4.8","stateOrProvinceName");A("2.5.4.9","streetAddress");A("2.5.4.10","organizationName");A("2.5.4.11","organizationalUnitName");A("2.5.4.12","title");A("2.5.4.13","description");A("2.5.4.15","businessCategory");A("2.5.4.17","postalCode");A("2.5.4.42","givenName");A("1.3.6.1.4.1.311.60.2.1.2","jurisdictionOfIncorporationStateOrProvinceName");A("1.3.6.1.4.1.311.60.2.1.3","jurisdictionOfIncorporationCountryName");A("2.16.840.1.113730.1.1","nsCertType");A("2.16.840.1.113730.1.13","nsComment");ee("2.5.29.1","authorityKeyIdentifier");ee("2.5.29.2","keyAttributes");ee("2.5.29.3","certificatePolicies");ee("2.5.29.4","keyUsageRestriction");ee("2.5.29.5","policyMapping");ee("2.5.29.6","subtreesConstraint");ee("2.5.29.7","subjectAltName");ee("2.5.29.8","issuerAltName");ee("2.5.29.9","subjectDirectoryAttributes");ee("2.5.29.10","basicConstraints");ee("2.5.29.11","nameConstraints");ee("2.5.29.12","policyConstraints");ee("2.5.29.13","basicConstraints");A("2.5.29.14","subjectKeyIdentifier");A("2.5.29.15","keyUsage");ee("2.5.29.16","privateKeyUsagePeriod");A("2.5.29.17","subjectAltName");A("2.5.29.18","issuerAltName");A("2.5.29.19","basicConstraints");ee("2.5.29.20","cRLNumber");ee("2.5.29.21","cRLReason");ee("2.5.29.22","expirationDate");ee("2.5.29.23","instructionCode");ee("2.5.29.24","invalidityDate");ee("2.5.29.25","cRLDistributionPoints");ee("2.5.29.26","issuingDistributionPoint");ee("2.5.29.27","deltaCRLIndicator");ee("2.5.29.28","issuingDistributionPoint");ee("2.5.29.29","certificateIssuer");ee("2.5.29.30","nameConstraints");A("2.5.29.31","cRLDistributionPoints");A("2.5.29.32","certificatePolicies");ee("2.5.29.33","policyMappings");ee("2.5.29.34","policyConstraints");A("2.5.29.35","authorityKeyIdentifier");ee("2.5.29.36","policyConstraints");A("2.5.29.37","extKeyUsage");ee("2.5.29.46","freshestCRL");ee("2.5.29.54","inhibitAnyPolicy");A("1.3.6.1.4.1.11129.2.4.2","timestampList");A("1.3.6.1.5.5.7.1.1","authorityInfoAccess");A("1.3.6.1.5.5.7.3.1","serverAuth");A("1.3.6.1.5.5.7.3.2","clientAuth");A("1.3.6.1.5.5.7.3.3","codeSigning");A("1.3.6.1.5.5.7.3.4","emailProtection");A("1.3.6.1.5.5.7.3.8","timeStamping")});var zn=k((Nv,Tu)=>{var ae=te();Se();ks();var B=Tu.exports=ae.asn1=ae.asn1||{};B.Class={UNIVERSAL:0,APPLICATION:64,CONTEXT_SPECIFIC:128,PRIVATE:192};B.Type={NONE:0,BOOLEAN:1,INTEGER:2,BITSTRING:3,OCTETSTRING:4,NULL:5,OID:6,ODESC:7,EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED:11,UTF8:12,ROID:13,SEQUENCE:16,SET:17,PRINTABLESTRING:19,IA5STRING:22,UTCTIME:23,GENERALIZEDTIME:24,BMPSTRING:30};B.create=function(t,e,r,n,s){if(ae.util.isArray(n)){for(var i=[],o=0;o<n.length;++o)n[o]!==void 0&&i.push(n[o]);n=i}var a={tagClass:t,type:e,constructed:r,composed:r||ae.util.isArray(n),value:n};return s&&"bitStringContents"in s&&(a.bitStringContents=s.bitStringContents,a.original=B.copy(a)),a};B.copy=function(t,e){var r;if(ae.util.isArray(t)){r=[];for(var n=0;n<t.length;++n)r.push(B.copy(t[n],e));return r}return typeof t=="string"?t:(r={tagClass:t.tagClass,type:t.type,constructed:t.constructed,composed:t.composed,value:B.copy(t.value,e)},e&&!e.excludeBitStringContents&&(r.bitStringContents=t.bitStringContents),r)};B.equals=function(t,e,r){if(ae.util.isArray(t)){if(!ae.util.isArray(e)||t.length!==e.length)return!1;for(var n=0;n<t.length;++n)if(!B.equals(t[n],e[n]))return!1;return!0}if(typeof t!=typeof e)return!1;if(typeof t=="string")return t===e;var s=t.tagClass===e.tagClass&&t.type===e.type&&t.constructed===e.constructed&&t.composed===e.composed&&B.equals(t.value,e.value);return r&&r.includeBitStringContents&&(s=s&&t.bitStringContents===e.bitStringContents),s};B.getBerValueLength=function(t){var e=t.getByte();if(e!==128){var r,n=e&128;return n?r=t.getInt((e&127)<<3):r=e,r}};function Kn(t,e,r){if(r>e){var n=new Error("Too few bytes to parse DER.");throw n.available=t.length(),n.remaining=e,n.requested=r,n}}var md=function(t,e){var r=t.getByte();if(e--,r!==128){var n,s=r&128;if(!s)n=r;else{var i=r&127;Kn(t,e,i),n=t.getInt(i<<3)}if(n<0)throw new Error("Negative length: "+n);return n}};B.fromDer=function(t,e){e===void 0&&(e={strict:!0,parseAllBytes:!0,decodeBitStrings:!0}),typeof e=="boolean"&&(e={strict:e,parseAllBytes:!0,decodeBitStrings:!0}),"strict"in e||(e.strict=!0),"parseAllBytes"in e||(e.parseAllBytes=!0),"decodeBitStrings"in e||(e.decodeBitStrings=!0),typeof t=="string"&&(t=ae.util.createBuffer(t));var r=t.length(),n=Ms(t,t.length(),0,e);if(e.parseAllBytes&&t.length()!==0){var s=new Error("Unparsed DER bytes remain after ASN.1 parsing.");throw s.byteCount=r,s.remaining=t.length(),s}return n};function Ms(t,e,r,n){var s;Kn(t,e,2);var i=t.getByte();e--;var o=i&192,a=i&31;s=t.length();var f=md(t,e);if(e-=s-t.length(),f!==void 0&&f>e){if(n.strict){var u=new Error("Too few bytes to read ASN.1 value.");throw u.available=t.length(),u.remaining=e,u.requested=f,u}f=e}var c,h,l=(i&32)===32;if(l)if(c=[],f===void 0)for(;;){if(Kn(t,e,2),t.bytes(2)===String.fromCharCode(0,0)){t.getBytes(2),e-=2;break}s=t.length(),c.push(Ms(t,e,r+1,n)),e-=s-t.length()}else for(;f>0;)s=t.length(),c.push(Ms(t,f,r+1,n)),e-=s-t.length(),f-=s-t.length();if(c===void 0&&o===B.Class.UNIVERSAL&&a===B.Type.BITSTRING&&(h=t.bytes(f)),c===void 0&&n.decodeBitStrings&&o===B.Class.UNIVERSAL&&a===B.Type.BITSTRING&&f>1){var d=t.read,p=e,g=0;if(a===B.Type.BITSTRING&&(Kn(t,e,1),g=t.getByte(),e--),g===0)try{s=t.length();var m={strict:!0,decodeBitStrings:!0},v=Ms(t,e,r+1,m),S=s-t.length();e-=S,a==B.Type.BITSTRING&&S++;var C=v.tagClass;S===f&&(C===B.Class.UNIVERSAL||C===B.Class.CONTEXT_SPECIFIC)&&(c=[v])}catch{}c===void 0&&(t.read=d,e=p)}if(c===void 0){if(f===void 0){if(n.strict)throw new Error("Non-constructed ASN.1 object of indefinite length.");f=e}if(a===B.Type.BMPSTRING)for(c="";f>0;f-=2)Kn(t,e,2),c+=String.fromCharCode(t.getInt16()),e-=2;else c=t.getBytes(f),e-=f}var T=h===void 0?null:{bitStringContents:h};return B.create(o,a,l,c,T)}B.toDer=function(t){var e=ae.util.createBuffer(),r=t.tagClass|t.type,n=ae.util.createBuffer(),s=!1;if("bitStringContents"in t&&(s=!0,t.original&&(s=B.equals(t,t.original))),s)n.putBytes(t.bitStringContents);else if(t.composed){t.constructed?r|=32:n.putByte(0);for(var i=0;i<t.value.length;++i)t.value[i]!==void 0&&n.putBuffer(B.toDer(t.value[i]))}else if(t.type===B.Type.BMPSTRING)for(var i=0;i<t.value.length;++i)n.putInt16(t.value.charCodeAt(i));else t.type===B.Type.INTEGER&&t.value.length>1&&(t.value.charCodeAt(0)===0&&!(t.value.charCodeAt(1)&128)||t.value.charCodeAt(0)===255&&(t.value.charCodeAt(1)&128)===128)?n.putBytes(t.value.substr(1)):n.putBytes(t.value);if(e.putByte(r),n.length()<=127)e.putByte(n.length()&127);else{var o=n.length(),a="";do a+=String.fromCharCode(o&255),o=o>>>8;while(o>0);e.putByte(a.length|128);for(var i=a.length-1;i>=0;--i)e.putByte(a.charCodeAt(i))}return e.putBuffer(n),e};B.oidToDer=function(t){var e=t.split("."),r=ae.util.createBuffer();r.putByte(40*parseInt(e[0],10)+parseInt(e[1],10));for(var n,s,i,o,a=2;a<e.length;++a){n=!0,s=[],i=parseInt(e[a],10);do o=i&127,i=i>>>7,n||(o|=128),s.push(o),n=!1;while(i>0);for(var f=s.length-1;f>=0;--f)r.putByte(s[f])}return r};B.derToOid=function(t){var e;typeof t=="string"&&(t=ae.util.createBuffer(t));var r=t.getByte();e=Math.floor(r/40)+"."+r%40;for(var n=0;t.length()>0;)r=t.getByte(),n=n<<7,r&128?n+=r&127:(e+="."+(n+r),n=0);return e};B.utcTimeToDate=function(t){var e=new Date,r=parseInt(t.substr(0,2),10);r=r>=50?1900+r:2e3+r;var n=parseInt(t.substr(2,2),10)-1,s=parseInt(t.substr(4,2),10),i=parseInt(t.substr(6,2),10),o=parseInt(t.substr(8,2),10),a=0;if(t.length>11){var f=t.charAt(10),u=10;f!=="+"&&f!=="-"&&(a=parseInt(t.substr(10,2),10),u+=2)}if(e.setUTCFullYear(r,n,s),e.setUTCHours(i,o,a,0),u&&(f=t.charAt(u),f==="+"||f==="-")){var c=parseInt(t.substr(u+1,2),10),h=parseInt(t.substr(u+4,2),10),l=c*60+h;l*=6e4,f==="+"?e.setTime(+e-l):e.setTime(+e+l)}return e};B.generalizedTimeToDate=function(t){var e=new Date,r=parseInt(t.substr(0,4),10),n=parseInt(t.substr(4,2),10)-1,s=parseInt(t.substr(6,2),10),i=parseInt(t.substr(8,2),10),o=parseInt(t.substr(10,2),10),a=parseInt(t.substr(12,2),10),f=0,u=0,c=!1;t.charAt(t.length-1)==="Z"&&(c=!0);var h=t.length-5,l=t.charAt(h);if(l==="+"||l==="-"){var d=parseInt(t.substr(h+1,2),10),p=parseInt(t.substr(h+4,2),10);u=d*60+p,u*=6e4,l==="+"&&(u*=-1),c=!0}return t.charAt(14)==="."&&(f=parseFloat(t.substr(14),10)*1e3),c?(e.setUTCFullYear(r,n,s),e.setUTCHours(i,o,a,f),e.setTime(+e+u)):(e.setFullYear(r,n,s),e.setHours(i,o,a,f)),e};B.dateToUtcTime=function(t){if(typeof t=="string")return t;var e="",r=[];r.push((""+t.getUTCFullYear()).substr(2)),r.push(""+(t.getUTCMonth()+1)),r.push(""+t.getUTCDate()),r.push(""+t.getUTCHours()),r.push(""+t.getUTCMinutes()),r.push(""+t.getUTCSeconds());for(var n=0;n<r.length;++n)r[n].length<2&&(e+="0"),e+=r[n];return e+="Z",e};B.dateToGeneralizedTime=function(t){if(typeof t=="string")return t;var e="",r=[];r.push(""+t.getUTCFullYear()),r.push(""+(t.getUTCMonth()+1)),r.push(""+t.getUTCDate()),r.push(""+t.getUTCHours()),r.push(""+t.getUTCMinutes()),r.push(""+t.getUTCSeconds());for(var n=0;n<r.length;++n)r[n].length<2&&(e+="0"),e+=r[n];return e+="Z",e};B.integerToDer=function(t){var e=ae.util.createBuffer();if(t>=-128&&t<128)return e.putSignedInt(t,8);if(t>=-32768&&t<32768)return e.putSignedInt(t,16);if(t>=-8388608&&t<8388608)return e.putSignedInt(t,24);if(t>=-2147483648&&t<2147483648)return e.putSignedInt(t,32);var r=new Error("Integer too large; max is 32-bits.");throw r.integer=t,r};B.derToInteger=function(t){typeof t=="string"&&(t=ae.util.createBuffer(t));var e=t.length()*8;if(e>32)throw new Error("Integer too large; max is 32-bits.");return t.getSignedInt(e)};B.validate=function(t,e,r,n){var s=!1;if((t.tagClass===e.tagClass||typeof e.tagClass>"u")&&(t.type===e.type||typeof e.type>"u"))if(t.constructed===e.constructed||typeof e.constructed>"u"){if(s=!0,e.value&&ae.util.isArray(e.value))for(var i=0,o=0;s&&o<e.value.length;++o)s=e.value[o].optional||!1,t.value[i]&&(s=B.validate(t.value[i],e.value[o],r,n),s?++i:e.value[o].optional&&(s=!0)),!s&&n&&n.push("["+e.name+'] Tag class "'+e.tagClass+'", type "'+e.type+'" expected value length "'+e.value.length+'", got "'+t.value.length+'"');if(s&&r&&(e.capture&&(r[e.capture]=t.value),e.captureAsn1&&(r[e.captureAsn1]=t),e.captureBitStringContents&&"bitStringContents"in t&&(r[e.captureBitStringContents]=t.bitStringContents),e.captureBitStringValue&&"bitStringContents"in t)){var a;if(t.bitStringContents.length<2)r[e.captureBitStringValue]="";else{var f=t.bitStringContents.charCodeAt(0);if(f!==0)throw new Error("captureBitStringValue only supported for zero unused bits");r[e.captureBitStringValue]=t.bitStringContents.slice(1)}}}else n&&n.push("["+e.name+'] Expected constructed "'+e.constructed+'", got "'+t.constructed+'"');else n&&(t.tagClass!==e.tagClass&&n.push("["+e.name+'] Expected tag class "'+e.tagClass+'", got "'+t.tagClass+'"'),t.type!==e.type&&n.push("["+e.name+'] Expected type "'+e.type+'", got "'+t.type+'"'));return s};var Bu=/[^\\u0000-\\u00ff]/;B.prettyPrint=function(t,e,r){var n="";e=e||0,r=r||2,e>0&&(n+=`
`);for(var s="",i=0;i<e*r;++i)s+=" ";switch(n+=s+"Tag: ",t.tagClass){case B.Class.UNIVERSAL:n+="Universal:";break;case B.Class.APPLICATION:n+="Application:";break;case B.Class.CONTEXT_SPECIFIC:n+="Context-Specific:";break;case B.Class.PRIVATE:n+="Private:";break}if(t.tagClass===B.Class.UNIVERSAL)switch(n+=t.type,t.type){case B.Type.NONE:n+=" (None)";break;case B.Type.BOOLEAN:n+=" (Boolean)";break;case B.Type.INTEGER:n+=" (Integer)";break;case B.Type.BITSTRING:n+=" (Bit string)";break;case B.Type.OCTETSTRING:n+=" (Octet string)";break;case B.Type.NULL:n+=" (Null)";break;case B.Type.OID:n+=" (Object Identifier)";break;case B.Type.ODESC:n+=" (Object Descriptor)";break;case B.Type.EXTERNAL:n+=" (External or Instance of)";break;case B.Type.REAL:n+=" (Real)";break;case B.Type.ENUMERATED:n+=" (Enumerated)";break;case B.Type.EMBEDDED:n+=" (Embedded PDV)";break;case B.Type.UTF8:n+=" (UTF8)";break;case B.Type.ROID:n+=" (Relative Object Identifier)";break;case B.Type.SEQUENCE:n+=" (Sequence)";break;case B.Type.SET:n+=" (Set)";break;case B.Type.PRINTABLESTRING:n+=" (Printable String)";break;case B.Type.IA5String:n+=" (IA5String (ASCII))";break;case B.Type.UTCTIME:n+=" (UTC time)";break;case B.Type.GENERALIZEDTIME:n+=" (Generalized time)";break;case B.Type.BMPSTRING:n+=" (BMP String)";break}else n+=t.type;if(n+=`
`,n+=s+"Constructed: "+t.constructed+`
`,t.composed){for(var o=0,a="",i=0;i<t.value.length;++i)t.value[i]!==void 0&&(o+=1,a+=B.prettyPrint(t.value[i],e+1,r),i+1<t.value.length&&(a+=","));n+=s+"Sub values: "+o+a}else{if(n+=s+"Value: ",t.type===B.Type.OID){var f=B.derToOid(t.value);n+=f,ae.pki&&ae.pki.oids&&f in ae.pki.oids&&(n+=" ("+ae.pki.oids[f]+") ")}if(t.type===B.Type.INTEGER)try{n+=B.derToInteger(t.value)}catch{n+="0x"+ae.util.bytesToHex(t.value)}else if(t.type===B.Type.BITSTRING){if(t.value.length>1?n+="0x"+ae.util.bytesToHex(t.value.slice(1)):n+="(none)",t.value.length>0){var u=t.value.charCodeAt(0);u==1?n+=" (1 unused bit shown)":u>1&&(n+=" ("+u+" unused bits shown)")}}else if(t.type===B.Type.OCTETSTRING)Bu.test(t.value)||(n+="("+t.value+") "),n+="0x"+ae.util.bytesToHex(t.value);else if(t.type===B.Type.UTF8)try{n+=ae.util.decodeUtf8(t.value)}catch(c){if(c.message==="URI malformed")n+="0x"+ae.util.bytesToHex(t.value)+" (malformed UTF8)";else throw c}else t.type===B.Type.PRINTABLESTRING||t.type===B.Type.IA5String?n+=t.value:Bu.test(t.value)?n+="0x"+ae.util.bytesToHex(t.value):t.value.length===0?n+="[null]":n+=t.value}return n}});var Uo=k((Lv,Pu)=>{var Pe=te();Se();Pu.exports=Pe.cipher=Pe.cipher||{};Pe.cipher.algorithms=Pe.cipher.algorithms||{};Pe.cipher.createCipher=function(t,e){var r=t;if(typeof r=="string"&&(r=Pe.cipher.getAlgorithm(r),r&&(r=r())),!r)throw new Error("Unsupported algorithm: "+t);return new Pe.cipher.BlockCipher({algorithm:r,key:e,decrypt:!1})};Pe.cipher.createDecipher=function(t,e){var r=t;if(typeof r=="string"&&(r=Pe.cipher.getAlgorithm(r),r&&(r=r())),!r)throw new Error("Unsupported algorithm: "+t);return new Pe.cipher.BlockCipher({algorithm:r,key:e,decrypt:!0})};Pe.cipher.registerAlgorithm=function(t,e){t=t.toUpperCase(),Pe.cipher.algorithms[t]=e};Pe.cipher.getAlgorithm=function(t){return t=t.toUpperCase(),t in Pe.cipher.algorithms?Pe.cipher.algorithms[t]:null};var Fo=Pe.cipher.BlockCipher=function(t){this.algorithm=t.algorithm,this.mode=this.algorithm.mode,this.blockSize=this.mode.blockSize,this._finish=!1,this._input=null,this.output=null,this._op=t.decrypt?this.mode.decrypt:this.mode.encrypt,this._decrypt=t.decrypt,this.algorithm.initialize(t)};Fo.prototype.start=function(t){t=t||{};var e={};for(var r in t)e[r]=t[r];e.decrypt=this._decrypt,this._finish=!1,this._input=Pe.util.createBuffer(),this.output=t.output||Pe.util.createBuffer(),this.mode.start(e)};Fo.prototype.update=function(t){for(t&&this._input.putBuffer(t);!this._op.call(this.mode,this._input,this.output,this._finish)&&!this._finish;);this._input.compact()};Fo.prototype.finish=function(t){t&&(this.mode.name==="ECB"||this.mode.name==="CBC")&&(this.mode.pad=function(r){return t(this.blockSize,r,!1)},this.mode.unpad=function(r){return t(this.blockSize,r,!0)});var e={};return e.decrypt=this._decrypt,e.overflow=this._input.length()%this.blockSize,!(!this._decrypt&&this.mode.pad&&!this.mode.pad(this._input,e)||(this._finish=!0,this.update(),this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,e))||this.mode.afterFinish&&!this.mode.afterFinish(this.output,e))}});var zo=k((Ov,Ru)=>{var Re=te();Se();Re.cipher=Re.cipher||{};var V=Ru.exports=Re.cipher.modes=Re.cipher.modes||{};V.ecb=function(t){t=t||{},this.name="ECB",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)};V.ecb.prototype.start=function(t){};V.ecb.prototype.encrypt=function(t,e,r){if(t.length()<this.blockSize&&!(r&&t.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=t.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var n=0;n<this._ints;++n)e.putInt32(this._outBlock[n])};V.ecb.prototype.decrypt=function(t,e,r){if(t.length()<this.blockSize&&!(r&&t.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=t.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var n=0;n<this._ints;++n)e.putInt32(this._outBlock[n])};V.ecb.prototype.pad=function(t,e){var r=t.length()===this.blockSize?this.blockSize:this.blockSize-t.length();return t.fillWithByte(r,r),!0};V.ecb.prototype.unpad=function(t,e){if(e.overflow>0)return!1;var r=t.length(),n=t.at(r-1);return n>this.blockSize<<2?!1:(t.truncate(n),!0)};V.cbc=function(t){t=t||{},this.name="CBC",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)};V.cbc.prototype.start=function(t){if(t.iv===null){if(!this._prev)throw new Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else if("iv"in t)this._iv=Ns(t.iv,this.blockSize),this._prev=this._iv.slice(0);else throw new Error("Invalid IV parameter.")};V.cbc.prototype.encrypt=function(t,e,r){if(t.length()<this.blockSize&&!(r&&t.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=this._prev[n]^t.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(var n=0;n<this._ints;++n)e.putInt32(this._outBlock[n]);this._prev=this._outBlock};V.cbc.prototype.decrypt=function(t,e,r){if(t.length()<this.blockSize&&!(r&&t.length()>0))return!0;for(var n=0;n<this._ints;++n)this._inBlock[n]=t.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(var n=0;n<this._ints;++n)e.putInt32(this._prev[n]^this._outBlock[n]);this._prev=this._inBlock.slice(0)};V.cbc.prototype.pad=function(t,e){var r=t.length()===this.blockSize?this.blockSize:this.blockSize-t.length();return t.fillWithByte(r,r),!0};V.cbc.prototype.unpad=function(t,e){if(e.overflow>0)return!1;var r=t.length(),n=t.at(r-1);return n>this.blockSize<<2?!1:(t.truncate(n),!0)};V.cfb=function(t){t=t||{},this.name="CFB",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialBlock=new Array(this._ints),this._partialOutput=Re.util.createBuffer(),this._partialBytes=0};V.cfb.prototype.start=function(t){if(!("iv"in t))throw new Error("Invalid IV parameter.");this._iv=Ns(t.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};V.cfb.prototype.encrypt=function(t,e,r){var n=t.length();if(n===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize){for(var s=0;s<this._ints;++s)this._inBlock[s]=t.getInt32()^this._outBlock[s],e.putInt32(this._inBlock[s]);return}var i=(this.blockSize-n)%this.blockSize;i>0&&(i=this.blockSize-i),this._partialOutput.clear();for(var s=0;s<this._ints;++s)this._partialBlock[s]=t.getInt32()^this._outBlock[s],this._partialOutput.putInt32(this._partialBlock[s]);if(i>0)t.read-=this.blockSize;else for(var s=0;s<this._ints;++s)this._inBlock[s]=this._partialBlock[s];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),i>0&&!r)return e.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=i,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0};V.cfb.prototype.decrypt=function(t,e,r){var n=t.length();if(n===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize){for(var s=0;s<this._ints;++s)this._inBlock[s]=t.getInt32(),e.putInt32(this._inBlock[s]^this._outBlock[s]);return}var i=(this.blockSize-n)%this.blockSize;i>0&&(i=this.blockSize-i),this._partialOutput.clear();for(var s=0;s<this._ints;++s)this._partialBlock[s]=t.getInt32(),this._partialOutput.putInt32(this._partialBlock[s]^this._outBlock[s]);if(i>0)t.read-=this.blockSize;else for(var s=0;s<this._ints;++s)this._inBlock[s]=this._partialBlock[s];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),i>0&&!r)return e.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=i,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0};V.ofb=function(t){t=t||{},this.name="OFB",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=Re.util.createBuffer(),this._partialBytes=0};V.ofb.prototype.start=function(t){if(!("iv"in t))throw new Error("Invalid IV parameter.");this._iv=Ns(t.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};V.ofb.prototype.encrypt=function(t,e,r){var n=t.length();if(t.length()===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize){for(var s=0;s<this._ints;++s)e.putInt32(t.getInt32()^this._outBlock[s]),this._inBlock[s]=this._outBlock[s];return}var i=(this.blockSize-n)%this.blockSize;i>0&&(i=this.blockSize-i),this._partialOutput.clear();for(var s=0;s<this._ints;++s)this._partialOutput.putInt32(t.getInt32()^this._outBlock[s]);if(i>0)t.read-=this.blockSize;else for(var s=0;s<this._ints;++s)this._inBlock[s]=this._outBlock[s];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),i>0&&!r)return e.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=i,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0};V.ofb.prototype.decrypt=V.ofb.prototype.encrypt;V.ctr=function(t){t=t||{},this.name="CTR",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=Re.util.createBuffer(),this._partialBytes=0};V.ctr.prototype.start=function(t){if(!("iv"in t))throw new Error("Invalid IV parameter.");this._iv=Ns(t.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0};V.ctr.prototype.encrypt=function(t,e,r){var n=t.length();if(n===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize)for(var s=0;s<this._ints;++s)e.putInt32(t.getInt32()^this._outBlock[s]);else{var i=(this.blockSize-n)%this.blockSize;i>0&&(i=this.blockSize-i),this._partialOutput.clear();for(var s=0;s<this._ints;++s)this._partialOutput.putInt32(t.getInt32()^this._outBlock[s]);if(i>0&&(t.read-=this.blockSize),this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),i>0&&!r)return e.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=i,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}Ls(this._inBlock)};V.ctr.prototype.decrypt=V.ctr.prototype.encrypt;V.gcm=function(t){t=t||{},this.name="GCM",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints),this._partialOutput=Re.util.createBuffer(),this._partialBytes=0,this._R=3774873600};V.gcm.prototype.start=function(t){if(!("iv"in t))throw new Error("Invalid IV parameter.");var e=Re.util.createBuffer(t.iv);this._cipherLength=0;var r;if("additionalData"in t?r=Re.util.createBuffer(t.additionalData):r=Re.util.createBuffer(),"tagLength"in t?this._tagLength=t.tagLength:this._tagLength=128,this._tag=null,t.decrypt&&(this._tag=Re.util.createBuffer(t.tag).getBytes(),this._tag.length!==this._tagLength/8))throw new Error("Authentication tag does not match tag length.");this._hashBlock=new Array(this._ints),this.tag=null,this._hashSubkey=new Array(this._ints),this.cipher.encrypt([0,0,0,0],this._hashSubkey),this.componentBits=4,this._m=this.generateHashTable(this._hashSubkey,this.componentBits);var n=e.length();if(n===12)this._j0=[e.getInt32(),e.getInt32(),e.getInt32(),1];else{for(this._j0=[0,0,0,0];e.length()>0;)this._j0=this.ghash(this._hashSubkey,this._j0,[e.getInt32(),e.getInt32(),e.getInt32(),e.getInt32()]);this._j0=this.ghash(this._hashSubkey,this._j0,[0,0].concat(Ko(n*8)))}this._inBlock=this._j0.slice(0),Ls(this._inBlock),this._partialBytes=0,r=Re.util.createBuffer(r),this._aDataLength=Ko(r.length()*8);var s=r.length()%this.blockSize;for(s&&r.fillWithByte(0,this.blockSize-s),this._s=[0,0,0,0];r.length()>0;)this._s=this.ghash(this._hashSubkey,this._s,[r.getInt32(),r.getInt32(),r.getInt32(),r.getInt32()])};V.gcm.prototype.encrypt=function(t,e,r){var n=t.length();if(n===0)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),this._partialBytes===0&&n>=this.blockSize){for(var s=0;s<this._ints;++s)e.putInt32(this._outBlock[s]^=t.getInt32());this._cipherLength+=this.blockSize}else{var i=(this.blockSize-n)%this.blockSize;i>0&&(i=this.blockSize-i),this._partialOutput.clear();for(var s=0;s<this._ints;++s)this._partialOutput.putInt32(t.getInt32()^this._outBlock[s]);if(i<=0||r){if(r){var o=n%this.blockSize;this._cipherLength+=o,this._partialOutput.truncate(this.blockSize-o)}else this._cipherLength+=this.blockSize;for(var s=0;s<this._ints;++s)this._outBlock[s]=this._partialOutput.getInt32();this._partialOutput.read-=this.blockSize}if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),i>0&&!r)return t.read-=this.blockSize,e.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=i,!0;e.putBytes(this._partialOutput.getBytes(n-this._partialBytes)),this._partialBytes=0}this._s=this.ghash(this._hashSubkey,this._s,this._outBlock),Ls(this._inBlock)};V.gcm.prototype.decrypt=function(t,e,r){var n=t.length();if(n<this.blockSize&&!(r&&n>0))return!0;this.cipher.encrypt(this._inBlock,this._outBlock),Ls(this._inBlock),this._hashBlock[0]=t.getInt32(),this._hashBlock[1]=t.getInt32(),this._hashBlock[2]=t.getInt32(),this._hashBlock[3]=t.getInt32(),this._s=this.ghash(this._hashSubkey,this._s,this._hashBlock);for(var s=0;s<this._ints;++s)e.putInt32(this._outBlock[s]^this._hashBlock[s]);n<this.blockSize?this._cipherLength+=n%this.blockSize:this._cipherLength+=this.blockSize};V.gcm.prototype.afterFinish=function(t,e){var r=!0;e.decrypt&&e.overflow&&t.truncate(this.blockSize-e.overflow),this.tag=Re.util.createBuffer();var n=this._aDataLength.concat(Ko(this._cipherLength*8));this._s=this.ghash(this._hashSubkey,this._s,n);var s=[];this.cipher.encrypt(this._j0,s);for(var i=0;i<this._ints;++i)this.tag.putInt32(this._s[i]^s[i]);return this.tag.truncate(this.tag.length()%(this._tagLength/8)),e.decrypt&&this.tag.bytes()!==this._tag&&(r=!1),r};V.gcm.prototype.multiply=function(t,e){for(var r=[0,0,0,0],n=e.slice(0),s=0;s<128;++s){var i=t[s/32|0]&1<<31-s%32;i&&(r[0]^=n[0],r[1]^=n[1],r[2]^=n[2],r[3]^=n[3]),this.pow(n,n)}return r};V.gcm.prototype.pow=function(t,e){for(var r=t[3]&1,n=3;n>0;--n)e[n]=t[n]>>>1|(t[n-1]&1)<<31;e[0]=t[0]>>>1,r&&(e[0]^=this._R)};V.gcm.prototype.tableMultiply=function(t){for(var e=[0,0,0,0],r=0;r<32;++r){var n=r/8|0,s=t[n]>>>(7-r%8)*4&15,i=this._m[r][s];e[0]^=i[0],e[1]^=i[1],e[2]^=i[2],e[3]^=i[3]}return e};V.gcm.prototype.ghash=function(t,e,r){return e[0]^=r[0],e[1]^=r[1],e[2]^=r[2],e[3]^=r[3],this.tableMultiply(e)};V.gcm.prototype.generateHashTable=function(t,e){for(var r=8/e,n=4*r,s=16*r,i=new Array(s),o=0;o<s;++o){var a=[0,0,0,0],f=o/n|0,u=(n-1-o%n)*e;a[f]=1<<e-1<<u,i[o]=this.generateSubHashTable(this.multiply(a,t),e)}return i};V.gcm.prototype.generateSubHashTable=function(t,e){var r=1<<e,n=r>>>1,s=new Array(r);s[n]=t.slice(0);for(var i=n>>>1;i>0;)this.pow(s[2*i],s[i]=[]),i>>=1;for(i=2;i<n;){for(var o=1;o<i;++o){var a=s[i],f=s[o];s[i+o]=[a[0]^f[0],a[1]^f[1],a[2]^f[2],a[3]^f[3]]}i*=2}for(s[0]=[0,0,0,0],i=n+1;i<r;++i){var u=s[i^n];s[i]=[t[0]^u[0],t[1]^u[1],t[2]^u[2],t[3]^u[3]]}return s};function Ns(t,e){if(typeof t=="string"&&(t=Re.util.createBuffer(t)),Re.util.isArray(t)&&t.length>4){var r=t;t=Re.util.createBuffer();for(var n=0;n<r.length;++n)t.putByte(r[n])}if(t.length()<e)throw new Error("Invalid IV length; got "+t.length()+" bytes and expected "+e+" bytes.");if(!Re.util.isArray(t)){for(var s=[],i=e/4,n=0;n<i;++n)s.push(t.getInt32());t=s}return t}function Ls(t){t[t.length-1]=t[t.length-1]+1&4294967295}function Ko(t){return[t/4294967296|0,t&4294967295]}});var Fs=k((Fv,Nu)=>{var ie=te();Uo();zo();Se();Nu.exports=ie.aes=ie.aes||{};ie.aes.startEncrypting=function(t,e,r,n){var s=Os({key:t,output:r,decrypt:!1,mode:n});return s.start(e),s};ie.aes.createEncryptionCipher=function(t,e){return Os({key:t,output:null,decrypt:!1,mode:e})};ie.aes.startDecrypting=function(t,e,r,n){var s=Os({key:t,output:r,decrypt:!0,mode:n});return s.start(e),s};ie.aes.createDecryptionCipher=function(t,e){return Os({key:t,output:null,decrypt:!0,mode:e})};ie.aes.Algorithm=function(t,e){Go||ku();var r=this;r.name=t,r.mode=new e({blockSize:16,cipher:{encrypt:function(n,s){return Vo(r._w,n,s,!1)},decrypt:function(n,s){return Vo(r._w,n,s,!0)}}}),r._init=!1};ie.aes.Algorithm.prototype.initialize=function(t){if(!this._init){var e=t.key,r;if(typeof e=="string"&&(e.length===16||e.length===24||e.length===32))e=ie.util.createBuffer(e);else if(ie.util.isArray(e)&&(e.length===16||e.length===24||e.length===32)){r=e,e=ie.util.createBuffer();for(var n=0;n<r.length;++n)e.putByte(r[n])}if(!ie.util.isArray(e)){r=e,e=[];var s=r.length();if(s===16||s===24||s===32){s=s>>>2;for(var n=0;n<s;++n)e.push(r.getInt32())}}if(!ie.util.isArray(e)||!(e.length===4||e.length===6||e.length===8))throw new Error("Invalid key parameter.");var i=this.mode.name,o=["CFB","OFB","CTR","GCM"].indexOf(i)!==-1;this._w=Mu(e,t.decrypt&&!o),this._init=!0}};ie.aes._expandKey=function(t,e){return Go||ku(),Mu(t,e)};ie.aes._updateBlock=Vo;en("AES-ECB",ie.cipher.modes.ecb);en("AES-CBC",ie.cipher.modes.cbc);en("AES-CFB",ie.cipher.modes.cfb);en("AES-OFB",ie.cipher.modes.ofb);en("AES-CTR",ie.cipher.modes.ctr);en("AES-GCM",ie.cipher.modes.gcm);function en(t,e){var r=function(){return new ie.aes.Algorithm(t,e)};ie.cipher.registerAlgorithm(t,r)}var Go=!1,Jr=4,Fe,qo,Du,Ir,ut;function ku(){Go=!0,Du=[0,1,2,4,8,16,32,64,128,27,54];for(var t=new Array(256),e=0;e<128;++e)t[e]=e<<1,t[e+128]=e+128<<1^283;Fe=new Array(256),qo=new Array(256),Ir=new Array(4),ut=new Array(4);for(var e=0;e<4;++e)Ir[e]=new Array(256),ut[e]=new Array(256);for(var r=0,n=0,s,i,o,a,f,u,c,e=0;e<256;++e){a=n^n<<1^n<<2^n<<3^n<<4,a=a>>8^a&255^99,Fe[r]=a,qo[a]=r,f=t[a],s=t[r],i=t[s],o=t[i],u=f<<24^a<<16^a<<8^(a^f),c=(s^i^o)<<24^(r^o)<<16^(r^i^o)<<8^(r^s^o);for(var h=0;h<4;++h)Ir[h][r]=u,ut[h][a]=c,u=u<<24|u>>>8,c=c<<24|c>>>8;r===0?r=n=1:(r=s^t[t[t[s^o]]],n^=t[t[n]])}}function Mu(t,e){for(var r=t.slice(0),n,s=1,i=r.length,o=i+6+1,a=Jr*o,f=i;f<a;++f)n=r[f-1],f%i===0?(n=Fe[n>>>16&255]<<24^Fe[n>>>8&255]<<16^Fe[n&255]<<8^Fe[n>>>24]^Du[s]<<24,s++):i>6&&f%i===4&&(n=Fe[n>>>24]<<24^Fe[n>>>16&255]<<16^Fe[n>>>8&255]<<8^Fe[n&255]),r[f]=r[f-i]^n;if(e){var u,c=ut[0],h=ut[1],l=ut[2],d=ut[3],p=r.slice(0);a=r.length;for(var f=0,g=a-Jr;f<a;f+=Jr,g-=Jr)if(f===0||f===a-Jr)p[f]=r[g],p[f+1]=r[g+3],p[f+2]=r[g+2],p[f+3]=r[g+1];else for(var m=0;m<Jr;++m)u=r[g+m],p[f+(3&-m)]=c[Fe[u>>>24]]^h[Fe[u>>>16&255]]^l[Fe[u>>>8&255]]^d[Fe[u&255]];r=p}return r}function Vo(t,e,r,n){var s=t.length/4-1,i,o,a,f,u;n?(i=ut[0],o=ut[1],a=ut[2],f=ut[3],u=qo):(i=Ir[0],o=Ir[1],a=Ir[2],f=Ir[3],u=Fe);var c,h,l,d,p,g,m;c=e[0]^t[0],h=e[n?3:1]^t[1],l=e[2]^t[2],d=e[n?1:3]^t[3];for(var v=3,S=1;S<s;++S)p=i[c>>>24]^o[h>>>16&255]^a[l>>>8&255]^f[d&255]^t[++v],g=i[h>>>24]^o[l>>>16&255]^a[d>>>8&255]^f[c&255]^t[++v],m=i[l>>>24]^o[d>>>16&255]^a[c>>>8&255]^f[h&255]^t[++v],d=i[d>>>24]^o[c>>>16&255]^a[h>>>8&255]^f[l&255]^t[++v],c=p,h=g,l=m;r[0]=u[c>>>24]<<24^u[h>>>16&255]<<16^u[l>>>8&255]<<8^u[d&255]^t[++v],r[n?3:1]=u[h>>>24]<<24^u[l>>>16&255]<<16^u[d>>>8&255]<<8^u[c&255]^t[++v],r[2]=u[l>>>24]<<24^u[d>>>16&255]<<16^u[c>>>8&255]<<8^u[h&255]^t[++v],r[n?1:3]=u[d>>>24]<<24^u[c>>>16&255]<<16^u[h>>>8&255]<<8^u[l&255]^t[++v]}function Os(t){t=t||{};var e=(t.mode||"CBC").toUpperCase(),r="AES-"+e,n;t.decrypt?n=ie.cipher.createDecipher(r,t.key):n=ie.cipher.createCipher(r,t.key);var s=n.start;return n.start=function(i,o){var a=null;o instanceof ie.util.ByteBuffer&&(a=o,o={}),o=o||{},o.output=a,o.iv=i,s.call(n,o)},n}});var Fu=k((Uv,Ou)=>{var he=te();Uo();zo();Se();Ou.exports=he.des=he.des||{};he.des.startEncrypting=function(t,e,r,n){var s=Us({key:t,output:r,decrypt:!1,mode:n||(e===null?"ECB":"CBC")});return s.start(e),s};he.des.createEncryptionCipher=function(t,e){return Us({key:t,output:null,decrypt:!1,mode:e})};he.des.startDecrypting=function(t,e,r,n){var s=Us({key:t,output:r,decrypt:!0,mode:n||(e===null?"ECB":"CBC")});return s.start(e),s};he.des.createDecryptionCipher=function(t,e){return Us({key:t,output:null,decrypt:!0,mode:e})};he.des.Algorithm=function(t,e){var r=this;r.name=t,r.mode=new e({blockSize:8,cipher:{encrypt:function(n,s){return Lu(r._keys,n,s,!1)},decrypt:function(n,s){return Lu(r._keys,n,s,!0)}}}),r._init=!1};he.des.Algorithm.prototype.initialize=function(t){if(!this._init){var e=he.util.createBuffer(t.key);if(this.name.indexOf("3DES")===0&&e.length()!==24)throw new Error("Invalid Triple-DES key size: "+e.length()*8);this._keys=Cd(e),this._init=!0}};St("DES-ECB",he.cipher.modes.ecb);St("DES-CBC",he.cipher.modes.cbc);St("DES-CFB",he.cipher.modes.cfb);St("DES-OFB",he.cipher.modes.ofb);St("DES-CTR",he.cipher.modes.ctr);St("3DES-ECB",he.cipher.modes.ecb);St("3DES-CBC",he.cipher.modes.cbc);St("3DES-CFB",he.cipher.modes.cfb);St("3DES-OFB",he.cipher.modes.ofb);St("3DES-CTR",he.cipher.modes.ctr);function St(t,e){var r=function(){return new he.des.Algorithm(t,e)};he.cipher.registerAlgorithm(t,r)}var bd=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],vd=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],xd=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584],wd=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],Sd=[256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080],Ed=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312],Id=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154],_d=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696];function Cd(t){for(var e=[0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964],r=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],n=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],s=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],i=[0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256],o=[0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],a=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],f=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],u=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],c=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488],h=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],l=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],d=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],p=[0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261],g=t.length()>8?3:1,m=[],v=[0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0],S=0,C,T=0;T<g;T++){var x=t.getInt32(),_=t.getInt32();C=(x>>>4^_)&252645135,_^=C,x^=C<<4,C=(_>>>-16^x)&65535,x^=C,_^=C<<-16,C=(x>>>2^_)&858993459,_^=C,x^=C<<2,C=(_>>>-16^x)&65535,x^=C,_^=C<<-16,C=(x>>>1^_)&1431655765,_^=C,x^=C<<1,C=(_>>>8^x)&16711935,x^=C,_^=C<<8,C=(x>>>1^_)&1431655765,_^=C,x^=C<<1,C=x<<8|_>>>20&240,x=_<<24|_<<8&16711680|_>>>8&65280|_>>>24&240,_=C;for(var P=0;P<v.length;++P){v[P]?(x=x<<2|x>>>26,_=_<<2|_>>>26):(x=x<<1|x>>>27,_=_<<1|_>>>27),x&=-15,_&=-15;var O=e[x>>>28]|r[x>>>24&15]|n[x>>>20&15]|s[x>>>16&15]|i[x>>>12&15]|o[x>>>8&15]|a[x>>>4&15],z=f[_>>>28]|u[_>>>24&15]|c[_>>>20&15]|h[_>>>16&15]|l[_>>>12&15]|d[_>>>8&15]|p[_>>>4&15];C=(z>>>16^O)&65535,m[S++]=O^C,m[S++]=z^C<<16}}return m}function Lu(t,e,r,n){var s=t.length===32?3:9,i;s===3?i=n?[30,-2,-2]:[0,32,2]:i=n?[94,62,-2,32,64,2,30,-2,-2]:[0,32,2,62,30,-2,64,96,2];var o,a=e[0],f=e[1];o=(a>>>4^f)&252645135,f^=o,a^=o<<4,o=(a>>>16^f)&65535,f^=o,a^=o<<16,o=(f>>>2^a)&858993459,a^=o,f^=o<<2,o=(f>>>8^a)&16711935,a^=o,f^=o<<8,o=(a>>>1^f)&1431655765,f^=o,a^=o<<1,a=a<<1|a>>>31,f=f<<1|f>>>31;for(var u=0;u<s;u+=3){for(var c=i[u+1],h=i[u+2],l=i[u];l!=c;l+=h){var d=f^t[l],p=(f>>>4|f<<28)^t[l+1];o=a,a=f,f=o^(vd[d>>>24&63]|wd[d>>>16&63]|Ed[d>>>8&63]|_d[d&63]|bd[p>>>24&63]|xd[p>>>16&63]|Sd[p>>>8&63]|Id[p&63])}o=a,a=f,f=o}a=a>>>1|a<<31,f=f>>>1|f<<31,o=(a>>>1^f)&1431655765,f^=o,a^=o<<1,o=(f>>>8^a)&16711935,a^=o,f^=o<<8,o=(f>>>2^a)&858993459,a^=o,f^=o<<2,o=(a>>>16^f)&65535,f^=o,a^=o<<16,o=(a>>>4^f)&252645135,f^=o,a^=o<<4,r[0]=a,r[1]=f}function Us(t){t=t||{};var e=(t.mode||"CBC").toUpperCase(),r="DES-"+e,n;t.decrypt?n=he.cipher.createDecipher(r,t.key):n=he.cipher.createCipher(r,t.key);var s=n.start;return n.start=function(i,o){var a=null;o instanceof he.util.ByteBuffer&&(a=o,o={}),o=o||{},o.output=a,o.iv=i,s.call(n,o)},n}});var _r=k((Kv,Uu)=>{var Ks=te();Uu.exports=Ks.md=Ks.md||{};Ks.md.algorithms=Ks.md.algorithms||{}});var zu=k((zv,Ku)=>{var qt=te();_r();Se();var Ad=Ku.exports=qt.hmac=qt.hmac||{};Ad.create=function(){var t=null,e=null,r=null,n=null,s={};return s.start=function(i,o){if(i!==null)if(typeof i=="string")if(i=i.toLowerCase(),i in qt.md.algorithms)e=qt.md.algorithms[i].create();else throw new Error('Unknown hash algorithm "'+i+'"');else e=i;if(o===null)o=t;else{if(typeof o=="string")o=qt.util.createBuffer(o);else if(qt.util.isArray(o)){var a=o;o=qt.util.createBuffer();for(var f=0;f<a.length;++f)o.putByte(a[f])}var u=o.length();u>e.blockLength&&(e.start(),e.update(o.bytes()),o=e.digest()),r=qt.util.createBuffer(),n=qt.util.createBuffer(),u=o.length();for(var f=0;f<u;++f){var a=o.at(f);r.putByte(54^a),n.putByte(92^a)}if(u<e.blockLength)for(var a=e.blockLength-u,f=0;f<a;++f)r.putByte(54),n.putByte(92);t=o,r=r.bytes(),n=n.bytes()}e.start(),e.update(r)},s.update=function(i){e.update(i)},s.getMac=function(){var i=e.digest().bytes();return e.start(),e.update(n),e.update(i),e.digest()},s.digest=s.getMac,s}});var tn=k(()=>{});var Ho=k((Gv,qu)=>{var Ue=te();zu();_r();Se();var Bd=Ue.pkcs5=Ue.pkcs5||{},Vt;Ue.util.isNodejs&&!Ue.options.usePureJavaScript&&(Vt=tn());qu.exports=Ue.pbkdf2=Bd.pbkdf2=function(t,e,r,n,s,i){if(typeof s=="function"&&(i=s,s=null),Ue.util.isNodejs&&!Ue.options.usePureJavaScript&&Vt.pbkdf2&&(s===null||typeof s!="object")&&(Vt.pbkdf2Sync.length>4||!s||s==="sha1"))return typeof s!="string"&&(s="sha1"),t=Buffer.from(t,"binary"),e=Buffer.from(e,"binary"),i?Vt.pbkdf2Sync.length===4?Vt.pbkdf2(t,e,r,n,function(C,T){if(C)return i(C);i(null,T.toString("binary"))}):Vt.pbkdf2(t,e,r,n,s,function(C,T){if(C)return i(C);i(null,T.toString("binary"))}):Vt.pbkdf2Sync.length===4?Vt.pbkdf2Sync(t,e,r,n).toString("binary"):Vt.pbkdf2Sync(t,e,r,n,s).toString("binary");if((typeof s>"u"||s===null)&&(s="sha1"),typeof s=="string"){if(!(s in Ue.md.algorithms))throw new Error("Unknown hash algorithm: "+s);s=Ue.md[s].create()}var o=s.digestLength;if(n>4294967295*o){var a=new Error("Derived key is too long.");if(i)return i(a);throw a}var f=Math.ceil(n/o),u=n-(f-1)*o,c=Ue.hmac.create();c.start(s,t);var h="",l,d,p;if(!i){for(var g=1;g<=f;++g){c.start(null,null),c.update(e),c.update(Ue.util.int32ToBytes(g)),l=p=c.digest().getBytes();for(var m=2;m<=r;++m)c.start(null,null),c.update(p),d=c.digest().getBytes(),l=Ue.util.xorBytes(l,d,o),p=d;h+=g<f?l:l.substr(0,u)}return h}var g=1,m;function v(){if(g>f)return i(null,h);c.start(null,null),c.update(e),c.update(Ue.util.int32ToBytes(g)),l=p=c.digest().getBytes(),m=2,S()}function S(){if(m<=r)return c.start(null,null),c.update(p),d=c.digest().getBytes(),l=Ue.util.xorBytes(l,d,o),p=d,++m,Ue.util.setImmediate(S);h+=g<f?l:l.substr(0,u),++g,v()}v()}});var Hu=k((Hv,Gu)=>{var qs=te();Se();var Vu=Gu.exports=qs.pem=qs.pem||{};Vu.encode=function(t,e){e=e||{};var r="-----BEGIN "+t.type+`-----\r
`,n;if(t.procType&&(n={name:"Proc-Type",values:[String(t.procType.version),t.procType.type]},r+=zs(n)),t.contentDomain&&(n={name:"Content-Domain",values:[t.contentDomain]},r+=zs(n)),t.dekInfo&&(n={name:"DEK-Info",values:[t.dekInfo.algorithm]},t.dekInfo.parameters&&n.values.push(t.dekInfo.parameters),r+=zs(n)),t.headers)for(var s=0;s<t.headers.length;++s)r+=zs(t.headers[s]);return t.procType&&(r+=`\r
`),r+=qs.util.encode64(t.body,e.maxline||64)+`\r
`,r+="-----END "+t.type+`-----\r
`,r};Vu.decode=function(t){for(var e=[],r=/\s*-----BEGIN ([A-Z0-9- ]+)-----\r?\n?([\x21-\x7e\s]+?(?:\r?\n\r?\n))?([:A-Za-z0-9+\/=\s]+?)-----END \1-----/g,n=/([\x21-\x7e]+):\s*([\x21-\x7e\s^:]+)/,s=/\r?\n/,i;i=r.exec(t),!!i;){var o=i[1];o==="NEW CERTIFICATE REQUEST"&&(o="CERTIFICATE REQUEST");var a={type:o,procType:null,contentDomain:null,dekInfo:null,headers:[],body:qs.util.decode64(i[3])};if(e.push(a),!!i[2]){for(var f=i[2].split(s),u=0;i&&u<f.length;){for(var c=f[u].replace(/\s+$/,""),h=u+1;h<f.length;++h){var l=f[h];if(!/\s/.test(l[0]))break;c+=l,u=h}if(i=c.match(n),i){for(var d={name:i[1],values:[]},p=i[2].split(","),g=0;g<p.length;++g)d.values.push(Td(p[g]));if(a.procType)if(!a.contentDomain&&d.name==="Content-Domain")a.contentDomain=p[0]||"";else if(!a.dekInfo&&d.name==="DEK-Info"){if(d.values.length===0)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must have at least one subfield.');a.dekInfo={algorithm:p[0],parameters:p[1]||null}}else a.headers.push(d);else{if(d.name!=="Proc-Type")throw new Error('Invalid PEM formatted message. The first encapsulated header must be "Proc-Type".');if(d.values.length!==2)throw new Error('Invalid PEM formatted message. The "Proc-Type" header must have two subfields.');a.procType={version:p[0],type:p[1]}}}++u}if(a.procType==="ENCRYPTED"&&!a.dekInfo)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must be present if "Proc-Type" is "ENCRYPTED".')}}if(e.length===0)throw new Error("Invalid PEM formatted message.");return e};function zs(t){for(var e=t.name+": ",r=[],n=function(f,u){return" "+u},s=0;s<t.values.length;++s)r.push(t.values[s].replace(/^(\S+\r\n)/,n));e+=r.join(",")+`\r
`;for(var i=0,o=-1,s=0;s<e.length;++s,++i)if(i>65&&o!==-1){var a=e[o];a===","?(++o,e=e.substr(0,o)+`\r
 `+e.substr(o)):e=e.substr(0,o)+`\r
`+a+e.substr(o+1),i=s-o-1,o=-1,++s}else(e[s]===" "||e[s]==="	"||e[s]===",")&&(o=s);return e}function Td(t){return t.replace(/^\s+/,"")}});var Qu=k((Wv,Yu)=>{var Et=te();_r();Se();var ju=Yu.exports=Et.sha256=Et.sha256||{};Et.md.sha256=Et.md.algorithms.sha256=ju;ju.create=function(){$u||Pd();var t=null,e=Et.util.createBuffer(),r=new Array(64),n={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,fullMessageLength:null,messageLengthSize:8};return n.start=function(){n.messageLength=0,n.fullMessageLength=n.messageLength64=[];for(var s=n.messageLengthSize/4,i=0;i<s;++i)n.fullMessageLength.push(0);return e=Et.util.createBuffer(),t={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225},n},n.start(),n.update=function(s,i){i==="utf8"&&(s=Et.util.encodeUtf8(s));var o=s.length;n.messageLength+=o,o=[o/4294967296>>>0,o>>>0];for(var a=n.fullMessageLength.length-1;a>=0;--a)n.fullMessageLength[a]+=o[1],o[1]=o[0]+(n.fullMessageLength[a]/4294967296>>>0),n.fullMessageLength[a]=n.fullMessageLength[a]>>>0,o[0]=o[1]/4294967296>>>0;return e.putBytes(s),Wu(t,r,e),(e.read>2048||e.length()===0)&&e.compact(),n},n.digest=function(){var s=Et.util.createBuffer();s.putBytes(e.bytes());var i=n.fullMessageLength[n.fullMessageLength.length-1]+n.messageLengthSize,o=i&n.blockLength-1;s.putBytes(Wo.substr(0,n.blockLength-o));for(var a,f,u=n.fullMessageLength[0]*8,c=0;c<n.fullMessageLength.length-1;++c)a=n.fullMessageLength[c+1]*8,f=a/4294967296>>>0,u+=f,s.putInt32(u>>>0),u=a>>>0;s.putInt32(u);var h={h0:t.h0,h1:t.h1,h2:t.h2,h3:t.h3,h4:t.h4,h5:t.h5,h6:t.h6,h7:t.h7};Wu(h,r,s);var l=Et.util.createBuffer();return l.putInt32(h.h0),l.putInt32(h.h1),l.putInt32(h.h2),l.putInt32(h.h3),l.putInt32(h.h4),l.putInt32(h.h5),l.putInt32(h.h6),l.putInt32(h.h7),l},n};var Wo=null,$u=!1,Zu=null;function Pd(){Wo=String.fromCharCode(128),Wo+=Et.util.fillString(String.fromCharCode(0),64),Zu=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],$u=!0}function Wu(t,e,r){for(var n,s,i,o,a,f,u,c,h,l,d,p,g,m,v,S=r.length();S>=64;){for(u=0;u<16;++u)e[u]=r.getInt32();for(;u<64;++u)n=e[u-2],n=(n>>>17|n<<15)^(n>>>19|n<<13)^n>>>10,s=e[u-15],s=(s>>>7|s<<25)^(s>>>18|s<<14)^s>>>3,e[u]=n+e[u-7]+s+e[u-16]|0;for(c=t.h0,h=t.h1,l=t.h2,d=t.h3,p=t.h4,g=t.h5,m=t.h6,v=t.h7,u=0;u<64;++u)o=(p>>>6|p<<26)^(p>>>11|p<<21)^(p>>>25|p<<7),a=m^p&(g^m),i=(c>>>2|c<<30)^(c>>>13|c<<19)^(c>>>22|c<<10),f=c&h|l&(c^h),n=v+o+a+Zu[u]+e[u],s=i+f,v=m,m=g,g=p,p=d+n>>>0,d=l,l=h,h=c,c=n+s>>>0;t.h0=t.h0+c|0,t.h1=t.h1+h|0,t.h2=t.h2+l|0,t.h3=t.h3+d|0,t.h4=t.h4+p|0,t.h5=t.h5+g|0,t.h6=t.h6+m|0,t.h7=t.h7+v|0,S-=64}}});var Ju=k((jv,Xu)=>{var It=te();Se();var Vs=null;It.util.isNodejs&&!It.options.usePureJavaScript&&!process.versions["node-webkit"]&&(Vs=tn());var Rd=Xu.exports=It.prng=It.prng||{};Rd.create=function(t){for(var e={plugin:t,key:null,seed:null,time:null,reseeds:0,generated:0,keyBytes:""},r=t.md,n=new Array(32),s=0;s<32;++s)n[s]=r.create();e.pools=n,e.pool=0,e.generate=function(u,c){if(!c)return e.generateSync(u);var h=e.plugin.cipher,l=e.plugin.increment,d=e.plugin.formatKey,p=e.plugin.formatSeed,g=It.util.createBuffer();e.key=null,m();function m(v){if(v)return c(v);if(g.length()>=u)return c(null,g.getBytes(u));if(e.generated>1048575&&(e.key=null),e.key===null)return It.util.nextTick(function(){i(m)});var S=h(e.key,e.seed);e.generated+=S.length,g.putBytes(S),e.key=d(h(e.key,l(e.seed))),e.seed=p(h(e.key,e.seed)),It.util.setImmediate(m)}},e.generateSync=function(u){var c=e.plugin.cipher,h=e.plugin.increment,l=e.plugin.formatKey,d=e.plugin.formatSeed;e.key=null;for(var p=It.util.createBuffer();p.length()<u;){e.generated>1048575&&(e.key=null),e.key===null&&o();var g=c(e.key,e.seed);e.generated+=g.length,p.putBytes(g),e.key=l(c(e.key,h(e.seed))),e.seed=d(c(e.key,e.seed))}return p.getBytes(u)};function i(u){if(e.pools[0].messageLength>=32)return a(),u();var c=32-e.pools[0].messageLength<<5;e.seedFile(c,function(h,l){if(h)return u(h);e.collect(l),a(),u()})}function o(){if(e.pools[0].messageLength>=32)return a();var u=32-e.pools[0].messageLength<<5;e.collect(e.seedFileSync(u)),a()}function a(){e.reseeds=e.reseeds===4294967295?0:e.reseeds+1;var u=e.plugin.md.create();u.update(e.keyBytes);for(var c=1,h=0;h<32;++h)e.reseeds%c===0&&(u.update(e.pools[h].digest().getBytes()),e.pools[h].start()),c=c<<1;e.keyBytes=u.digest().getBytes(),u.start(),u.update(e.keyBytes);var l=u.digest().getBytes();e.key=e.plugin.formatKey(e.keyBytes),e.seed=e.plugin.formatSeed(l),e.generated=0}function f(u){var c=null,h=It.util.globalScope,l=h.crypto||h.msCrypto;l&&l.getRandomValues&&(c=function(x){return l.getRandomValues(x)});var d=It.util.createBuffer();if(c)for(;d.length()<u;){var p=Math.max(1,Math.min(u-d.length(),65536)/4),g=new Uint32Array(Math.floor(p));try{c(g);for(var m=0;m<g.length;++m)d.putInt32(g[m])}catch(x){if(!(typeof QuotaExceededError<"u"&&x instanceof QuotaExceededError))throw x}}if(d.length()<u)for(var v,S,C,T=Math.floor(Math.random()*65536);d.length()<u;){S=16807*(T&65535),v=16807*(T>>16),S+=(v&32767)<<16,S+=v>>15,S=(S&2147483647)+(S>>31),T=S&4294967295;for(var m=0;m<3;++m)C=T>>>(m<<3),C^=Math.floor(Math.random()*256),d.putByte(C&255)}return d.getBytes(u)}return Vs?(e.seedFile=function(u,c){Vs.randomBytes(u,function(h,l){if(h)return c(h);c(null,l.toString())})},e.seedFileSync=function(u){return Vs.randomBytes(u).toString()}):(e.seedFile=function(u,c){try{c(null,f(u))}catch(h){c(h)}},e.seedFileSync=f),e.collect=function(u){for(var c=u.length,h=0;h<c;++h)e.pools[e.pool].update(u.substr(h,1)),e.pool=e.pool===31?0:e.pool+1},e.collectInt=function(u,c){for(var h="",l=0;l<c;l+=8)h+=String.fromCharCode(u>>l&255);e.collect(h)},e.registerWorker=function(u){if(u===self)e.seedFile=function(h,l){function d(p){var g=p.data;g.forge&&g.forge.prng&&(self.removeEventListener("message",d),l(g.forge.prng.err,g.forge.prng.bytes))}self.addEventListener("message",d),self.postMessage({forge:{prng:{needed:h}}})};else{var c=function(h){var l=h.data;l.forge&&l.forge.prng&&e.seedFile(l.forge.prng.needed,function(d,p){u.postMessage({forge:{prng:{err:d,bytes:p}}})})};u.addEventListener("message",c)}},e}});var qn=k(($v,jo)=>{var De=te();Fs();Qu();Ju();Se();(function(){if(De.random&&De.random.getBytes){jo.exports=De.random;return}(function(t){var e={},r=new Array(4),n=De.util.createBuffer();e.formatKey=function(h){var l=De.util.createBuffer(h);return h=new Array(4),h[0]=l.getInt32(),h[1]=l.getInt32(),h[2]=l.getInt32(),h[3]=l.getInt32(),De.aes._expandKey(h,!1)},e.formatSeed=function(h){var l=De.util.createBuffer(h);return h=new Array(4),h[0]=l.getInt32(),h[1]=l.getInt32(),h[2]=l.getInt32(),h[3]=l.getInt32(),h},e.cipher=function(h,l){return De.aes._updateBlock(h,l,r,!1),n.putInt32(r[0]),n.putInt32(r[1]),n.putInt32(r[2]),n.putInt32(r[3]),n.getBytes()},e.increment=function(h){return++h[3],h},e.md=De.md.sha256;function s(){var h=De.prng.create(e);return h.getBytes=function(l,d){return h.generate(l,d)},h.getBytesSync=function(l){return h.generate(l)},h}var i=s(),o=null,a=De.util.globalScope,f=a.crypto||a.msCrypto;if(f&&f.getRandomValues&&(o=function(h){return f.getRandomValues(h)}),De.options.usePureJavaScript||!De.util.isNodejs&&!o){if(typeof window>"u"||window.document,i.collectInt(+new Date,32),typeof navigator<"u"){var u="";for(var c in navigator)try{typeof navigator[c]=="string"&&(u+=navigator[c])}catch{}i.collect(u),u=null}t&&(t().mousemove(function(h){i.collectInt(h.clientX,16),i.collectInt(h.clientY,16)}),t().keypress(function(h){i.collectInt(h.charCode,8)}))}if(!De.random)De.random=i;else for(var c in i)De.random[c]=i[c];De.random.createInstance=s,jo.exports=De.random})(typeof jQuery<"u"?jQuery:null)})()});var nf=k((Zv,rf)=>{var Ve=te();Se();var $o=[217,120,249,196,25,221,181,237,40,233,253,121,74,160,216,157,198,126,55,131,43,118,83,142,98,76,100,136,68,139,251,162,23,154,89,245,135,179,79,19,97,69,109,141,9,129,125,50,189,143,64,235,134,183,123,11,240,149,33,34,92,107,78,130,84,214,101,147,206,96,178,28,115,86,192,20,167,140,241,220,18,117,202,31,59,190,228,209,66,61,212,48,163,60,182,38,111,191,14,218,70,105,7,87,39,242,29,155,188,148,67,3,248,17,199,246,144,239,62,231,6,195,213,47,200,102,30,215,8,232,234,222,128,82,238,247,132,170,114,172,53,77,106,42,150,26,210,113,90,21,73,116,75,159,208,94,4,24,164,236,194,224,65,110,15,81,203,204,36,145,175,80,161,244,112,57,153,124,58,133,35,184,180,122,252,2,54,91,37,85,151,49,45,93,250,152,227,138,146,174,5,223,41,16,103,108,186,201,211,0,230,207,225,158,168,44,99,22,1,63,88,226,137,169,13,56,52,27,171,51,255,176,187,72,12,95,185,177,205,46,197,243,219,71,229,165,156,119,10,166,32,104,254,127,193,173],ef=[1,2,3,5],Dd=function(t,e){return t<<e&65535|(t&65535)>>16-e},kd=function(t,e){return(t&65535)>>e|t<<16-e&65535};rf.exports=Ve.rc2=Ve.rc2||{};Ve.rc2.expandKey=function(t,e){typeof t=="string"&&(t=Ve.util.createBuffer(t)),e=e||128;var r=t,n=t.length(),s=e,i=Math.ceil(s/8),o=255>>(s&7),a;for(a=n;a<128;a++)r.putByte($o[r.at(a-1)+r.at(a-n)&255]);for(r.setAt(128-i,$o[r.at(128-i)&o]),a=127-i;a>=0;a--)r.setAt(a,$o[r.at(a+1)^r.at(a+i)]);return r};var tf=function(t,e,r){var n=!1,s=null,i=null,o=null,a,f,u,c,h=[];for(t=Ve.rc2.expandKey(t,e),u=0;u<64;u++)h.push(t.getInt16Le());r?(a=function(p){for(u=0;u<4;u++)p[u]+=h[c]+(p[(u+3)%4]&p[(u+2)%4])+(~p[(u+3)%4]&p[(u+1)%4]),p[u]=Dd(p[u],ef[u]),c++},f=function(p){for(u=0;u<4;u++)p[u]+=h[p[(u+3)%4]&63]}):(a=function(p){for(u=3;u>=0;u--)p[u]=kd(p[u],ef[u]),p[u]-=h[c]+(p[(u+3)%4]&p[(u+2)%4])+(~p[(u+3)%4]&p[(u+1)%4]),c--},f=function(p){for(u=3;u>=0;u--)p[u]-=h[p[(u+3)%4]&63]});var l=function(p){var g=[];for(u=0;u<4;u++){var m=s.getInt16Le();o!==null&&(r?m^=o.getInt16Le():o.putInt16Le(m)),g.push(m&65535)}c=r?0:63;for(var v=0;v<p.length;v++)for(var S=0;S<p[v][0];S++)p[v][1](g);for(u=0;u<4;u++)o!==null&&(r?o.putInt16Le(g[u]):g[u]^=o.getInt16Le()),i.putInt16Le(g[u])},d=null;return d={start:function(p,g){p&&typeof p=="string"&&(p=Ve.util.createBuffer(p)),n=!1,s=Ve.util.createBuffer(),i=g||new Ve.util.createBuffer,o=p,d.output=i},update:function(p){for(n||s.putBuffer(p);s.length()>=8;)l([[5,a],[1,f],[6,a],[1,f],[5,a]])},finish:function(p){var g=!0;if(r)if(p)g=p(8,s,!r);else{var m=s.length()===8?8:8-s.length();s.fillWithByte(m,m)}if(g&&(n=!0,d.update()),!r&&(g=s.length()===0,g))if(p)g=p(8,i,!r);else{var v=i.length(),S=i.at(v-1);S>v?g=!1:i.truncate(S)}return g}},d};Ve.rc2.startEncrypting=function(t,e,r){var n=Ve.rc2.createEncryptionCipher(t,128);return n.start(e,r),n};Ve.rc2.createEncryptionCipher=function(t,e){return tf(t,e,!0)};Ve.rc2.startDecrypting=function(t,e,r){var n=Ve.rc2.createDecryptionCipher(t,128);return n.start(e,r),n};Ve.rc2.createDecryptionCipher=function(t,e){return tf(t,e,!1)}});var Ws=k((Yv,lf)=>{var Zo=te();lf.exports=Zo.jsbn=Zo.jsbn||{};var Gt,Md=0xdeadbeefcafe,sf=(Md&16777215)==15715070;function E(t,e,r){this.data=[],t!=null&&(typeof t=="number"?this.fromNumber(t,e,r):e==null&&typeof t!="string"?this.fromString(t,256):this.fromString(t,e))}Zo.jsbn.BigInteger=E;function Y(){return new E(null)}function Nd(t,e,r,n,s,i){for(;--i>=0;){var o=e*this.data[t++]+r.data[n]+s;s=Math.floor(o/67108864),r.data[n++]=o&67108863}return s}function Ld(t,e,r,n,s,i){for(var o=e&32767,a=e>>15;--i>=0;){var f=this.data[t]&32767,u=this.data[t++]>>15,c=a*f+u*o;f=o*f+((c&32767)<<15)+r.data[n]+(s&1073741823),s=(f>>>30)+(c>>>15)+a*u+(s>>>30),r.data[n++]=f&1073741823}return s}function of(t,e,r,n,s,i){for(var o=e&16383,a=e>>14;--i>=0;){var f=this.data[t]&16383,u=this.data[t++]>>14,c=a*f+u*o;f=o*f+((c&16383)<<14)+r.data[n]+s,s=(f>>28)+(c>>14)+a*u,r.data[n++]=f&268435455}return s}typeof navigator>"u"?(E.prototype.am=of,Gt=28):sf&&navigator.appName=="Microsoft Internet Explorer"?(E.prototype.am=Ld,Gt=30):sf&&navigator.appName!="Netscape"?(E.prototype.am=Nd,Gt=26):(E.prototype.am=of,Gt=28);E.prototype.DB=Gt;E.prototype.DM=(1<<Gt)-1;E.prototype.DV=1<<Gt;var Yo=52;E.prototype.FV=Math.pow(2,Yo);E.prototype.F1=Yo-Gt;E.prototype.F2=2*Gt-Yo;var Od="0123456789abcdefghijklmnopqrstuvwxyz",Gs=new Array,rn,Je;rn="0".charCodeAt(0);for(Je=0;Je<=9;++Je)Gs[rn++]=Je;rn="a".charCodeAt(0);for(Je=10;Je<36;++Je)Gs[rn++]=Je;rn="A".charCodeAt(0);for(Je=10;Je<36;++Je)Gs[rn++]=Je;function af(t){return Od.charAt(t)}function cf(t,e){var r=Gs[t.charCodeAt(e)];return r??-1}function Fd(t){for(var e=this.t-1;e>=0;--e)t.data[e]=this.data[e];t.t=this.t,t.s=this.s}function Ud(t){this.t=1,this.s=t<0?-1:0,t>0?this.data[0]=t:t<-1?this.data[0]=t+this.DV:this.t=0}function sr(t){var e=Y();return e.fromInt(t),e}function Kd(t,e){var r;if(e==16)r=4;else if(e==8)r=3;else if(e==256)r=8;else if(e==2)r=1;else if(e==32)r=5;else if(e==4)r=2;else{this.fromRadix(t,e);return}this.t=0,this.s=0;for(var n=t.length,s=!1,i=0;--n>=0;){var o=r==8?t[n]&255:cf(t,n);if(o<0){t.charAt(n)=="-"&&(s=!0);continue}s=!1,i==0?this.data[this.t++]=o:i+r>this.DB?(this.data[this.t-1]|=(o&(1<<this.DB-i)-1)<<i,this.data[this.t++]=o>>this.DB-i):this.data[this.t-1]|=o<<i,i+=r,i>=this.DB&&(i-=this.DB)}r==8&&t[0]&128&&(this.s=-1,i>0&&(this.data[this.t-1]|=(1<<this.DB-i)-1<<i)),this.clamp(),s&&E.ZERO.subTo(this,this)}function zd(){for(var t=this.s&this.DM;this.t>0&&this.data[this.t-1]==t;)--this.t}function qd(t){if(this.s<0)return"-"+this.negate().toString(t);var e;if(t==16)e=4;else if(t==8)e=3;else if(t==2)e=1;else if(t==32)e=5;else if(t==4)e=2;else return this.toRadix(t);var r=(1<<e)-1,n,s=!1,i="",o=this.t,a=this.DB-o*this.DB%e;if(o-- >0)for(a<this.DB&&(n=this.data[o]>>a)>0&&(s=!0,i=af(n));o>=0;)a<e?(n=(this.data[o]&(1<<a)-1)<<e-a,n|=this.data[--o]>>(a+=this.DB-e)):(n=this.data[o]>>(a-=e)&r,a<=0&&(a+=this.DB,--o)),n>0&&(s=!0),s&&(i+=af(n));return s?i:"0"}function Vd(){var t=Y();return E.ZERO.subTo(this,t),t}function Gd(){return this.s<0?this.negate():this}function Hd(t){var e=this.s-t.s;if(e!=0)return e;var r=this.t;if(e=r-t.t,e!=0)return this.s<0?-e:e;for(;--r>=0;)if((e=this.data[r]-t.data[r])!=0)return e;return 0}function Hs(t){var e=1,r;return(r=t>>>16)!=0&&(t=r,e+=16),(r=t>>8)!=0&&(t=r,e+=8),(r=t>>4)!=0&&(t=r,e+=4),(r=t>>2)!=0&&(t=r,e+=2),(r=t>>1)!=0&&(t=r,e+=1),e}function Wd(){return this.t<=0?0:this.DB*(this.t-1)+Hs(this.data[this.t-1]^this.s&this.DM)}function jd(t,e){var r;for(r=this.t-1;r>=0;--r)e.data[r+t]=this.data[r];for(r=t-1;r>=0;--r)e.data[r]=0;e.t=this.t+t,e.s=this.s}function $d(t,e){for(var r=t;r<this.t;++r)e.data[r-t]=this.data[r];e.t=Math.max(this.t-t,0),e.s=this.s}function Zd(t,e){var r=t%this.DB,n=this.DB-r,s=(1<<n)-1,i=Math.floor(t/this.DB),o=this.s<<r&this.DM,a;for(a=this.t-1;a>=0;--a)e.data[a+i+1]=this.data[a]>>n|o,o=(this.data[a]&s)<<r;for(a=i-1;a>=0;--a)e.data[a]=0;e.data[i]=o,e.t=this.t+i+1,e.s=this.s,e.clamp()}function Yd(t,e){e.s=this.s;var r=Math.floor(t/this.DB);if(r>=this.t){e.t=0;return}var n=t%this.DB,s=this.DB-n,i=(1<<n)-1;e.data[0]=this.data[r]>>n;for(var o=r+1;o<this.t;++o)e.data[o-r-1]|=(this.data[o]&i)<<s,e.data[o-r]=this.data[o]>>n;n>0&&(e.data[this.t-r-1]|=(this.s&i)<<s),e.t=this.t-r,e.clamp()}function Qd(t,e){for(var r=0,n=0,s=Math.min(t.t,this.t);r<s;)n+=this.data[r]-t.data[r],e.data[r++]=n&this.DM,n>>=this.DB;if(t.t<this.t){for(n-=t.s;r<this.t;)n+=this.data[r],e.data[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<t.t;)n-=t.data[r],e.data[r++]=n&this.DM,n>>=this.DB;n-=t.s}e.s=n<0?-1:0,n<-1?e.data[r++]=this.DV+n:n>0&&(e.data[r++]=n),e.t=r,e.clamp()}function Xd(t,e){var r=this.abs(),n=t.abs(),s=r.t;for(e.t=s+n.t;--s>=0;)e.data[s]=0;for(s=0;s<n.t;++s)e.data[s+r.t]=r.am(0,n.data[s],e,s,0,r.t);e.s=0,e.clamp(),this.s!=t.s&&E.ZERO.subTo(e,e)}function Jd(t){for(var e=this.abs(),r=t.t=2*e.t;--r>=0;)t.data[r]=0;for(r=0;r<e.t-1;++r){var n=e.am(r,e.data[r],t,2*r,0,1);(t.data[r+e.t]+=e.am(r+1,2*e.data[r],t,2*r+1,n,e.t-r-1))>=e.DV&&(t.data[r+e.t]-=e.DV,t.data[r+e.t+1]=1)}t.t>0&&(t.data[t.t-1]+=e.am(r,e.data[r],t,2*r,0,1)),t.s=0,t.clamp()}function eg(t,e,r){var n=t.abs();if(!(n.t<=0)){var s=this.abs();if(s.t<n.t){e?.fromInt(0),r!=null&&this.copyTo(r);return}r==null&&(r=Y());var i=Y(),o=this.s,a=t.s,f=this.DB-Hs(n.data[n.t-1]);f>0?(n.lShiftTo(f,i),s.lShiftTo(f,r)):(n.copyTo(i),s.copyTo(r));var u=i.t,c=i.data[u-1];if(c!=0){var h=c*(1<<this.F1)+(u>1?i.data[u-2]>>this.F2:0),l=this.FV/h,d=(1<<this.F1)/h,p=1<<this.F2,g=r.t,m=g-u,v=e??Y();for(i.dlShiftTo(m,v),r.compareTo(v)>=0&&(r.data[r.t++]=1,r.subTo(v,r)),E.ONE.dlShiftTo(u,v),v.subTo(i,i);i.t<u;)i.data[i.t++]=0;for(;--m>=0;){var S=r.data[--g]==c?this.DM:Math.floor(r.data[g]*l+(r.data[g-1]+p)*d);if((r.data[g]+=i.am(0,S,r,m,0,u))<S)for(i.dlShiftTo(m,v),r.subTo(v,r);r.data[g]<--S;)r.subTo(v,r)}e!=null&&(r.drShiftTo(u,e),o!=a&&E.ZERO.subTo(e,e)),r.t=u,r.clamp(),f>0&&r.rShiftTo(f,r),o<0&&E.ZERO.subTo(r,r)}}}function tg(t){var e=Y();return this.abs().divRemTo(t,null,e),this.s<0&&e.compareTo(E.ZERO)>0&&t.subTo(e,e),e}function Cr(t){this.m=t}function rg(t){return t.s<0||t.compareTo(this.m)>=0?t.mod(this.m):t}function ng(t){return t}function sg(t){t.divRemTo(this.m,null,t)}function ig(t,e,r){t.multiplyTo(e,r),this.reduce(r)}function og(t,e){t.squareTo(e),this.reduce(e)}Cr.prototype.convert=rg;Cr.prototype.revert=ng;Cr.prototype.reduce=sg;Cr.prototype.mulTo=ig;Cr.prototype.sqrTo=og;function ag(){if(this.t<1)return 0;var t=this.data[0];if(!(t&1))return 0;var e=t&3;return e=e*(2-(t&15)*e)&15,e=e*(2-(t&255)*e)&255,e=e*(2-((t&65535)*e&65535))&65535,e=e*(2-t*e%this.DV)%this.DV,e>0?this.DV-e:-e}function Ar(t){this.m=t,this.mp=t.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function cg(t){var e=Y();return t.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),t.s<0&&e.compareTo(E.ZERO)>0&&this.m.subTo(e,e),e}function ug(t){var e=Y();return t.copyTo(e),this.reduce(e),e}function fg(t){for(;t.t<=this.mt2;)t.data[t.t++]=0;for(var e=0;e<this.m.t;++e){var r=t.data[e]&32767,n=r*this.mpl+((r*this.mph+(t.data[e]>>15)*this.mpl&this.um)<<15)&t.DM;for(r=e+this.m.t,t.data[r]+=this.m.am(0,n,t,e,0,this.m.t);t.data[r]>=t.DV;)t.data[r]-=t.DV,t.data[++r]++}t.clamp(),t.drShiftTo(this.m.t,t),t.compareTo(this.m)>=0&&t.subTo(this.m,t)}function hg(t,e){t.squareTo(e),this.reduce(e)}function lg(t,e,r){t.multiplyTo(e,r),this.reduce(r)}Ar.prototype.convert=cg;Ar.prototype.revert=ug;Ar.prototype.reduce=fg;Ar.prototype.mulTo=lg;Ar.prototype.sqrTo=hg;function pg(){return(this.t>0?this.data[0]&1:this.s)==0}function dg(t,e){if(t>4294967295||t<1)return E.ONE;var r=Y(),n=Y(),s=e.convert(this),i=Hs(t)-1;for(s.copyTo(r);--i>=0;)if(e.sqrTo(r,n),(t&1<<i)>0)e.mulTo(n,s,r);else{var o=r;r=n,n=o}return e.revert(r)}function gg(t,e){var r;return t<256||e.isEven()?r=new Cr(e):r=new Ar(e),this.exp(t,r)}E.prototype.copyTo=Fd;E.prototype.fromInt=Ud;E.prototype.fromString=Kd;E.prototype.clamp=zd;E.prototype.dlShiftTo=jd;E.prototype.drShiftTo=$d;E.prototype.lShiftTo=Zd;E.prototype.rShiftTo=Yd;E.prototype.subTo=Qd;E.prototype.multiplyTo=Xd;E.prototype.squareTo=Jd;E.prototype.divRemTo=eg;E.prototype.invDigit=ag;E.prototype.isEven=pg;E.prototype.exp=dg;E.prototype.toString=qd;E.prototype.negate=Vd;E.prototype.abs=Gd;E.prototype.compareTo=Hd;E.prototype.bitLength=Wd;E.prototype.mod=tg;E.prototype.modPowInt=gg;E.ZERO=sr(0);E.ONE=sr(1);function yg(){var t=Y();return this.copyTo(t),t}function mg(){if(this.s<0){if(this.t==1)return this.data[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this.data[0];if(this.t==0)return 0}return(this.data[1]&(1<<32-this.DB)-1)<<this.DB|this.data[0]}function bg(){return this.t==0?this.s:this.data[0]<<24>>24}function vg(){return this.t==0?this.s:this.data[0]<<16>>16}function xg(t){return Math.floor(Math.LN2*this.DB/Math.log(t))}function wg(){return this.s<0?-1:this.t<=0||this.t==1&&this.data[0]<=0?0:1}function Sg(t){if(t==null&&(t=10),this.signum()==0||t<2||t>36)return"0";var e=this.chunkSize(t),r=Math.pow(t,e),n=sr(r),s=Y(),i=Y(),o="";for(this.divRemTo(n,s,i);s.signum()>0;)o=(r+i.intValue()).toString(t).substr(1)+o,s.divRemTo(n,s,i);return i.intValue().toString(t)+o}function Eg(t,e){this.fromInt(0),e==null&&(e=10);for(var r=this.chunkSize(e),n=Math.pow(e,r),s=!1,i=0,o=0,a=0;a<t.length;++a){var f=cf(t,a);if(f<0){t.charAt(a)=="-"&&this.signum()==0&&(s=!0);continue}o=e*o+f,++i>=r&&(this.dMultiply(n),this.dAddOffset(o,0),i=0,o=0)}i>0&&(this.dMultiply(Math.pow(e,i)),this.dAddOffset(o,0)),s&&E.ZERO.subTo(this,this)}function Ig(t,e,r){if(typeof e=="number")if(t<2)this.fromInt(1);else for(this.fromNumber(t,r),this.testBit(t-1)||this.bitwiseTo(E.ONE.shiftLeft(t-1),Qo,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(e);)this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(E.ONE.shiftLeft(t-1),this);else{var n=new Array,s=t&7;n.length=(t>>3)+1,e.nextBytes(n),s>0?n[0]&=(1<<s)-1:n[0]=0,this.fromString(n,256)}}function _g(){var t=this.t,e=new Array;e[0]=this.s;var r=this.DB-t*this.DB%8,n,s=0;if(t-- >0)for(r<this.DB&&(n=this.data[t]>>r)!=(this.s&this.DM)>>r&&(e[s++]=n|this.s<<this.DB-r);t>=0;)r<8?(n=(this.data[t]&(1<<r)-1)<<8-r,n|=this.data[--t]>>(r+=this.DB-8)):(n=this.data[t]>>(r-=8)&255,r<=0&&(r+=this.DB,--t)),n&128&&(n|=-256),s==0&&(this.s&128)!=(n&128)&&++s,(s>0||n!=this.s)&&(e[s++]=n);return e}function Cg(t){return this.compareTo(t)==0}function Ag(t){return this.compareTo(t)<0?this:t}function Bg(t){return this.compareTo(t)>0?this:t}function Tg(t,e,r){var n,s,i=Math.min(t.t,this.t);for(n=0;n<i;++n)r.data[n]=e(this.data[n],t.data[n]);if(t.t<this.t){for(s=t.s&this.DM,n=i;n<this.t;++n)r.data[n]=e(this.data[n],s);r.t=this.t}else{for(s=this.s&this.DM,n=i;n<t.t;++n)r.data[n]=e(s,t.data[n]);r.t=t.t}r.s=e(this.s,t.s),r.clamp()}function Pg(t,e){return t&e}function Rg(t){var e=Y();return this.bitwiseTo(t,Pg,e),e}function Qo(t,e){return t|e}function Dg(t){var e=Y();return this.bitwiseTo(t,Qo,e),e}function uf(t,e){return t^e}function kg(t){var e=Y();return this.bitwiseTo(t,uf,e),e}function ff(t,e){return t&~e}function Mg(t){var e=Y();return this.bitwiseTo(t,ff,e),e}function Ng(){for(var t=Y(),e=0;e<this.t;++e)t.data[e]=this.DM&~this.data[e];return t.t=this.t,t.s=~this.s,t}function Lg(t){var e=Y();return t<0?this.rShiftTo(-t,e):this.lShiftTo(t,e),e}function Og(t){var e=Y();return t<0?this.lShiftTo(-t,e):this.rShiftTo(t,e),e}function Fg(t){if(t==0)return-1;var e=0;return t&65535||(t>>=16,e+=16),t&255||(t>>=8,e+=8),t&15||(t>>=4,e+=4),t&3||(t>>=2,e+=2),t&1||++e,e}function Ug(){for(var t=0;t<this.t;++t)if(this.data[t]!=0)return t*this.DB+Fg(this.data[t]);return this.s<0?this.t*this.DB:-1}function Kg(t){for(var e=0;t!=0;)t&=t-1,++e;return e}function zg(){for(var t=0,e=this.s&this.DM,r=0;r<this.t;++r)t+=Kg(this.data[r]^e);return t}function qg(t){var e=Math.floor(t/this.DB);return e>=this.t?this.s!=0:(this.data[e]&1<<t%this.DB)!=0}function Vg(t,e){var r=E.ONE.shiftLeft(t);return this.bitwiseTo(r,e,r),r}function Gg(t){return this.changeBit(t,Qo)}function Hg(t){return this.changeBit(t,ff)}function Wg(t){return this.changeBit(t,uf)}function jg(t,e){for(var r=0,n=0,s=Math.min(t.t,this.t);r<s;)n+=this.data[r]+t.data[r],e.data[r++]=n&this.DM,n>>=this.DB;if(t.t<this.t){for(n+=t.s;r<this.t;)n+=this.data[r],e.data[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<t.t;)n+=t.data[r],e.data[r++]=n&this.DM,n>>=this.DB;n+=t.s}e.s=n<0?-1:0,n>0?e.data[r++]=n:n<-1&&(e.data[r++]=this.DV+n),e.t=r,e.clamp()}function $g(t){var e=Y();return this.addTo(t,e),e}function Zg(t){var e=Y();return this.subTo(t,e),e}function Yg(t){var e=Y();return this.multiplyTo(t,e),e}function Qg(t){var e=Y();return this.divRemTo(t,e,null),e}function Xg(t){var e=Y();return this.divRemTo(t,null,e),e}function Jg(t){var e=Y(),r=Y();return this.divRemTo(t,e,r),new Array(e,r)}function ey(t){this.data[this.t]=this.am(0,t-1,this,0,0,this.t),++this.t,this.clamp()}function ty(t,e){if(t!=0){for(;this.t<=e;)this.data[this.t++]=0;for(this.data[e]+=t;this.data[e]>=this.DV;)this.data[e]-=this.DV,++e>=this.t&&(this.data[this.t++]=0),++this.data[e]}}function Vn(){}function hf(t){return t}function ry(t,e,r){t.multiplyTo(e,r)}function ny(t,e){t.squareTo(e)}Vn.prototype.convert=hf;Vn.prototype.revert=hf;Vn.prototype.mulTo=ry;Vn.prototype.sqrTo=ny;function sy(t){return this.exp(t,new Vn)}function iy(t,e,r){var n=Math.min(this.t+t.t,e);for(r.s=0,r.t=n;n>0;)r.data[--n]=0;var s;for(s=r.t-this.t;n<s;++n)r.data[n+this.t]=this.am(0,t.data[n],r,n,0,this.t);for(s=Math.min(t.t,e);n<s;++n)this.am(0,t.data[n],r,n,0,e-n);r.clamp()}function oy(t,e,r){--e;var n=r.t=this.t+t.t-e;for(r.s=0;--n>=0;)r.data[n]=0;for(n=Math.max(e-this.t,0);n<t.t;++n)r.data[this.t+n-e]=this.am(e-n,t.data[n],r,0,0,this.t+n-e);r.clamp(),r.drShiftTo(1,r)}function nn(t){this.r2=Y(),this.q3=Y(),E.ONE.dlShiftTo(2*t.t,this.r2),this.mu=this.r2.divide(t),this.m=t}function ay(t){if(t.s<0||t.t>2*this.m.t)return t.mod(this.m);if(t.compareTo(this.m)<0)return t;var e=Y();return t.copyTo(e),this.reduce(e),e}function cy(t){return t}function uy(t){for(t.drShiftTo(this.m.t-1,this.r2),t.t>this.m.t+1&&(t.t=this.m.t+1,t.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);t.compareTo(this.r2)<0;)t.dAddOffset(1,this.m.t+1);for(t.subTo(this.r2,t);t.compareTo(this.m)>=0;)t.subTo(this.m,t)}function fy(t,e){t.squareTo(e),this.reduce(e)}function hy(t,e,r){t.multiplyTo(e,r),this.reduce(r)}nn.prototype.convert=ay;nn.prototype.revert=cy;nn.prototype.reduce=uy;nn.prototype.mulTo=hy;nn.prototype.sqrTo=fy;function ly(t,e){var r=t.bitLength(),n,s=sr(1),i;if(r<=0)return s;r<18?n=1:r<48?n=3:r<144?n=4:r<768?n=5:n=6,r<8?i=new Cr(e):e.isEven()?i=new nn(e):i=new Ar(e);var o=new Array,a=3,f=n-1,u=(1<<n)-1;if(o[1]=i.convert(this),n>1){var c=Y();for(i.sqrTo(o[1],c);a<=u;)o[a]=Y(),i.mulTo(c,o[a-2],o[a]),a+=2}var h=t.t-1,l,d=!0,p=Y(),g;for(r=Hs(t.data[h])-1;h>=0;){for(r>=f?l=t.data[h]>>r-f&u:(l=(t.data[h]&(1<<r+1)-1)<<f-r,h>0&&(l|=t.data[h-1]>>this.DB+r-f)),a=n;!(l&1);)l>>=1,--a;if((r-=a)<0&&(r+=this.DB,--h),d)o[l].copyTo(s),d=!1;else{for(;a>1;)i.sqrTo(s,p),i.sqrTo(p,s),a-=2;a>0?i.sqrTo(s,p):(g=s,s=p,p=g),i.mulTo(p,o[l],s)}for(;h>=0&&!(t.data[h]&1<<r);)i.sqrTo(s,p),g=s,s=p,p=g,--r<0&&(r=this.DB-1,--h)}return i.revert(s)}function py(t){var e=this.s<0?this.negate():this.clone(),r=t.s<0?t.negate():t.clone();if(e.compareTo(r)<0){var n=e;e=r,r=n}var s=e.getLowestSetBit(),i=r.getLowestSetBit();if(i<0)return e;for(s<i&&(i=s),i>0&&(e.rShiftTo(i,e),r.rShiftTo(i,r));e.signum()>0;)(s=e.getLowestSetBit())>0&&e.rShiftTo(s,e),(s=r.getLowestSetBit())>0&&r.rShiftTo(s,r),e.compareTo(r)>=0?(e.subTo(r,e),e.rShiftTo(1,e)):(r.subTo(e,r),r.rShiftTo(1,r));return i>0&&r.lShiftTo(i,r),r}function dy(t){if(t<=0)return 0;var e=this.DV%t,r=this.s<0?t-1:0;if(this.t>0)if(e==0)r=this.data[0]%t;else for(var n=this.t-1;n>=0;--n)r=(e*r+this.data[n])%t;return r}function gy(t){var e=t.isEven();if(this.isEven()&&e||t.signum()==0)return E.ZERO;for(var r=t.clone(),n=this.clone(),s=sr(1),i=sr(0),o=sr(0),a=sr(1);r.signum()!=0;){for(;r.isEven();)r.rShiftTo(1,r),e?((!s.isEven()||!i.isEven())&&(s.addTo(this,s),i.subTo(t,i)),s.rShiftTo(1,s)):i.isEven()||i.subTo(t,i),i.rShiftTo(1,i);for(;n.isEven();)n.rShiftTo(1,n),e?((!o.isEven()||!a.isEven())&&(o.addTo(this,o),a.subTo(t,a)),o.rShiftTo(1,o)):a.isEven()||a.subTo(t,a),a.rShiftTo(1,a);r.compareTo(n)>=0?(r.subTo(n,r),e&&s.subTo(o,s),i.subTo(a,i)):(n.subTo(r,n),e&&o.subTo(s,o),a.subTo(i,a))}if(n.compareTo(E.ONE)!=0)return E.ZERO;if(a.compareTo(t)>=0)return a.subtract(t);if(a.signum()<0)a.addTo(t,a);else return a;return a.signum()<0?a.add(t):a}var ft=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509],yy=(1<<26)/ft[ft.length-1];function my(t){var e,r=this.abs();if(r.t==1&&r.data[0]<=ft[ft.length-1]){for(e=0;e<ft.length;++e)if(r.data[0]==ft[e])return!0;return!1}if(r.isEven())return!1;for(e=1;e<ft.length;){for(var n=ft[e],s=e+1;s<ft.length&&n<yy;)n*=ft[s++];for(n=r.modInt(n);e<s;)if(n%ft[e++]==0)return!1}return r.millerRabin(t)}function by(t){var e=this.subtract(E.ONE),r=e.getLowestSetBit();if(r<=0)return!1;for(var n=e.shiftRight(r),s=vy(),i,o=0;o<t;++o){do i=new E(this.bitLength(),s);while(i.compareTo(E.ONE)<=0||i.compareTo(e)>=0);var a=i.modPow(n,this);if(a.compareTo(E.ONE)!=0&&a.compareTo(e)!=0){for(var f=1;f++<r&&a.compareTo(e)!=0;)if(a=a.modPowInt(2,this),a.compareTo(E.ONE)==0)return!1;if(a.compareTo(e)!=0)return!1}}return!0}function vy(){return{nextBytes:function(t){for(var e=0;e<t.length;++e)t[e]=Math.floor(Math.random()*256)}}}E.prototype.chunkSize=xg;E.prototype.toRadix=Sg;E.prototype.fromRadix=Eg;E.prototype.fromNumber=Ig;E.prototype.bitwiseTo=Tg;E.prototype.changeBit=Vg;E.prototype.addTo=jg;E.prototype.dMultiply=ey;E.prototype.dAddOffset=ty;E.prototype.multiplyLowerTo=iy;E.prototype.multiplyUpperTo=oy;E.prototype.modInt=dy;E.prototype.millerRabin=by;E.prototype.clone=yg;E.prototype.intValue=mg;E.prototype.byteValue=bg;E.prototype.shortValue=vg;E.prototype.signum=wg;E.prototype.toByteArray=_g;E.prototype.equals=Cg;E.prototype.min=Ag;E.prototype.max=Bg;E.prototype.and=Rg;E.prototype.or=Dg;E.prototype.xor=kg;E.prototype.andNot=Mg;E.prototype.not=Ng;E.prototype.shiftLeft=Lg;E.prototype.shiftRight=Og;E.prototype.getLowestSetBit=Ug;E.prototype.bitCount=zg;E.prototype.testBit=qg;E.prototype.setBit=Gg;E.prototype.clearBit=Hg;E.prototype.flipBit=Wg;E.prototype.add=$g;E.prototype.subtract=Zg;E.prototype.multiply=Yg;E.prototype.divide=Qg;E.prototype.remainder=Xg;E.prototype.divideAndRemainder=Jg;E.prototype.modPow=ly;E.prototype.modInverse=gy;E.prototype.pow=sy;E.prototype.gcd=py;E.prototype.isProbablePrime=my});var mf=k((Qv,yf)=>{var _t=te();_r();Se();var df=yf.exports=_t.sha1=_t.sha1||{};_t.md.sha1=_t.md.algorithms.sha1=df;df.create=function(){gf||xy();var t=null,e=_t.util.createBuffer(),r=new Array(80),n={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,fullMessageLength:null,messageLengthSize:8};return n.start=function(){n.messageLength=0,n.fullMessageLength=n.messageLength64=[];for(var s=n.messageLengthSize/4,i=0;i<s;++i)n.fullMessageLength.push(0);return e=_t.util.createBuffer(),t={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520},n},n.start(),n.update=function(s,i){i==="utf8"&&(s=_t.util.encodeUtf8(s));var o=s.length;n.messageLength+=o,o=[o/4294967296>>>0,o>>>0];for(var a=n.fullMessageLength.length-1;a>=0;--a)n.fullMessageLength[a]+=o[1],o[1]=o[0]+(n.fullMessageLength[a]/4294967296>>>0),n.fullMessageLength[a]=n.fullMessageLength[a]>>>0,o[0]=o[1]/4294967296>>>0;return e.putBytes(s),pf(t,r,e),(e.read>2048||e.length()===0)&&e.compact(),n},n.digest=function(){var s=_t.util.createBuffer();s.putBytes(e.bytes());var i=n.fullMessageLength[n.fullMessageLength.length-1]+n.messageLengthSize,o=i&n.blockLength-1;s.putBytes(Xo.substr(0,n.blockLength-o));for(var a,f,u=n.fullMessageLength[0]*8,c=0;c<n.fullMessageLength.length-1;++c)a=n.fullMessageLength[c+1]*8,f=a/4294967296>>>0,u+=f,s.putInt32(u>>>0),u=a>>>0;s.putInt32(u);var h={h0:t.h0,h1:t.h1,h2:t.h2,h3:t.h3,h4:t.h4};pf(h,r,s);var l=_t.util.createBuffer();return l.putInt32(h.h0),l.putInt32(h.h1),l.putInt32(h.h2),l.putInt32(h.h3),l.putInt32(h.h4),l},n};var Xo=null,gf=!1;function xy(){Xo=String.fromCharCode(128),Xo+=_t.util.fillString(String.fromCharCode(0),64),gf=!0}function pf(t,e,r){for(var n,s,i,o,a,f,u,c,h=r.length();h>=64;){for(s=t.h0,i=t.h1,o=t.h2,a=t.h3,f=t.h4,c=0;c<16;++c)n=r.getInt32(),e[c]=n,u=a^i&(o^a),n=(s<<5|s>>>27)+u+f+1518500249+n,f=a,a=o,o=(i<<30|i>>>2)>>>0,i=s,s=n;for(;c<20;++c)n=e[c-3]^e[c-8]^e[c-14]^e[c-16],n=n<<1|n>>>31,e[c]=n,u=a^i&(o^a),n=(s<<5|s>>>27)+u+f+1518500249+n,f=a,a=o,o=(i<<30|i>>>2)>>>0,i=s,s=n;for(;c<32;++c)n=e[c-3]^e[c-8]^e[c-14]^e[c-16],n=n<<1|n>>>31,e[c]=n,u=i^o^a,n=(s<<5|s>>>27)+u+f+1859775393+n,f=a,a=o,o=(i<<30|i>>>2)>>>0,i=s,s=n;for(;c<40;++c)n=e[c-6]^e[c-16]^e[c-28]^e[c-32],n=n<<2|n>>>30,e[c]=n,u=i^o^a,n=(s<<5|s>>>27)+u+f+1859775393+n,f=a,a=o,o=(i<<30|i>>>2)>>>0,i=s,s=n;for(;c<60;++c)n=e[c-6]^e[c-16]^e[c-28]^e[c-32],n=n<<2|n>>>30,e[c]=n,u=i&o|a&(i^o),n=(s<<5|s>>>27)+u+f+2400959708+n,f=a,a=o,o=(i<<30|i>>>2)>>>0,i=s,s=n;for(;c<80;++c)n=e[c-6]^e[c-16]^e[c-28]^e[c-32],n=n<<2|n>>>30,e[c]=n,u=i^o^a,n=(s<<5|s>>>27)+u+f+3395469782+n,f=a,a=o,o=(i<<30|i>>>2)>>>0,i=s,s=n;t.h0=t.h0+s|0,t.h1=t.h1+i|0,t.h2=t.h2+o|0,t.h3=t.h3+a|0,t.h4=t.h4+f|0,h-=64}}});var xf=k((Xv,vf)=>{var Ct=te();Se();qn();mf();var bf=vf.exports=Ct.pkcs1=Ct.pkcs1||{};bf.encode_rsa_oaep=function(t,e,r){var n,s,i,o;typeof r=="string"?(n=r,s=arguments[3]||void 0,i=arguments[4]||void 0):r&&(n=r.label||void 0,s=r.seed||void 0,i=r.md||void 0,r.mgf1&&r.mgf1.md&&(o=r.mgf1.md)),i?i.start():i=Ct.md.sha1.create(),o||(o=i);var a=Math.ceil(t.n.bitLength()/8),f=a-2*i.digestLength-2;if(e.length>f){var u=new Error("RSAES-OAEP input message length is too long.");throw u.length=e.length,u.maxLength=f,u}n||(n=""),i.update(n,"raw");for(var c=i.digest(),h="",l=f-e.length,d=0;d<l;d++)h+="\0";var p=c.getBytes()+h+""+e;if(!s)s=Ct.random.getBytes(i.digestLength);else if(s.length!==i.digestLength){var u=new Error("Invalid RSAES-OAEP seed. The seed length must match the digest length.");throw u.seedLength=s.length,u.digestLength=i.digestLength,u}var g=js(s,a-i.digestLength-1,o),m=Ct.util.xorBytes(p,g,p.length),v=js(m,i.digestLength,o),S=Ct.util.xorBytes(s,v,s.length);return"\0"+S+m};bf.decode_rsa_oaep=function(t,e,r){var n,s,i;typeof r=="string"?(n=r,s=arguments[3]||void 0):r&&(n=r.label||void 0,s=r.md||void 0,r.mgf1&&r.mgf1.md&&(i=r.mgf1.md));var o=Math.ceil(t.n.bitLength()/8);if(e.length!==o){var m=new Error("RSAES-OAEP encoded message length is invalid.");throw m.length=e.length,m.expectedLength=o,m}if(s===void 0?s=Ct.md.sha1.create():s.start(),i||(i=s),o<2*s.digestLength+2)throw new Error("RSAES-OAEP key is too short for the hash function.");n||(n=""),s.update(n,"raw");for(var a=s.digest().getBytes(),f=e.charAt(0),u=e.substring(1,s.digestLength+1),c=e.substring(1+s.digestLength),h=js(c,s.digestLength,i),l=Ct.util.xorBytes(u,h,u.length),d=js(l,o-s.digestLength-1,i),p=Ct.util.xorBytes(c,d,c.length),g=p.substring(0,s.digestLength),m=f!=="\0",v=0;v<s.digestLength;++v)m|=a.charAt(v)!==g.charAt(v);for(var S=1,C=s.digestLength,T=s.digestLength;T<p.length;T++){var x=p.charCodeAt(T),_=x&1^1,P=S?65534:0;m|=x&P,S=S&_,C+=S}if(m||p.charCodeAt(C)!==1)throw new Error("Invalid RSAES-OAEP padding.");return p.substring(C+1)};function js(t,e,r){r||(r=Ct.md.sha1.create());for(var n="",s=Math.ceil(e/r.digestLength),i=0;i<s;++i){var o=String.fromCharCode(i>>24&255,i>>16&255,i>>8&255,i&255);r.start(),r.update(t+o),n+=r.digest().getBytes()}return n.substring(0,e)}});var wf=k((Jv,Jo)=>{var ir=te();Se();Ws();qn();(function(){if(ir.prime){Jo.exports=ir.prime;return}var t=Jo.exports=ir.prime=ir.prime||{},e=ir.jsbn.BigInteger,r=[6,4,2,4,2,4,6,2],n=new e(null);n.fromInt(30);var s=function(h,l){return h|l};t.generateProbablePrime=function(h,l,d){typeof l=="function"&&(d=l,l={}),l=l||{};var p=l.algorithm||"PRIMEINC";typeof p=="string"&&(p={name:p}),p.options=p.options||{};var g=l.prng||ir.random,m={nextBytes:function(v){for(var S=g.getBytesSync(v.length),C=0;C<v.length;++C)v[C]=S.charCodeAt(C)}};if(p.name==="PRIMEINC")return i(h,m,p.options,d);throw new Error("Invalid prime generation algorithm: "+p.name)};function i(h,l,d,p){return"workers"in d?f(h,l,d,p):o(h,l,d,p)}function o(h,l,d,p){var g=u(h,l),m=0,v=c(g.bitLength());"millerRabinTests"in d&&(v=d.millerRabinTests);var S=10;"maxBlockTime"in d&&(S=d.maxBlockTime),a(g,h,l,m,v,S,p)}function a(h,l,d,p,g,m,v){var S=+new Date;do{if(h.bitLength()>l&&(h=u(l,d)),h.isProbablePrime(g))return v(null,h);h.dAddOffset(r[p++%8],0)}while(m<0||+new Date-S<m);ir.util.setImmediate(function(){a(h,l,d,p,g,m,v)})}function f(h,l,d,p){if(typeof Worker>"u")return o(h,l,d,p);var g=u(h,l),m=d.workers,v=d.workLoad||100,S=v*30/8,C=d.workerScript||"forge/prime.worker.js";if(m===-1)return ir.util.estimateCores(function(x,_){x&&(_=2),m=_-1,T()});T();function T(){m=Math.max(1,m);for(var x=[],_=0;_<m;++_)x[_]=new Worker(C);for(var P=m,_=0;_<m;++_)x[_].addEventListener("message",z);var O=!1;function z(oe){if(!O){--P;var Ae=oe.data;if(Ae.found){for(var Oe=0;Oe<x.length;++Oe)x[Oe].terminate();return O=!0,p(null,new e(Ae.prime,16))}g.bitLength()>h&&(g=u(h,l));var Vr=g.toString(16);oe.target.postMessage({hex:Vr,workLoad:v}),g.dAddOffset(S,0)}}}}function u(h,l){var d=new e(h,l),p=h-1;return d.testBit(p)||d.bitwiseTo(e.ONE.shiftLeft(p),s,d),d.dAddOffset(31-d.mod(n).byteValue(),0),d}function c(h){return h<=100?27:h<=150?18:h<=200?15:h<=250?12:h<=300?9:h<=350?8:h<=400?7:h<=500?6:h<=600?5:h<=800?4:h<=1250?3:2}})()});var Zs=k((ex,Bf)=>{var L=te();zn();Ws();ks();xf();wf();qn();Se();typeof G>"u"&&(G=L.jsbn.BigInteger);var G,ea=L.util.isNodejs?tn():null,b=L.asn1,et=L.util;L.pki=L.pki||{};Bf.exports=L.pki.rsa=L.rsa=L.rsa||{};var K=L.pki,wy=[6,4,2,4,2,4,6,2],Sy={name:"PrivateKeyInfo",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:b.Class.UNIVERSAL,type:b.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:b.Class.UNIVERSAL,type:b.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:b.Class.UNIVERSAL,type:b.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},Ey={name:"RSAPrivateKey",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:b.Class.UNIVERSAL,type:b.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",tagClass:b.Class.UNIVERSAL,type:b.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",tagClass:b.Class.UNIVERSAL,type:b.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:b.Class.UNIVERSAL,type:b.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:b.Class.UNIVERSAL,type:b.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",tagClass:b.Class.UNIVERSAL,type:b.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",tagClass:b.Class.UNIVERSAL,type:b.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:b.Class.UNIVERSAL,type:b.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:b.Class.UNIVERSAL,type:b.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},Iy={name:"RSAPublicKey",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:b.Class.UNIVERSAL,type:b.Type.INTEGER,constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:b.Class.UNIVERSAL,type:b.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]},_y=L.pki.rsa.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:b.Class.UNIVERSAL,type:b.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:b.Class.UNIVERSAL,type:b.Type.BITSTRING,constructed:!1,value:[{name:"SubjectPublicKeyInfo.subjectPublicKey.RSAPublicKey",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"rsaPublicKey"}]}]},Cy={name:"DigestInfo",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm",tagClass:b.Class.UNIVERSAL,type:b.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm.algorithmIdentifier",tagClass:b.Class.UNIVERSAL,type:b.Type.OID,constructed:!1,capture:"algorithmIdentifier"},{name:"DigestInfo.DigestAlgorithm.parameters",tagClass:b.Class.UNIVERSAL,type:b.Type.NULL,capture:"parameters",optional:!0,constructed:!1}]},{name:"DigestInfo.digest",tagClass:b.Class.UNIVERSAL,type:b.Type.OCTETSTRING,constructed:!1,capture:"digest"}]},Ay=function(t){var e;if(t.algorithm in K.oids)e=K.oids[t.algorithm];else{var r=new Error("Unknown message digest algorithm.");throw r.algorithm=t.algorithm,r}var n=b.oidToDer(e).getBytes(),s=b.create(b.Class.UNIVERSAL,b.Type.SEQUENCE,!0,[]),i=b.create(b.Class.UNIVERSAL,b.Type.SEQUENCE,!0,[]);i.value.push(b.create(b.Class.UNIVERSAL,b.Type.OID,!1,n)),i.value.push(b.create(b.Class.UNIVERSAL,b.Type.NULL,!1,""));var o=b.create(b.Class.UNIVERSAL,b.Type.OCTETSTRING,!1,t.digest().getBytes());return s.value.push(i),s.value.push(o),b.toDer(s).getBytes()},Cf=function(t,e,r){if(r)return t.modPow(e.e,e.n);if(!e.p||!e.q)return t.modPow(e.d,e.n);e.dP||(e.dP=e.d.mod(e.p.subtract(G.ONE))),e.dQ||(e.dQ=e.d.mod(e.q.subtract(G.ONE))),e.qInv||(e.qInv=e.q.modInverse(e.p));var n;do n=new G(L.util.bytesToHex(L.random.getBytes(e.n.bitLength()/8)),16);while(n.compareTo(e.n)>=0||!n.gcd(e.n).equals(G.ONE));t=t.multiply(n.modPow(e.e,e.n)).mod(e.n);for(var s=t.mod(e.p).modPow(e.dP,e.p),i=t.mod(e.q).modPow(e.dQ,e.q);s.compareTo(i)<0;)s=s.add(e.p);var o=s.subtract(i).multiply(e.qInv).mod(e.p).multiply(e.q).add(i);return o=o.multiply(n.modInverse(e.n)).mod(e.n),o};K.rsa.encrypt=function(t,e,r){var n=r,s,i=Math.ceil(e.n.bitLength()/8);r!==!1&&r!==!0?(n=r===2,s=Af(t,e,r)):(s=L.util.createBuffer(),s.putBytes(t));for(var o=new G(s.toHex(),16),a=Cf(o,e,n),f=a.toString(16),u=L.util.createBuffer(),c=i-Math.ceil(f.length/2);c>0;)u.putByte(0),--c;return u.putBytes(L.util.hexToBytes(f)),u.getBytes()};K.rsa.decrypt=function(t,e,r,n){var s=Math.ceil(e.n.bitLength()/8);if(t.length!==s){var i=new Error("Encrypted message length is invalid.");throw i.length=t.length,i.expected=s,i}var o=new G(L.util.createBuffer(t).toHex(),16);if(o.compareTo(e.n)>=0)throw new Error("Encrypted message is invalid.");for(var a=Cf(o,e,r),f=a.toString(16),u=L.util.createBuffer(),c=s-Math.ceil(f.length/2);c>0;)u.putByte(0),--c;return u.putBytes(L.util.hexToBytes(f)),n!==!1?$s(u.getBytes(),e,r):u.getBytes()};K.rsa.createKeyPairGenerationState=function(t,e,r){typeof t=="string"&&(t=parseInt(t,10)),t=t||2048,r=r||{};var n=r.prng||L.random,s={nextBytes:function(a){for(var f=n.getBytesSync(a.length),u=0;u<a.length;++u)a[u]=f.charCodeAt(u)}},i=r.algorithm||"PRIMEINC",o;if(i==="PRIMEINC")o={algorithm:i,state:0,bits:t,rng:s,eInt:e||65537,e:new G(null),p:null,q:null,qBits:t>>1,pBits:t-(t>>1),pqState:0,num:null,keys:null},o.e.fromInt(o.eInt);else throw new Error("Invalid key generation algorithm: "+i);return o};K.rsa.stepKeyPairGenerationState=function(t,e){"algorithm"in t||(t.algorithm="PRIMEINC");var r=new G(null);r.fromInt(30);for(var n=0,s=function(h,l){return h|l},i=+new Date,o,a=0;t.keys===null&&(e<=0||a<e);){if(t.state===0){var f=t.p===null?t.pBits:t.qBits,u=f-1;t.pqState===0?(t.num=new G(f,t.rng),t.num.testBit(u)||t.num.bitwiseTo(G.ONE.shiftLeft(u),s,t.num),t.num.dAddOffset(31-t.num.mod(r).byteValue(),0),n=0,++t.pqState):t.pqState===1?t.num.bitLength()>f?t.pqState=0:t.num.isProbablePrime(Ty(t.num.bitLength()))?++t.pqState:t.num.dAddOffset(wy[n++%8],0):t.pqState===2?t.pqState=t.num.subtract(G.ONE).gcd(t.e).compareTo(G.ONE)===0?3:0:t.pqState===3&&(t.pqState=0,t.p===null?t.p=t.num:t.q=t.num,t.p!==null&&t.q!==null&&++t.state,t.num=null)}else if(t.state===1)t.p.compareTo(t.q)<0&&(t.num=t.p,t.p=t.q,t.q=t.num),++t.state;else if(t.state===2)t.p1=t.p.subtract(G.ONE),t.q1=t.q.subtract(G.ONE),t.phi=t.p1.multiply(t.q1),++t.state;else if(t.state===3)t.phi.gcd(t.e).compareTo(G.ONE)===0?++t.state:(t.p=null,t.q=null,t.state=0);else if(t.state===4)t.n=t.p.multiply(t.q),t.n.bitLength()===t.bits?++t.state:(t.q=null,t.state=0);else if(t.state===5){var c=t.e.modInverse(t.phi);t.keys={privateKey:K.rsa.setPrivateKey(t.n,t.e,c,t.p,t.q,c.mod(t.p1),c.mod(t.q1),t.q.modInverse(t.p)),publicKey:K.rsa.setPublicKey(t.n,t.e)}}o=+new Date,a+=o-i,i=o}return t.keys!==null};K.rsa.generateKeyPair=function(t,e,r,n){if(arguments.length===1?typeof t=="object"?(r=t,t=void 0):typeof t=="function"&&(n=t,t=void 0):arguments.length===2?typeof t=="number"?typeof e=="function"?(n=e,e=void 0):typeof e!="number"&&(r=e,e=void 0):(r=t,n=e,t=void 0,e=void 0):arguments.length===3&&(typeof e=="number"?typeof r=="function"&&(n=r,r=void 0):(n=r,r=e,e=void 0)),r=r||{},t===void 0&&(t=r.bits||2048),e===void 0&&(e=r.e||65537),!L.options.usePureJavaScript&&!r.prng&&t>=256&&t<=16384&&(e===65537||e===3)){if(n){if(Sf("generateKeyPair"))return ea.generateKeyPair("rsa",{modulusLength:t,publicExponent:e,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}},function(a,f,u){if(a)return n(a);n(null,{privateKey:K.privateKeyFromPem(u),publicKey:K.publicKeyFromPem(f)})});if(Ef("generateKey")&&Ef("exportKey"))return et.globalScope.crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:t,publicExponent:_f(e),hash:{name:"SHA-256"}},!0,["sign","verify"]).then(function(a){return et.globalScope.crypto.subtle.exportKey("pkcs8",a.privateKey)}).then(void 0,function(a){n(a)}).then(function(a){if(a){var f=K.privateKeyFromAsn1(b.fromDer(L.util.createBuffer(a)));n(null,{privateKey:f,publicKey:K.setRsaPublicKey(f.n,f.e)})}});if(If("generateKey")&&If("exportKey")){var s=et.globalScope.msCrypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:t,publicExponent:_f(e),hash:{name:"SHA-256"}},!0,["sign","verify"]);s.oncomplete=function(a){var f=a.target.result,u=et.globalScope.msCrypto.subtle.exportKey("pkcs8",f.privateKey);u.oncomplete=function(c){var h=c.target.result,l=K.privateKeyFromAsn1(b.fromDer(L.util.createBuffer(h)));n(null,{privateKey:l,publicKey:K.setRsaPublicKey(l.n,l.e)})},u.onerror=function(c){n(c)}},s.onerror=function(a){n(a)};return}}else if(Sf("generateKeyPairSync")){var i=ea.generateKeyPairSync("rsa",{modulusLength:t,publicExponent:e,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}});return{privateKey:K.privateKeyFromPem(i.privateKey),publicKey:K.publicKeyFromPem(i.publicKey)}}}var o=K.rsa.createKeyPairGenerationState(t,e,r);if(!n)return K.rsa.stepKeyPairGenerationState(o,0),o.keys;By(o,r,n)};K.setRsaPublicKey=K.rsa.setPublicKey=function(t,e){var r={n:t,e};return r.encrypt=function(n,s,i){if(typeof s=="string"?s=s.toUpperCase():s===void 0&&(s="RSAES-PKCS1-V1_5"),s==="RSAES-PKCS1-V1_5")s={encode:function(a,f,u){return Af(a,f,2).getBytes()}};else if(s==="RSA-OAEP"||s==="RSAES-OAEP")s={encode:function(a,f){return L.pkcs1.encode_rsa_oaep(f,a,i)}};else if(["RAW","NONE","NULL",null].indexOf(s)!==-1)s={encode:function(a){return a}};else if(typeof s=="string")throw new Error('Unsupported encryption scheme: "'+s+'".');var o=s.encode(n,r,!0);return K.rsa.encrypt(o,r,!0)},r.verify=function(n,s,i,o){typeof i=="string"?i=i.toUpperCase():i===void 0&&(i="RSASSA-PKCS1-V1_5"),o===void 0&&(o={_parseAllDigestBytes:!0}),"_parseAllDigestBytes"in o||(o._parseAllDigestBytes=!0),i==="RSASSA-PKCS1-V1_5"?i={verify:function(f,u){u=$s(u,r,!0);var c=b.fromDer(u,{parseAllBytes:o._parseAllDigestBytes}),h={},l=[];if(!b.validate(c,Cy,h,l)){var d=new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value.");throw d.errors=l,d}var p=b.derToOid(h.algorithmIdentifier);if(!(p===L.oids.md2||p===L.oids.md5||p===L.oids.sha1||p===L.oids.sha224||p===L.oids.sha256||p===L.oids.sha384||p===L.oids.sha512||p===L.oids["sha512-224"]||p===L.oids["sha512-256"])){var d=new Error("Unknown RSASSA-PKCS1-v1_5 DigestAlgorithm identifier.");throw d.oid=p,d}if((p===L.oids.md2||p===L.oids.md5)&&!("parameters"in h))throw new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value. Missing algorithm identifer NULL parameters.");return f===h.digest}}:(i==="NONE"||i==="NULL"||i===null)&&(i={verify:function(f,u){return u=$s(u,r,!0),f===u}});var a=K.rsa.decrypt(s,r,!0,!1);return i.verify(n,a,r.n.bitLength())},r};K.setRsaPrivateKey=K.rsa.setPrivateKey=function(t,e,r,n,s,i,o,a){var f={n:t,e,d:r,p:n,q:s,dP:i,dQ:o,qInv:a};return f.decrypt=function(u,c,h){typeof c=="string"?c=c.toUpperCase():c===void 0&&(c="RSAES-PKCS1-V1_5");var l=K.rsa.decrypt(u,f,!1,!1);if(c==="RSAES-PKCS1-V1_5")c={decode:$s};else if(c==="RSA-OAEP"||c==="RSAES-OAEP")c={decode:function(d,p){return L.pkcs1.decode_rsa_oaep(p,d,h)}};else if(["RAW","NONE","NULL",null].indexOf(c)!==-1)c={decode:function(d){return d}};else throw new Error('Unsupported encryption scheme: "'+c+'".');return c.decode(l,f,!1)},f.sign=function(u,c){var h=!1;typeof c=="string"&&(c=c.toUpperCase()),c===void 0||c==="RSASSA-PKCS1-V1_5"?(c={encode:Ay},h=1):(c==="NONE"||c==="NULL"||c===null)&&(c={encode:function(){return u}},h=1);var l=c.encode(u,f.n.bitLength());return K.rsa.encrypt(l,f,h)},f};K.wrapRsaPrivateKey=function(t){return b.create(b.Class.UNIVERSAL,b.Type.SEQUENCE,!0,[b.create(b.Class.UNIVERSAL,b.Type.INTEGER,!1,b.integerToDer(0).getBytes()),b.create(b.Class.UNIVERSAL,b.Type.SEQUENCE,!0,[b.create(b.Class.UNIVERSAL,b.Type.OID,!1,b.oidToDer(K.oids.rsaEncryption).getBytes()),b.create(b.Class.UNIVERSAL,b.Type.NULL,!1,"")]),b.create(b.Class.UNIVERSAL,b.Type.OCTETSTRING,!1,b.toDer(t).getBytes())])};K.privateKeyFromAsn1=function(t){var e={},r=[];if(b.validate(t,Sy,e,r)&&(t=b.fromDer(L.util.createBuffer(e.privateKey))),e={},r=[],!b.validate(t,Ey,e,r)){var n=new Error("Cannot read private key. ASN.1 object does not contain an RSAPrivateKey.");throw n.errors=r,n}var s,i,o,a,f,u,c,h;return s=L.util.createBuffer(e.privateKeyModulus).toHex(),i=L.util.createBuffer(e.privateKeyPublicExponent).toHex(),o=L.util.createBuffer(e.privateKeyPrivateExponent).toHex(),a=L.util.createBuffer(e.privateKeyPrime1).toHex(),f=L.util.createBuffer(e.privateKeyPrime2).toHex(),u=L.util.createBuffer(e.privateKeyExponent1).toHex(),c=L.util.createBuffer(e.privateKeyExponent2).toHex(),h=L.util.createBuffer(e.privateKeyCoefficient).toHex(),K.setRsaPrivateKey(new G(s,16),new G(i,16),new G(o,16),new G(a,16),new G(f,16),new G(u,16),new G(c,16),new G(h,16))};K.privateKeyToAsn1=K.privateKeyToRSAPrivateKey=function(t){return b.create(b.Class.UNIVERSAL,b.Type.SEQUENCE,!0,[b.create(b.Class.UNIVERSAL,b.Type.INTEGER,!1,b.integerToDer(0).getBytes()),b.create(b.Class.UNIVERSAL,b.Type.INTEGER,!1,At(t.n)),b.create(b.Class.UNIVERSAL,b.Type.INTEGER,!1,At(t.e)),b.create(b.Class.UNIVERSAL,b.Type.INTEGER,!1,At(t.d)),b.create(b.Class.UNIVERSAL,b.Type.INTEGER,!1,At(t.p)),b.create(b.Class.UNIVERSAL,b.Type.INTEGER,!1,At(t.q)),b.create(b.Class.UNIVERSAL,b.Type.INTEGER,!1,At(t.dP)),b.create(b.Class.UNIVERSAL,b.Type.INTEGER,!1,At(t.dQ)),b.create(b.Class.UNIVERSAL,b.Type.INTEGER,!1,At(t.qInv))])};K.publicKeyFromAsn1=function(t){var e={},r=[];if(b.validate(t,_y,e,r)){var n=b.derToOid(e.publicKeyOid);if(n!==K.oids.rsaEncryption){var s=new Error("Cannot read public key. Unknown OID.");throw s.oid=n,s}t=e.rsaPublicKey}if(r=[],!b.validate(t,Iy,e,r)){var s=new Error("Cannot read public key. ASN.1 object does not contain an RSAPublicKey.");throw s.errors=r,s}var i=L.util.createBuffer(e.publicKeyModulus).toHex(),o=L.util.createBuffer(e.publicKeyExponent).toHex();return K.setRsaPublicKey(new G(i,16),new G(o,16))};K.publicKeyToAsn1=K.publicKeyToSubjectPublicKeyInfo=function(t){return b.create(b.Class.UNIVERSAL,b.Type.SEQUENCE,!0,[b.create(b.Class.UNIVERSAL,b.Type.SEQUENCE,!0,[b.create(b.Class.UNIVERSAL,b.Type.OID,!1,b.oidToDer(K.oids.rsaEncryption).getBytes()),b.create(b.Class.UNIVERSAL,b.Type.NULL,!1,"")]),b.create(b.Class.UNIVERSAL,b.Type.BITSTRING,!1,[K.publicKeyToRSAPublicKey(t)])])};K.publicKeyToRSAPublicKey=function(t){return b.create(b.Class.UNIVERSAL,b.Type.SEQUENCE,!0,[b.create(b.Class.UNIVERSAL,b.Type.INTEGER,!1,At(t.n)),b.create(b.Class.UNIVERSAL,b.Type.INTEGER,!1,At(t.e))])};function Af(t,e,r){var n=L.util.createBuffer(),s=Math.ceil(e.n.bitLength()/8);if(t.length>s-11){var i=new Error("Message is too long for PKCS#1 v1.5 padding.");throw i.length=t.length,i.max=s-11,i}n.putByte(0),n.putByte(r);var o=s-3-t.length,a;if(r===0||r===1){a=r===0?0:255;for(var f=0;f<o;++f)n.putByte(a)}else for(;o>0;){for(var u=0,c=L.random.getBytes(o),f=0;f<o;++f)a=c.charCodeAt(f),a===0?++u:n.putByte(a);o=u}return n.putByte(0),n.putBytes(t),n}function $s(t,e,r,n){var s=Math.ceil(e.n.bitLength()/8),i=L.util.createBuffer(t),o=i.getByte(),a=i.getByte();if(o!==0||r&&a!==0&&a!==1||!r&&a!=2||r&&a===0&&typeof n>"u")throw new Error("Encryption block is invalid.");var f=0;if(a===0){f=s-3-n;for(var u=0;u<f;++u)if(i.getByte()!==0)throw new Error("Encryption block is invalid.")}else if(a===1)for(f=0;i.length()>1;){if(i.getByte()!==255){--i.read;break}++f}else if(a===2)for(f=0;i.length()>1;){if(i.getByte()===0){--i.read;break}++f}var c=i.getByte();if(c!==0||f!==s-3-i.length())throw new Error("Encryption block is invalid.");return i.getBytes()}function By(t,e,r){typeof e=="function"&&(r=e,e={}),e=e||{};var n={algorithm:{name:e.algorithm||"PRIMEINC",options:{workers:e.workers||2,workLoad:e.workLoad||100,workerScript:e.workerScript}}};"prng"in e&&(n.prng=e.prng),s();function s(){i(t.pBits,function(a,f){if(a)return r(a);if(t.p=f,t.q!==null)return o(a,t.q);i(t.qBits,o)})}function i(a,f){L.prime.generateProbablePrime(a,n,f)}function o(a,f){if(a)return r(a);if(t.q=f,t.p.compareTo(t.q)<0){var u=t.p;t.p=t.q,t.q=u}if(t.p.subtract(G.ONE).gcd(t.e).compareTo(G.ONE)!==0){t.p=null,s();return}if(t.q.subtract(G.ONE).gcd(t.e).compareTo(G.ONE)!==0){t.q=null,i(t.qBits,o);return}if(t.p1=t.p.subtract(G.ONE),t.q1=t.q.subtract(G.ONE),t.phi=t.p1.multiply(t.q1),t.phi.gcd(t.e).compareTo(G.ONE)!==0){t.p=t.q=null,s();return}if(t.n=t.p.multiply(t.q),t.n.bitLength()!==t.bits){t.q=null,i(t.qBits,o);return}var c=t.e.modInverse(t.phi);t.keys={privateKey:K.rsa.setPrivateKey(t.n,t.e,c,t.p,t.q,c.mod(t.p1),c.mod(t.q1),t.q.modInverse(t.p)),publicKey:K.rsa.setPublicKey(t.n,t.e)},r(null,t.keys)}}function At(t){var e=t.toString(16);e[0]>="8"&&(e="00"+e);var r=L.util.hexToBytes(e);return r.length>1&&(r.charCodeAt(0)===0&&!(r.charCodeAt(1)&128)||r.charCodeAt(0)===255&&(r.charCodeAt(1)&128)===128)?r.substr(1):r}function Ty(t){return t<=100?27:t<=150?18:t<=200?15:t<=250?12:t<=300?9:t<=350?8:t<=400?7:t<=500?6:t<=600?5:t<=800?4:t<=1250?3:2}function Sf(t){return L.util.isNodejs&&typeof ea[t]=="function"}function Ef(t){return typeof et.globalScope<"u"&&typeof et.globalScope.crypto=="object"&&typeof et.globalScope.crypto.subtle=="object"&&typeof et.globalScope.crypto.subtle[t]=="function"}function If(t){return typeof et.globalScope<"u"&&typeof et.globalScope.msCrypto=="object"&&typeof et.globalScope.msCrypto.subtle=="object"&&typeof et.globalScope.msCrypto.subtle[t]=="function"}function _f(t){for(var e=L.util.hexToBytes(t.toString(16)),r=new Uint8Array(e.length),n=0;n<e.length;++n)r[n]=e.charCodeAt(n);return r}});var Mf=k((tx,kf)=>{var R=te();Fs();zn();Fu();_r();ks();Ho();Hu();qn();nf();Zs();Se();typeof Tf>"u"&&(Tf=R.jsbn.BigInteger);var Tf,w=R.asn1,q=R.pki=R.pki||{};kf.exports=q.pbe=R.pbe=R.pbe||{};var Br=q.oids,Py={name:"EncryptedPrivateKeyInfo",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedPrivateKeyInfo.encryptionAlgorithm",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:w.Class.UNIVERSAL,type:w.Type.OID,constructed:!1,capture:"encryptionOid"},{name:"AlgorithmIdentifier.parameters",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,captureAsn1:"encryptionParams"}]},{name:"EncryptedPrivateKeyInfo.encryptedData",tagClass:w.Class.UNIVERSAL,type:w.Type.OCTETSTRING,constructed:!1,capture:"encryptedData"}]},Ry={name:"PBES2Algorithms",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:w.Class.UNIVERSAL,type:w.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",tagClass:w.Class.UNIVERSAL,type:w.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:w.Class.UNIVERSAL,type:w.Type.INTEGER,constructed:!1,capture:"kdfIterationCount"},{name:"PBES2Algorithms.params.keyLength",tagClass:w.Class.UNIVERSAL,type:w.Type.INTEGER,constructed:!1,optional:!0,capture:"keyLength"},{name:"PBES2Algorithms.params.prf",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,optional:!0,value:[{name:"PBES2Algorithms.params.prf.algorithm",tagClass:w.Class.UNIVERSAL,type:w.Type.OID,constructed:!1,capture:"prfOid"}]}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",tagClass:w.Class.UNIVERSAL,type:w.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:w.Class.UNIVERSAL,type:w.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},Dy={name:"pkcs-12PbeParams",tagClass:w.Class.UNIVERSAL,type:w.Type.SEQUENCE,constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:w.Class.UNIVERSAL,type:w.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:w.Class.UNIVERSAL,type:w.Type.INTEGER,constructed:!1,capture:"iterations"}]};q.encryptPrivateKeyInfo=function(t,e,r){r=r||{},r.saltSize=r.saltSize||8,r.count=r.count||2048,r.algorithm=r.algorithm||"aes128",r.prfAlgorithm=r.prfAlgorithm||"sha1";var n=R.random.getBytesSync(r.saltSize),s=r.count,i=w.integerToDer(s),o,a,f;if(r.algorithm.indexOf("aes")===0||r.algorithm==="des"){var u,c,h;switch(r.algorithm){case"aes128":o=16,u=16,c=Br["aes128-CBC"],h=R.aes.createEncryptionCipher;break;case"aes192":o=24,u=16,c=Br["aes192-CBC"],h=R.aes.createEncryptionCipher;break;case"aes256":o=32,u=16,c=Br["aes256-CBC"],h=R.aes.createEncryptionCipher;break;case"des":o=8,u=8,c=Br.desCBC,h=R.des.createEncryptionCipher;break;default:var l=new Error("Cannot encrypt private key. Unknown encryption algorithm.");throw l.algorithm=r.algorithm,l}var d="hmacWith"+r.prfAlgorithm.toUpperCase(),p=Df(d),g=R.pkcs5.pbkdf2(e,n,s,o,p),m=R.random.getBytesSync(u),v=h(g);v.start(m),v.update(w.toDer(t)),v.finish(),f=v.output.getBytes();var S=ky(n,i,o,d);a=w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[w.create(w.Class.UNIVERSAL,w.Type.OID,!1,w.oidToDer(Br.pkcs5PBES2).getBytes()),w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[w.create(w.Class.UNIVERSAL,w.Type.OID,!1,w.oidToDer(Br.pkcs5PBKDF2).getBytes()),S]),w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[w.create(w.Class.UNIVERSAL,w.Type.OID,!1,w.oidToDer(c).getBytes()),w.create(w.Class.UNIVERSAL,w.Type.OCTETSTRING,!1,m)])])])}else if(r.algorithm==="3des"){o=24;var C=new R.util.ByteBuffer(n),g=q.pbe.generatePkcs12Key(e,C,1,s,o),m=q.pbe.generatePkcs12Key(e,C,2,s,o),v=R.des.createEncryptionCipher(g);v.start(m),v.update(w.toDer(t)),v.finish(),f=v.output.getBytes(),a=w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[w.create(w.Class.UNIVERSAL,w.Type.OID,!1,w.oidToDer(Br["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[w.create(w.Class.UNIVERSAL,w.Type.OCTETSTRING,!1,n),w.create(w.Class.UNIVERSAL,w.Type.INTEGER,!1,i.getBytes())])])}else{var l=new Error("Cannot encrypt private key. Unknown encryption algorithm.");throw l.algorithm=r.algorithm,l}var T=w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[a,w.create(w.Class.UNIVERSAL,w.Type.OCTETSTRING,!1,f)]);return T};q.decryptPrivateKeyInfo=function(t,e){var r=null,n={},s=[];if(!w.validate(t,Py,n,s)){var i=new Error("Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw i.errors=s,i}var o=w.derToOid(n.encryptionOid),a=q.pbe.getCipher(o,n.encryptionParams,e),f=R.util.createBuffer(n.encryptedData);return a.update(f),a.finish()&&(r=w.fromDer(a.output)),r};q.encryptedPrivateKeyToPem=function(t,e){var r={type:"ENCRYPTED PRIVATE KEY",body:w.toDer(t).getBytes()};return R.pem.encode(r,{maxline:e})};q.encryptedPrivateKeyFromPem=function(t){var e=R.pem.decode(t)[0];if(e.type!=="ENCRYPTED PRIVATE KEY"){var r=new Error('Could not convert encrypted private key from PEM; PEM header type is "ENCRYPTED PRIVATE KEY".');throw r.headerType=e.type,r}if(e.procType&&e.procType.type==="ENCRYPTED")throw new Error("Could not convert encrypted private key from PEM; PEM is encrypted.");return w.fromDer(e.body)};q.encryptRsaPrivateKey=function(t,e,r){if(r=r||{},!r.legacy){var n=q.wrapRsaPrivateKey(q.privateKeyToAsn1(t));return n=q.encryptPrivateKeyInfo(n,e,r),q.encryptedPrivateKeyToPem(n)}var s,i,o,a;switch(r.algorithm){case"aes128":s="AES-128-CBC",o=16,i=R.random.getBytesSync(16),a=R.aes.createEncryptionCipher;break;case"aes192":s="AES-192-CBC",o=24,i=R.random.getBytesSync(16),a=R.aes.createEncryptionCipher;break;case"aes256":s="AES-256-CBC",o=32,i=R.random.getBytesSync(16),a=R.aes.createEncryptionCipher;break;case"3des":s="DES-EDE3-CBC",o=24,i=R.random.getBytesSync(8),a=R.des.createEncryptionCipher;break;case"des":s="DES-CBC",o=8,i=R.random.getBytesSync(8),a=R.des.createEncryptionCipher;break;default:var f=new Error('Could not encrypt RSA private key; unsupported encryption algorithm "'+r.algorithm+'".');throw f.algorithm=r.algorithm,f}var u=R.pbe.opensslDeriveBytes(e,i.substr(0,8),o),c=a(u);c.start(i),c.update(w.toDer(q.privateKeyToAsn1(t))),c.finish();var h={type:"RSA PRIVATE KEY",procType:{version:"4",type:"ENCRYPTED"},dekInfo:{algorithm:s,parameters:R.util.bytesToHex(i).toUpperCase()},body:c.output.getBytes()};return R.pem.encode(h)};q.decryptRsaPrivateKey=function(t,e){var r=null,n=R.pem.decode(t)[0];if(n.type!=="ENCRYPTED PRIVATE KEY"&&n.type!=="PRIVATE KEY"&&n.type!=="RSA PRIVATE KEY"){var s=new Error('Could not convert private key from PEM; PEM header type is not "ENCRYPTED PRIVATE KEY", "PRIVATE KEY", or "RSA PRIVATE KEY".');throw s.headerType=s,s}if(n.procType&&n.procType.type==="ENCRYPTED"){var i,o;switch(n.dekInfo.algorithm){case"DES-CBC":i=8,o=R.des.createDecryptionCipher;break;case"DES-EDE3-CBC":i=24,o=R.des.createDecryptionCipher;break;case"AES-128-CBC":i=16,o=R.aes.createDecryptionCipher;break;case"AES-192-CBC":i=24,o=R.aes.createDecryptionCipher;break;case"AES-256-CBC":i=32,o=R.aes.createDecryptionCipher;break;case"RC2-40-CBC":i=5,o=function(h){return R.rc2.createDecryptionCipher(h,40)};break;case"RC2-64-CBC":i=8,o=function(h){return R.rc2.createDecryptionCipher(h,64)};break;case"RC2-128-CBC":i=16,o=function(h){return R.rc2.createDecryptionCipher(h,128)};break;default:var s=new Error('Could not decrypt private key; unsupported encryption algorithm "'+n.dekInfo.algorithm+'".');throw s.algorithm=n.dekInfo.algorithm,s}var a=R.util.hexToBytes(n.dekInfo.parameters),f=R.pbe.opensslDeriveBytes(e,a.substr(0,8),i),u=o(f);if(u.start(a),u.update(R.util.createBuffer(n.body)),u.finish())r=u.output.getBytes();else return r}else r=n.body;return n.type==="ENCRYPTED PRIVATE KEY"?r=q.decryptPrivateKeyInfo(w.fromDer(r),e):r=w.fromDer(r),r!==null&&(r=q.privateKeyFromAsn1(r)),r};q.pbe.generatePkcs12Key=function(t,e,r,n,s,i){var o,a;if(typeof i>"u"||i===null){if(!("sha1"in R.md))throw new Error('"sha1" hash algorithm unavailable.');i=R.md.sha1.create()}var f=i.digestLength,u=i.blockLength,c=new R.util.ByteBuffer,h=new R.util.ByteBuffer;if(t!=null){for(a=0;a<t.length;a++)h.putInt16(t.charCodeAt(a));h.putInt16(0)}var l=h.length(),d=e.length(),p=new R.util.ByteBuffer;p.fillWithByte(r,u);var g=u*Math.ceil(d/u),m=new R.util.ByteBuffer;for(a=0;a<g;a++)m.putByte(e.at(a%d));var v=u*Math.ceil(l/u),S=new R.util.ByteBuffer;for(a=0;a<v;a++)S.putByte(h.at(a%l));var C=m;C.putBuffer(S);for(var T=Math.ceil(s/f),x=1;x<=T;x++){var _=new R.util.ByteBuffer;_.putBytes(p.bytes()),_.putBytes(C.bytes());for(var P=0;P<n;P++)i.start(),i.update(_.getBytes()),_=i.digest();var O=new R.util.ByteBuffer;for(a=0;a<u;a++)O.putByte(_.at(a%f));var z=Math.ceil(d/u)+Math.ceil(l/u),oe=new R.util.ByteBuffer;for(o=0;o<z;o++){var Ae=new R.util.ByteBuffer(C.getBytes(u)),Oe=511;for(a=O.length()-1;a>=0;a--)Oe=Oe>>8,Oe+=O.at(a)+Ae.at(a),Ae.setAt(a,Oe&255);oe.putBuffer(Ae)}C=oe,c.putBuffer(_)}return c.truncate(c.length()-s),c};q.pbe.getCipher=function(t,e,r){switch(t){case q.oids.pkcs5PBES2:return q.pbe.getCipherForPBES2(t,e,r);case q.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case q.oids["pbewithSHAAnd40BitRC2-CBC"]:return q.pbe.getCipherForPKCS12PBE(t,e,r);default:var n=new Error("Cannot read encrypted PBE data block. Unsupported OID.");throw n.oid=t,n.supportedOids=["pkcs5PBES2","pbeWithSHAAnd3-KeyTripleDES-CBC","pbewithSHAAnd40BitRC2-CBC"],n}};q.pbe.getCipherForPBES2=function(t,e,r){var n={},s=[];if(!w.validate(e,Ry,n,s)){var i=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw i.errors=s,i}if(t=w.derToOid(n.kdfOid),t!==q.oids.pkcs5PBKDF2){var i=new Error("Cannot read encrypted private key. Unsupported key derivation function OID.");throw i.oid=t,i.supportedOids=["pkcs5PBKDF2"],i}if(t=w.derToOid(n.encOid),t!==q.oids["aes128-CBC"]&&t!==q.oids["aes192-CBC"]&&t!==q.oids["aes256-CBC"]&&t!==q.oids["des-EDE3-CBC"]&&t!==q.oids.desCBC){var i=new Error("Cannot read encrypted private key. Unsupported encryption scheme OID.");throw i.oid=t,i.supportedOids=["aes128-CBC","aes192-CBC","aes256-CBC","des-EDE3-CBC","desCBC"],i}var o=n.kdfSalt,a=R.util.createBuffer(n.kdfIterationCount);a=a.getInt(a.length()<<3);var f,u;switch(q.oids[t]){case"aes128-CBC":f=16,u=R.aes.createDecryptionCipher;break;case"aes192-CBC":f=24,u=R.aes.createDecryptionCipher;break;case"aes256-CBC":f=32,u=R.aes.createDecryptionCipher;break;case"des-EDE3-CBC":f=24,u=R.des.createDecryptionCipher;break;case"desCBC":f=8,u=R.des.createDecryptionCipher;break}var c=Rf(n.prfOid),h=R.pkcs5.pbkdf2(r,o,a,f,c),l=n.encIv,d=u(h);return d.start(l),d};q.pbe.getCipherForPKCS12PBE=function(t,e,r){var n={},s=[];if(!w.validate(e,Dy,n,s)){var i=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw i.errors=s,i}var o=R.util.createBuffer(n.salt),a=R.util.createBuffer(n.iterations);a=a.getInt(a.length()<<3);var f,u,c;switch(t){case q.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:f=24,u=8,c=R.des.startDecrypting;break;case q.oids["pbewithSHAAnd40BitRC2-CBC"]:f=5,u=8,c=function(g,m){var v=R.rc2.createDecryptionCipher(g,40);return v.start(m,null),v};break;default:var i=new Error("Cannot read PKCS #12 PBE data block. Unsupported OID.");throw i.oid=t,i}var h=Rf(n.prfOid),l=q.pbe.generatePkcs12Key(r,o,1,a,f,h);h.start();var d=q.pbe.generatePkcs12Key(r,o,2,a,u,h);return c(l,d)};q.pbe.opensslDeriveBytes=function(t,e,r,n){if(typeof n>"u"||n===null){if(!("md5"in R.md))throw new Error('"md5" hash algorithm unavailable.');n=R.md.md5.create()}e===null&&(e="");for(var s=[Pf(n,t+e)],i=16,o=1;i<r;++o,i+=16)s.push(Pf(n,s[o-1]+t+e));return s.join("").substr(0,r)};function Pf(t,e){return t.start().update(e).digest().getBytes()}function Rf(t){var e;if(!t)e="hmacWithSHA1";else if(e=q.oids[w.derToOid(t)],!e){var r=new Error("Unsupported PRF OID.");throw r.oid=t,r.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],r}return Df(e)}function Df(t){var e=R.md;switch(t){case"hmacWithSHA224":e=R.md.sha512;case"hmacWithSHA1":case"hmacWithSHA256":case"hmacWithSHA384":case"hmacWithSHA512":t=t.substr(8).toLowerCase();break;default:var r=new Error("Unsupported PRF algorithm.");throw r.algorithm=t,r.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],r}if(!e||!(t in e))throw new Error("Unknown hash algorithm: "+t);return e[t].create()}function ky(t,e,r,n){var s=w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[w.create(w.Class.UNIVERSAL,w.Type.OCTETSTRING,!1,t),w.create(w.Class.UNIVERSAL,w.Type.INTEGER,!1,e.getBytes())]);return n!=="hmacWithSHA1"&&s.value.push(w.create(w.Class.UNIVERSAL,w.Type.INTEGER,!1,R.util.hexToBytes(r.toString(16))),w.create(w.Class.UNIVERSAL,w.Type.SEQUENCE,!0,[w.create(w.Class.UNIVERSAL,w.Type.OID,!1,w.oidToDer(q.oids[n]).getBytes()),w.create(w.Class.UNIVERSAL,w.Type.NULL,!1,"")])),s}});var Vf=k((Ox,qf)=>{var ce=te();_r();Se();var Gn=qf.exports=ce.sha512=ce.sha512||{};ce.md.sha512=ce.md.algorithms.sha512=Gn;var Kf=ce.sha384=ce.sha512.sha384=ce.sha512.sha384||{};Kf.create=function(){return Gn.create("SHA-384")};ce.md.sha384=ce.md.algorithms.sha384=Kf;ce.sha512.sha256=ce.sha512.sha256||{create:function(){return Gn.create("SHA-512/256")}};ce.md["sha512/256"]=ce.md.algorithms["sha512/256"]=ce.sha512.sha256;ce.sha512.sha224=ce.sha512.sha224||{create:function(){return Gn.create("SHA-512/224")}};ce.md["sha512/224"]=ce.md.algorithms["sha512/224"]=ce.sha512.sha224;Gn.create=function(t){if(zf||Fy(),typeof t>"u"&&(t="SHA-512"),!(t in Tr))throw new Error("Invalid SHA-512 algorithm: "+t);for(var e=Tr[t],r=null,n=ce.util.createBuffer(),s=new Array(80),i=0;i<80;++i)s[i]=new Array(2);var o=64;switch(t){case"SHA-384":o=48;break;case"SHA-512/256":o=32;break;case"SHA-512/224":o=28;break}var a={algorithm:t.replace("-","").toLowerCase(),blockLength:128,digestLength:o,messageLength:0,fullMessageLength:null,messageLengthSize:16};return a.start=function(){a.messageLength=0,a.fullMessageLength=a.messageLength128=[];for(var f=a.messageLengthSize/4,u=0;u<f;++u)a.fullMessageLength.push(0);n=ce.util.createBuffer(),r=new Array(e.length);for(var u=0;u<e.length;++u)r[u]=e[u].slice(0);return a},a.start(),a.update=function(f,u){u==="utf8"&&(f=ce.util.encodeUtf8(f));var c=f.length;a.messageLength+=c,c=[c/4294967296>>>0,c>>>0];for(var h=a.fullMessageLength.length-1;h>=0;--h)a.fullMessageLength[h]+=c[1],c[1]=c[0]+(a.fullMessageLength[h]/4294967296>>>0),a.fullMessageLength[h]=a.fullMessageLength[h]>>>0,c[0]=c[1]/4294967296>>>0;return n.putBytes(f),Uf(r,s,n),(n.read>2048||n.length()===0)&&n.compact(),a},a.digest=function(){var f=ce.util.createBuffer();f.putBytes(n.bytes());var u=a.fullMessageLength[a.fullMessageLength.length-1]+a.messageLengthSize,c=u&a.blockLength-1;f.putBytes(ra.substr(0,a.blockLength-c));for(var h,l,d=a.fullMessageLength[0]*8,p=0;p<a.fullMessageLength.length-1;++p)h=a.fullMessageLength[p+1]*8,l=h/4294967296>>>0,d+=l,f.putInt32(d>>>0),d=h>>>0;f.putInt32(d);for(var g=new Array(r.length),p=0;p<r.length;++p)g[p]=r[p].slice(0);Uf(g,s,f);var m=ce.util.createBuffer(),v;t==="SHA-512"?v=g.length:t==="SHA-384"?v=g.length-2:v=g.length-4;for(var p=0;p<v;++p)m.putInt32(g[p][0]),(p!==v-1||t!=="SHA-512/224")&&m.putInt32(g[p][1]);return m},a};var ra=null,zf=!1,na=null,Tr=null;function Fy(){ra=String.fromCharCode(128),ra+=ce.util.fillString(String.fromCharCode(0),128),na=[[1116352408,3609767458],[1899447441,602891725],[3049323471,3964484399],[3921009573,2173295548],[961987163,4081628472],[1508970993,3053834265],[2453635748,2937671579],[2870763221,3664609560],[3624381080,2734883394],[310598401,1164996542],[607225278,1323610764],[1426881987,3590304994],[1925078388,4068182383],[2162078206,991336113],[2614888103,633803317],[3248222580,3479774868],[3835390401,2666613458],[4022224774,944711139],[264347078,2341262773],[604807628,2007800933],[770255983,1495990901],[1249150122,1856431235],[1555081692,3175218132],[1996064986,2198950837],[2554220882,3999719339],[2821834349,766784016],[2952996808,2566594879],[3210313671,3203337956],[3336571891,1034457026],[3584528711,2466948901],[113926993,3758326383],[338241895,168717936],[666307205,1188179964],[773529912,1546045734],[1294757372,1522805485],[1396182291,2643833823],[1695183700,2343527390],[1986661051,1014477480],[2177026350,1206759142],[2456956037,344077627],[2730485921,1290863460],[2820302411,3158454273],[3259730800,3505952657],[3345764771,106217008],[3516065817,3606008344],[3600352804,1432725776],[4094571909,1467031594],[275423344,851169720],[430227734,3100823752],[506948616,1363258195],[659060556,3750685593],[883997877,3785050280],[958139571,3318307427],[1322822218,3812723403],[1537002063,2003034995],[1747873779,3602036899],[1955562222,1575990012],[2024104815,1125592928],[2227730452,2716904306],[2361852424,442776044],[2428436474,593698344],[2756734187,3733110249],[3204031479,2999351573],[3329325298,3815920427],[3391569614,3928383900],[3515267271,566280711],[3940187606,3454069534],[4118630271,4000239992],[116418474,1914138554],[174292421,2731055270],[289380356,3203993006],[460393269,320620315],[685471733,587496836],[852142971,1086792851],[1017036298,365543100],[1126000580,2618297676],[1288033470,3409855158],[1501505948,4234509866],[1607167915,987167468],[1816402316,1246189591]],Tr={},Tr["SHA-512"]=[[1779033703,4089235720],[3144134277,2227873595],[1013904242,4271175723],[2773480762,1595750129],[1359893119,2917565137],[2600822924,725511199],[528734635,4215389547],[1541459225,327033209]],Tr["SHA-384"]=[[3418070365,3238371032],[1654270250,914150663],[2438529370,812702999],[355462360,4144912697],[1731405415,4290775857],[2394180231,1750603025],[3675008525,1694076839],[1203062813,3204075428]],Tr["SHA-512/256"]=[[573645204,4230739756],[2673172387,3360449730],[596883563,1867755857],[2520282905,1497426621],[2519219938,2827943907],[3193839141,1401305490],[721525244,746961066],[246885852,2177182882]],Tr["SHA-512/224"]=[[2352822216,424955298],[1944164710,2312950998],[502970286,855612546],[1738396948,1479516111],[258812777,2077511080],[2011393907,79989058],[1067287976,1780299464],[286451373,2446758561]],zf=!0}function Uf(t,e,r){for(var n,s,i,o,a,f,u,c,h,l,d,p,g,m,v,S,C,T,x,_,P,O,z,oe,Ae,Oe,Vr,ws,Ie,qe,F,Mi,Ni,Li,Oi,fc=r.length();fc>=128;){for(Ie=0;Ie<16;++Ie)e[Ie][0]=r.getInt32()>>>0,e[Ie][1]=r.getInt32()>>>0;for(;Ie<80;++Ie)Mi=e[Ie-2],qe=Mi[0],F=Mi[1],n=((qe>>>19|F<<13)^(F>>>29|qe<<3)^qe>>>6)>>>0,s=((qe<<13|F>>>19)^(F<<3|qe>>>29)^(qe<<26|F>>>6))>>>0,Li=e[Ie-15],qe=Li[0],F=Li[1],i=((qe>>>1|F<<31)^(qe>>>8|F<<24)^qe>>>7)>>>0,o=((qe<<31|F>>>1)^(qe<<24|F>>>8)^(qe<<25|F>>>7))>>>0,Ni=e[Ie-7],Oi=e[Ie-16],F=s+Ni[1]+o+Oi[1],e[Ie][0]=n+Ni[0]+i+Oi[0]+(F/4294967296>>>0)>>>0,e[Ie][1]=F>>>0;for(g=t[0][0],m=t[0][1],v=t[1][0],S=t[1][1],C=t[2][0],T=t[2][1],x=t[3][0],_=t[3][1],P=t[4][0],O=t[4][1],z=t[5][0],oe=t[5][1],Ae=t[6][0],Oe=t[6][1],Vr=t[7][0],ws=t[7][1],Ie=0;Ie<80;++Ie)u=((P>>>14|O<<18)^(P>>>18|O<<14)^(O>>>9|P<<23))>>>0,c=((P<<18|O>>>14)^(P<<14|O>>>18)^(O<<23|P>>>9))>>>0,h=(Ae^P&(z^Ae))>>>0,l=(Oe^O&(oe^Oe))>>>0,a=((g>>>28|m<<4)^(m>>>2|g<<30)^(m>>>7|g<<25))>>>0,f=((g<<4|m>>>28)^(m<<30|g>>>2)^(m<<25|g>>>7))>>>0,d=(g&v|C&(g^v))>>>0,p=(m&S|T&(m^S))>>>0,F=ws+c+l+na[Ie][1]+e[Ie][1],n=Vr+u+h+na[Ie][0]+e[Ie][0]+(F/4294967296>>>0)>>>0,s=F>>>0,F=f+p,i=a+d+(F/4294967296>>>0)>>>0,o=F>>>0,Vr=Ae,ws=Oe,Ae=z,Oe=oe,z=P,oe=O,F=_+s,P=x+n+(F/4294967296>>>0)>>>0,O=F>>>0,x=C,_=T,C=v,T=S,v=g,S=m,F=s+o,g=n+i+(F/4294967296>>>0)>>>0,m=F>>>0;F=t[0][1]+m,t[0][0]=t[0][0]+g+(F/4294967296>>>0)>>>0,t[0][1]=F>>>0,F=t[1][1]+S,t[1][0]=t[1][0]+v+(F/4294967296>>>0)>>>0,t[1][1]=F>>>0,F=t[2][1]+T,t[2][0]=t[2][0]+C+(F/4294967296>>>0)>>>0,t[2][1]=F>>>0,F=t[3][1]+_,t[3][0]=t[3][0]+x+(F/4294967296>>>0)>>>0,t[3][1]=F>>>0,F=t[4][1]+O,t[4][0]=t[4][0]+P+(F/4294967296>>>0)>>>0,t[4][1]=F>>>0,F=t[5][1]+oe,t[5][0]=t[5][0]+z+(F/4294967296>>>0)>>>0,t[5][1]=F>>>0,F=t[6][1]+Oe,t[6][0]=t[6][0]+Ae+(F/4294967296>>>0)>>>0,t[6][1]=F>>>0,F=t[7][1]+ws,t[7][0]=t[7][0]+Vr+(F/4294967296>>>0)>>>0,t[7][1]=F>>>0,fc-=128}}});var n0=k((lS,r0)=>{r0.exports=Ra;var t0=128,t1=127,r1=~t1,n1=Math.pow(2,31);function Ra(t,e,r){if(Number.MAX_SAFE_INTEGER&&t>Number.MAX_SAFE_INTEGER)throw Ra.bytes=0,new RangeError("Could not encode varint");e=e||[],r=r||0;for(var n=r;t>=n1;)e[r++]=t&255|t0,t/=128;for(;t&r1;)e[r++]=t&255|t0,t>>>=7;return e[r]=t|0,Ra.bytes=r-n+1,e}});var o0=k((pS,i0)=>{i0.exports=Da;var s1=128,s0=127;function Da(t,n){var r=0,n=n||0,s=0,i=n,o,a=t.length;do{if(i>=a||s>49)throw Da.bytes=0,new RangeError("Could not decode varint");o=t[i++],r+=s<28?(o&s0)<<s:(o&s0)*Math.pow(2,s),s+=7}while(o>=s1);return Da.bytes=i-n,r}});var c0=k((dS,a0)=>{var i1=Math.pow(2,7),o1=Math.pow(2,14),a1=Math.pow(2,21),c1=Math.pow(2,28),u1=Math.pow(2,35),f1=Math.pow(2,42),h1=Math.pow(2,49),l1=Math.pow(2,56),p1=Math.pow(2,63);a0.exports=function(t){return t<i1?1:t<o1?2:t<a1?3:t<c1?4:t<u1?5:t<f1?6:t<h1?7:t<l1?8:t<p1?9:10}});var hi=k((gS,u0)=>{u0.exports={encode:n0(),decode:o0(),encodingLength:c0()}});var _0=k(($S,I0)=>{var En=1e3,In=En*60,_n=In*60,Nr=_n*24,M1=Nr*7,N1=Nr*365.25;I0.exports=function(t,e){e=e||{};var r=typeof t;if(r==="string"&&t.length>0)return L1(t);if(r==="number"&&isFinite(t))return e.long?F1(t):O1(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function L1(t){if(t=String(t),!(t.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(e){var r=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*N1;case"weeks":case"week":case"w":return r*M1;case"days":case"day":case"d":return r*Nr;case"hours":case"hour":case"hrs":case"hr":case"h":return r*_n;case"minutes":case"minute":case"mins":case"min":case"m":return r*In;case"seconds":case"second":case"secs":case"sec":case"s":return r*En;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function O1(t){var e=Math.abs(t);return e>=Nr?Math.round(t/Nr)+"d":e>=_n?Math.round(t/_n)+"h":e>=In?Math.round(t/In)+"m":e>=En?Math.round(t/En)+"s":t+"ms"}function F1(t){var e=Math.abs(t);return e>=Nr?yi(t,e,Nr,"day"):e>=_n?yi(t,e,_n,"hour"):e>=In?yi(t,e,In,"minute"):e>=En?yi(t,e,En,"second"):t+" ms"}function yi(t,e,r,n){var s=e>=r*1.5;return Math.round(t/r)+" "+n+(s?"s":"")}});var A0=k((ZS,C0)=>{function U1(t){r.debug=r,r.default=r,r.coerce=f,r.disable=i,r.enable=s,r.enabled=o,r.humanize=_0(),r.destroy=u,Object.keys(t).forEach(c=>{r[c]=t[c]}),r.names=[],r.skips=[],r.formatters={};function e(c){let h=0;for(let l=0;l<c.length;l++)h=(h<<5)-h+c.charCodeAt(l),h|=0;return r.colors[Math.abs(h)%r.colors.length]}r.selectColor=e;function r(c){let h,l=null,d,p;function g(...m){if(!g.enabled)return;let v=g,S=Number(new Date),C=S-(h||S);v.diff=C,v.prev=h,v.curr=S,h=S,m[0]=r.coerce(m[0]),typeof m[0]!="string"&&m.unshift("%O");let T=0;m[0]=m[0].replace(/%([a-zA-Z%])/g,(_,P)=>{if(_==="%%")return"%";T++;let O=r.formatters[P];if(typeof O=="function"){let z=m[T];_=O.call(v,z),m.splice(T,1),T--}return _}),r.formatArgs.call(v,m),(v.log||r.log).apply(v,m)}return g.namespace=c,g.useColors=r.useColors(),g.color=r.selectColor(c),g.extend=n,g.destroy=r.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>l!==null?l:(d!==r.namespaces&&(d=r.namespaces,p=r.enabled(c)),p),set:m=>{l=m}}),typeof r.init=="function"&&r.init(g),g}function n(c,h){let l=r(this.namespace+(typeof h>"u"?":":h)+c);return l.log=this.log,l}function s(c){r.save(c),r.namespaces=c,r.names=[],r.skips=[];let h,l=(typeof c=="string"?c:"").split(/[\s,]+/),d=l.length;for(h=0;h<d;h++)l[h]&&(c=l[h].replace(/\*/g,".*?"),c[0]==="-"?r.skips.push(new RegExp("^"+c.slice(1)+"$")):r.names.push(new RegExp("^"+c+"$")))}function i(){let c=[...r.names.map(a),...r.skips.map(a).map(h=>"-"+h)].join(",");return r.enable(""),c}function o(c){if(c[c.length-1]==="*")return!0;let h,l;for(h=0,l=r.skips.length;h<l;h++)if(r.skips[h].test(c))return!1;for(h=0,l=r.names.length;h<l;h++)if(r.names[h].test(c))return!0;return!1}function a(c){return c.toString().substring(2,c.toString().length-2).replace(/\.\*\?$/,"*")}function f(c){return c instanceof Error?c.stack||c.message:c}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}C0.exports=U1});var B0=k((Ye,mi)=>{Ye.formatArgs=z1;Ye.save=q1;Ye.load=V1;Ye.useColors=K1;Ye.storage=G1();Ye.destroy=(()=>{let t=!1;return()=>{t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();Ye.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function K1(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function z1(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+mi.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;t.splice(1,0,e,"color: inherit");let r=0,n=0;t[0].replace(/%[a-zA-Z%]/g,s=>{s!=="%%"&&(r++,s==="%c"&&(n=r))}),t.splice(n,0,e)}Ye.log=console.debug||console.log||(()=>{});function q1(t){try{t?Ye.storage.setItem("debug",t):Ye.storage.removeItem("debug")}catch{}}function V1(){let t;try{t=Ye.storage.getItem("debug")}catch{}return!t&&typeof process<"u"&&"env"in process&&(t=process.env.DEBUG),t}function G1(){try{return localStorage}catch{}}mi.exports=A0()(Ye);var{formatters:H1}=mi.exports;H1.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var D0=k((iE,R0)=>{"use strict";R0.exports=Me;var ls=gr();function Me(t,e){this.lo=t>>>0,this.hi=e>>>0}var Fr=Me.zero=new Me(0,0);Fr.toNumber=function(){return 0};Fr.zzEncode=Fr.zzDecode=function(){return this};Fr.length=function(){return 1};var W1=Me.zeroHash="\0\0\0\0\0\0\0\0";Me.fromNumber=function(e){if(e===0)return Fr;var r=e<0;r&&(e=-e);var n=e>>>0,s=(e-n)/4294967296>>>0;return r&&(s=~s>>>0,n=~n>>>0,++n>4294967295&&(n=0,++s>4294967295&&(s=0))),new Me(n,s)};Me.from=function(e){if(typeof e=="number")return Me.fromNumber(e);if(ls.isString(e))if(ls.Long)e=ls.Long.fromString(e);else return Me.fromNumber(parseInt(e,10));return e.low||e.high?new Me(e.low>>>0,e.high>>>0):Fr};Me.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var r=~this.lo+1>>>0,n=~this.hi>>>0;return r||(n=n+1>>>0),-(r+n*4294967296)}return this.lo+this.hi*4294967296};Me.prototype.toLong=function(e){return ls.Long?new ls.Long(this.lo|0,this.hi|0,Boolean(e)):{low:this.lo|0,high:this.hi|0,unsigned:Boolean(e)}};var dr=String.prototype.charCodeAt;Me.fromHash=function(e){return e===W1?Fr:new Me((dr.call(e,0)|dr.call(e,1)<<8|dr.call(e,2)<<16|dr.call(e,3)<<24)>>>0,(dr.call(e,4)|dr.call(e,5)<<8|dr.call(e,6)<<16|dr.call(e,7)<<24)>>>0)};Me.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};Me.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};Me.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};Me.prototype.length=function(){var e=this.lo,r=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?r===0?e<16384?e<128?1:2:e<2097152?3:4:r<16384?r<128?5:6:r<2097152?7:8:n<128?9:10}});var gr=k(Ha=>{"use strict";var N=Ha;N.asPromise=ao();N.base64=co();N.EventEmitter=uo();N.float=fo();N.inquire=ho();N.utf8=po();N.pool=go();N.LongBits=D0();N.isNode=Boolean(typeof globalThis<"u"&&globalThis&&globalThis.process&&globalThis.process.versions&&globalThis.process.versions.node);N.global=N.isNode&&globalThis||typeof window<"u"&&window||typeof self<"u"&&self||Ha;N.emptyArray=Object.freeze?Object.freeze([]):[];N.emptyObject=Object.freeze?Object.freeze({}):{};N.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};N.isString=function(e){return typeof e=="string"||e instanceof String};N.isObject=function(e){return e&&typeof e=="object"};N.isset=N.isSet=function(e,r){var n=e[r];return n!=null&&e.hasOwnProperty(r)?typeof n!="object"||(Array.isArray(n)?n.length:Object.keys(n).length)>0:!1};N.Buffer=function(){try{var t=N.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch{return null}}();N._Buffer_from=null;N._Buffer_allocUnsafe=null;N.newBuffer=function(e){return typeof e=="number"?N.Buffer?N._Buffer_allocUnsafe(e):new N.Array(e):N.Buffer?N._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};N.Array=typeof Uint8Array<"u"?Uint8Array:Array;N.Long=N.global.dcodeIO&&N.global.dcodeIO.Long||N.global.Long||N.inquire("long");N.key2Re=/^true|false|0|1$/;N.key32Re=/^-?(?:0|[1-9][0-9]*)$/;N.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;N.longToHash=function(e){return e?N.LongBits.from(e).toHash():N.LongBits.zeroHash};N.longFromHash=function(e,r){var n=N.LongBits.fromHash(e);return N.Long?N.Long.fromBits(n.lo,n.hi,r):n.toNumber(Boolean(r))};function k0(t,e,r){for(var n=Object.keys(e),s=0;s<n.length;++s)(t[n[s]]===void 0||!r)&&(t[n[s]]=e[n[s]]);return t}N.merge=k0;N.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function M0(t){function e(r,n){if(!(this instanceof e))return new e(r,n);Object.defineProperty(this,"message",{get:function(){return r}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),n&&k0(this,n)}return(e.prototype=Object.create(Error.prototype)).constructor=e,Object.defineProperty(e.prototype,"name",{get:function(){return t}}),e.prototype.toString=function(){return this.name+": "+this.message},e}N.newError=M0;N.ProtocolError=M0("ProtocolError");N.oneOfGetter=function(e){for(var r={},n=0;n<e.length;++n)r[e[n]]=1;return function(){for(var s=Object.keys(this),i=s.length-1;i>-1;--i)if(r[s[i]]===1&&this[s[i]]!==void 0&&this[s[i]]!==null)return s[i]}};N.oneOfSetter=function(e){return function(r){for(var n=0;n<e.length;++n)e[n]!==r&&delete this[e[n]]}};N.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};N._configure=function(){var t=N.Buffer;if(!t){N._Buffer_from=N._Buffer_allocUnsafe=null;return}N._Buffer_from=t.from!==Uint8Array.from&&t.from||function(r,n){return new t(r,n)},N._Buffer_allocUnsafe=t.allocUnsafe||function(r){return new t(r)}}});var Xa=k((aE,F0)=>{"use strict";F0.exports=Q;var st=gr(),Wa,wi=st.LongBits,N0=st.base64,L0=st.utf8;function ps(t,e,r){this.fn=t,this.len=e,this.next=void 0,this.val=r}function $a(){}function j1(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function Q(){this.len=0,this.head=new ps($a,0,0),this.tail=this.head,this.states=null}var O0=function(){return st.Buffer?function(){return(Q.create=function(){return new Wa})()}:function(){return new Q}};Q.create=O0();Q.alloc=function(e){return new st.Array(e)};st.Array!==Array&&(Q.alloc=st.pool(Q.alloc,st.Array.prototype.subarray));Q.prototype._push=function(e,r,n){return this.tail=this.tail.next=new ps(e,r,n),this.len+=r,this};function Za(t,e,r){e[r]=t&255}function $1(t,e,r){for(;t>127;)e[r++]=t&127|128,t>>>=7;e[r]=t}function Ya(t,e){this.len=t,this.next=void 0,this.val=e}Ya.prototype=Object.create(ps.prototype);Ya.prototype.fn=$1;Q.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new Ya((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};Q.prototype.int32=function(e){return e<0?this._push(Qa,10,wi.fromNumber(e)):this.uint32(e)};Q.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function Qa(t,e,r){for(;t.hi;)e[r++]=t.lo&127|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;t.lo>127;)e[r++]=t.lo&127|128,t.lo=t.lo>>>7;e[r++]=t.lo}Q.prototype.uint64=function(e){var r=wi.from(e);return this._push(Qa,r.length(),r)};Q.prototype.int64=Q.prototype.uint64;Q.prototype.sint64=function(e){var r=wi.from(e).zzEncode();return this._push(Qa,r.length(),r)};Q.prototype.bool=function(e){return this._push(Za,1,e?1:0)};function ja(t,e,r){e[r]=t&255,e[r+1]=t>>>8&255,e[r+2]=t>>>16&255,e[r+3]=t>>>24}Q.prototype.fixed32=function(e){return this._push(ja,4,e>>>0)};Q.prototype.sfixed32=Q.prototype.fixed32;Q.prototype.fixed64=function(e){var r=wi.from(e);return this._push(ja,4,r.lo)._push(ja,4,r.hi)};Q.prototype.sfixed64=Q.prototype.fixed64;Q.prototype.float=function(e){return this._push(st.float.writeFloatLE,4,e)};Q.prototype.double=function(e){return this._push(st.float.writeDoubleLE,8,e)};var Z1=st.Array.prototype.set?function(e,r,n){r.set(e,n)}:function(e,r,n){for(var s=0;s<e.length;++s)r[n+s]=e[s]};Q.prototype.bytes=function(e){var r=e.length>>>0;if(!r)return this._push(Za,1,0);if(st.isString(e)){var n=Q.alloc(r=N0.length(e));N0.decode(e,n,0),e=n}return this.uint32(r)._push(Z1,r,e)};Q.prototype.string=function(e){var r=L0.length(e);return r?this.uint32(r)._push(L0.write,r,e):this._push(Za,1,0)};Q.prototype.fork=function(){return this.states=new j1(this),this.head=this.tail=new ps($a,0,0),this.len=0,this};Q.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new ps($a,0,0),this.len=0),this};Q.prototype.ldelim=function(){var e=this.head,r=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=r,this.len+=n),this};Q.prototype.finish=function(){for(var e=this.head.next,r=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,r,n),n+=e.len,e=e.next;return r};Q._configure=function(t){Wa=t,Q.create=O0(),Wa._configure()}});var z0=k((cE,K0)=>{"use strict";K0.exports=Dt;var U0=Xa();(Dt.prototype=Object.create(U0.prototype)).constructor=Dt;var yr=gr();function Dt(){U0.call(this)}Dt._configure=function(){Dt.alloc=yr._Buffer_allocUnsafe,Dt.writeBytesBuffer=yr.Buffer&&yr.Buffer.prototype instanceof Uint8Array&&yr.Buffer.prototype.set.name==="set"?function(e,r,n){r.set(e,n)}:function(e,r,n){if(e.copy)e.copy(r,n,0,e.length);else for(var s=0;s<e.length;)r[n++]=e[s++]}};Dt.prototype.bytes=function(e){yr.isString(e)&&(e=yr._Buffer_from(e,"base64"));var r=e.length>>>0;return this.uint32(r),r&&this._push(Dt.writeBytesBuffer,r,e),this};function Y1(t,e,r){t.length<40?yr.utf8.write(t,e,r):e.utf8Write?e.utf8Write(t,r):e.write(t,r)}Dt.prototype.string=function(e){var r=yr.Buffer.byteLength(e);return this.uint32(r),r&&this._push(Y1,r,e),this};Dt._configure()});var tc=k((uE,W0)=>{"use strict";W0.exports=Ee;var kt=gr(),ec,G0=kt.LongBits,Q1=kt.utf8;function gt(t,e){return RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}function Ee(t){this.buf=t,this.pos=0,this.len=t.length}var q0=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Ee(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Ee(e);throw Error("illegal buffer")},H0=function(){return kt.Buffer?function(r){return(Ee.create=function(s){return kt.Buffer.isBuffer(s)?new ec(s):q0(s)})(r)}:q0};Ee.create=H0();Ee.prototype._slice=kt.Array.prototype.subarray||kt.Array.prototype.slice;Ee.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,gt(this,10);return e}}();Ee.prototype.int32=function(){return this.uint32()|0};Ee.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function Ja(){var t=new G0(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(t.lo=(t.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(this.buf[this.pos]&127)<<28)>>>0,t.hi=(t.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return t;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw gt(this);if(t.lo=(t.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,t}if(this.len-this.pos>4){for(;e<5;++e)if(t.hi=(t.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw gt(this);if(t.hi=(t.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}Ee.prototype.bool=function(){return this.uint32()!==0};function Si(t,e){return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0}Ee.prototype.fixed32=function(){if(this.pos+4>this.len)throw gt(this,4);return Si(this.buf,this.pos+=4)};Ee.prototype.sfixed32=function(){if(this.pos+4>this.len)throw gt(this,4);return Si(this.buf,this.pos+=4)|0};function V0(){if(this.pos+8>this.len)throw gt(this,8);return new G0(Si(this.buf,this.pos+=4),Si(this.buf,this.pos+=4))}Ee.prototype.float=function(){if(this.pos+4>this.len)throw gt(this,4);var e=kt.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};Ee.prototype.double=function(){if(this.pos+8>this.len)throw gt(this,4);var e=kt.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};Ee.prototype.bytes=function(){var e=this.uint32(),r=this.pos,n=this.pos+e;if(n>this.len)throw gt(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(r,n):r===n?new this.buf.constructor(0):this._slice.call(this.buf,r,n)};Ee.prototype.string=function(){var e=this.bytes();return Q1.read(e,0,e.length)};Ee.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw gt(this,e);this.pos+=e}else do if(this.pos>=this.len)throw gt(this);while(this.buf[this.pos++]&128);return this};Ee.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(t=this.uint32()&7)!==4;)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this};Ee._configure=function(t){ec=t,Ee.create=H0(),ec._configure();var e=kt.Long?"toLong":"toNumber";kt.merge(Ee.prototype,{int64:function(){return Ja.call(this)[e](!1)},uint64:function(){return Ja.call(this)[e](!0)},sint64:function(){return Ja.call(this).zzDecode()[e](!1)},fixed64:function(){return V0.call(this)[e](!0)},sfixed64:function(){return V0.call(this)[e](!1)}})}});var Y0=k((fE,Z0)=>{"use strict";Z0.exports=Ur;var $0=tc();(Ur.prototype=Object.create($0.prototype)).constructor=Ur;var j0=gr();function Ur(t){$0.call(this,t)}Ur._configure=function(){j0.Buffer&&(Ur.prototype._slice=j0.Buffer.prototype.slice)};Ur.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};Ur._configure()});var X0=k((hE,Q0)=>{"use strict";Q0.exports=ds;var rc=gr();(ds.prototype=Object.create(rc.EventEmitter.prototype)).constructor=ds;function ds(t,e,r){if(typeof t!="function")throw TypeError("rpcImpl must be a function");rc.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=Boolean(e),this.responseDelimited=Boolean(r)}ds.prototype.rpcCall=function t(e,r,n,s,i){if(!s)throw TypeError("request must be specified");var o=this;if(!i)return rc.asPromise(t,o,e,r,n,s);if(!o.rpcImpl){setTimeout(function(){i(Error("already ended"))},0);return}try{return o.rpcImpl(e,r[o.requestDelimited?"encodeDelimited":"encode"](s).finish(),function(f,u){if(f)return o.emit("error",f,e),i(f);if(u===null){o.end(!0);return}if(!(u instanceof n))try{u=n[o.responseDelimited?"decodeDelimited":"decode"](u)}catch(c){return o.emit("error",c,e),i(c)}return o.emit("data",u,e),i(null,u)})}catch(a){o.emit("error",a,e),setTimeout(function(){i(a)},0);return}};ds.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var el=k(J0=>{"use strict";var X1=J0;X1.Service=X0()});var rl=k((pE,tl)=>{"use strict";tl.exports={}});var il=k(sl=>{"use strict";var We=sl;We.build="minimal";We.Writer=Xa();We.BufferWriter=z0();We.Reader=tc();We.BufferReader=Y0();We.util=gr();We.rpc=el();We.roots=rl();We.configure=nl;function nl(){We.util._configure(),We.Writer._configure(We.BufferWriter),We.Reader._configure(We.BufferReader)}nl()});var nc=k((gE,ol)=>{"use strict";ol.exports=il()});var cl=k((al,gs)=>{"use strict";(function(t,e){typeof define=="function"&&define.amd?define(["protobufjs/minimal"],e):typeof hc=="function"&&typeof gs=="object"&&gs&&gs.exports&&(gs.exports=e(nc()))})(al,function(t){"use strict";var e=t.Reader,r=t.Writer,n=t.util,s=t.roots.default||(t.roots.default={});return s.RPC=function(){function i(a){if(this.subscriptions=[],this.messages=[],a)for(var f=Object.keys(a),u=0;u<f.length;++u)a[f[u]]!=null&&(this[f[u]]=a[f[u]])}i.prototype.subscriptions=n.emptyArray,i.prototype.messages=n.emptyArray,i.prototype.control=null;var o;return Object.defineProperty(i.prototype,"_control",{get:n.oneOfGetter(o=["control"]),set:n.oneOfSetter(o)}),i.encode=function(f,u){if(u||(u=r.create()),f.subscriptions!=null&&f.subscriptions.length)for(var c=0;c<f.subscriptions.length;++c)s.RPC.SubOpts.encode(f.subscriptions[c],u.uint32(10).fork()).ldelim();if(f.messages!=null&&f.messages.length)for(var c=0;c<f.messages.length;++c)s.RPC.Message.encode(f.messages[c],u.uint32(18).fork()).ldelim();return f.control!=null&&Object.hasOwnProperty.call(f,"control")&&s.RPC.ControlMessage.encode(f.control,u.uint32(26).fork()).ldelim(),u},i.decode=function(f,u){f instanceof e||(f=e.create(f));for(var c=u===void 0?f.len:f.pos+u,h=new s.RPC;f.pos<c;){var l=f.uint32();switch(l>>>3){case 1:h.subscriptions&&h.subscriptions.length||(h.subscriptions=[]),h.subscriptions.push(s.RPC.SubOpts.decode(f,f.uint32()));break;case 2:h.messages&&h.messages.length||(h.messages=[]),h.messages.push(s.RPC.Message.decode(f,f.uint32()));break;case 3:h.control=s.RPC.ControlMessage.decode(f,f.uint32());break;default:f.skipType(l&7);break}}return h},i.fromObject=function(f){if(f instanceof s.RPC)return f;var u=new s.RPC;if(f.subscriptions){if(!Array.isArray(f.subscriptions))throw TypeError(".RPC.subscriptions: array expected");u.subscriptions=[];for(var c=0;c<f.subscriptions.length;++c){if(typeof f.subscriptions[c]!="object")throw TypeError(".RPC.subscriptions: object expected");u.subscriptions[c]=s.RPC.SubOpts.fromObject(f.subscriptions[c])}}if(f.messages){if(!Array.isArray(f.messages))throw TypeError(".RPC.messages: array expected");u.messages=[];for(var c=0;c<f.messages.length;++c){if(typeof f.messages[c]!="object")throw TypeError(".RPC.messages: object expected");u.messages[c]=s.RPC.Message.fromObject(f.messages[c])}}if(f.control!=null){if(typeof f.control!="object")throw TypeError(".RPC.control: object expected");u.control=s.RPC.ControlMessage.fromObject(f.control)}return u},i.toObject=function(f,u){u||(u={});var c={};if((u.arrays||u.defaults)&&(c.subscriptions=[],c.messages=[]),f.subscriptions&&f.subscriptions.length){c.subscriptions=[];for(var h=0;h<f.subscriptions.length;++h)c.subscriptions[h]=s.RPC.SubOpts.toObject(f.subscriptions[h],u)}if(f.messages&&f.messages.length){c.messages=[];for(var h=0;h<f.messages.length;++h)c.messages[h]=s.RPC.Message.toObject(f.messages[h],u)}return f.control!=null&&f.hasOwnProperty("control")&&(c.control=s.RPC.ControlMessage.toObject(f.control,u),u.oneofs&&(c._control="control")),c},i.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},i.SubOpts=function(){function a(u){if(u)for(var c=Object.keys(u),h=0;h<c.length;++h)u[c[h]]!=null&&(this[c[h]]=u[c[h]])}a.prototype.subscribe=null,a.prototype.topic=null;var f;return Object.defineProperty(a.prototype,"_subscribe",{get:n.oneOfGetter(f=["subscribe"]),set:n.oneOfSetter(f)}),Object.defineProperty(a.prototype,"_topic",{get:n.oneOfGetter(f=["topic"]),set:n.oneOfSetter(f)}),a.encode=function(c,h){return h||(h=r.create()),c.subscribe!=null&&Object.hasOwnProperty.call(c,"subscribe")&&h.uint32(8).bool(c.subscribe),c.topic!=null&&Object.hasOwnProperty.call(c,"topic")&&h.uint32(18).string(c.topic),h},a.decode=function(c,h){c instanceof e||(c=e.create(c));for(var l=h===void 0?c.len:c.pos+h,d=new s.RPC.SubOpts;c.pos<l;){var p=c.uint32();switch(p>>>3){case 1:d.subscribe=c.bool();break;case 2:d.topic=c.string();break;default:c.skipType(p&7);break}}return d},a.fromObject=function(c){if(c instanceof s.RPC.SubOpts)return c;var h=new s.RPC.SubOpts;return c.subscribe!=null&&(h.subscribe=Boolean(c.subscribe)),c.topic!=null&&(h.topic=String(c.topic)),h},a.toObject=function(c,h){h||(h={});var l={};return c.subscribe!=null&&c.hasOwnProperty("subscribe")&&(l.subscribe=c.subscribe,h.oneofs&&(l._subscribe="subscribe")),c.topic!=null&&c.hasOwnProperty("topic")&&(l.topic=c.topic,h.oneofs&&(l._topic="topic")),l},a.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},a}(),i.Message=function(){function a(u){if(u)for(var c=Object.keys(u),h=0;h<c.length;++h)u[c[h]]!=null&&(this[c[h]]=u[c[h]])}a.prototype.from=null,a.prototype.data=null,a.prototype.seqno=null,a.prototype.topic="",a.prototype.signature=null,a.prototype.key=null;var f;return Object.defineProperty(a.prototype,"_from",{get:n.oneOfGetter(f=["from"]),set:n.oneOfSetter(f)}),Object.defineProperty(a.prototype,"_data",{get:n.oneOfGetter(f=["data"]),set:n.oneOfSetter(f)}),Object.defineProperty(a.prototype,"_seqno",{get:n.oneOfGetter(f=["seqno"]),set:n.oneOfSetter(f)}),Object.defineProperty(a.prototype,"_signature",{get:n.oneOfGetter(f=["signature"]),set:n.oneOfSetter(f)}),Object.defineProperty(a.prototype,"_key",{get:n.oneOfGetter(f=["key"]),set:n.oneOfSetter(f)}),a.encode=function(c,h){return h||(h=r.create()),c.from!=null&&Object.hasOwnProperty.call(c,"from")&&h.uint32(10).bytes(c.from),c.data!=null&&Object.hasOwnProperty.call(c,"data")&&h.uint32(18).bytes(c.data),c.seqno!=null&&Object.hasOwnProperty.call(c,"seqno")&&h.uint32(26).bytes(c.seqno),h.uint32(34).string(c.topic),c.signature!=null&&Object.hasOwnProperty.call(c,"signature")&&h.uint32(42).bytes(c.signature),c.key!=null&&Object.hasOwnProperty.call(c,"key")&&h.uint32(50).bytes(c.key),h},a.decode=function(c,h){c instanceof e||(c=e.create(c));for(var l=h===void 0?c.len:c.pos+h,d=new s.RPC.Message;c.pos<l;){var p=c.uint32();switch(p>>>3){case 1:d.from=c.bytes();break;case 2:d.data=c.bytes();break;case 3:d.seqno=c.bytes();break;case 4:d.topic=c.string();break;case 5:d.signature=c.bytes();break;case 6:d.key=c.bytes();break;default:c.skipType(p&7);break}}if(!d.hasOwnProperty("topic"))throw n.ProtocolError("missing required 'topic'",{instance:d});return d},a.fromObject=function(c){if(c instanceof s.RPC.Message)return c;var h=new s.RPC.Message;return c.from!=null&&(typeof c.from=="string"?n.base64.decode(c.from,h.from=n.newBuffer(n.base64.length(c.from)),0):c.from.length&&(h.from=c.from)),c.data!=null&&(typeof c.data=="string"?n.base64.decode(c.data,h.data=n.newBuffer(n.base64.length(c.data)),0):c.data.length&&(h.data=c.data)),c.seqno!=null&&(typeof c.seqno=="string"?n.base64.decode(c.seqno,h.seqno=n.newBuffer(n.base64.length(c.seqno)),0):c.seqno.length&&(h.seqno=c.seqno)),c.topic!=null&&(h.topic=String(c.topic)),c.signature!=null&&(typeof c.signature=="string"?n.base64.decode(c.signature,h.signature=n.newBuffer(n.base64.length(c.signature)),0):c.signature.length&&(h.signature=c.signature)),c.key!=null&&(typeof c.key=="string"?n.base64.decode(c.key,h.key=n.newBuffer(n.base64.length(c.key)),0):c.key.length&&(h.key=c.key)),h},a.toObject=function(c,h){h||(h={});var l={};return h.defaults&&(l.topic=""),c.from!=null&&c.hasOwnProperty("from")&&(l.from=h.bytes===String?n.base64.encode(c.from,0,c.from.length):h.bytes===Array?Array.prototype.slice.call(c.from):c.from,h.oneofs&&(l._from="from")),c.data!=null&&c.hasOwnProperty("data")&&(l.data=h.bytes===String?n.base64.encode(c.data,0,c.data.length):h.bytes===Array?Array.prototype.slice.call(c.data):c.data,h.oneofs&&(l._data="data")),c.seqno!=null&&c.hasOwnProperty("seqno")&&(l.seqno=h.bytes===String?n.base64.encode(c.seqno,0,c.seqno.length):h.bytes===Array?Array.prototype.slice.call(c.seqno):c.seqno,h.oneofs&&(l._seqno="seqno")),c.topic!=null&&c.hasOwnProperty("topic")&&(l.topic=c.topic),c.signature!=null&&c.hasOwnProperty("signature")&&(l.signature=h.bytes===String?n.base64.encode(c.signature,0,c.signature.length):h.bytes===Array?Array.prototype.slice.call(c.signature):c.signature,h.oneofs&&(l._signature="signature")),c.key!=null&&c.hasOwnProperty("key")&&(l.key=h.bytes===String?n.base64.encode(c.key,0,c.key.length):h.bytes===Array?Array.prototype.slice.call(c.key):c.key,h.oneofs&&(l._key="key")),l},a.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},a}(),i.ControlMessage=function(){function a(f){if(this.ihave=[],this.iwant=[],this.graft=[],this.prune=[],f)for(var u=Object.keys(f),c=0;c<u.length;++c)f[u[c]]!=null&&(this[u[c]]=f[u[c]])}return a.prototype.ihave=n.emptyArray,a.prototype.iwant=n.emptyArray,a.prototype.graft=n.emptyArray,a.prototype.prune=n.emptyArray,a.encode=function(u,c){if(c||(c=r.create()),u.ihave!=null&&u.ihave.length)for(var h=0;h<u.ihave.length;++h)s.RPC.ControlIHave.encode(u.ihave[h],c.uint32(10).fork()).ldelim();if(u.iwant!=null&&u.iwant.length)for(var h=0;h<u.iwant.length;++h)s.RPC.ControlIWant.encode(u.iwant[h],c.uint32(18).fork()).ldelim();if(u.graft!=null&&u.graft.length)for(var h=0;h<u.graft.length;++h)s.RPC.ControlGraft.encode(u.graft[h],c.uint32(26).fork()).ldelim();if(u.prune!=null&&u.prune.length)for(var h=0;h<u.prune.length;++h)s.RPC.ControlPrune.encode(u.prune[h],c.uint32(34).fork()).ldelim();return c},a.decode=function(u,c){u instanceof e||(u=e.create(u));for(var h=c===void 0?u.len:u.pos+c,l=new s.RPC.ControlMessage;u.pos<h;){var d=u.uint32();switch(d>>>3){case 1:l.ihave&&l.ihave.length||(l.ihave=[]),l.ihave.push(s.RPC.ControlIHave.decode(u,u.uint32()));break;case 2:l.iwant&&l.iwant.length||(l.iwant=[]),l.iwant.push(s.RPC.ControlIWant.decode(u,u.uint32()));break;case 3:l.graft&&l.graft.length||(l.graft=[]),l.graft.push(s.RPC.ControlGraft.decode(u,u.uint32()));break;case 4:l.prune&&l.prune.length||(l.prune=[]),l.prune.push(s.RPC.ControlPrune.decode(u,u.uint32()));break;default:u.skipType(d&7);break}}return l},a.fromObject=function(u){if(u instanceof s.RPC.ControlMessage)return u;var c=new s.RPC.ControlMessage;if(u.ihave){if(!Array.isArray(u.ihave))throw TypeError(".RPC.ControlMessage.ihave: array expected");c.ihave=[];for(var h=0;h<u.ihave.length;++h){if(typeof u.ihave[h]!="object")throw TypeError(".RPC.ControlMessage.ihave: object expected");c.ihave[h]=s.RPC.ControlIHave.fromObject(u.ihave[h])}}if(u.iwant){if(!Array.isArray(u.iwant))throw TypeError(".RPC.ControlMessage.iwant: array expected");c.iwant=[];for(var h=0;h<u.iwant.length;++h){if(typeof u.iwant[h]!="object")throw TypeError(".RPC.ControlMessage.iwant: object expected");c.iwant[h]=s.RPC.ControlIWant.fromObject(u.iwant[h])}}if(u.graft){if(!Array.isArray(u.graft))throw TypeError(".RPC.ControlMessage.graft: array expected");c.graft=[];for(var h=0;h<u.graft.length;++h){if(typeof u.graft[h]!="object")throw TypeError(".RPC.ControlMessage.graft: object expected");c.graft[h]=s.RPC.ControlGraft.fromObject(u.graft[h])}}if(u.prune){if(!Array.isArray(u.prune))throw TypeError(".RPC.ControlMessage.prune: array expected");c.prune=[];for(var h=0;h<u.prune.length;++h){if(typeof u.prune[h]!="object")throw TypeError(".RPC.ControlMessage.prune: object expected");c.prune[h]=s.RPC.ControlPrune.fromObject(u.prune[h])}}return c},a.toObject=function(u,c){c||(c={});var h={};if((c.arrays||c.defaults)&&(h.ihave=[],h.iwant=[],h.graft=[],h.prune=[]),u.ihave&&u.ihave.length){h.ihave=[];for(var l=0;l<u.ihave.length;++l)h.ihave[l]=s.RPC.ControlIHave.toObject(u.ihave[l],c)}if(u.iwant&&u.iwant.length){h.iwant=[];for(var l=0;l<u.iwant.length;++l)h.iwant[l]=s.RPC.ControlIWant.toObject(u.iwant[l],c)}if(u.graft&&u.graft.length){h.graft=[];for(var l=0;l<u.graft.length;++l)h.graft[l]=s.RPC.ControlGraft.toObject(u.graft[l],c)}if(u.prune&&u.prune.length){h.prune=[];for(var l=0;l<u.prune.length;++l)h.prune[l]=s.RPC.ControlPrune.toObject(u.prune[l],c)}return h},a.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},a}(),i.ControlIHave=function(){function a(u){if(this.messageIDs=[],u)for(var c=Object.keys(u),h=0;h<c.length;++h)u[c[h]]!=null&&(this[c[h]]=u[c[h]])}a.prototype.topicID=null,a.prototype.messageIDs=n.emptyArray;var f;return Object.defineProperty(a.prototype,"_topicID",{get:n.oneOfGetter(f=["topicID"]),set:n.oneOfSetter(f)}),a.encode=function(c,h){if(h||(h=r.create()),c.topicID!=null&&Object.hasOwnProperty.call(c,"topicID")&&h.uint32(10).string(c.topicID),c.messageIDs!=null&&c.messageIDs.length)for(var l=0;l<c.messageIDs.length;++l)h.uint32(18).bytes(c.messageIDs[l]);return h},a.decode=function(c,h){c instanceof e||(c=e.create(c));for(var l=h===void 0?c.len:c.pos+h,d=new s.RPC.ControlIHave;c.pos<l;){var p=c.uint32();switch(p>>>3){case 1:d.topicID=c.string();break;case 2:d.messageIDs&&d.messageIDs.length||(d.messageIDs=[]),d.messageIDs.push(c.bytes());break;default:c.skipType(p&7);break}}return d},a.fromObject=function(c){if(c instanceof s.RPC.ControlIHave)return c;var h=new s.RPC.ControlIHave;if(c.topicID!=null&&(h.topicID=String(c.topicID)),c.messageIDs){if(!Array.isArray(c.messageIDs))throw TypeError(".RPC.ControlIHave.messageIDs: array expected");h.messageIDs=[];for(var l=0;l<c.messageIDs.length;++l)typeof c.messageIDs[l]=="string"?n.base64.decode(c.messageIDs[l],h.messageIDs[l]=n.newBuffer(n.base64.length(c.messageIDs[l])),0):c.messageIDs[l].length&&(h.messageIDs[l]=c.messageIDs[l])}return h},a.toObject=function(c,h){h||(h={});var l={};if((h.arrays||h.defaults)&&(l.messageIDs=[]),c.topicID!=null&&c.hasOwnProperty("topicID")&&(l.topicID=c.topicID,h.oneofs&&(l._topicID="topicID")),c.messageIDs&&c.messageIDs.length){l.messageIDs=[];for(var d=0;d<c.messageIDs.length;++d)l.messageIDs[d]=h.bytes===String?n.base64.encode(c.messageIDs[d],0,c.messageIDs[d].length):h.bytes===Array?Array.prototype.slice.call(c.messageIDs[d]):c.messageIDs[d]}return l},a.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},a}(),i.ControlIWant=function(){function a(f){if(this.messageIDs=[],f)for(var u=Object.keys(f),c=0;c<u.length;++c)f[u[c]]!=null&&(this[u[c]]=f[u[c]])}return a.prototype.messageIDs=n.emptyArray,a.encode=function(u,c){if(c||(c=r.create()),u.messageIDs!=null&&u.messageIDs.length)for(var h=0;h<u.messageIDs.length;++h)c.uint32(10).bytes(u.messageIDs[h]);return c},a.decode=function(u,c){u instanceof e||(u=e.create(u));for(var h=c===void 0?u.len:u.pos+c,l=new s.RPC.ControlIWant;u.pos<h;){var d=u.uint32();switch(d>>>3){case 1:l.messageIDs&&l.messageIDs.length||(l.messageIDs=[]),l.messageIDs.push(u.bytes());break;default:u.skipType(d&7);break}}return l},a.fromObject=function(u){if(u instanceof s.RPC.ControlIWant)return u;var c=new s.RPC.ControlIWant;if(u.messageIDs){if(!Array.isArray(u.messageIDs))throw TypeError(".RPC.ControlIWant.messageIDs: array expected");c.messageIDs=[];for(var h=0;h<u.messageIDs.length;++h)typeof u.messageIDs[h]=="string"?n.base64.decode(u.messageIDs[h],c.messageIDs[h]=n.newBuffer(n.base64.length(u.messageIDs[h])),0):u.messageIDs[h].length&&(c.messageIDs[h]=u.messageIDs[h])}return c},a.toObject=function(u,c){c||(c={});var h={};if((c.arrays||c.defaults)&&(h.messageIDs=[]),u.messageIDs&&u.messageIDs.length){h.messageIDs=[];for(var l=0;l<u.messageIDs.length;++l)h.messageIDs[l]=c.bytes===String?n.base64.encode(u.messageIDs[l],0,u.messageIDs[l].length):c.bytes===Array?Array.prototype.slice.call(u.messageIDs[l]):u.messageIDs[l]}return h},a.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},a}(),i.ControlGraft=function(){function a(u){if(u)for(var c=Object.keys(u),h=0;h<c.length;++h)u[c[h]]!=null&&(this[c[h]]=u[c[h]])}a.prototype.topicID=null;var f;return Object.defineProperty(a.prototype,"_topicID",{get:n.oneOfGetter(f=["topicID"]),set:n.oneOfSetter(f)}),a.encode=function(c,h){return h||(h=r.create()),c.topicID!=null&&Object.hasOwnProperty.call(c,"topicID")&&h.uint32(10).string(c.topicID),h},a.decode=function(c,h){c instanceof e||(c=e.create(c));for(var l=h===void 0?c.len:c.pos+h,d=new s.RPC.ControlGraft;c.pos<l;){var p=c.uint32();switch(p>>>3){case 1:d.topicID=c.string();break;default:c.skipType(p&7);break}}return d},a.fromObject=function(c){if(c instanceof s.RPC.ControlGraft)return c;var h=new s.RPC.ControlGraft;return c.topicID!=null&&(h.topicID=String(c.topicID)),h},a.toObject=function(c,h){h||(h={});var l={};return c.topicID!=null&&c.hasOwnProperty("topicID")&&(l.topicID=c.topicID,h.oneofs&&(l._topicID="topicID")),l},a.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},a}(),i.ControlPrune=function(){function a(u){if(this.peers=[],u)for(var c=Object.keys(u),h=0;h<c.length;++h)u[c[h]]!=null&&(this[c[h]]=u[c[h]])}a.prototype.topicID=null,a.prototype.peers=n.emptyArray,a.prototype.backoff=null;var f;return Object.defineProperty(a.prototype,"_topicID",{get:n.oneOfGetter(f=["topicID"]),set:n.oneOfSetter(f)}),Object.defineProperty(a.prototype,"_backoff",{get:n.oneOfGetter(f=["backoff"]),set:n.oneOfSetter(f)}),a.encode=function(c,h){if(h||(h=r.create()),c.topicID!=null&&Object.hasOwnProperty.call(c,"topicID")&&h.uint32(10).string(c.topicID),c.peers!=null&&c.peers.length)for(var l=0;l<c.peers.length;++l)s.RPC.PeerInfo.encode(c.peers[l],h.uint32(18).fork()).ldelim();return c.backoff!=null&&Object.hasOwnProperty.call(c,"backoff")&&h.uint32(24).uint64(c.backoff),h},a.decode=function(c,h){c instanceof e||(c=e.create(c));for(var l=h===void 0?c.len:c.pos+h,d=new s.RPC.ControlPrune;c.pos<l;){var p=c.uint32();switch(p>>>3){case 1:d.topicID=c.string();break;case 2:d.peers&&d.peers.length||(d.peers=[]),d.peers.push(s.RPC.PeerInfo.decode(c,c.uint32()));break;case 3:d.backoff=c.uint64();break;default:c.skipType(p&7);break}}return d},a.fromObject=function(c){if(c instanceof s.RPC.ControlPrune)return c;var h=new s.RPC.ControlPrune;if(c.topicID!=null&&(h.topicID=String(c.topicID)),c.peers){if(!Array.isArray(c.peers))throw TypeError(".RPC.ControlPrune.peers: array expected");h.peers=[];for(var l=0;l<c.peers.length;++l){if(typeof c.peers[l]!="object")throw TypeError(".RPC.ControlPrune.peers: object expected");h.peers[l]=s.RPC.PeerInfo.fromObject(c.peers[l])}}return c.backoff!=null&&(n.Long?(h.backoff=n.Long.fromValue(c.backoff)).unsigned=!0:typeof c.backoff=="string"?h.backoff=parseInt(c.backoff,10):typeof c.backoff=="number"?h.backoff=c.backoff:typeof c.backoff=="object"&&(h.backoff=new n.LongBits(c.backoff.low>>>0,c.backoff.high>>>0).toNumber(!0))),h},a.toObject=function(c,h){h||(h={});var l={};if((h.arrays||h.defaults)&&(l.peers=[]),c.topicID!=null&&c.hasOwnProperty("topicID")&&(l.topicID=c.topicID,h.oneofs&&(l._topicID="topicID")),c.peers&&c.peers.length){l.peers=[];for(var d=0;d<c.peers.length;++d)l.peers[d]=s.RPC.PeerInfo.toObject(c.peers[d],h)}return c.backoff!=null&&c.hasOwnProperty("backoff")&&(typeof c.backoff=="number"?l.backoff=h.longs===String?String(c.backoff):c.backoff:l.backoff=h.longs===String?n.Long.prototype.toString.call(c.backoff):h.longs===Number?new n.LongBits(c.backoff.low>>>0,c.backoff.high>>>0).toNumber(!0):c.backoff,h.oneofs&&(l._backoff="backoff")),l},a.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},a}(),i.PeerInfo=function(){function a(u){if(u)for(var c=Object.keys(u),h=0;h<c.length;++h)u[c[h]]!=null&&(this[c[h]]=u[c[h]])}a.prototype.peerID=null,a.prototype.signedPeerRecord=null;var f;return Object.defineProperty(a.prototype,"_peerID",{get:n.oneOfGetter(f=["peerID"]),set:n.oneOfSetter(f)}),Object.defineProperty(a.prototype,"_signedPeerRecord",{get:n.oneOfGetter(f=["signedPeerRecord"]),set:n.oneOfSetter(f)}),a.encode=function(c,h){return h||(h=r.create()),c.peerID!=null&&Object.hasOwnProperty.call(c,"peerID")&&h.uint32(10).bytes(c.peerID),c.signedPeerRecord!=null&&Object.hasOwnProperty.call(c,"signedPeerRecord")&&h.uint32(18).bytes(c.signedPeerRecord),h},a.decode=function(c,h){c instanceof e||(c=e.create(c));for(var l=h===void 0?c.len:c.pos+h,d=new s.RPC.PeerInfo;c.pos<l;){var p=c.uint32();switch(p>>>3){case 1:d.peerID=c.bytes();break;case 2:d.signedPeerRecord=c.bytes();break;default:c.skipType(p&7);break}}return d},a.fromObject=function(c){if(c instanceof s.RPC.PeerInfo)return c;var h=new s.RPC.PeerInfo;return c.peerID!=null&&(typeof c.peerID=="string"?n.base64.decode(c.peerID,h.peerID=n.newBuffer(n.base64.length(c.peerID)),0):c.peerID.length&&(h.peerID=c.peerID)),c.signedPeerRecord!=null&&(typeof c.signedPeerRecord=="string"?n.base64.decode(c.signedPeerRecord,h.signedPeerRecord=n.newBuffer(n.base64.length(c.signedPeerRecord)),0):c.signedPeerRecord.length&&(h.signedPeerRecord=c.signedPeerRecord)),h},a.toObject=function(c,h){h||(h={});var l={};return c.peerID!=null&&c.hasOwnProperty("peerID")&&(l.peerID=h.bytes===String?n.base64.encode(c.peerID,0,c.peerID.length):h.bytes===Array?Array.prototype.slice.call(c.peerID):c.peerID,h.oneofs&&(l._peerID="peerID")),c.signedPeerRecord!=null&&c.hasOwnProperty("signedPeerRecord")&&(l.signedPeerRecord=h.bytes===String?n.base64.encode(c.signedPeerRecord,0,c.signedPeerRecord.length):h.bytes===Array?Array.prototype.slice.call(c.signedPeerRecord):c.signedPeerRecord,h.oneofs&&(l._signedPeerRecord="signedPeerRecord")),l},a.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},a}(),i}(),s})});var vl=k((qE,bl)=>{"use strict";function be(t,r){var r=r||{};this._head=0,this._tail=0,this._capacity=r.capacity,this._capacityMask=3,this._list=new Array(4),Array.isArray(t)&&this._fromArray(t)}be.prototype.peekAt=function(e){var r=e;if(r===(r|0)){var n=this.size();if(!(r>=n||r<-n))return r<0&&(r+=n),r=this._head+r&this._capacityMask,this._list[r]}};be.prototype.get=function(e){return this.peekAt(e)};be.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]};be.prototype.peekFront=function(){return this.peek()};be.prototype.peekBack=function(){return this.peekAt(-1)};Object.defineProperty(be.prototype,"length",{get:function(){return this.size()}});be.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};be.prototype.unshift=function(e){if(e===void 0)return this.size();var r=this._list.length;return this._head=this._head-1+r&this._capacityMask,this._list[this._head]=e,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};be.prototype.shift=function(){var e=this._head;if(e!==this._tail){var r=this._list[e];return this._list[e]=void 0,this._head=e+1&this._capacityMask,e<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),r}};be.prototype.push=function(e){if(e===void 0)return this.size();var r=this._tail;return this._list[r]=e,this._tail=r+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)};be.prototype.pop=function(){var e=this._tail;if(e!==this._head){var r=this._list.length;this._tail=e-1+r&this._capacityMask;var n=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&e>1e4&&e<=r>>>2&&this._shrinkArray(),n}};be.prototype.removeOne=function(e){var r=e;if(r===(r|0)&&this._head!==this._tail){var n=this.size(),s=this._list.length;if(!(r>=n||r<-n)){r<0&&(r+=n),r=this._head+r&this._capacityMask;var i=this._list[r],o;if(e<n/2){for(o=e;o>0;o--)this._list[r]=this._list[r=r-1+s&this._capacityMask];this._list[r]=void 0,this._head=this._head+1+s&this._capacityMask}else{for(o=n-1-e;o>0;o--)this._list[r]=this._list[r=r+1+s&this._capacityMask];this._list[r]=void 0,this._tail=this._tail-1+s&this._capacityMask}return i}}};be.prototype.remove=function(e,r){var n=e,s,i=r;if(n===(n|0)&&this._head!==this._tail){var o=this.size(),a=this._list.length;if(!(n>=o||n<-o||r<1)){if(n<0&&(n+=o),r===1||!r)return s=new Array(1),s[0]=this.removeOne(n),s;if(n===0&&n+r>=o)return s=this.toArray(),this.clear(),s;n+r>o&&(r=o-n);var f;for(s=new Array(r),f=0;f<r;f++)s[f]=this._list[this._head+n+f&this._capacityMask];if(n=this._head+n&this._capacityMask,e+r===o){for(this._tail=this._tail-r+a&this._capacityMask,f=r;f>0;f--)this._list[n=n+1+a&this._capacityMask]=void 0;return s}if(e===0){for(this._head=this._head+r+a&this._capacityMask,f=r-1;f>0;f--)this._list[n=n+1+a&this._capacityMask]=void 0;return s}if(n<o/2){for(this._head=this._head+e+r+a&this._capacityMask,f=e;f>0;f--)this.unshift(this._list[n=n-1+a&this._capacityMask]);for(n=this._head-1+a&this._capacityMask;i>0;)this._list[n=n-1+a&this._capacityMask]=void 0,i--;e<0&&(this._tail=n)}else{for(this._tail=n,n=n+r+a&this._capacityMask,f=o-(r+e);f>0;f--)this.push(this._list[n++]);for(n=this._tail;i>0;)this._list[n=n+1+a&this._capacityMask]=void 0,i--}return this._head<2&&this._tail>1e4&&this._tail<=a>>>2&&this._shrinkArray(),s}}};be.prototype.splice=function(e,r){var n=e;if(n===(n|0)){var s=this.size();if(n<0&&(n+=s),!(n>s))if(arguments.length>2){var i,o,a,f=arguments.length,u=this._list.length,c=2;if(!s||n<s/2){for(o=new Array(n),i=0;i<n;i++)o[i]=this._list[this._head+i&this._capacityMask];for(r===0?(a=[],n>0&&(this._head=this._head+n+u&this._capacityMask)):(a=this.remove(n,r),this._head=this._head+n+u&this._capacityMask);f>c;)this.unshift(arguments[--f]);for(i=n;i>0;i--)this.unshift(o[i-1])}else{o=new Array(s-(n+r));var h=o.length;for(i=0;i<h;i++)o[i]=this._list[this._head+n+r+i&this._capacityMask];for(r===0?(a=[],n!=s&&(this._tail=this._head+n+u&this._capacityMask)):(a=this.remove(n,r),this._tail=this._tail-h+u&this._capacityMask);c<f;)this.push(arguments[c++]);for(i=0;i<h;i++)this.push(o[i])}return a}else return this.remove(n,r)}};be.prototype.clear=function(){this._head=0,this._tail=0};be.prototype.isEmpty=function(){return this._head===this._tail};be.prototype.toArray=function(){return this._copyArray(!1)};be.prototype._fromArray=function(e){for(var r=0;r<e.length;r++)this.push(e[r])};be.prototype._copyArray=function(e){var r=[],n=this._list,s=n.length,i;if(e||this._head>this._tail){for(i=this._head;i<s;i++)r.push(n[i]);for(i=0;i<this._tail;i++)r.push(n[i])}else for(i=this._head;i<this._tail;i++)r.push(n[i]);return r};be.prototype._growArray=function(){this._head&&(this._list=this._copyArray(!0),this._head=0),this._tail=this._list.length,this._list.length<<=1,this._capacityMask=this._capacityMask<<1|1};be.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1};bl.exports=be});var e2={};Ne(e2,{GossipSub:()=>xs,gossipsub:()=>Jb,multicodec:()=>Xb});var Es=class{constructor(e){if(!(e>0)||e-1&e)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){let e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}},Gr=class{constructor(e={}){this.hwm=e.splitLimit??16,this.head=new Es(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return e?.byteLength!=null?e.byteLength:1}push(e){if(e?.value!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){let r=this.head;this.head=r.next=new Es(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){let r=this.tail.next;this.tail.next=null,this.tail=r,e=this.tail.shift()}return e?.value!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}};function Nt(t={}){return Gl(r=>{let n=r.shift();if(n==null)return{done:!0};if(n.error!=null)throw n.error;return{done:n.done===!0,value:n.value}},t)}function Gl(t,e){e=e??{};let r=e.onEnd,n=new Gr,s,i,o,a=async()=>n.isEmpty()?o?{done:!0}:await new Promise((g,m)=>{i=v=>{i=null,n.push(v);try{g(t(n))}catch(S){m(S)}return s}}):t(n),f=g=>i!=null?i(g):(n.push(g),s),u=g=>(n=new Gr,i!=null?i({error:g}):(n.push({error:g}),s)),c=g=>{if(o)return s;if(e?.objectMode!==!0&&g?.byteLength==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return f({done:!1,value:g})},h=g=>o?s:(o=!0,g!=null?u(g):f({done:!0})),l=()=>(n=new Gr,h(),{done:!0}),d=g=>(h(g),{done:!0});if(s={[Symbol.asyncIterator](){return this},next:a,return:l,throw:d,push:c,end:h,get readableLength(){return n.size}},r==null)return s;let p=s;return s={[Symbol.asyncIterator](){return this},next(){return p.next()},throw(g){return p.throw(g),r!=null&&(r(g),r=void 0),{done:!0}},return(){return p.return(),r!=null&&(r(),r=void 0),{done:!0}},push:c,end(g){return p.end(g),r!=null&&(r(g),r=void 0),s},get readableLength(){return p.readableLength}},s}async function*Fi(...t){let e=Nt({objectMode:!0});Promise.resolve().then(async()=>{try{await Promise.all(t.map(async r=>{for await(let n of r)e.push(n)})),e.end()}catch(r){e.end(r)}}),yield*e}var Hl=(...t)=>{let e;for(;t.length>0;)e=t.shift()(e);return e},pc=t=>t!=null&&(typeof t[Symbol.asyncIterator]=="function"||typeof t[Symbol.iterator]=="function"||typeof t.next=="function"),Ui=t=>t!=null&&typeof t.sink=="function"&&pc(t.source),Wl=t=>e=>{let r=t.sink(e);if(r.then!=null){let n=Nt({objectMode:!0});return r.then(()=>{n.end()},i=>{n.end(i)}),Fi(n,async function*(){yield*t.source,n.end()}())}return t.source};function Hr(t,...e){if(Ui(t)){let n=t;t=()=>n.source}else if(pc(t)){let n=t;t=()=>n}let r=[t,...e];if(r.length>1&&Ui(r[r.length-1])&&(r[r.length-1]=r[r.length-1].sink),r.length>2)for(let n=1;n<r.length-1;n++)Ui(r[n])&&(r[n]=Wl(r[n]));return Hl(...r)}var Hh=U(Be(),1);var Gi={};Ne(Gi,{identity:()=>Jl});function $l(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var s=0;s<t.length;s++){var i=t.charAt(s),o=i.charCodeAt(0);if(r[o]!==255)throw new TypeError(i+" is ambiguous");r[o]=s}var a=t.length,f=t.charAt(0),u=Math.log(a)/Math.log(256),c=Math.log(256)/Math.log(a);function h(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var g=0,m=0,v=0,S=p.length;v!==S&&p[v]===0;)v++,g++;for(var C=(S-v)*c+1>>>0,T=new Uint8Array(C);v!==S;){for(var x=p[v],_=0,P=C-1;(x!==0||_<m)&&P!==-1;P--,_++)x+=256*T[P]>>>0,T[P]=x%a>>>0,x=x/a>>>0;if(x!==0)throw new Error("Non-zero carry");m=_,v++}for(var O=C-m;O!==C&&T[O]===0;)O++;for(var z=f.repeat(g);O<C;++O)z+=t.charAt(T[O]);return z}function l(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var g=0;if(p[g]!==" "){for(var m=0,v=0;p[g]===f;)m++,g++;for(var S=(p.length-g)*u+1>>>0,C=new Uint8Array(S);p[g];){var T=r[p.charCodeAt(g)];if(T===255)return;for(var x=0,_=S-1;(T!==0||x<v)&&_!==-1;_--,x++)T+=a*C[_]>>>0,C[_]=T%256>>>0,T=T/256>>>0;if(T!==0)throw new Error("Non-zero carry");v=x,g++}if(p[g]!==" "){for(var P=S-v;P!==S&&C[P]===0;)P++;for(var O=new Uint8Array(m+(S-P)),z=m;P!==S;)O[z++]=C[P++];return O}}}function d(p){var g=l(p);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:l,decode:d}}var Zl=$l,Yl=Zl,yc=Yl;var l2=new Uint8Array(0);var mc=(t,e)=>{if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(let r=0;r<t.byteLength;r++)if(t[r]!==e[r])return!1;return!0},Lt=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")};var bc=t=>new TextEncoder().encode(t),vc=t=>new TextDecoder().decode(t);var Ki=class{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},zi=class{constructor(e,r,n){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return wc(this,e)}},qi=class{constructor(e){this.decoders=e}or(e){return wc(this,e)}decode(e){let r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},wc=(t,e)=>new qi({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}}),Vi=class{constructor(e,r,n,s){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=s,this.encoder=new Ki(e,r,n),this.decoder=new zi(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},Wr=({name:t,prefix:e,encode:r,decode:n})=>new Vi(t,e,r,n),Qt=({prefix:t,name:e,alphabet:r})=>{let{encode:n,decode:s}=yc(r,e);return Wr({prefix:t,name:e,encode:n,decode:i=>Lt(s(i))})},Ql=(t,e,r,n)=>{let s={};for(let c=0;c<e.length;++c)s[e[c]]=c;let i=t.length;for(;t[i-1]==="=";)--i;let o=new Uint8Array(i*r/8|0),a=0,f=0,u=0;for(let c=0;c<i;++c){let h=s[t[c]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);f=f<<r|h,a+=r,a>=8&&(a-=8,o[u++]=255&f>>a)}if(a>=r||255&f<<8-a)throw new SyntaxError("Unexpected end of data");return o},Xl=(t,e,r)=>{let n=e[e.length-1]==="=",s=(1<<r)-1,i="",o=0,a=0;for(let f=0;f<t.length;++f)for(a=a<<8|t[f],o+=8;o>r;)o-=r,i+=e[s&a>>o];if(o&&(i+=e[s&a<<r-o]),n)for(;i.length*r&7;)i+="=";return i},ge=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>Wr({prefix:e,name:t,encode(s){return Xl(s,n,r)},decode(s){return Ql(s,n,r,t)}});var Jl=Wr({prefix:"\0",name:"identity",encode:t=>vc(t),decode:t=>bc(t)});var Hi={};Ne(Hi,{base2:()=>ep});var ep=ge({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Wi={};Ne(Wi,{base8:()=>tp});var tp=ge({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var ji={};Ne(ji,{base10:()=>rp});var rp=Qt({prefix:"9",name:"base10",alphabet:"0123456789"});var $i={};Ne($i,{base16:()=>np,base16upper:()=>sp});var np=ge({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),sp=ge({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Zi={};Ne(Zi,{base32:()=>ot,base32hex:()=>cp,base32hexpad:()=>fp,base32hexpadupper:()=>hp,base32hexupper:()=>up,base32pad:()=>op,base32padupper:()=>ap,base32upper:()=>ip,base32z:()=>lp});var ot=ge({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),ip=ge({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),op=ge({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),ap=ge({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),cp=ge({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),up=ge({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),fp=ge({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),hp=ge({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),lp=ge({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var Yi={};Ne(Yi,{base36:()=>pp,base36upper:()=>dp});var pp=Qt({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),dp=Qt({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Qi={};Ne(Qi,{base58btc:()=>ve,base58flickr:()=>gp});var ve=Qt({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),gp=Qt({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Xi={};Ne(Xi,{base64:()=>jr,base64pad:()=>yp,base64url:()=>mp,base64urlpad:()=>bp});var jr=ge({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),yp=ge({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),mp=ge({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),bp=ge({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Ji={};Ne(Ji,{base256emoji:()=>Ep});var Sc=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),vp=Sc.reduce((t,e,r)=>(t[r]=e,t),[]),xp=Sc.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function wp(t){return t.reduce((e,r)=>(e+=vp[r],e),"")}function Sp(t){let e=[];for(let r of t){let n=xp[r.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(n)}return new Uint8Array(e)}var Ep=Wr({prefix:"\u{1F680}",name:"base256emoji",encode:wp,decode:Sp});var no={};Ne(no,{sha256:()=>_e,sha512:()=>qp});var Ip=_c,Ec=128,_p=127,Cp=~_p,Ap=Math.pow(2,31);function _c(t,e,r){e=e||[],r=r||0;for(var n=r;t>=Ap;)e[r++]=t&255|Ec,t/=128;for(;t&Cp;)e[r++]=t&255|Ec,t>>>=7;return e[r]=t|0,_c.bytes=r-n+1,e}var Bp=eo,Tp=128,Ic=127;function eo(t,n){var r=0,n=n||0,s=0,i=n,o,a=t.length;do{if(i>=a)throw eo.bytes=0,new RangeError("Could not decode varint");o=t[i++],r+=s<28?(o&Ic)<<s:(o&Ic)*Math.pow(2,s),s+=7}while(o>=Tp);return eo.bytes=i-n,r}var Pp=Math.pow(2,7),Rp=Math.pow(2,14),Dp=Math.pow(2,21),kp=Math.pow(2,28),Mp=Math.pow(2,35),Np=Math.pow(2,42),Lp=Math.pow(2,49),Op=Math.pow(2,56),Fp=Math.pow(2,63),Up=function(t){return t<Pp?1:t<Rp?2:t<Dp?3:t<kp?4:t<Mp?5:t<Np?6:t<Lp?7:t<Op?8:t<Fp?9:10},Kp={encode:Ip,decode:Bp,encodingLength:Up},zp=Kp,kn=zp;var Mn=(t,e=0)=>[kn.decode(t,e),kn.decode.bytes],$r=(t,e,r=0)=>(kn.encode(t,e,r),e),Zr=t=>kn.encodingLength(t);var mt=(t,e)=>{let r=e.byteLength,n=Zr(t),s=n+Zr(r),i=new Uint8Array(s+r);return $r(t,i,0),$r(r,i,n),i.set(e,s),new Yr(t,r,e,i)},br=t=>{let e=Lt(t),[r,n]=Mn(e),[s,i]=Mn(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new Yr(r,s,o,e)},Cc=(t,e)=>{if(t===e)return!0;{let r=e;return t.code===r.code&&t.size===r.size&&r.bytes instanceof Uint8Array&&mc(t.bytes,r.bytes)}},Yr=class{constructor(e,r,n,s){this.code=e,this.size=r,this.digest=n,this.bytes=s}};var ro=({name:t,code:e,encode:r})=>new to(t,e,r),to=class{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}digest(e){if(e instanceof Uint8Array){let r=this.encode(e);return r instanceof Uint8Array?mt(this.code,r):r.then(n=>mt(this.code,n))}else throw Error("Unknown type, must be binary type")}};var Bc=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),_e=ro({name:"sha2-256",code:18,encode:Bc("SHA-256")}),qp=ro({name:"sha2-512",code:19,encode:Bc("SHA-512")});var so={};Ne(so,{identity:()=>Xt});var Tc=0,Vp="identity",Pc=Lt,Gp=t=>mt(Tc,Pc(t)),Xt={code:Tc,name:Vp,encode:Pc,digest:Gp};var k2=new TextEncoder,M2=new TextDecoder;var Rc=(t,e)=>{let{bytes:r,version:n}=t;switch(n){case 0:return $p(r,io(t),e||ve.encoder);default:return Zp(r,io(t),e||ot.encoder)}};var Dc=new WeakMap,io=t=>{let e=Dc.get(t);if(e==null){let r=new Map;return Dc.set(t,r),r}return e},se=class{constructor(e,r,n,s){this.code=r,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{let{code:e,multihash:r}=this;if(e!==Nn)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==Yp)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return se.createV0(r)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{let{code:e,digest:r}=this.multihash,n=mt(e,r);return se.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return se.equals(this,e)}static equals(e,r){let n=r;return n&&e.code===n.code&&e.version===n.version&&Cc(e.multihash,n.multihash)}toString(e){return Rc(this,e)}toJSON(){return{"/":Rc(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;let r=e;if(r instanceof se)return r;if(r["/"]!=null&&r["/"]===r.bytes||r.asCID===r){let{version:n,code:s,multihash:i,bytes:o}=r;return new se(n,s,i,o||kc(n,s,i.bytes))}else if(r[Qp]===!0){let{version:n,multihash:s,code:i}=r,o=br(s);return se.create(n,i,o)}else return null}static create(e,r,n){if(typeof r!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(r!==Nn)throw new Error(`Version 0 CID must use dag-pb (code: ${Nn}) block encoding`);return new se(e,r,n,n.bytes)}case 1:{let s=kc(e,r,n.bytes);return new se(e,r,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return se.create(0,Nn,e)}static createV1(e,r){return se.create(1,e,r)}static decode(e){let[r,n]=se.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return r}static decodeFirst(e){let r=se.inspectBytes(e),n=r.size-r.multihashSize,s=Lt(e.subarray(n,n+r.multihashSize));if(s.byteLength!==r.multihashSize)throw new Error("Incorrect length");let i=s.subarray(r.multihashSize-r.digestSize),o=new Yr(r.multihashCode,r.digestSize,i,s);return[r.version===0?se.createV0(o):se.createV1(r.codec,o),e.subarray(r.size)]}static inspectBytes(e){let r=0,n=()=>{let[h,l]=Mn(e.subarray(r));return r+=l,h},s=n(),i=Nn;if(s===18?(s=0,r=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);let o=r,a=n(),f=n(),u=r+f,c=u-o;return{version:s,codec:i,multihashCode:a,digestSize:f,multihashSize:c,size:u}}static parse(e,r){let[n,s]=jp(e,r),i=se.decode(s);return io(i).set(n,e),i}},jp=(t,e)=>{switch(t[0]){case"Q":{let r=e||ve;return[ve.prefix,r.decode(`${ve.prefix}${t}`)]}case ve.prefix:{let r=e||ve;return[ve.prefix,r.decode(t)]}case ot.prefix:{let r=e||ot;return[ot.prefix,r.decode(t)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[t[0],e.decode(t)]}}},$p=(t,e,r)=>{let{prefix:n}=r;if(n!==ve.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let s=e.get(n);if(s==null){let i=r.encode(t).slice(1);return e.set(n,i),i}else return s},Zp=(t,e,r)=>{let{prefix:n}=r,s=e.get(n);if(s==null){let i=r.encode(t);return e.set(n,i),i}else return s},Nn=112,Yp=18,kc=(t,e,r)=>{let n=Zr(t),s=n+Zr(e),i=new Uint8Array(s+r.byteLength);return $r(t,i,0),$r(e,i,n),i.set(r,s),i},Qp=Symbol.for("@ipld/js-cid/CID");var Jt={...Gi,...Hi,...Wi,...ji,...$i,...Zi,...Yi,...Qi,...Xi,...Ji},G2={...no,...so};function xr(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Ot(t=0){return globalThis.Buffer?.alloc!=null?xr(globalThis.Buffer.alloc(t)):new Uint8Array(t)}function Ft(t=0){return globalThis.Buffer?.allocUnsafe!=null?xr(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Nc(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}var Mc=Nc("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),oo=Nc("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);let e=Ft(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Xp={utf8:Mc,"utf-8":Mc,hex:Jt.base16,latin1:oo,ascii:oo,binary:oo,...Jt},_s=Xp;function ye(t,e="utf8"){let r=_s[e];if(r==null)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?xr(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function xe(t,e){if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(let r=0;r<t.byteLength;r++)if(t[r]!==e[r])return!1;return!0}var Ao=U(vo(),1),gu=U(au(),1),Bo=U(Co(),1),yu=U(du(),1),mu=U(Sr(),1);function ad(){mu.default._configure(),Ao.default._configure(gu.default),Bo.default._configure(yu.default)}ad();var bu=["uint64","int64","sint64","fixed64","sfixed64"];function cd(t){for(let e of bu){if(t[e]==null)continue;let r=t[e];t[e]=function(){return BigInt(r.call(this).toString())}}return t}function To(t){return cd(new Ao.default(t))}function ud(t){for(let e of bu){if(t[e]==null)continue;let r=t[e];t[e]=function(n){return r.call(this,n.toString())}}return t}function Po(){return ud(Bo.default.create())}function Ut(t,e){let r=To(t instanceof Uint8Array?t:t.subarray());return e.decode(r)}function Kt(t,e){let r=Po();return e.encode(t,r,{lengthDelimited:!1}),r.finish()}var Xr;(function(t){t[t.VARINT=0]="VARINT",t[t.BIT64=1]="BIT64",t[t.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",t[t.START_GROUP=3]="START_GROUP",t[t.END_GROUP=4]="END_GROUP",t[t.BIT32=5]="BIT32"})(Xr||(Xr={}));function Ps(t,e,r,n){return{name:t,type:e,encode:r,decode:n}}function Ro(t){function e(s){if(t[s.toString()]==null)throw new Error("Invalid enum value");return t[s]}let r=function(i,o){let a=e(i);o.int32(a)},n=function(i){let o=i.int32();return e(o)};return Ps("enum",Xr.VARINT,r,n)}function zt(t,e){return Ps("message",Xr.LENGTH_DELIMITED,t,e)}var fe;(function(t){t.RSA="RSA",t.Ed25519="Ed25519",t.Secp256k1="Secp256k1"})(fe||(fe={}));var Do;(function(t){t[t.RSA=0]="RSA",t[t.Ed25519=1]="Ed25519",t[t.Secp256k1=2]="Secp256k1"})(Do||(Do={}));(function(t){t.codec=()=>Ro(Do)})(fe||(fe={}));var xt;(function(t){let e;t.codec=()=>(e==null&&(e=zt((r,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),r.Type!=null&&(n.uint32(8),fe.codec().encode(r.Type,n)),r.Data!=null&&(n.uint32(18),n.bytes(r.Data)),s.lengthDelimited!==!1&&n.ldelim()},(r,n)=>{let s={},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let o=r.uint32();switch(o>>>3){case 1:s.Type=fe.codec().decode(r);break;case 2:s.Data=r.bytes();break;default:r.skipType(o&7);break}}return s})),e),t.encode=r=>Kt(r,t.codec()),t.decode=r=>Ut(r,t.codec())})(xt||(xt={}));var wt;(function(t){let e;t.codec=()=>(e==null&&(e=zt((r,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),r.Type!=null&&(n.uint32(8),fe.codec().encode(r.Type,n)),r.Data!=null&&(n.uint32(18),n.bytes(r.Data)),s.lengthDelimited!==!1&&n.ldelim()},(r,n)=>{let s={},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let o=r.uint32();switch(o>>>3){case 1:s.Type=fe.codec().decode(r);break;case 2:s.Data=r.bytes();break;default:r.skipType(o&7);break}}return s})),e),t.encode=r=>Kt(r,t.codec()),t.decode=r=>Ut(r,t.codec())})(wt||(wt={}));var xw=U(zn(),1),ww=U(Mf(),1),Mm=U(te(),1),Nh=U(Be(),1);var My=U(Be(),1);function me(t,e){e==null&&(e=t.reduce((s,i)=>s+i.length,0));let r=Ft(e),n=0;for(let s of t)r.set(s,n),n+=s.length;return xr(r)}var Ge={get(t=globalThis){let e=t.crypto;if(e==null||e.subtle==null)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p-crypto/blob/master/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return e}};var Ny=U(Be(),1);var yx=U(Se(),1),mx=U(Ws(),1),Lf=U(te(),1);function H(t,e="utf8"){let r=_s[e];if(r==null)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function ht(t,e){let r=Uint8Array.from(t.abs().toByteArray());if(r=r[0]===0?r.subarray(1):r,e!=null){if(r.length>e)throw new Error("byte array longer than desired length");r=me([new Uint8Array(e-r.length),r])}return H(r,"base64url")}function je(t){let e=Of(t);return new Lf.default.jsbn.BigInteger(H(e,"base16"),16)}function Of(t,e){let r=ye(t,"base64urlpad");if(e!=null){if(r.length>e)throw new Error("byte array longer than desired length");r=me([new Uint8Array(e-r.length),r])}return r}var Ly={"P-256":256,"P-384":384,"P-521":521},Oy=Object.keys(Ly),Ax=Oy.join(" / ");function ta(t){let e=t?.algorithm??"AES-GCM",r=t?.keyLength??16,n=t?.nonceLength??12,s=t?.digest??"SHA-256",i=t?.saltLength??16,o=t?.iterations??32767,a=Ge.get();r*=8;async function f(h,l){let d=a.getRandomValues(new Uint8Array(i)),p=a.getRandomValues(new Uint8Array(n)),g={name:e,iv:p};typeof l=="string"&&(l=ye(l));let m={name:"PBKDF2",salt:d,iterations:o,hash:{name:s}},v=await a.subtle.importKey("raw",l,{name:"PBKDF2"},!1,["deriveKey","deriveBits"]),S=await a.subtle.deriveKey(m,v,{name:e,length:r},!0,["encrypt"]),C=await a.subtle.encrypt(g,S,h);return me([d,g.iv,new Uint8Array(C)])}async function u(h,l){let d=h.subarray(0,i),p=h.subarray(i,i+n),g=h.subarray(i+n),m={name:e,iv:p};typeof l=="string"&&(l=ye(l));let v={name:"PBKDF2",salt:d,iterations:o,hash:{name:s}},S=await a.subtle.importKey("raw",l,{name:"PBKDF2"},!1,["deriveKey","deriveBits"]),C=await a.subtle.deriveKey(v,S,{name:e,length:r},!0,["decrypt"]),T=await a.subtle.decrypt(m,C,g);return new Uint8Array(T)}return{encrypt:f,decrypt:u}}var pa={};Ne(pa,{RsaPrivateKey:()=>ln,RsaPublicKey:()=>Yn,fromJwk:()=>cm,generateKeyPair:()=>um,unmarshalRsaPrivateKey:()=>om,unmarshalRsaPublicKey:()=>am});var la=U(Be(),1);var sw=U(Vf(),1),Zn=U(te(),1);var Uy=U(tn(),1);var W=BigInt(0),ue=BigInt(1),or=BigInt(2),Wn=BigInt(3),Ky=BigInt(8),le=Object.freeze({a:W,b:BigInt(7),P:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:ue,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee")});function Gf(t){let{a:e,b:r}=le,n=D(t*t),s=D(n*t);return D(s+e*t+r)}var Ys=le.a===W,Xs=class extends Error{constructor(e){super(e)}},X=class{constructor(e,r,n){this.x=e,this.y=r,this.z=n}static fromAffine(e){if(!(e instanceof re))throw new TypeError("JacobianPoint#fromAffine: expected Point");return new X(e.x,e.y,ue)}static toAffineBatch(e){let r=Hy(e.map(n=>n.z));return e.map((n,s)=>n.toAffine(r[s]))}static normalizeZ(e){return X.toAffineBatch(e).map(X.fromAffine)}equals(e){if(!(e instanceof X))throw new TypeError("JacobianPoint expected");let{x:r,y:n,z:s}=this,{x:i,y:o,z:a}=e,f=D(s*s),u=D(a*a),c=D(r*u),h=D(i*f),l=D(D(n*a)*u),d=D(D(o*s)*f);return c===h&&l===d}negate(){return new X(this.x,D(-this.y),this.z)}double(){let{x:e,y:r,z:n}=this,s=D(e*e),i=D(r*r),o=D(i*i),a=e+i,f=D(or*(D(a*a)-s-o)),u=D(Wn*s),c=D(u*u),h=D(c-or*f),l=D(u*(f-h)-Ky*o),d=D(or*r*n);return new X(h,l,d)}add(e){if(!(e instanceof X))throw new TypeError("JacobianPoint expected");let{x:r,y:n,z:s}=this,{x:i,y:o,z:a}=e;if(i===W||o===W)return this;if(r===W||n===W)return e;let f=D(s*s),u=D(a*a),c=D(r*u),h=D(i*f),l=D(D(n*a)*u),d=D(D(o*s)*f),p=D(h-c),g=D(d-l);if(p===W)return g===W?this.double():X.ZERO;let m=D(p*p),v=D(p*m),S=D(c*m),C=D(g*g-v-or*S),T=D(g*(S-C)-l*v),x=D(s*a*p);return new X(C,T,x)}subtract(e){return this.add(e.negate())}multiplyUnsafe(e){let r=X.ZERO;if(typeof e=="bigint"&&e===W)return r;let n=jf(e);if(n===ue)return this;if(!Ys){let h=r,l=this;for(;n>W;)n&ue&&(h=h.add(l)),l=l.double(),n>>=ue;return h}let{k1neg:s,k1:i,k2neg:o,k2:a}=Zf(n),f=r,u=r,c=this;for(;i>W||a>W;)i&ue&&(f=f.add(c)),a&ue&&(u=u.add(c)),c=c.double(),i>>=ue,a>>=ue;return s&&(f=f.negate()),o&&(u=u.negate()),u=new X(D(u.x*le.beta),u.y,u.z),f.add(u)}precomputeWindow(e){let r=Ys?128/e+1:256/e+1,n=[],s=this,i=s;for(let o=0;o<r;o++){i=s,n.push(i);for(let a=1;a<2**(e-1);a++)i=i.add(s),n.push(i);s=i.double()}return n}wNAF(e,r){!r&&this.equals(X.BASE)&&(r=re.BASE);let n=r&&r._WINDOW_SIZE||1;if(256%n)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let s=r&&ia.get(r);s||(s=this.precomputeWindow(n),r&&n!==1&&(s=X.normalizeZ(s),ia.set(r,s)));let i=X.ZERO,o=X.ZERO,a=1+(Ys?128/n:256/n),f=2**(n-1),u=BigInt(2**n-1),c=2**n,h=BigInt(n);for(let l=0;l<a;l++){let d=l*f,p=Number(e&u);if(e>>=h,p>f&&(p-=c,e+=ue),p===0){let g=s[d];l%2&&(g=g.negate()),o=o.add(g)}else{let g=s[d+Math.abs(p)-1];p<0&&(g=g.negate()),i=i.add(g)}}return{p:i,f:o}}multiply(e,r){let n=jf(e),s,i;if(Ys){let{k1neg:o,k1:a,k2neg:f,k2:u}=Zf(n),{p:c,f:h}=this.wNAF(a,r),{p:l,f:d}=this.wNAF(u,r);o&&(c=c.negate()),f&&(l=l.negate()),l=new X(D(l.x*le.beta),l.y,l.z),s=c.add(l),i=h.add(d)}else{let{p:o,f:a}=this.wNAF(n,r);s=o,i=a}return X.normalizeZ([s,i])[0]}toAffine(e=fn(this.z)){let{x:r,y:n,z:s}=this,i=e,o=D(i*i),a=D(o*i),f=D(r*o),u=D(n*a);if(D(s*i)!==ue)throw new Error("invZ was invalid");return new re(f,u)}};X.BASE=new X(le.Gx,le.Gy,ue);X.ZERO=new X(W,ue,W);var ia=new WeakMap,re=class{constructor(e,r){this.x=e,this.y=r}_setWindowSize(e){this._WINDOW_SIZE=e,ia.delete(this)}hasEvenY(){return this.y%or===W}static fromCompressedHex(e){let r=e.length===32,n=Ht(r?e:e.subarray(1));if(!sa(n))throw new Error("Point is not on curve");let s=Gf(n),i=Gy(s),o=(i&ue)===ue;r?o&&(i=D(-i)):(e[0]&1)===1!==o&&(i=D(-i));let a=new re(n,i);return a.assertValidity(),a}static fromUncompressedHex(e){let r=Ht(e.subarray(1,33)),n=Ht(e.subarray(33,65)),s=new re(r,n);return s.assertValidity(),s}static fromHex(e){let r=un(e),n=r.length,s=r[0];if(n===32||n===33&&(s===2||s===3))return this.fromCompressedHex(r);if(n===65&&s===4)return this.fromUncompressedHex(r);throw new Error(`Point.fromHex: received invalid point. Expected 32-33 compressed bytes or 65 uncompressed bytes, not ${n}`)}static fromPrivateKey(e){return re.BASE.multiply(ei(e))}static fromSignature(e,r,n){e=un(e);let s=Yf(e),{r:i,s:o}=Qf(r);if(n!==0&&n!==1)throw new Error("Cannot recover signature: invalid recovery bit");let a=n&1?"03":"02",f=re.fromHex(a+on(i)),{n:u}=le,c=fn(i,u),h=D(-s*c,u),l=D(o*c,u),d=re.BASE.multiplyAndAddUnsafe(f,h,l);if(!d)throw new Error("Cannot recover signature: point at infinify");return d.assertValidity(),d}toRawBytes(e=!1){return Pr(this.toHex(e))}toHex(e=!1){let r=on(this.x);return e?`${this.hasEvenY()?"02":"03"}${r}`:`04${r}${on(this.y)}`}toHexX(){return this.toHex(!0).slice(2)}toRawX(){return this.toRawBytes(!0).slice(1)}assertValidity(){let e="Point is not on elliptic curve",{x:r,y:n}=this;if(!sa(r)||!sa(n))throw new Error(e);let s=D(n*n),i=Gf(r);if(D(s-i)!==W)throw new Error(e)}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new re(this.x,D(-this.y))}double(){return X.fromAffine(this).double().toAffine()}add(e){return X.fromAffine(this).add(X.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return X.fromAffine(this).multiply(e,this).toAffine()}multiplyAndAddUnsafe(e,r,n){let s=X.fromAffine(this),i=r===W||r===ue||this!==re.BASE?s.multiplyUnsafe(r):s.multiply(r),o=X.fromAffine(e).multiplyUnsafe(n),a=i.add(o);return a.equals(X.ZERO)?void 0:a.toAffine()}};re.BASE=new re(le.Gx,le.Gy);re.ZERO=new re(W,W);function Hf(t){return Number.parseInt(t[0],16)>=8?"00"+t:t}function Wf(t){if(t.length<2||t[0]!==2)throw new Error(`Invalid signature integer tag: ${cn(t)}`);let e=t[1],r=t.subarray(2,e+2);if(!e||r.length!==e)throw new Error("Invalid signature integer: wrong length");if(r[0]===0&&r[1]<=127)throw new Error("Invalid signature integer: trailing length");return{data:Ht(r),left:t.subarray(e+2)}}function zy(t){if(t.length<2||t[0]!=48)throw new Error(`Invalid signature tag: ${cn(t)}`);if(t[1]!==t.length-2)throw new Error("Invalid signature: incorrect length");let{data:e,left:r}=Wf(t.subarray(2)),{data:n,left:s}=Wf(r);if(s.length)throw new Error(`Invalid signature: left bytes after parsing: ${cn(s)}`);return{r:e,s:n}}var Bt=class{constructor(e,r){this.r=e,this.s=r,this.assertValidity()}static fromCompact(e){let r=e instanceof Uint8Array,n="Signature.fromCompact";if(typeof e!="string"&&!r)throw new TypeError(`${n}: Expected string or Uint8Array`);let s=r?cn(e):e;if(s.length!==128)throw new Error(`${n}: Expected 64-byte hex`);return new Bt(Js(s.slice(0,64)),Js(s.slice(64,128)))}static fromDER(e){let r=e instanceof Uint8Array;if(typeof e!="string"&&!r)throw new TypeError("Signature.fromDER: Expected string or Uint8Array");let{r:n,s}=zy(r?e:Pr(e));return new Bt(n,s)}static fromHex(e){return this.fromDER(e)}assertValidity(){let{r:e,s:r}=this;if(!$n(e))throw new Error("Invalid Signature: r must be 0 < r < n");if(!$n(r))throw new Error("Invalid Signature: s must be 0 < s < n")}hasHighS(){let e=le.n>>ue;return this.s>e}normalizeS(){return this.hasHighS()?new Bt(this.r,le.n-this.s):this}toDERRawBytes(e=!1){return Pr(this.toDERHex(e))}toDERHex(e=!1){let r=Hf(Hn(this.s));if(e)return r;let n=Hf(Hn(this.r)),s=Hn(n.length/2),i=Hn(r.length/2);return`30${Hn(n.length/2+r.length/2+4)}02${s}${n}02${i}${r}`}toRawBytes(){return this.toDERRawBytes()}toHex(){return this.toDERHex()}toCompactRawBytes(){return Pr(this.toCompactHex())}toCompactHex(){return on(this.r)+on(this.s)}};function sn(...t){if(!t.every(n=>n instanceof Uint8Array))throw new Error("Uint8Array list expected");if(t.length===1)return t[0];let e=t.reduce((n,s)=>n+s.length,0),r=new Uint8Array(e);for(let n=0,s=0;n<t.length;n++){let i=t[n];r.set(i,s),s+=i.length}return r}var qy=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function cn(t){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");let e="";for(let r=0;r<t.length;r++)e+=qy[t[r]];return e}var Vy=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000");function on(t){if(typeof t!="bigint")throw new Error("Expected bigint");if(!(W<=t&&t<Vy))throw new Error("Expected number < 2^256");return t.toString(16).padStart(64,"0")}function oa(t){let e=Pr(on(t));if(e.length!==32)throw new Error("Error: expected 32 bytes");return e}function Hn(t){let e=t.toString(16);return e.length&1?`0${e}`:e}function Js(t){if(typeof t!="string")throw new TypeError("hexToNumber: expected string, got "+typeof t);return BigInt(`0x${t}`)}function Pr(t){if(typeof t!="string")throw new TypeError("hexToBytes: expected string, got "+typeof t);if(t.length%2)throw new Error("hexToBytes: received invalid unpadded hex"+t.length);let e=new Uint8Array(t.length/2);for(let r=0;r<e.length;r++){let n=r*2,s=t.slice(n,n+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");e[r]=i}return e}function Ht(t){return Js(cn(t))}function un(t){return t instanceof Uint8Array?Uint8Array.from(t):Pr(t)}function jf(t){if(typeof t=="number"&&Number.isSafeInteger(t)&&t>0)return BigInt(t);if(typeof t=="bigint"&&$n(t))return t;throw new TypeError("Expected valid private scalar: 0 < scalar < curve.n")}function D(t,e=le.P){let r=t%e;return r>=W?r:e+r}function tt(t,e){let{P:r}=le,n=t;for(;e-- >W;)n*=n,n%=r;return n}function Gy(t){let{P:e}=le,r=BigInt(6),n=BigInt(11),s=BigInt(22),i=BigInt(23),o=BigInt(44),a=BigInt(88),f=t*t*t%e,u=f*f*t%e,c=tt(u,Wn)*u%e,h=tt(c,Wn)*u%e,l=tt(h,or)*f%e,d=tt(l,n)*l%e,p=tt(d,s)*d%e,g=tt(p,o)*p%e,m=tt(g,a)*g%e,v=tt(m,o)*p%e,S=tt(v,Wn)*u%e,C=tt(S,i)*d%e,T=tt(C,r)*f%e;return tt(T,or)}function fn(t,e=le.P){if(t===W||e<=W)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let r=D(t,e),n=e,s=W,i=ue,o=ue,a=W;for(;r!==W;){let u=n/r,c=n%r,h=s-o*u,l=i-a*u;n=r,r=c,s=o,i=a,o=h,a=l}if(n!==ue)throw new Error("invert: does not exist");return D(s,e)}function Hy(t,e=le.P){let r=new Array(t.length),n=t.reduce((i,o,a)=>o===W?i:(r[a]=i,D(i*o,e)),ue),s=fn(n,e);return t.reduceRight((i,o,a)=>o===W?i:(r[a]=D(i*r[a],e),D(i*o,e)),s),r}var $f=(t,e)=>(t+e/or)/e,Wy={a1:BigInt("0x3086d221a7d46bcde86c90e49284eb15"),b1:-ue*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),a2:BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),b2:BigInt("0x3086d221a7d46bcde86c90e49284eb15"),POW_2_128:BigInt("0x100000000000000000000000000000000")};function Zf(t){let{n:e}=le,{a1:r,b1:n,a2:s,b2:i,POW_2_128:o}=Wy,a=$f(i*t,e),f=$f(-n*t,e),u=D(t-a*r-f*s,e),c=D(-a*n-f*i,e),h=u>o,l=c>o;if(h&&(u=e-u),l&&(c=e-c),u>o||c>o)throw new Error("splitScalarEndo: Endomorphism failed, k="+t);return{k1neg:h,k1:u,k2neg:l,k2:c}}function Yf(t){let{n:e}=le,n=t.length*8-256,s=Ht(t);return n>0&&(s=s>>BigInt(n)),s>=e&&(s-=e),s}var an,jn,aa=class{constructor(){this.v=new Uint8Array(32).fill(1),this.k=new Uint8Array(32).fill(0),this.counter=0}hmac(...e){return lt.hmacSha256(this.k,...e)}hmacSync(...e){return jn(this.k,...e)}checkSync(){if(typeof jn!="function")throw new Xs("hmacSha256Sync needs to be set")}incr(){if(this.counter>=1e3)throw new Error("Tried 1,000 k values for sign(), all were invalid");this.counter+=1}async reseed(e=new Uint8Array){this.k=await this.hmac(this.v,Uint8Array.from([0]),e),this.v=await this.hmac(this.v),e.length!==0&&(this.k=await this.hmac(this.v,Uint8Array.from([1]),e),this.v=await this.hmac(this.v))}reseedSync(e=new Uint8Array){this.checkSync(),this.k=this.hmacSync(this.v,Uint8Array.from([0]),e),this.v=this.hmacSync(this.v),e.length!==0&&(this.k=this.hmacSync(this.v,Uint8Array.from([1]),e),this.v=this.hmacSync(this.v))}async generate(){return this.incr(),this.v=await this.hmac(this.v),this.v}generateSync(){return this.checkSync(),this.incr(),this.v=this.hmacSync(this.v),this.v}};function $n(t){return W<t&&t<le.n}function sa(t){return W<t&&t<le.P}function jy(t,e,r){let n=Ht(t);if(!$n(n))return;let{n:s}=le,i=re.BASE.multiply(n),o=D(i.x,s);if(o===W)return;let a=D(fn(n,s)*D(e+r*o,s),s);if(a===W)return;let f=new Bt(o,a),u=(i.x===f.r?0:2)|Number(i.y&ue);return{sig:f,recovery:u}}function ei(t){let e;if(typeof t=="bigint")e=t;else if(typeof t=="number"&&Number.isSafeInteger(t)&&t>0)e=BigInt(t);else if(typeof t=="string"){if(t.length!==64)throw new Error("Expected 32 bytes of private key");e=Js(t)}else if(t instanceof Uint8Array){if(t.length!==32)throw new Error("Expected 32 bytes of private key");e=Ht(t)}else throw new TypeError("Expected valid private key");if(!$n(e))throw new Error("Expected private key: 0 < key < n");return e}function $y(t){return t instanceof re?(t.assertValidity(),t):re.fromHex(t)}function Qf(t){if(t instanceof Bt)return t.assertValidity(),t;try{return Bt.fromDER(t)}catch{return Bt.fromCompact(t)}}function ca(t,e=!1){return re.fromPrivateKey(t).toRawBytes(e)}function Xf(t){let e=t.length>32?t.slice(0,32):t;return Ht(e)}function Zy(t){let e=Xf(t),r=D(e,le.n);return Jf(r<W?e:r)}function Jf(t){return oa(t)}function Yy(t,e,r){if(t==null)throw new Error(`sign: expected valid message hash, not "${t}"`);let n=un(t),s=ei(e),i=[Jf(s),Zy(n)];if(r!=null){r===!0&&(r=lt.randomBytes(32));let f=un(r);if(f.length!==32)throw new Error("sign: Expected 32 bytes of extra data");i.push(f)}let o=sn(...i),a=Xf(n);return{seed:o,m:a,d:s}}function Qy(t,e){let{sig:r,recovery:n}=t,{canonical:s,der:i,recovered:o}=Object.assign({canonical:!0,der:!0},e);s&&r.hasHighS()&&(r=r.normalizeS(),n^=1);let a=i?r.toDERRawBytes():r.toCompactRawBytes();return o?[a,n]:a}async function eh(t,e,r={}){let{seed:n,m:s,d:i}=Yy(t,e,r.extraEntropy),o,a=new aa;for(await a.reseed(n);!(o=jy(await a.generate(),s,i));)await a.reseed();return Qy(o,r)}var Xy={strict:!0};function th(t,e,r,n=Xy){let s;try{s=Qf(t),e=un(e)}catch{return!1}let{r:i,s:o}=s;if(n.strict&&s.hasHighS())return!1;let a=Yf(e),f;try{f=$y(r)}catch{return!1}let{n:u}=le,c=fn(o,u),h=D(a*c,u),l=D(i*c,u),d=re.BASE.multiplyAndAddUnsafe(f,h,l);return d?D(d.x,u)===i:!1}re.BASE._setWindowSize(8);var $e={node:Uy,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0};var Qs={},lt={bytesToHex:cn,hexToBytes:Pr,concatBytes:sn,mod:D,invert:fn,isValidPrivateKey(t){try{return ei(t),!0}catch{return!1}},_bigintTo32Bytes:oa,_normalizePrivateKey:ei,hashToPrivateKey:t=>{if(t=un(t),t.length<40||t.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");let e=D(Ht(t),le.n-ue)+ue;return oa(e)},randomBytes:(t=32)=>{if($e.web)return $e.web.getRandomValues(new Uint8Array(t));if($e.node){let{randomBytes:e}=$e.node;return Uint8Array.from(e(t))}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>lt.hashToPrivateKey(lt.randomBytes(40)),sha256:async(...t)=>{if($e.web){let e=await $e.web.subtle.digest("SHA-256",sn(...t));return new Uint8Array(e)}else if($e.node){let{createHash:e}=$e.node,r=e("sha256");return t.forEach(n=>r.update(n)),Uint8Array.from(r.digest())}else throw new Error("The environment doesn't have sha256 function")},hmacSha256:async(t,...e)=>{if($e.web){let r=await $e.web.subtle.importKey("raw",t,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),n=sn(...e),s=await $e.web.subtle.sign("HMAC",r,n);return new Uint8Array(s)}else if($e.node){let{createHmac:r}=$e.node,n=r("sha256",t);return e.forEach(s=>n.update(s)),Uint8Array.from(n.digest())}else throw new Error("The environment doesn't have hmac-sha256 function")},sha256Sync:void 0,hmacSha256Sync:void 0,taggedHash:async(t,...e)=>{let r=Qs[t];if(r===void 0){let n=await lt.sha256(Uint8Array.from(t,s=>s.charCodeAt(0)));r=sn(n,n),Qs[t]=r}return lt.sha256(r,...e)},taggedHashSync:(t,...e)=>{if(typeof an!="function")throw new Xs("sha256Sync is undefined, you need to set it");let r=Qs[t];if(r===void 0){let n=an(Uint8Array.from(t,s=>s.charCodeAt(0)));r=sn(n,n),Qs[t]=r}return an(r,...e)},precompute(t=8,e=re.BASE){let r=e===re.BASE?e:new re(e.x,e.y);return r._setWindowSize(t),r.multiply(Wn),r}};Object.defineProperties(lt,{sha256Sync:{configurable:!1,get(){return an},set(t){an||(an=t)}},hmacSha256Sync:{configurable:!1,get(){return jn},set(t){jn||(jn=t)}}});var rh=U(Be(),1);function ar(t){if(isNaN(t)||t<=0)throw(0,rh.default)(new Error("random bytes length must be a Number bigger than 0"),"ERR_INVALID_LENGTH");return lt.randomBytes(t)}var Rr={};Ne(Rr,{jwkToPkcs1:()=>tm,jwkToPkix:()=>nm,pkcs1ToJwk:()=>em,pkixToJwk:()=>rm});var Kx=U(zn(),1),zx=U(Zs(),1),Wt=U(te(),1);var ua=U(Be(),1);function em(t){let e=Wt.default.asn1.fromDer(H(t,"ascii")),r=Wt.default.pki.privateKeyFromAsn1(e);return{kty:"RSA",n:ht(r.n),e:ht(r.e),d:ht(r.d),p:ht(r.p),q:ht(r.q),dp:ht(r.dP),dq:ht(r.dQ),qi:ht(r.qInv),alg:"RS256"}}function tm(t){if(t.n==null||t.e==null||t.d==null||t.p==null||t.q==null||t.dp==null||t.dq==null||t.qi==null)throw(0,ua.default)(new Error("JWK was missing components"),"ERR_INVALID_PARAMETERS");let e=Wt.default.pki.privateKeyToAsn1({n:je(t.n),e:je(t.e),d:je(t.d),p:je(t.p),q:je(t.q),dP:je(t.dp),dQ:je(t.dq),qInv:je(t.qi)});return ye(Wt.default.asn1.toDer(e).getBytes(),"ascii")}function rm(t){let e=Wt.default.asn1.fromDer(H(t,"ascii")),r=Wt.default.pki.publicKeyFromAsn1(e);return{kty:"RSA",n:ht(r.n),e:ht(r.e)}}function nm(t){if(t.n==null||t.e==null)throw(0,ua.default)(new Error("JWK was missing components"),"ERR_INVALID_PARAMETERS");let e=Wt.default.pki.publicKeyToAsn1({n:je(t.n),e:je(t.e)});return ye(Wt.default.asn1.toDer(e).getBytes(),"ascii")}var Hx=U(Zs(),1),fa=U(te(),1);function nh(t,e){return e.map(r=>je(t[r]))}function sh(t){return fa.default.pki.setRsaPrivateKey(...nh(t,["n","e","d","p","q","dp","dq","qi"]))}function ih(t){return fa.default.pki.setRsaPublicKey(...nh(t,["n","e"]))}var oh=U(Be(),1);async function ah(t){let e=await Ge.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:t,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),r=await fh(e);return{privateKey:r[0],publicKey:r[1]}}async function ha(t){let r=[await Ge.get().subtle.importKey("jwk",t,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await sm(t)],n=await fh({privateKey:r[0],publicKey:r[1]});return{privateKey:n[0],publicKey:n[1]}}async function ch(t,e){let r=await Ge.get().subtle.importKey("jwk",t,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),n=await Ge.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},r,Uint8Array.from(e));return new Uint8Array(n,0,n.byteLength)}async function uh(t,e,r){let n=await Ge.get().subtle.importKey("jwk",t,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return await Ge.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},n,e,r)}async function fh(t){if(t.privateKey==null||t.publicKey==null)throw(0,oh.default)(new Error("Private and public key are required"),"ERR_INVALID_PARAMETERS");return await Promise.all([Ge.get().subtle.exportKey("jwk",t.privateKey),Ge.get().subtle.exportKey("jwk",t.publicKey)])}async function sm(t){return await Ge.get().subtle.importKey("jwk",{kty:t.kty,n:t.n,e:t.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function hh(t,e,r,n){let s=e?ih(t):sh(t),i=H(Uint8Array.from(r),"ascii"),o=n(i,s);return ye(o,"ascii")}function lh(t,e){return hh(t,!0,e,(r,n)=>n.encrypt(r))}function ph(t,e){return hh(t,!1,e,(r,n)=>n.decrypt(r))}async function hn(t,e){let n=await ta().encrypt(t,e);return jr.encode(n)}var Yn=class{constructor(e){this._key=e}async verify(e,r){return await uh(this._key,r,e)}marshal(){return Rr.jwkToPkix(this._key)}get bytes(){return xt.encode({Type:fe.RSA,Data:this.marshal()}).subarray()}encrypt(e){return lh(this._key,e)}equals(e){return xe(this.bytes,e.bytes)}async hash(){let{bytes:e}=await _e.digest(this.bytes);return e}},ln=class{constructor(e,r){this._key=e,this._publicKey=r}genSecret(){return ar(16)}async sign(e){return await ch(this._key,e)}get public(){if(this._publicKey==null)throw(0,la.default)(new Error("public key not provided"),"ERR_PUBKEY_NOT_PROVIDED");return new Yn(this._publicKey)}decrypt(e){return ph(this._key,e)}marshal(){return Rr.jwkToPkcs1(this._key)}get bytes(){return wt.encode({Type:fe.RSA,Data:this.marshal()}).subarray()}equals(e){return xe(this.bytes,e.bytes)}async hash(){let{bytes:e}=await _e.digest(this.bytes);return e}async id(){let e=await this.public.hash();return H(e,"base58btc")}async export(e,r="pkcs-8"){if(r==="pkcs-8"){let n=new Zn.default.util.ByteBuffer(this.marshal()),s=Zn.default.asn1.fromDer(n),i=Zn.default.pki.privateKeyFromAsn1(s),o={algorithm:"aes256",count:1e4,saltSize:128/8,prfAlgorithm:"sha512"};return Zn.default.pki.encryptRsaPrivateKey(i,e,o)}else{if(r==="libp2p-key")return await hn(this.bytes,e);throw(0,la.default)(new Error(`export format '${r}' is not supported`),"ERR_INVALID_EXPORT_FORMAT")}}};async function om(t){let e=Rr.pkcs1ToJwk(t),r=await ha(e);return new ln(r.privateKey,r.publicKey)}function am(t){let e=Rr.pkixToJwk(t);return new Yn(e)}async function cm(t){let e=await ha(t);return new ln(e.privateKey,e.publicKey)}async function um(t){let e=await ah(t);return new ln(e.privateKey,e.publicKey)}var Ea={};Ne(Ea,{Ed25519PrivateKey:()=>kr,Ed25519PublicKey:()=>ts,generateKeyPair:()=>Tm,generateKeyPairFromSeed:()=>Ah,unmarshalEd25519PrivateKey:()=>Am,unmarshalEd25519PublicKey:()=>Bm});var Sa=U(Be(),1);var fm=U(tn(),1);var ke=BigInt(0),$=BigInt(1),pn=BigInt(2),dh=BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),pe=Object.freeze({a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),P:BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),l:dh,n:dh,h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960")});var bh=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000"),Qn=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),ow=BigInt("6853475219497561581579357271197624642482790079785650197046958215289687604742"),hm=BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),lm=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),pm=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),dm=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952"),j=class{constructor(e,r,n,s){this.x=e,this.y=r,this.z=n,this.t=s}static fromAffine(e){if(!(e instanceof de))throw new TypeError("ExtendedPoint#fromAffine: expected Point");return e.equals(de.ZERO)?j.ZERO:new j(e.x,e.y,$,I(e.x*e.y))}static toAffineBatch(e){let r=mm(e.map(n=>n.z));return e.map((n,s)=>n.toAffine(r[s]))}static normalizeZ(e){return this.toAffineBatch(e).map(this.fromAffine)}equals(e){gh(e);let{x:r,y:n,z:s}=this,{x:i,y:o,z:a}=e,f=I(r*a),u=I(i*s),c=I(n*a),h=I(o*s);return f===u&&c===h}negate(){return new j(I(-this.x),this.y,this.z,I(-this.t))}double(){let{x:e,y:r,z:n}=this,{a:s}=pe,i=I(e*e),o=I(r*r),a=I(pn*I(n*n)),f=I(s*i),u=e+r,c=I(I(u*u)-i-o),h=f+o,l=h-a,d=f-o,p=I(c*l),g=I(h*d),m=I(c*d),v=I(l*h);return new j(p,g,v,m)}add(e){gh(e);let{x:r,y:n,z:s,t:i}=this,{x:o,y:a,z:f,t:u}=e,c=I((n-r)*(a+o)),h=I((n+r)*(a-o)),l=I(h-c);if(l===ke)return this.double();let d=I(s*pn*u),p=I(i*pn*f),g=p+d,m=h+c,v=p-d,S=I(g*l),C=I(m*v),T=I(g*v),x=I(l*m);return new j(S,C,x,T)}subtract(e){return this.add(e.negate())}precomputeWindow(e){let r=1+256/e,n=[],s=this,i=s;for(let o=0;o<r;o++){i=s,n.push(i);for(let a=1;a<2**(e-1);a++)i=i.add(s),n.push(i);s=i.double()}return n}wNAF(e,r){!r&&this.equals(j.BASE)&&(r=de.BASE);let n=r&&r._WINDOW_SIZE||1;if(256%n)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let s=r&&ba.get(r);s||(s=this.precomputeWindow(n),r&&n!==1&&(s=j.normalizeZ(s),ba.set(r,s)));let i=j.ZERO,o=j.ZERO,a=1+256/n,f=2**(n-1),u=BigInt(2**n-1),c=2**n,h=BigInt(n);for(let l=0;l<a;l++){let d=l*f,p=Number(e&u);if(e>>=h,p>f&&(p-=c,e+=$),p===0){let g=s[d];l%2&&(g=g.negate()),o=o.add(g)}else{let g=s[d+Math.abs(p)-1];p<0&&(g=g.negate()),i=i.add(g)}}return j.normalizeZ([i,o])[0]}multiply(e,r){return this.wNAF(ri(e,pe.l),r)}multiplyUnsafe(e){let r=ri(e,pe.l,!1),n=j.BASE,s=j.ZERO;if(r===ke)return s;if(this.equals(s)||r===$)return this;if(this.equals(n))return this.wNAF(r);let i=s,o=this;for(;r>ke;)r&$&&(i=i.add(o)),o=o.double(),r>>=$;return i}isSmallOrder(){return this.multiplyUnsafe(pe.h).equals(j.ZERO)}isTorsionFree(){return this.multiplyUnsafe(pe.l).equals(j.ZERO)}toAffine(e=ni(this.z)){let{x:r,y:n,z:s}=this,i=I(r*e),o=I(n*e);if(I(s*e)!==$)throw new Error("invZ was invalid");return new de(i,o)}fromRistrettoBytes(){ga()}toRistrettoBytes(){ga()}fromRistrettoHash(){ga()}};j.BASE=new j(pe.Gx,pe.Gy,$,I(pe.Gx*pe.Gy));j.ZERO=new j(ke,$,$,ke);function gh(t){if(!(t instanceof j))throw new TypeError("ExtendedPoint expected")}function da(t){if(!(t instanceof He))throw new TypeError("RistrettoPoint expected")}function ga(){throw new Error("Legacy method: switch to RistrettoPoint")}var He=class{constructor(e){this.ep=e}static calcElligatorRistrettoMap(e){let{d:r}=pe,n=I(Qn*e*e),s=I((n+$)*pm),i=BigInt(-1),o=I((i-r*n)*I(n+r)),{isValid:a,value:f}=xa(s,o),u=I(f*e);ur(u)||(u=I(-u)),a||(f=u),a||(i=n);let c=I(i*(n-$)*dm-o),h=f*f,l=I((f+f)*o),d=I(c*hm),p=I($-h),g=I($+h);return new j(I(l*g),I(p*d),I(d*g),I(l*p))}static hashToCurve(e){e=fr(e,64);let r=ya(e.slice(0,32)),n=this.calcElligatorRistrettoMap(r),s=ya(e.slice(32,64)),i=this.calcElligatorRistrettoMap(s);return new He(n.add(i))}static fromHex(e){e=fr(e,32);let{a:r,d:n}=pe,s="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",i=ya(e);if(!vm(Xn(i),e)||ur(i))throw new Error(s);let o=I(i*i),a=I($+r*o),f=I($-r*o),u=I(a*a),c=I(f*f),h=I(r*n*u-c),{isValid:l,value:d}=mh(I(h*c)),p=I(d*f),g=I(d*p*h),m=I((i+i)*p);ur(m)&&(m=I(-m));let v=I(a*g),S=I(m*v);if(!l||ur(S)||v===ke)throw new Error(s);return new He(new j(m,v,$,S))}toRawBytes(){let{x:e,y:r,z:n,t:s}=this.ep,i=I(I(n+r)*I(n-r)),o=I(e*r),a=I(o*o),{value:f}=mh(I(i*a)),u=I(f*i),c=I(f*o),h=I(u*c*s),l;if(ur(s*h)){let p=I(r*Qn),g=I(e*Qn);e=p,r=g,l=I(u*lm)}else l=c;ur(e*h)&&(r=I(-r));let d=I((n-r)*l);return ur(d)&&(d=I(-d)),Xn(d)}toHex(){return Jn(this.toRawBytes())}toString(){return this.toHex()}equals(e){da(e);let r=this.ep,n=e.ep,s=I(r.x*n.y)===I(r.y*n.x),i=I(r.y*n.y)===I(r.x*n.x);return s||i}add(e){return da(e),new He(this.ep.add(e.ep))}subtract(e){return da(e),new He(this.ep.subtract(e.ep))}multiply(e){return new He(this.ep.multiply(e))}multiplyUnsafe(e){return new He(this.ep.multiplyUnsafe(e))}};He.BASE=new He(j.BASE);He.ZERO=new He(j.ZERO);var ba=new WeakMap,de=class{constructor(e,r){this.x=e,this.y=r}_setWindowSize(e){this._WINDOW_SIZE=e,ba.delete(this)}static fromHex(e,r=!0){let{d:n,P:s}=pe;e=fr(e,32);let i=e.slice();i[31]=e[31]&-129;let o=es(i);if(r&&o>=s)throw new Error("Expected 0 < hex < P");if(!r&&o>=bh)throw new Error("Expected 0 < hex < 2**256");let a=I(o*o),f=I(a-$),u=I(n*a+$),{isValid:c,value:h}=xa(f,u);if(!c)throw new Error("Point.fromHex: invalid y coordinate");let l=(h&$)===$;return(e[31]&128)!==0!==l&&(h=I(-h)),new de(h,o)}static async fromPrivateKey(e){return(await si(e)).point}toRawBytes(){let e=Xn(this.y);return e[31]|=this.x&$?128:0,e}toHex(){return Jn(this.toRawBytes())}toX25519(){let{y:e}=this,r=I(($+e)*ni($-e));return Xn(r)}isTorsionFree(){return j.fromAffine(this).isTorsionFree()}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new de(I(-this.x),this.y)}add(e){return j.fromAffine(this).add(j.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return j.fromAffine(this).multiply(e,this).toAffine()}};de.BASE=new de(pe.Gx,pe.Gy);de.ZERO=new de(ke,$);var Dr=class{constructor(e,r){this.r=e,this.s=r,this.assertValidity()}static fromHex(e){let r=fr(e,64),n=de.fromHex(r.slice(0,32),!1),s=es(r.slice(32,64));return new Dr(n,s)}assertValidity(){let{r:e,s:r}=this;if(!(e instanceof de))throw new Error("Expected Point instance");return ri(r,pe.l,!1),this}toRawBytes(){let e=new Uint8Array(64);return e.set(this.r.toRawBytes()),e.set(Xn(this.s),32),e}toHex(){return Jn(this.toRawBytes())}};function yh(...t){if(!t.every(n=>n instanceof Uint8Array))throw new Error("Expected Uint8Array list");if(t.length===1)return t[0];let e=t.reduce((n,s)=>n+s.length,0),r=new Uint8Array(e);for(let n=0,s=0;n<t.length;n++){let i=t[n];r.set(i,s),s+=i.length}return r}var gm=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Jn(t){if(!(t instanceof Uint8Array))throw new Error("Uint8Array expected");let e="";for(let r=0;r<t.length;r++)e+=gm[t[r]];return e}function va(t){if(typeof t!="string")throw new TypeError("hexToBytes: expected string, got "+typeof t);if(t.length%2)throw new Error("hexToBytes: received invalid unpadded hex");let e=new Uint8Array(t.length/2);for(let r=0;r<e.length;r++){let n=r*2,s=t.slice(n,n+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");e[r]=i}return e}function vh(t){let r=t.toString(16).padStart(64,"0");return va(r)}function Xn(t){return vh(t).reverse()}function ur(t){return(I(t)&$)===$}function es(t){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");return BigInt("0x"+Jn(Uint8Array.from(t).reverse()))}var ym=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");function ya(t){return I(es(t)&ym)}function I(t,e=pe.P){let r=t%e;return r>=ke?r:e+r}function ni(t,e=pe.P){if(t===ke||e<=ke)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let r=I(t,e),n=e,s=ke,i=$,o=$,a=ke;for(;r!==ke;){let u=n/r,c=n%r,h=s-o*u,l=i-a*u;n=r,r=c,s=o,i=a,o=h,a=l}if(n!==$)throw new Error("invert: does not exist");return I(s,e)}function mm(t,e=pe.P){let r=new Array(t.length),n=t.reduce((i,o,a)=>o===ke?i:(r[a]=i,I(i*o,e)),$),s=ni(n,e);return t.reduceRight((i,o,a)=>o===ke?i:(r[a]=I(i*r[a],e),I(i*o,e)),s),r}function Tt(t,e){let{P:r}=pe,n=t;for(;e-- >ke;)n*=n,n%=r;return n}function bm(t){let{P:e}=pe,r=BigInt(5),n=BigInt(10),s=BigInt(20),i=BigInt(40),o=BigInt(80),f=t*t%e*t%e,u=Tt(f,pn)*f%e,c=Tt(u,$)*t%e,h=Tt(c,r)*c%e,l=Tt(h,n)*h%e,d=Tt(l,s)*l%e,p=Tt(d,i)*d%e,g=Tt(p,o)*p%e,m=Tt(g,o)*p%e,v=Tt(m,n)*h%e;return{pow_p_5_8:Tt(v,pn)*t%e,b2:f}}function xa(t,e){let r=I(e*e*e),n=I(r*r*e),s=bm(t*n).pow_p_5_8,i=I(t*r*s),o=I(e*i*i),a=i,f=I(i*Qn),u=o===t,c=o===I(-t),h=o===I(-t*Qn);return u&&(i=a),(c||h)&&(i=f),ur(i)&&(i=I(-i)),{isValid:u||c,value:i}}function mh(t){return xa($,t)}function ti(t){return I(es(t),pe.l)}function vm(t,e){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function fr(t,e){let r=t instanceof Uint8Array?Uint8Array.from(t):va(t);if(typeof e=="number"&&r.length!==e)throw new Error(`Expected ${e} bytes`);return r}function ri(t,e,r=!0){if(!e)throw new TypeError("Specify max value");if(typeof t=="number"&&Number.isSafeInteger(t)&&(t=BigInt(t)),typeof t=="bigint"&&t<e){if(r){if(ke<t)return t}else if(ke<=t)return t}throw new TypeError("Expected valid scalar: 0 < scalar < max")}function xm(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function wm(t){if(t=typeof t=="bigint"||typeof t=="number"?vh(ri(t,bh)):fr(t),t.length!==32)throw new Error("Expected 32 bytes");return t}function Sm(t){let e=xm(t.slice(0,32)),r=t.slice(32,64),n=ti(e),s=de.BASE.multiply(n),i=s.toRawBytes();return{head:e,prefix:r,scalar:n,point:s,pointBytes:i}}var ma;async function si(t){return Sm(await hr.sha512(wm(t)))}async function wa(t){return(await si(t)).pointBytes}async function xh(t,e){t=fr(t);let{prefix:r,scalar:n,pointBytes:s}=await si(e),i=ti(await hr.sha512(r,t)),o=de.BASE.multiply(i),a=ti(await hr.sha512(o.toRawBytes(),s,t)),f=I(i+a*n,pe.l);return new Dr(o,f).toRawBytes()}function Em(t,e,r){e=fr(e),r instanceof de||(r=de.fromHex(r,!1));let{r:n,s}=t instanceof Dr?t.assertValidity():Dr.fromHex(t),i=j.BASE.multiplyUnsafe(s);return{r:n,s,SB:i,pub:r,msg:e}}function Im(t,e,r,n){let s=ti(n),i=j.fromAffine(t).multiplyUnsafe(s);return j.fromAffine(e).add(i).subtract(r).multiplyUnsafe(pe.h).equals(j.ZERO)}async function wh(t,e,r){let{r:n,SB:s,msg:i,pub:o}=Em(t,e,r),a=await hr.sha512(n.toRawBytes(),o.toRawBytes(),i);return Im(o,n,s,a)}de.BASE._setWindowSize(8);var cr={node:fm,web:typeof self=="object"&&"crypto"in self?self.crypto:void 0},hr={bytesToHex:Jn,hexToBytes:va,concatBytes:yh,getExtendedPublicKey:si,mod:I,invert:ni,TORSION_SUBGROUP:["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"],hashToPrivateScalar:t=>{if(t=fr(t),t.length<40||t.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");return I(es(t),pe.l-$)+$},randomBytes:(t=32)=>{if(cr.web)return cr.web.getRandomValues(new Uint8Array(t));if(cr.node){let{randomBytes:e}=cr.node;return new Uint8Array(e(t).buffer)}else throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>hr.randomBytes(32),sha512:async(...t)=>{let e=yh(...t);if(cr.web){let r=await cr.web.subtle.digest("SHA-512",e.buffer);return new Uint8Array(r)}else{if(cr.node)return Uint8Array.from(cr.node.createHash("sha512").update(e).digest());throw new Error("The environment doesn't have sha512 function")}},precompute(t=8,e=de.BASE){let r=e.equals(de.BASE)?e:new de(e.x,e.y);return r._setWindowSize(t),r.multiply(pn),r},sha512Sync:void 0};Object.defineProperties(hr,{sha512Sync:{configurable:!1,get(){return ma},set(t){ma||(ma=t)}}});var dn=32,jt=64,ii=32;async function Sh(){let t=hr.randomPrivateKey(),e=await wa(t);return{privateKey:Ch(t,e),publicKey:e}}async function Eh(t){if(t.length!==ii)throw new TypeError('"seed" must be 32 bytes in length.');if(!(t instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');let e=t,r=await wa(e);return{privateKey:Ch(e,r),publicKey:r}}async function Ih(t,e){let r=t.subarray(0,ii);return await xh(e,r)}async function _h(t,e,r){return await wh(e,r,t)}function Ch(t,e){let r=new Uint8Array(jt);for(let n=0;n<ii;n++)r[n]=t[n],r[ii+n]=e[n];return r}var ts=class{constructor(e){this._key=gn(e,dn)}async verify(e,r){return await _h(this._key,r,e)}marshal(){return this._key}get bytes(){return xt.encode({Type:fe.Ed25519,Data:this.marshal()}).subarray()}equals(e){return xe(this.bytes,e.bytes)}async hash(){let{bytes:e}=await _e.digest(this.bytes);return e}},kr=class{constructor(e,r){this._key=gn(e,jt),this._publicKey=gn(r,dn)}async sign(e){return await Ih(this._key,e)}get public(){return new ts(this._publicKey)}marshal(){return this._key}get bytes(){return wt.encode({Type:fe.Ed25519,Data:this.marshal()}).subarray()}equals(e){return xe(this.bytes,e.bytes)}async hash(){let{bytes:e}=await _e.digest(this.bytes);return e}async id(){let e=await Xt.digest(this.public.bytes);return ve.encode(e.bytes).substring(1)}async export(e,r="libp2p-key"){if(r==="libp2p-key")return await hn(this.bytes,e);throw(0,Sa.default)(new Error(`export format '${r}' is not supported`),"ERR_INVALID_EXPORT_FORMAT")}};function Am(t){if(t.length>jt){t=gn(t,jt+dn);let n=t.subarray(0,jt),s=t.subarray(jt,t.length);return new kr(n,s)}t=gn(t,jt);let e=t.subarray(0,jt),r=t.subarray(dn);return new kr(e,r)}function Bm(t){return t=gn(t,dn),new ts(t)}async function Tm(){let{privateKey:t,publicKey:e}=await Sh();return new kr(t,e)}async function Ah(t){let{privateKey:e,publicKey:r}=await Eh(t);return new kr(e,r)}function gn(t,e){if(t=Uint8Array.from(t??[]),t.length!==e)throw(0,Sa.default)(new Error(`Key must be a Uint8Array of length ${e}, got ${t.length}`),"ERR_INVALID_KEY_TYPE");return t}var _a={};Ne(_a,{Secp256k1PrivateKey:()=>ns,Secp256k1PublicKey:()=>rs,generateKeyPair:()=>km,unmarshalSecp256k1PrivateKey:()=>Rm,unmarshalSecp256k1PublicKey:()=>Dm});var Mh=U(Be(),1);var yn=U(Be(),1);function Bh(){return lt.randomPrivateKey()}async function Th(t,e){let{digest:r}=await _e.digest(e);try{return await eh(r,t)}catch(n){throw(0,yn.default)(n,"ERR_INVALID_INPUT")}}async function Ph(t,e,r){try{let{digest:n}=await _e.digest(r);return th(e,n,t)}catch(n){throw(0,yn.default)(n,"ERR_INVALID_INPUT")}}function Rh(t){return re.fromHex(t).toRawBytes(!0)}function Dh(t){try{ca(t,!0)}catch(e){throw(0,yn.default)(e,"ERR_INVALID_PRIVATE_KEY")}}function Ia(t){try{re.fromHex(t)}catch(e){throw(0,yn.default)(e,"ERR_INVALID_PUBLIC_KEY")}}function kh(t){try{return ca(t,!0)}catch(e){throw(0,yn.default)(e,"ERR_INVALID_PRIVATE_KEY")}}var rs=class{constructor(e){Ia(e),this._key=e}async verify(e,r){return await Ph(this._key,r,e)}marshal(){return Rh(this._key)}get bytes(){return xt.encode({Type:fe.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return xe(this.bytes,e.bytes)}async hash(){let{bytes:e}=await _e.digest(this.bytes);return e}},ns=class{constructor(e,r){this._key=e,this._publicKey=r??kh(e),Dh(this._key),Ia(this._publicKey)}async sign(e){return await Th(this._key,e)}get public(){return new rs(this._publicKey)}marshal(){return this._key}get bytes(){return wt.encode({Type:fe.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return xe(this.bytes,e.bytes)}async hash(){let{bytes:e}=await _e.digest(this.bytes);return e}async id(){let e=await this.public.hash();return H(e,"base58btc")}async export(e,r="libp2p-key"){if(r==="libp2p-key")return await hn(this.bytes,e);throw(0,Mh.default)(new Error(`export format '${r}' is not supported`),"ERR_INVALID_EXPORT_FORMAT")}};function Rm(t){return new ns(t)}function Dm(t){return new rs(t)}async function km(){let t=await Bh();return new ns(t)}var lr={rsa:pa,ed25519:Ea,secp256k1:_a};function Ca(t){let e=Object.keys(lr).join(" / ");return(0,Nh.default)(new Error(`invalid or unsupported key type ${t}. Must be ${e}`),"ERR_UNSUPPORTED_KEY_TYPE")}function Nm(t){if(t=t.toLowerCase(),t==="rsa"||t==="ed25519"||t==="secp256k1")return lr[t];throw Ca(t)}function ss(t){let e=xt.decode(t),r=e.Data??new Uint8Array;switch(e.Type){case fe.RSA:return lr.rsa.unmarshalRsaPublicKey(r);case fe.Ed25519:return lr.ed25519.unmarshalEd25519PublicKey(r);case fe.Secp256k1:return lr.secp256k1.unmarshalSecp256k1PublicKey(r);default:throw Ca(e.Type??"RSA")}}function Lh(t,e){return e=(e??"rsa").toLowerCase(),Nm(e),t.bytes}async function oi(t){let e=wt.decode(t),r=e.Data??new Uint8Array;switch(e.Type){case fe.RSA:return await lr.rsa.unmarshalRsaPrivateKey(r);case fe.Ed25519:return lr.ed25519.unmarshalEd25519PrivateKey(r);case fe.Secp256k1:return lr.secp256k1.unmarshalSecp256k1PrivateKey(r);default:throw Ca(e.Type??"RSA")}}var Oh={ERR_SIGNATURE_NOT_VALID:"ERR_SIGNATURE_NOT_VALID"};var is;(function(t){let e;t.codec=()=>(e==null&&(e=zt((r,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),(s.writeDefaults===!0||r.publicKey!=null&&r.publicKey.byteLength>0)&&(n.uint32(10),n.bytes(r.publicKey)),(s.writeDefaults===!0||r.payloadType!=null&&r.payloadType.byteLength>0)&&(n.uint32(18),n.bytes(r.payloadType)),(s.writeDefaults===!0||r.payload!=null&&r.payload.byteLength>0)&&(n.uint32(26),n.bytes(r.payload)),(s.writeDefaults===!0||r.signature!=null&&r.signature.byteLength>0)&&(n.uint32(42),n.bytes(r.signature)),s.lengthDelimited!==!1&&n.ldelim()},(r,n)=>{let s={publicKey:new Uint8Array(0),payloadType:new Uint8Array(0),payload:new Uint8Array(0),signature:new Uint8Array(0)},i=n==null?r.len:r.pos+n;for(;r.pos<i;){let o=r.uint32();switch(o>>>3){case 1:s.publicKey=r.bytes();break;case 2:s.payloadType=r.bytes();break;case 3:s.payload=r.bytes();break;case 5:s.signature=r.bytes();break;default:r.skipType(o&7);break}}return s})),e),t.encode=r=>Kt(r,t.codec()),t.decode=r=>Ut(r,t.codec())})(is||(is={}));var Om=U(Be(),1);var Fh=Symbol.for("@libp2p/peer-id");var Fm=Symbol.for("nodejs.util.inspect.custom"),Uh=Object.values(Jt).map(t=>t.decoder).reduce((t,e)=>t.or(e),Jt.identity.decoder),Kh=114,Aa=36,Ba=37,os=class{constructor(e){this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}get[Fh](){return!0}toString(){return this.string==null&&(this.string=ve.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return se.createV1(Kh,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){if(e instanceof Uint8Array)return xe(this.multihash.bytes,e);if(typeof e=="string")return Mr(e).equals(this);if(e?.multihash?.bytes!=null)return xe(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[Fm](){return`PeerId(${this.toString()})`}},mn=class extends os{constructor(e){super({...e,type:"RSA"}),this.type="RSA",this.publicKey=e.publicKey}},bn=class extends os{constructor(e){super({...e,type:"Ed25519"}),this.type="Ed25519",this.publicKey=e.multihash.digest}},vn=class extends os{constructor(e){super({...e,type:"secp256k1"}),this.type="secp256k1",this.publicKey=e.multihash.digest}};function Mr(t,e){if(e=e??Uh,t.charAt(0)==="1"||t.charAt(0)==="Q"){let r=br(ve.decode(`z${t}`));return t.startsWith("12D")?new bn({multihash:r}):t.startsWith("16U")?new vn({multihash:r}):new mn({multihash:r})}return pr(Uh.decode(t))}function pr(t){try{let e=br(t);if(e.code===Xt.code){if(e.digest.length===Aa)return new bn({multihash:e});if(e.digest.length===Ba)return new vn({multihash:e})}if(e.code===_e.code)return new mn({multihash:e})}catch{return Um(se.decode(t))}throw new Error("Supplied PeerID CID is invalid")}function Um(t){if(t==null||t.multihash==null||t.version==null||t.version===1&&t.code!==Kh)throw new Error("Supplied PeerID CID is invalid");let e=t.multihash;if(e.code===_e.code)return new mn({multihash:t.multihash});if(e.code===Xt.code){if(e.digest.length===Aa)return new bn({multihash:t.multihash});if(e.digest.length===Ba)return new vn({multihash:t.multihash})}throw new Error("Supplied PeerID CID is invalid")}async function zh(t,e){return t.length===Aa?new bn({multihash:mt(Xt.code,t),privateKey:e}):t.length===Ba?new vn({multihash:mt(Xt.code,t),privateKey:e}):new mn({multihash:await _e.digest(t),publicKey:t,privateKey:e})}var Vh=Symbol.for("@achingbrain/uint8arraylist");function qh(t,e){if(e==null||e<0)throw new RangeError("index is out of bounds");let r=0;for(let n of t){let s=r+n.byteLength;if(e<s)return{buf:n,index:e-r};r=s}throw new RangeError("index is out of bounds")}function ai(t){return Boolean(t?.[Vh])}var rt=class{constructor(...e){Object.defineProperty(this,Vh,{value:!0}),this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let r=0;for(let n of e)if(n instanceof Uint8Array)r+=n.byteLength,this.bufs.push(n);else if(ai(n))r+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=r}prepend(...e){this.prependAll(e)}prependAll(e){let r=0;for(let n of e.reverse())if(n instanceof Uint8Array)r+=n.byteLength,this.bufs.unshift(n);else if(ai(n))r+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=r}get(e){let r=qh(this.bufs,e);return r.buf[r.index]}set(e,r){let n=qh(this.bufs,e);n.buf[n.index]=r}write(e,r=0){if(e instanceof Uint8Array)for(let n=0;n<e.length;n++)this.set(r+n,e[n]);else if(ai(e))for(let n=0;n<e.length;n++)this.set(r+n,e.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}}slice(e,r){let{bufs:n,length:s}=this._subList(e,r);return me(n,s)}subarray(e,r){let{bufs:n,length:s}=this._subList(e,r);return n.length===1?n[0]:me(n,s)}sublist(e,r){let{bufs:n,length:s}=this._subList(e,r),i=new rt;return i.length=s,i.bufs=n,i}_subList(e,r){if(e=e??0,r=r??this.length,e<0&&(e=this.length+e),r<0&&(r=this.length+r),e<0||r>this.length)throw new RangeError("index is out of bounds");if(e===r)return{bufs:[],length:0};if(e===0&&r===this.length)return{bufs:[...this.bufs],length:this.length};let n=[],s=0;for(let i=0;i<this.bufs.length;i++){let o=this.bufs[i],a=s,f=a+o.byteLength;if(s=f,e>=f)continue;let u=e>=a&&e<f,c=r>a&&r<=f;if(u&&c){if(e===a&&r===f){n.push(o);break}let h=e-a;n.push(o.subarray(h,h+(r-e)));break}if(u){if(e===0){n.push(o);continue}n.push(o.subarray(e-a));continue}if(c){if(r===f){n.push(o);break}n.push(o.subarray(0,r-a));break}n.push(o)}return{bufs:n,length:r-e}}indexOf(e,r=0){if(!ai(e)&&!(e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');let n=e instanceof Uint8Array?e:e.subarray();if(r=Number(r??0),isNaN(r)&&(r=0),r<0&&(r=this.length+r),r<0&&(r=0),e.length===0)return r>this.length?this.length:r;let s=n.byteLength;if(s===0)throw new TypeError("search must be at least 1 byte long");let i=256,o=new Int32Array(i);for(let h=0;h<i;h++)o[h]=-1;for(let h=0;h<s;h++)o[n[h]]=h;let a=o,f=this.byteLength-n.byteLength,u=n.byteLength-1,c;for(let h=r;h<=f;h+=c){c=0;for(let l=u;l>=0;l--){let d=this.get(h+l);if(n[l]!==d){c=Math.max(1,l-a[d]);break}}if(c===0)return h}return-1}getInt8(e){let r=this.subarray(e,e+1);return new DataView(r.buffer,r.byteOffset,r.byteLength).getInt8(0)}setInt8(e,r){let n=Ft(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,r),this.write(n,e)}getInt16(e,r){let n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,r)}setInt16(e,r,n){let s=Ot(2);new DataView(s.buffer,s.byteOffset,s.byteLength).setInt16(0,r,n),this.write(s,e)}getInt32(e,r){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,r)}setInt32(e,r,n){let s=Ot(4);new DataView(s.buffer,s.byteOffset,s.byteLength).setInt32(0,r,n),this.write(s,e)}getBigInt64(e,r){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,r)}setBigInt64(e,r,n){let s=Ot(8);new DataView(s.buffer,s.byteOffset,s.byteLength).setBigInt64(0,r,n),this.write(s,e)}getUint8(e){let r=this.subarray(e,e+1);return new DataView(r.buffer,r.byteOffset,r.byteLength).getUint8(0)}setUint8(e,r){let n=Ft(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,r),this.write(n,e)}getUint16(e,r){let n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,r)}setUint16(e,r,n){let s=Ot(2);new DataView(s.buffer,s.byteOffset,s.byteLength).setUint16(0,r,n),this.write(s,e)}getUint32(e,r){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,r)}setUint32(e,r,n){let s=Ot(4);new DataView(s.buffer,s.byteOffset,s.byteLength).setUint32(0,r,n),this.write(s,e)}getBigUint64(e,r){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,r)}setBigUint64(e,r,n){let s=Ot(8);new DataView(s.buffer,s.byteOffset,s.byteLength).setBigUint64(0,r,n),this.write(s,e)}getFloat32(e,r){let n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,r)}setFloat32(e,r,n){let s=Ot(4);new DataView(s.buffer,s.byteOffset,s.byteLength).setFloat32(0,r,n),this.write(s,e)}getFloat64(e,r){let n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,r)}setFloat64(e,r,n){let s=Ot(8);new DataView(s.buffer,s.byteOffset,s.byteLength).setFloat64(0,r,n),this.write(s,e)}equals(e){if(e==null||!(e instanceof rt)||e.bufs.length!==this.bufs.length)return!1;for(let r=0;r<this.bufs.length;r++)if(!xe(this.bufs[r],e.bufs[r]))return!1;return!0}static fromUint8Arrays(e,r){let n=new rt;return n.bufs=e,r==null&&(r=e.reduce((s,i)=>s+i.byteLength,0)),n.length=r,n}};function ci(t){return t instanceof Uint8Array?{get(e){return t[e]},set(e,r){t[e]=r}}:{get(e){return t.get(e)},set(e,r){t.set(e,r)}}}var Gh=4294967296,Ze=class{constructor(e=0,r=0){this.hi=e,this.lo=r}toBigInt(e){if(e===!0)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){let r=~this.lo+1>>>0,n=~this.hi>>>0;return r===0&&(n=n+1>>>0),-(BigInt(r)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toNumber(e){return Number(this.toBigInt(e))}zzDecode(){let e=-(this.lo&1),r=((this.lo>>>1|this.hi<<31)^e)>>>0,n=(this.hi>>>1^e)>>>0;return new Ze(n,r)}zzEncode(){let e=this.hi>>31,r=((this.hi<<1|this.lo>>>31)^e)>>>0,n=(this.lo<<1^e)>>>0;return new Ze(r,n)}toBytes(e,r=0){let n=ci(e);for(;this.hi>0;)n.set(r++,this.lo&127|128),this.lo=(this.lo>>>7|this.hi<<25)>>>0,this.hi>>>=7;for(;this.lo>127;)n.set(r++,this.lo&127|128),this.lo=this.lo>>>7;n.set(r++,this.lo)}static fromBigInt(e){if(e===0n)return new Ze;let r=e<0;r&&(e=-e);let n=Number(e>>32n)|0,s=Number(e-(BigInt(n)<<32n))|0;return r&&(n=~n>>>0,s=~s>>>0,++s>Gh&&(s=0,++n>Gh&&(n=0))),new Ze(n,s)}static fromNumber(e){if(e===0)return new Ze;let r=e<0;r&&(e=-e);let n=e>>>0,s=(e-n)/4294967296>>>0;return r&&(s=~s>>>0,n=~n>>>0,++n>4294967295&&(n=0,++s>4294967295&&(s=0))),new Ze(s,n)}static fromBytes(e,r=0){let n=ci(e),s=new Ze,i=0;if(e.length-r>4){for(;i<4;++i)if(s.lo=(s.lo|(n.get(r)&127)<<i*7)>>>0,n.get(r++)<128)return s;if(s.lo=(s.lo|(n.get(r)&127)<<28)>>>0,s.hi=(s.hi|(n.get(r)&127)>>4)>>>0,n.get(r++)<128)return s;i=0}else for(;i<4;++i){if(r>=e.length)throw RangeError(`index out of range: ${r} > ${e.length}`);if(s.lo=(s.lo|(n.get(r)&127)<<i*7)>>>0,n.get(r++)<128)return s}if(e.length-r>4){for(;i<5;++i)if(s.hi=(s.hi|(n.get(r)&127)<<i*7+3)>>>0,n.get(r++)<128)return s}else if(r<e.byteLength)for(;i<5;++i){if(r>=e.length)throw RangeError(`index out of range: ${r} > ${e.length}`);if(s.hi=(s.hi|(n.get(r)&127)<<i*7+3)>>>0,n.get(r++)<128)return s}throw RangeError("invalid varint encoding")}};var Km=Math.pow(2,7),zm=Math.pow(2,14),qm=Math.pow(2,21),Vm=Math.pow(2,28),Gm=Math.pow(2,35),Hm=Math.pow(2,42),Wm=Math.pow(2,49),jm=Math.pow(2,56),$m=Math.pow(2,63),pt={encodingLength(t){return t<Km?1:t<zm?2:t<qm?3:t<Vm?4:t<Gm?5:t<Hm?6:t<Wm?7:t<jm?8:t<$m?9:10},encode(t,e,r=0){if(Number.MAX_SAFE_INTEGER!=null&&t>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return e==null&&(e=Ft(pt.encodingLength(t))),Ze.fromNumber(t).toBytes(e,r),e},decode(t,e=0){return Ze.fromBytes(t,e).toNumber(!0)}};var Zm,nt=class{constructor(e){let{peerId:r,payloadType:n,payload:s,signature:i}=e;this.peerId=r,this.payloadType=n,this.payload=s,this.signature=i}marshal(){if(this.peerId.publicKey==null)throw new Error("Missing public key");return this.marshaled==null&&(this.marshaled=is.encode({publicKey:this.peerId.publicKey,payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(e){return xe(this.marshal(),e.marshal())}async validate(e){let r=Wh(e,this.payloadType,this.payload);if(this.peerId.publicKey==null)throw new Error("Missing public key");return await ss(this.peerId.publicKey).verify(r.subarray(),this.signature)}};Zm=nt;nt.createFromProtobuf=async t=>{let e=is.decode(t),r=await zh(e.publicKey);return new nt({peerId:r,payloadType:e.payloadType,payload:e.payload,signature:e.signature})};nt.seal=async(t,e)=>{if(e.privateKey==null)throw new Error("Missing private key");let r=t.domain,n=t.codec,s=t.marshal(),i=Wh(r,n,s),a=await(await oi(e.privateKey)).sign(i.subarray());return new nt({peerId:e,payloadType:n,payload:s,signature:a})};nt.openAndCertify=async(t,e)=>{let r=await nt.createFromProtobuf(t);if(!await r.validate(e))throw(0,Hh.default)(new Error("envelope signature is not valid for the given domain"),Oh.ERR_SIGNATURE_NOT_VALID);return r};var Wh=(t,e,r)=>{let n=ye(t),s=pt.encode(n.byteLength),i=pt.encode(e.length),o=pt.encode(r.length);return new rt(s,n,i,e,o,r)};var ui=class{index=0;input="";new(e){return this.index=0,this.input=e,this}readAtomically(e){let r=this.index,n=e();return n===void 0&&(this.index=r),n}parseWith(e){let r=e();if(this.index===this.input.length)return r}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{let r=this.readChar();if(r===e)return r})}readSeparator(e,r,n){return this.readAtomically(()=>{if(!(r>0&&this.readGivenChar(e)===void 0))return n()})}readNumber(e,r,n,s){return this.readAtomically(()=>{let i=0,o=0,a=this.peekChar();if(a===void 0)return;let f=a==="0",u=2**(8*s)-1;for(;;){let c=this.readAtomically(()=>{let h=this.readChar();if(h===void 0)return;let l=Number.parseInt(h,e);if(!Number.isNaN(l))return l});if(c===void 0)break;if(i*=e,i+=c,i>u||(o+=1,r!==void 0&&o>r))return}if(o!==0)return!n&&f&&o>1?void 0:i})}readIPv4Addr(){return this.readAtomically(()=>{let e=new Uint8Array(4);for(let r=0;r<e.length;r++){let n=this.readSeparator(".",r,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;e[r]=n}return e})}readIPv6Addr(){let e=r=>{for(let n=0;n<r.length/2;n++){let s=n*2;if(n<r.length-3){let o=this.readSeparator(":",n,()=>this.readIPv4Addr());if(o!==void 0)return r[s]=o[0],r[s+1]=o[1],r[s+2]=o[2],r[s+3]=o[3],[s+4,!0]}let i=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(i===void 0)return[s,!1];r[s]=i>>8,r[s+1]=i&255}return[r.length,!1]};return this.readAtomically(()=>{let r=new Uint8Array(16),[n,s]=e(r);if(n===16)return r;if(s||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;let i=new Uint8Array(14),o=16-(n+2),[a]=e(i.subarray(0,o));return r.set(i.subarray(0,a),16-a),r})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}};var jh=45,Ym=15,xn=new ui;function $h(t){if(!(t.length>Ym))return xn.new(t).parseWith(()=>xn.readIPv4Addr())}function Zh(t){if(!(t.length>jh))return xn.new(t).parseWith(()=>xn.readIPv6Addr())}function Yh(t){if(!(t.length>jh))return xn.new(t).parseWith(()=>xn.readIPAddr())}function Qh(t){return Boolean($h(t))}function Xh(t){return Boolean(Zh(t))}function fi(t){return Boolean(Yh(t))}var Jh=Qh,Qm=Xh,Ta=function(t){let e=0;if(t=t.toString().trim(),Jh(t)){let r=new Uint8Array(e+4);return t.split(/\./g).forEach(n=>{r[e++]=parseInt(n,10)&255}),r}if(Qm(t)){let r=t.split(":",8),n;for(n=0;n<r.length;n++){let i=Jh(r[n]),o;i&&(o=Ta(r[n]),r[n]=H(o.slice(0,2),"base16")),o!=null&&++n<8&&r.splice(n,0,H(o.slice(2,4),"base16"))}if(r[0]==="")for(;r.length<8;)r.unshift("0");else if(r[r.length-1]==="")for(;r.length<8;)r.push("0");else if(r.length<8){for(n=0;n<r.length&&r[n]!=="";n++);let i=[n,1];for(n=9-r.length;n>0;n--)i.push("0");r.splice.apply(r,i)}let s=new Uint8Array(e+16);for(n=0;n<r.length;n++){let i=parseInt(r[n],16);s[e++]=i>>8&255,s[e++]=i&255}return s}throw new Error("invalid ip address")},e0=function(t,e=0,r){e=~~e,r=r??t.length-e;let n=new DataView(t.buffer);if(r===4){let s=[];for(let i=0;i<r;i++)s.push(t[e+i]);return s.join(".")}if(r===16){let s=[];for(let i=0;i<r;i+=2)s.push(n.getUint16(e+i).toString(16));return s.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""};var as={},Pa={},Jm=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,-1,"ip6zone"],[53,-1,"dns",!0],[54,-1,"dns4",!0],[55,-1,"dns6",!0],[56,-1,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,-1,"unix",!1,!0],[421,-1,"ipfs"],[421,-1,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,-1,"garlic64"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,-1,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,-1,"memory"]];Jm.forEach(t=>{let e=e1(...t);Pa[e.code]=e,as[e.name]=e});function e1(t,e,r,n,s){return{code:t,size:e,name:r,resolvable:Boolean(n),path:Boolean(s)}}function Ce(t){if(typeof t=="number"){if(Pa[t]!=null)return Pa[t];throw new Error(`no protocol with code: ${t}`)}else if(typeof t=="string"){if(as[t]!=null)return as[t];throw new Error(`no protocol with name: ${t}`)}throw new Error(`invalid protocol id type: ${typeof t}`)}var Pt=U(hi(),1);function li(t,e){switch(Ce(t).code){case 4:case 41:return g1(e);case 6:case 273:case 33:case 132:return p0(e).toString();case 53:case 54:case 55:case 56:case 400:case 777:return m1(e);case 421:return w1(e);case 444:return h0(e);case 445:return h0(e);case 466:return x1(e);default:return H(e,"base16")}}function l0(t,e){switch(Ce(t).code){case 4:return f0(e);case 41:return f0(e);case 6:case 273:case 33:case 132:return Ma(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 777:return y1(e);case 421:return b1(e);case 444:return S1(e);case 445:return E1(e);case 466:return v1(e);default:return ye(e,"base16")}}var ka=Object.values(Jt).map(t=>t.decoder),d1=function(){let t=ka[0].or(ka[1]);return ka.slice(2).forEach(e=>t=t.or(e)),t}();function f0(t){if(!fi(t))throw new Error("invalid ip address");return Ta(t)}function g1(t){let e=e0(t,0,t.length);if(e==null)throw new Error("ipBuff is required");if(!fi(e))throw new Error("invalid ip address");return e}function Ma(t){let e=new ArrayBuffer(2);return new DataView(e).setUint16(0,t),new Uint8Array(e)}function p0(t){return new DataView(t.buffer).getUint16(t.byteOffset)}function y1(t){let e=ye(t),r=Uint8Array.from(Pt.default.encode(e.length));return me([r,e],r.length+e.length)}function m1(t){let e=Pt.default.decode(t);if(t=t.slice(Pt.default.decode.bytes),t.length!==e)throw new Error("inconsistent lengths");return H(t)}function b1(t){let e;t[0]==="Q"||t[0]==="1"?e=br(ve.decode(`z${t}`)).bytes:e=se.parse(t).multihash.bytes;let r=Uint8Array.from(Pt.default.encode(e.length));return me([r,e],r.length+e.length)}function v1(t){let e=d1.decode(t),r=Uint8Array.from(Pt.default.encode(e.length));return me([r,e],r.length+e.length)}function x1(t){let e=Pt.default.decode(t),r=t.slice(Pt.default.decode.bytes);if(r.length!==e)throw new Error("inconsistent lengths");return"u"+H(r,"base64url")}function w1(t){let e=Pt.default.decode(t),r=t.slice(Pt.default.decode.bytes);if(r.length!==e)throw new Error("inconsistent lengths");return H(r,"base58btc")}function S1(t){let e=t.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);let r=ot.decode("b"+e[0]),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let s=Ma(n);return me([r,s],r.length+s.length)}function E1(t){let e=t.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);let r=ot.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");let s=Ma(n);return me([r,s],r.length+s.length)}function h0(t){let e=t.slice(0,t.length-2),r=t.slice(t.length-2),n=H(e,"base32"),s=p0(r);return`${n}:${s}`}var wn=U(hi(),1);function I1(t){let e=[],r=t.split("/").slice(1);if(r.length===1&&r[0]==="")return[];for(let n=0;n<r.length;n++){let s=r[n],i=Ce(s);if(i.size===0){e.push([s]);continue}if(n++,n>=r.length)throw g0("invalid address: "+t);if(i.path===!0){e.push([s,Ua(r.slice(n).join("/"))]);break}e.push([s,r[n]])}return e}function _1(t){let e=[];return t.map(r=>{let n=gi(r);return e.push(n.name),r.length>1&&r[1]!=null&&e.push(r[1]),null}),Ua(e.join("/"))}function C1(t){return t.map(e=>{Array.isArray(e)||(e=[e]);let r=gi(e);return e.length>1?[r.code,l0(r.code,e[1])]:[r.code]})}function Na(t){return t.map(e=>{let r=gi(e);return e[1]!=null?[r.code,li(r.code,e[1])]:[r.code]})}function La(t){return di(me(t.map(e=>{let r=gi(e),n=Uint8Array.from(wn.default.encode(r.code));return e.length>1&&e[1]!=null&&(n=me([n,e[1]])),n})))}function Oa(t,e){return t.size>0?t.size/8:t.size===0?0:wn.default.decode(e)+(wn.default.decode.bytes??0)}function pi(t){let e=[],r=0;for(;r<t.length;){let n=wn.default.decode(t,r),s=wn.default.decode.bytes??0,i=Ce(n),o=Oa(i,t.slice(r+s));if(o===0){e.push([n]),r+=s;continue}let a=t.slice(r+s,r+s+o);if(r+=o+s,r>t.length)throw g0("Invalid address Uint8Array: "+H(t,"base16"));e.push([n,a])}return e}function Fa(t){let e=pi(t),r=Na(e);return _1(r)}function A1(t){t=Ua(t);let e=I1(t),r=C1(e);return La(r)}function d0(t){return A1(t)}function di(t){let e=B1(t);if(e!=null)throw e;return Uint8Array.from(t)}function B1(t){try{pi(t)}catch(e){return e}}function Ua(t){return"/"+t.trim().split("/").filter(e=>e).join("/")}function g0(t){return new Error("Error parsing address: "+t)}function gi(t){return Ce(t[0])}var za=U(hi(),1);var b0=U(Be(),1);var Sn=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},Ka=function(t,e,r,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(t,r):s?s.value=r:e.set(t,r),r},cs,us,fs,y0,P1=Symbol.for("nodejs.util.inspect.custom"),m0=[Ce("dns").code,Ce("dns4").code,Ce("dns6").code,Ce("dnsaddr").code],R1=[Ce("p2p").code,Ce("ipfs").code],D1=new Map,v0=Symbol.for("@multiformats/js-multiaddr/multiaddr");function k1(t){return Boolean(t?.[v0])}var $t=class{constructor(e){if(cs.set(this,void 0),us.set(this,void 0),fs.set(this,void 0),this[y0]=!0,e==null&&(e=""),e instanceof Uint8Array)this.bytes=di(e);else if(typeof e=="string"){if(e.length>0&&e.charAt(0)!=="/")throw new Error(`multiaddr "${e}" must start with a "/"`);this.bytes=d0(e)}else if(k1(e))this.bytes=di(e.bytes);else throw new Error("addr must be a string, Buffer, or another Multiaddr")}toString(){return Sn(this,cs,"f")==null&&Ka(this,cs,Fa(this.bytes),"f"),Sn(this,cs,"f")}toJSON(){return this.toString()}toOptions(){let e=this.protoCodes(),r=this.toString().split("/").slice(1),n,s;if(r.length>2)m0.includes(e[0])&&R1.includes(e[1])?(n=Ce("tcp").name,s=443):(n=Ce(r[2]).name,s=parseInt(r[3]));else if(m0.includes(e[0]))n=Ce("tcp").name,s=443;else throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e[0]===41||e[0]===55?6:4,host:r[1],transport:n,port:s}}protos(){return this.protoCodes().map(e=>Object.assign({},Ce(e)))}protoCodes(){let e=[],r=this.bytes,n=0;for(;n<r.length;){let s=za.default.decode(r,n),i=za.default.decode.bytes??0,o=Ce(s),a=Oa(o,r.slice(n+i));n+=a+i,e.push(s)}return e}protoNames(){return this.protos().map(e=>e.name)}tuples(){return Sn(this,us,"f")==null&&Ka(this,us,pi(this.bytes),"f"),Sn(this,us,"f")}stringTuples(){return Sn(this,fs,"f")==null&&Ka(this,fs,Na(this.tuples()),"f"),Sn(this,fs,"f")}encapsulate(e){return e=new $t(e),new $t(this.toString()+e.toString())}decapsulate(e){let r=e.toString(),n=this.toString(),s=n.lastIndexOf(r);if(s<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new $t(n.slice(0,s))}decapsulateCode(e){let r=this.tuples();for(let n=r.length-1;n>=0;n--)if(r[n][0]===e)return new $t(La(r.slice(0,n)));return this}getPeerId(){try{let r=this.stringTuples().filter(n=>n[0]===as.ipfs.code).pop();if(r?.[1]!=null){let n=r[1];return n[0]==="Q"||n[0]==="1"?H(ve.decode(`z${n}`),"base58btc"):H(se.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){let e=null;try{e=this.stringTuples().filter(r=>Ce(r[0]).path===!0)[0][1],e==null&&(e=null)}catch{e=null}return e}equals(e){return xe(this.bytes,e.bytes)}async resolve(e){let r=this.protos().find(i=>i.resolvable);if(r==null)return[this];let n=D1.get(r.name);if(n==null)throw(0,b0.default)(new Error(`no available resolver for ${r.name}`),"ERR_NO_AVAILABLE_RESOLVER");return(await n(this,e)).map(i=>new $t(i))}nodeAddress(){let e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){let r=(e??this).protos();return!(r.length!==2||r[0].code!==4&&r[0].code!==41||r[1].code!==6&&r[1].code!==273)}[(cs=new WeakMap,us=new WeakMap,fs=new WeakMap,y0=v0,P1)](){return`Multiaddr(${Fa(this.bytes)})`}};function x0(t){return new $t(t)}function w0(t,e){let r=(n,s)=>n.toString().localeCompare(s.toString());return t.length!==e.length?!1:(e.sort(r),t.sort(r).every((n,s)=>e[s].equals(n)))}var hs;(function(t){let e;(function(n){let s;n.codec=()=>(s==null&&(s=zt((i,o,a={})=>{a.lengthDelimited!==!1&&o.fork(),(a.writeDefaults===!0||i.multiaddr!=null&&i.multiaddr.byteLength>0)&&(o.uint32(10),o.bytes(i.multiaddr)),a.lengthDelimited!==!1&&o.ldelim()},(i,o)=>{let a={multiaddr:new Uint8Array(0)},f=o==null?i.len:i.pos+o;for(;i.pos<f;){let u=i.uint32();switch(u>>>3){case 1:a.multiaddr=i.bytes();break;default:i.skipType(u&7);break}}return a})),s),n.encode=i=>Kt(i,n.codec()),n.decode=i=>Ut(i,n.codec())})(e=t.AddressInfo||(t.AddressInfo={}));let r;t.codec=()=>(r==null&&(r=zt((n,s,i={})=>{if(i.lengthDelimited!==!1&&s.fork(),(i.writeDefaults===!0||n.peerId!=null&&n.peerId.byteLength>0)&&(s.uint32(10),s.bytes(n.peerId)),(i.writeDefaults===!0||n.seq!==0n)&&(s.uint32(16),s.uint64(n.seq)),n.addresses!=null)for(let o of n.addresses)s.uint32(26),t.AddressInfo.codec().encode(o,s,{writeDefaults:!0});i.lengthDelimited!==!1&&s.ldelim()},(n,s)=>{let i={peerId:new Uint8Array(0),seq:0n,addresses:[]},o=s==null?n.len:n.pos+s;for(;n.pos<o;){let a=n.uint32();switch(a>>>3){case 1:i.peerId=n.bytes();break;case 2:i.seq=n.uint64();break;case 3:i.addresses.push(t.AddressInfo.codec().decode(n,n.uint32()));break;default:n.skipType(a&7);break}}return i})),r),t.encode=n=>Kt(n,t.codec()),t.decode=n=>Ut(n,t.codec())})(hs||(hs={}));var S0="libp2p-peer-record",E0=Uint8Array.from([3,1]);var dt=class{constructor(e){this.domain=dt.DOMAIN,this.codec=dt.CODEC;let{peerId:r,multiaddrs:n,seqNumber:s}=e;this.peerId=r,this.multiaddrs=n??[],this.seqNumber=s??BigInt(Date.now())}marshal(){return this.marshaled==null&&(this.marshaled=hs.encode({peerId:this.peerId.toBytes(),seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map(e=>({multiaddr:e.bytes}))})),this.marshaled}equals(e){return!(!(e instanceof dt)||!this.peerId.equals(e.peerId)||this.seqNumber!==e.seqNumber||!w0(this.multiaddrs,e.multiaddrs))}};dt.createFromProtobuf=t=>{let e=hs.decode(t),r=pr(e.peerId),n=(e.addresses??[]).map(i=>x0(i.multiaddr)),s=e.seq;return new dt({peerId:r,multiaddrs:n,seqNumber:s})};dt.DOMAIN=S0;dt.CODEC=E0;var Rt=U(B0(),1);Rt.default.formatters.b=t=>t==null?"undefined":ve.baseEncode(t);Rt.default.formatters.t=t=>t==null?"undefined":ot.baseEncode(t);Rt.default.formatters.m=t=>t==null?"undefined":jr.baseEncode(t);Rt.default.formatters.p=t=>t==null?"undefined":t.toString();Rt.default.formatters.c=t=>t==null?"undefined":t.toString();Rt.default.formatters.k=t=>t==null?"undefined":t.toString();function bi(t){return Object.assign((0,Rt.default)(t),{error:(0,Rt.default)(`${t}:error`),trace:(0,Rt.default)(`${t}:trace`)})}var qa=Symbol.for("@libp2p/topology");var T0=()=>{},Va=class{constructor(e){this.min=e.min??0,this.max=e.max??1/0,this.peers=new Set,this.onConnect=e.onConnect??T0,this.onDisconnect=e.onDisconnect??T0}get[Symbol.toStringTag](){return qa.toString()}get[qa](){return!0}async setRegistrar(e){this.registrar=e}disconnect(e){this.onDisconnect(e)}};function P0(t){return new Va(t)}var Lr=function(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)},Zt,vi=class extends EventTarget{constructor(){super(...arguments),Zt.set(this,new Map)}listenerCount(e){let r=Lr(this,Zt,"f").get(e);return r==null?0:r.length}addEventListener(e,r,n){super.addEventListener(e,r,n);let s=Lr(this,Zt,"f").get(e);s==null&&(s=[],Lr(this,Zt,"f").set(e,s)),s.push({callback:r,once:(n!==!0&&n!==!1&&n?.once)??!1})}removeEventListener(e,r,n){super.removeEventListener(e.toString(),r??null,n);let s=Lr(this,Zt,"f").get(e);s!=null&&(s=s.filter(({callback:i})=>i!==r),Lr(this,Zt,"f").set(e,s))}dispatchEvent(e){let r=super.dispatchEvent(e),n=Lr(this,Zt,"f").get(e.type);return n==null||(n=n.filter(({once:s})=>!s),Lr(this,Zt,"f").set(e.type,n)),r}};Zt=new WeakMap;var Ga=class extends Event{constructor(e,r){super(e,r),this.detail=r?.detail}},Or=globalThis.CustomEvent??Ga;var xi=class{constructor(e,r,n){this.gossip=e,this.msgs=new Map,this.history=[],this.notValidatedCount=0,this.msgIdToStrFn=n;for(let s=0;s<r;s++)this.history[s]=[]}get size(){return this.msgs.size}put(e,r,n=!1){let{msgIdStr:s}=e;return this.msgs.has(s)?!1:(this.msgs.set(s,{message:r,validated:n,originatingPeers:new Set,iwantCounts:new Map}),this.history[0].push({...e,topic:r.topic}),n||this.notValidatedCount++,!0)}observeDuplicate(e,r){let n=this.msgs.get(e);n&&!n.validated&&n.originatingPeers.add(r)}get(e){return this.msgs.get(this.msgIdToStrFn(e))?.message}getWithIWantCount(e,r){let n=this.msgs.get(e);if(!n)return null;let s=(n.iwantCounts.get(r)??0)+1;return n.iwantCounts.set(r,s),{msg:n.message,count:s}}getGossipIDs(e){let r=new Map;for(let n=0;n<this.gossip;n++)this.history[n].forEach(s=>{let i=this.msgs.get(s.msgIdStr);if(i&&i.validated&&e.has(s.topic)){let o=r.get(s.topic);o||(o=[],r.set(s.topic,o)),o.push(s.msgId)}});return r}validate(e){let r=this.msgs.get(e);if(!r)return null;r.validated||this.notValidatedCount--;let{message:n,originatingPeers:s}=r;return r.validated=!0,r.originatingPeers=new Set,{message:n,originatingPeers:s}}shift(){this.history[this.history.length-1].forEach(r=>{let n=this.msgs.get(r.msgIdStr);n&&(this.msgs.delete(r.msgIdStr),n.validated||this.notValidatedCount--)}),this.history.pop(),this.history.unshift([])}remove(e){let r=this.msgs.get(e);return r?(this.msgs.delete(e),r):null}};var ul=U(cl(),1),{RPC:ys}=ul.default;var sc="/floodsub/1.0.0",ic="/meshsub/1.0.0",Ei="/meshsub/1.1.0";var fl="ERR_TOPIC_VALIDATOR_REJECT",hl="ERR_TOPIC_VALIDATOR_IGNORE";function Mt(t){if(t.length<=1)return t;let e=()=>Math.floor(Math.random()*Math.floor(t.length));for(let r=0;r<t.length;r++){let n=e(),s=t[r];t[r]=t[n],t[n]=s}return t}function ll(t){return H(t,"base64")}var Kr="StrictSign",Cn="StrictNoSign",yt;(function(t){t.Accept="accept",t.Ignore="ignore",t.Reject="reject"})(yt||(yt={}));var pl;(function(t){t.StrictSign="StrictSign",t.StrictNoSign="StrictNoSign"})(pl||(pl={}));var mr;(function(t){t[t.Signing=0]="Signing",t[t.Anonymous=1]="Anonymous"})(mr||(mr={}));var Ke;(function(t){t.Error="error",t.Ignore="ignore",t.Reject="reject",t.Blacklisted="blacklisted"})(Ke||(Ke={}));var Le;(function(t){t.InvalidSignature="invalid_signature",t.InvalidSeqno="invalid_seqno",t.InvalidPeerId="invalid_peerid",t.SignaturePresent="signature_present",t.SeqnoPresent="seqno_present",t.FromPresent="from_present",t.TransformFailed="transform_failed"})(Le||(Le={}));var it;(function(t){t.duplicate="duplicate",t.invalid="invalid",t.valid="valid"})(it||(it={}));function oc(t){switch(t){case yt.Ignore:return Ke.Ignore;case yt.Reject:return Ke.Reject}}async function ac(t,e){switch(t){case Kr:{if(!e)throw Error("Must provide PeerId");if(e.privateKey==null)throw Error("Cannot sign message, no private key present");if(e.publicKey==null)throw Error("Cannot sign message, no public key present");let r=await oi(e.privateKey);return{type:mr.Signing,author:e,key:e.publicKey,privateKey:r}}case Cn:return{type:mr.Anonymous};default:throw new Error(`Unknown signature policy "${t}"`)}}var ne="ERR_INVALID_PEER_SCORE_PARAMS";var J=class extends Error{constructor(e,r,n){super(e),this.code=r,this.name=n?.name??"CodeError",this.props=n??{}}};var eb={topics:{},topicScoreCap:10,appSpecificScore:()=>0,appSpecificWeight:10,IPColocationFactorWeight:-5,IPColocationFactorThreshold:10,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:-10,behaviourPenaltyThreshold:0,behaviourPenaltyDecay:.2,decayInterval:1e3,decayToZero:.1,retainScore:3600*1e3},tb={topicWeight:.5,timeInMeshWeight:1,timeInMeshQuantum:1,timeInMeshCap:3600,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.5,firstMessageDeliveriesCap:2e3,meshMessageDeliveriesWeight:-1,meshMessageDeliveriesDecay:.5,meshMessageDeliveriesCap:100,meshMessageDeliveriesThreshold:20,meshMessageDeliveriesWindow:10,meshMessageDeliveriesActivation:5e3,meshFailurePenaltyWeight:-1,meshFailurePenaltyDecay:.5,invalidMessageDeliveriesWeight:-1,invalidMessageDeliveriesDecay:.3};function dl(t={}){return{...eb,...t,topics:t.topics?Object.entries(t.topics).reduce((e,[r,n])=>(e[r]=rb(n),e),{}):{}}}function rb(t={}){return{...tb,...t}}function gl(t){for(let[e,r]of Object.entries(t.topics))try{nb(r)}catch(n){throw new J(`invalid score parameters for topic ${e}: ${n.message}`,ne)}if(t.topicScoreCap<0)throw new J("invalid topic score cap; must be positive (or 0 for no cap)",ne);if(t.appSpecificScore===null||t.appSpecificScore===void 0)throw new J("missing application specific score function",ne);if(t.IPColocationFactorWeight>0)throw new J("invalid IPColocationFactorWeight; must be negative (or 0 to disable)",ne);if(t.IPColocationFactorWeight!==0&&t.IPColocationFactorThreshold<1)throw new J("invalid IPColocationFactorThreshold; must be at least 1",ne);if(t.behaviourPenaltyWeight>0)throw new J("invalid BehaviourPenaltyWeight; must be negative (or 0 to disable)",ne);if(t.behaviourPenaltyWeight!==0&&(t.behaviourPenaltyDecay<=0||t.behaviourPenaltyDecay>=1))throw new J("invalid BehaviourPenaltyDecay; must be between 0 and 1",ne);if(t.decayInterval<1e3)throw new J("invalid DecayInterval; must be at least 1s",ne);if(t.decayToZero<=0||t.decayToZero>=1)throw new J("invalid DecayToZero; must be between 0 and 1",ne)}function nb(t){if(t.topicWeight<0)throw new J("invalid topic weight; must be >= 0",ne);if(t.timeInMeshQuantum===0)throw new J("invalid TimeInMeshQuantum; must be non zero",ne);if(t.timeInMeshWeight<0)throw new J("invalid TimeInMeshWeight; must be positive (or 0 to disable)",ne);if(t.timeInMeshWeight!==0&&t.timeInMeshQuantum<=0)throw new J("invalid TimeInMeshQuantum; must be positive",ne);if(t.timeInMeshWeight!==0&&t.timeInMeshCap<=0)throw new J("invalid TimeInMeshCap; must be positive",ne);if(t.firstMessageDeliveriesWeight<0)throw new J("invallid FirstMessageDeliveriesWeight; must be positive (or 0 to disable)",ne);if(t.firstMessageDeliveriesWeight!==0&&(t.firstMessageDeliveriesDecay<=0||t.firstMessageDeliveriesDecay>=1))throw new J("invalid FirstMessageDeliveriesDecay; must be between 0 and 1",ne);if(t.firstMessageDeliveriesWeight!==0&&t.firstMessageDeliveriesCap<=0)throw new J("invalid FirstMessageDeliveriesCap; must be positive",ne);if(t.meshMessageDeliveriesWeight>0)throw new J("invalid MeshMessageDeliveriesWeight; must be negative (or 0 to disable)",ne);if(t.meshMessageDeliveriesWeight!==0&&(t.meshMessageDeliveriesDecay<=0||t.meshMessageDeliveriesDecay>=1))throw new J("invalid MeshMessageDeliveriesDecay; must be between 0 and 1",ne);if(t.meshMessageDeliveriesWeight!==0&&t.meshMessageDeliveriesCap<=0)throw new J("invalid MeshMessageDeliveriesCap; must be positive",ne);if(t.meshMessageDeliveriesWeight!==0&&t.meshMessageDeliveriesThreshold<=0)throw new J("invalid MeshMessageDeliveriesThreshold; must be positive",ne);if(t.meshMessageDeliveriesWindow<0)throw new J("invalid MeshMessageDeliveriesWindow; must be non-negative",ne);if(t.meshMessageDeliveriesWeight!==0&&t.meshMessageDeliveriesActivation<1e3)throw new J("invalid MeshMessageDeliveriesActivation; must be at least 1s",ne);if(t.meshFailurePenaltyWeight>0)throw new J("invalid MeshFailurePenaltyWeight; must be negative (or 0 to disable)",ne);if(t.meshFailurePenaltyWeight!==0&&(t.meshFailurePenaltyDecay<=0||t.meshFailurePenaltyDecay>=1))throw new J("invalid MeshFailurePenaltyDecay; must be between 0 and 1",ne);if(t.invalidMessageDeliveriesWeight>0)throw new J("invalid InvalidMessageDeliveriesWeight; must be negative (or 0 to disable)",ne);if(t.invalidMessageDeliveriesDecay<=0||t.invalidMessageDeliveriesDecay>=1)throw new J("invalid InvalidMessageDeliveriesDecay; must be between 0 and 1",ne)}var sb={gossipThreshold:-10,publishThreshold:-50,graylistThreshold:-80,acceptPXThreshold:10,opportunisticGraftThreshold:20};function yl(t={}){return{...sb,...t}}function ml(t,e,r,n){let s=0;Object.entries(e.topics).forEach(([o,a])=>{let f=r.topics[o];if(f===void 0)return;let u=0;if(a.inMesh){let d=a.meshTime/f.timeInMeshQuantum;d>f.timeInMeshCap&&(d=f.timeInMeshCap),u+=d*f.timeInMeshWeight}let c=a.firstMessageDeliveries;if(c>f.firstMessageDeliveriesCap&&(c=f.firstMessageDeliveriesCap),u+=c*f.firstMessageDeliveriesWeight,a.meshMessageDeliveriesActive&&a.meshMessageDeliveries<f.meshMessageDeliveriesThreshold){let d=f.meshMessageDeliveriesThreshold-a.meshMessageDeliveries,p=d*d;u+=p*f.meshMessageDeliveriesWeight}let h=a.meshFailurePenalty;u+=h*f.meshFailurePenaltyWeight;let l=a.invalidMessageDeliveries*a.invalidMessageDeliveries;u+=l*f.invalidMessageDeliveriesWeight,s+=u*f.topicWeight}),r.topicScoreCap>0&&s>r.topicScoreCap&&(s=r.topicScoreCap);let i=r.appSpecificScore(t);if(s+=i*r.appSpecificWeight,e.knownIPs.forEach(o=>{if(r.IPColocationFactorWhitelist.has(o))return;let a=n.get(o),f=a?a.size:0;if(f>r.IPColocationFactorThreshold){let u=f-r.IPColocationFactorThreshold,c=u*u;s+=c*r.IPColocationFactorWeight}}),e.behaviourPenalty>r.behaviourPenaltyThreshold){let o=e.behaviourPenalty-r.behaviourPenaltyThreshold,a=o*o;s+=a*r.behaviourPenaltyWeight}return s}var xl=U(vl(),1),ze;(function(t){t[t.unknown=0]="unknown",t[t.valid=1]="valid",t[t.invalid=2]="invalid",t[t.ignored=3]="ignored"})(ze||(ze={}));var Ii=class{constructor(){this.records=new Map,this.queue=new xl.default}ensureRecord(e){let r=this.records.get(e);if(r)return r;r={status:ze.unknown,firstSeen:Date.now(),validated:0,peers:new Set},this.records.set(e,r);let n={msgId:e,expire:Date.now()+12e4};return this.queue.push(n),r}gc(){let e=Date.now(),r=this.queue.peekFront();for(;r&&r.expire<e;)this.records.delete(r.msgId),this.queue.shift(),r=this.queue.peekFront()}clear(){this.records.clear(),this.queue.clear()}};function Ci(t,e,r=()=>!0){let n=new Set;if(e<=0)return n;for(let s of t){if(n.size>=e)break;r(s)&&(n.add(s),t.delete(s))}return n}function wl(t,e){return Ci(t,e,()=>!0)}var _i=class extends Map{constructor(e){super(),this.getDefault=e}getOrDefault(e){let r=super.get(e);return r===void 0&&(r=this.getDefault(),this.set(e,r)),r}};var An=bi("libp2p:gossipsub:score"),Ai=class{constructor(e,r,n){this.params=e,this.metrics=r,this.peerStats=new Map,this.peerIPs=new _i(()=>new Set),this.scoreCache=new Map,this.deliveryRecords=new Ii,gl(e),this.scoreCacheValidityMs=n.scoreCacheValidityMs,this.computeScore=n.computeScore??ml}get size(){return this.peerStats.size}start(){if(this._backgroundInterval){An("Peer score already running");return}this._backgroundInterval=setInterval(()=>this.background(),this.params.decayInterval),An("started")}stop(){if(!this._backgroundInterval){An("Peer score already stopped");return}clearInterval(this._backgroundInterval),delete this._backgroundInterval,this.peerIPs.clear(),this.peerStats.clear(),this.deliveryRecords.clear(),An("stopped")}background(){this.refreshScores(),this.deliveryRecords.gc()}dumpPeerScoreStats(){return Object.fromEntries(Array.from(this.peerStats.entries()).map(([e,r])=>[e,r]))}refreshScores(){let e=Date.now(),r=this.params.decayToZero;this.peerStats.forEach((n,s)=>{if(!n.connected){e>n.expire&&(this.removeIPsForPeer(s,n.knownIPs),this.peerStats.delete(s),this.scoreCache.delete(s));return}Object.entries(n.topics).forEach(([i,o])=>{let a=this.params.topics[i];a!==void 0&&(o.firstMessageDeliveries*=a.firstMessageDeliveriesDecay,o.firstMessageDeliveries<r&&(o.firstMessageDeliveries=0),o.meshMessageDeliveries*=a.meshMessageDeliveriesDecay,o.meshMessageDeliveries<r&&(o.meshMessageDeliveries=0),o.meshFailurePenalty*=a.meshFailurePenaltyDecay,o.meshFailurePenalty<r&&(o.meshFailurePenalty=0),o.invalidMessageDeliveries*=a.invalidMessageDeliveriesDecay,o.invalidMessageDeliveries<r&&(o.invalidMessageDeliveries=0),o.inMesh&&(o.meshTime=e-o.graftTime,o.meshTime>a.meshMessageDeliveriesActivation&&(o.meshMessageDeliveriesActive=!0)))}),n.behaviourPenalty*=this.params.behaviourPenaltyDecay,n.behaviourPenalty<r&&(n.behaviourPenalty=0)})}score(e){this.metrics?.scoreFnCalls.inc();let r=this.peerStats.get(e);if(!r)return 0;let n=Date.now(),s=this.scoreCache.get(e);if(s&&s.cacheUntil>n)return s.score;this.metrics?.scoreFnRuns.inc();let i=this.computeScore(e,r,this.params,this.peerIPs),o=n+this.scoreCacheValidityMs;return s?(this.metrics?.scoreCachedDelta.observe(Math.abs(i-s.score)),s.score=i,s.cacheUntil=o):this.scoreCache.set(e,{score:i,cacheUntil:o}),i}addPenalty(e,r,n){let s=this.peerStats.get(e);s&&(s.behaviourPenalty+=r,this.metrics?.onScorePenalty(n))}addPeer(e){let r={connected:!0,expire:0,topics:{},knownIPs:new Set,behaviourPenalty:0};this.peerStats.set(e,r)}addIP(e,r){let n=this.peerStats.get(e);n&&n.knownIPs.add(r),this.peerIPs.getOrDefault(r).add(e)}removeIP(e,r){let n=this.peerStats.get(e);n&&n.knownIPs.delete(r);let s=this.peerIPs.get(r);s&&(s.delete(e),s.size===0&&this.peerIPs.delete(r))}removePeer(e){let r=this.peerStats.get(e);if(r){if(this.score(e)>0){this.removeIPsForPeer(e,r.knownIPs),this.peerStats.delete(e);return}Object.entries(r.topics).forEach(([n,s])=>{s.firstMessageDeliveries=0;let i=this.params.topics[n].meshMessageDeliveriesThreshold;if(s.inMesh&&s.meshMessageDeliveriesActive&&s.meshMessageDeliveries<i){let o=i-s.meshMessageDeliveries;s.meshFailurePenalty+=o*o}s.inMesh=!1,s.meshMessageDeliveriesActive=!1}),r.connected=!1,r.expire=Date.now()+this.params.retainScore}}graft(e,r){let n=this.peerStats.get(e);if(n){let s=this.getPtopicStats(n,r);s&&(s.inMesh=!0,s.graftTime=Date.now(),s.meshTime=0,s.meshMessageDeliveriesActive=!1)}}prune(e,r){let n=this.peerStats.get(e);if(n){let s=this.getPtopicStats(n,r);if(s){let i=this.params.topics[r].meshMessageDeliveriesThreshold;if(s.meshMessageDeliveriesActive&&s.meshMessageDeliveries<i){let o=i-s.meshMessageDeliveries;s.meshFailurePenalty+=o*o}s.meshMessageDeliveriesActive=!1,s.inMesh=!1}}}validateMessage(e){this.deliveryRecords.ensureRecord(e)}deliverMessage(e,r,n){this.markFirstMessageDelivery(e,n);let s=this.deliveryRecords.ensureRecord(r),i=Date.now();if(s.status!==ze.unknown){An("unexpected delivery: message from %s was first seen %s ago and has delivery status %s",e,i-s.firstSeen,ze[s.status]);return}s.status=ze.valid,s.validated=i,s.peers.forEach(o=>{o!==e.toString()&&this.markDuplicateMessageDelivery(o,n)})}rejectInvalidMessage(e,r){this.markInvalidMessageDelivery(e,r)}rejectMessage(e,r,n,s){switch(s){case Ke.Error:this.markInvalidMessageDelivery(e,n);return;case Ke.Blacklisted:return}let i=this.deliveryRecords.ensureRecord(r);if(i.status!==ze.unknown){An("unexpected rejection: message from %s was first seen %s ago and has delivery status %d",e,Date.now()-i.firstSeen,ze[i.status]);return}if(s===Ke.Ignore){i.status=ze.ignored,i.peers.clear();return}i.status=ze.invalid,this.markInvalidMessageDelivery(e,n),i.peers.forEach(o=>{this.markInvalidMessageDelivery(o,n)}),i.peers.clear()}duplicateMessage(e,r,n){let s=this.deliveryRecords.ensureRecord(r);if(!s.peers.has(e))switch(s.status){case ze.unknown:s.peers.add(e);break;case ze.valid:s.peers.add(e),this.markDuplicateMessageDelivery(e,n,s.validated);break;case ze.invalid:this.markInvalidMessageDelivery(e,n);break;case ze.ignored:break}}markInvalidMessageDelivery(e,r){let n=this.peerStats.get(e);if(n){let s=this.getPtopicStats(n,r);s&&(s.invalidMessageDeliveries+=1)}}markFirstMessageDelivery(e,r){let n=this.peerStats.get(e);if(n){let s=this.getPtopicStats(n,r);if(s){let i=this.params.topics[r].firstMessageDeliveriesCap;s.firstMessageDeliveries=Math.min(i,s.firstMessageDeliveries+1),s.inMesh&&(i=this.params.topics[r].meshMessageDeliveriesCap,s.meshMessageDeliveries=Math.min(i,s.meshMessageDeliveries+1))}}}markDuplicateMessageDelivery(e,r,n){let s=this.peerStats.get(e);if(s){let i=n!==void 0?Date.now():0,o=this.getPtopicStats(s,r);if(o&&o.inMesh){let a=this.params.topics[r];if(n!==void 0){let u=i-n,c=u>a.meshMessageDeliveriesWindow;if(this.metrics?.onDuplicateMsgDelivery(r,u,c),c)return}let f=a.meshMessageDeliveriesCap;o.meshMessageDeliveries=Math.min(f,o.meshMessageDeliveries+1)}}}removeIPsForPeer(e,r){for(let n of r){let s=this.peerIPs.get(n);s&&(s.delete(e),s.size===0&&this.peerIPs.delete(n))}}getPtopicStats(e,r){let n=e.topics[r];return n!==void 0?n:this.params.topics[r]!==void 0?(n={inMesh:!1,graftTime:0,meshTime:0,firstMessageDeliveries:0,meshMessageDeliveries:0,meshMessageDeliveriesActive:!1,meshFailurePenalty:0,invalidMessageDeliveries:0},e.topics[r]=n,n):null}};var Bi=class{constructor(e,r,n){this.gossipsubIWantFollowupMs=e,this.msgIdToStrFn=r,this.metrics=n,this.promises=new Map,this.requestMsByMsg=new Map,this.requestMsByMsgExpire=10*e}get size(){return this.promises.size}get requestMsByMsgSize(){return this.requestMsByMsg.size}addPromise(e,r){let n=Math.floor(Math.random()*r.length),s=r[n],i=this.msgIdToStrFn(s),o=this.promises.get(i);o||(o=new Map,this.promises.set(i,o));let a=Date.now();return o.has(e)||(o.set(e,a+this.gossipsubIWantFollowupMs),this.metrics&&(this.metrics.iwantPromiseStarted.inc(1),this.requestMsByMsg.has(i)||this.requestMsByMsg.set(i,a))),i}getBrokenPromises(){let e=Date.now(),r=new Map,n=0;return this.promises.forEach((s,i)=>{s.forEach((o,a)=>{if(o<e){let f=r.get(a);f||(f=[],r.set(a,f)),f.push(i),s.delete(a),n++}}),s.size||this.promises.delete(i)}),this.metrics?.iwantPromiseBroken.inc(n),r}deliverMessage(e,r=!1){let n=this.trackMessage(e),s=this.promises.get(e);return s&&(this.promises.delete(e),this.metrics&&(this.metrics.iwantPromiseResolved.inc(1),r&&this.metrics.iwantPromiseResolvedFromDuplicate.inc(1),this.metrics.iwantPromiseResolvedPeers.inc(s.size))),n}rejectMessage(e,r){switch(this.trackMessage(e),r){case Ke.Error:return}this.promises.delete(e)}clear(){this.promises.clear()}prune(){let e=Date.now()-this.requestMsByMsgExpire,r=0;for(let[n,s]of this.requestMsByMsg.entries())if(s<e)this.requestMsByMsg.delete(n),r++;else break;this.metrics?.iwantMessagePruned.inc(r)}trackMessage(e){if(this.metrics){let r=this.requestMsByMsg.get(e);if(r!==void 0)return this.metrics.iwantPromiseDeliveryTime.observe((Date.now()-r)/1e3),this.requestMsByMsg.delete(e),Date.now()-r}return null}};var Bn=class{constructor(e){this.entries=new Map,this.validityMs=e.validityMs}get size(){return this.entries.size}put(e,r){return this.entries.has(e)?!0:(this.entries.set(e,{value:r,validUntilMs:Date.now()+this.validityMs}),!1)}prune(){let e=Date.now();for(let[r,n]of this.entries.entries())if(n.validUntilMs<e)this.entries.delete(r);else break}has(e){return this.entries.has(e)}get(e){let r=this.entries.get(e);return r&&r.validUntilMs>=Date.now()?r.value:void 0}clear(){this.entries.clear()}};var Sl;(function(t){t.forward="forward",t.publish="publish"})(Sl||(Sl={}));var Yt;(function(t){t.Fanout="fanout",t.Random="random",t.Subscribed="subscribed",t.Outbound="outbound",t.NotEnough="not_enough",t.Opportunistic="opportunistic"})(Yt||(Yt={}));var zr;(function(t){t.Dc="disconnected",t.BadScore="bad_score",t.Prune="prune",t.Unsub="unsubscribed",t.Excess="excess"})(zr||(zr={}));var Pn;(function(t){t.GraftBackoff="graft_backoff",t.BrokenPromise="broken_promise",t.MessageDeficit="message_deficit",t.IPColocation="IP_colocation"})(Pn||(Pn={}));var Rn;(function(t){t.LowScore="low_score",t.MaxIhave="max_ihave",t.MaxIasked="max_iasked"})(Rn||(Rn={}));var Tn;(function(t){t.graylist="graylist",t.publish="publish",t.gossip="gossip",t.mesh="mesh"})(Tn||(Tn={}));function El(t,e,r){return{protocolsEnabled:t.gauge({name:"gossipsub_protocol",help:"Status of enabled protocols",labelNames:["protocol"]}),topicSubscriptionStatus:t.gauge({name:"gossipsub_topic_subscription_status",help:"Status of our subscription to this topic",labelNames:["topicStr"]}),topicPeersCount:t.gauge({name:"gossipsub_topic_peer_count",help:"Number of peers subscribed to each topic",labelNames:["topicStr"]}),meshPeerCounts:t.gauge({name:"gossipsub_mesh_peer_count",help:"Number of peers in our mesh",labelNames:["topicStr"]}),meshPeerInclusionEvents:t.gauge({name:"gossipsub_mesh_peer_inclusion_events_total",help:"Number of times we include peers in a topic mesh for different reasons",labelNames:["topic","reason"]}),meshPeerChurnEvents:t.gauge({name:"gossipsub_peer_churn_events_total",help:"Number of times we remove peers in a topic mesh for different reasons",labelNames:["topic","reason"]}),peersPerProtocol:t.gauge({name:"gossipsub_peers_per_protocol_count",help:"Peers connected for each topic",labelNames:["protocol"]}),heartbeatDuration:t.histogram({name:"gossipsub_heartbeat_duration_seconds",help:"The time it takes to complete one iteration of the heartbeat",buckets:[.01,.1,1]}),heartbeatSkipped:t.gauge({name:"gossipsub_heartbeat_skipped",help:"Heartbeat run took longer than heartbeat interval so next is skipped"}),asyncValidationResult:t.gauge({name:"gossipsub_async_validation_result_total",help:"Message validation result for each topic",labelNames:["topic","acceptance"]}),asyncValidationMcacheHit:t.gauge({name:"gossipsub_async_validation_mcache_hit_total",help:"Async validation result reported by the user layer",labelNames:["hit"]}),rpcRecvBytes:t.gauge({name:"gossipsub_rpc_recv_bytes_total",help:"RPC recv"}),rpcRecvCount:t.gauge({name:"gossipsub_rpc_recv_count_total",help:"RPC recv"}),rpcRecvSubscription:t.gauge({name:"gossipsub_rpc_recv_subscription_total",help:"RPC recv"}),rpcRecvMessage:t.gauge({name:"gossipsub_rpc_recv_message_total",help:"RPC recv"}),rpcRecvControl:t.gauge({name:"gossipsub_rpc_recv_control_total",help:"RPC recv"}),rpcRecvIHave:t.gauge({name:"gossipsub_rpc_recv_ihave_total",help:"RPC recv"}),rpcRecvIWant:t.gauge({name:"gossipsub_rpc_recv_iwant_total",help:"RPC recv"}),rpcRecvGraft:t.gauge({name:"gossipsub_rpc_recv_graft_total",help:"RPC recv"}),rpcRecvPrune:t.gauge({name:"gossipsub_rpc_recv_prune_total",help:"RPC recv"}),rpcRecvNotAccepted:t.gauge({name:"gossipsub_rpc_rcv_not_accepted_total",help:"Total count of RPC dropped because acceptFrom() == false"}),rpcSentBytes:t.gauge({name:"gossipsub_rpc_sent_bytes_total",help:"RPC sent"}),rpcSentCount:t.gauge({name:"gossipsub_rpc_sent_count_total",help:"RPC sent"}),rpcSentSubscription:t.gauge({name:"gossipsub_rpc_sent_subscription_total",help:"RPC sent"}),rpcSentMessage:t.gauge({name:"gossipsub_rpc_sent_message_total",help:"RPC sent"}),rpcSentControl:t.gauge({name:"gossipsub_rpc_sent_control_total",help:"RPC sent"}),rpcSentIHave:t.gauge({name:"gossipsub_rpc_sent_ihave_total",help:"RPC sent"}),rpcSentIWant:t.gauge({name:"gossipsub_rpc_sent_iwant_total",help:"RPC sent"}),rpcSentGraft:t.gauge({name:"gossipsub_rpc_sent_graft_total",help:"RPC sent"}),rpcSentPrune:t.gauge({name:"gossipsub_rpc_sent_prune_total",help:"RPC sent"}),msgPublishCount:t.gauge({name:"gossipsub_msg_publish_count_total",help:"Total count of msg published by topic",labelNames:["topic"]}),msgPublishPeers:t.gauge({name:"gossipsub_msg_publish_peers_total",help:"Total count of peers that we publish a msg to",labelNames:["topic"]}),msgPublishPeersByGroup:t.gauge({name:"gossipsub_msg_publish_peers_by_group",help:"Total count of peers (by group) that we publish a msg to",labelNames:["topic","peerGroup"]}),msgPublishBytes:t.gauge({name:"gossipsub_msg_publish_bytes_total",help:"Total count of msg publish data.length bytes",labelNames:["topic"]}),msgForwardCount:t.gauge({name:"gossipsub_msg_forward_count_total",help:"Total count of msg forwarded by topic",labelNames:["topic"]}),msgForwardPeers:t.gauge({name:"gossipsub_msg_forward_peers_total",help:"Total count of peers that we forward a msg to",labelNames:["topic"]}),msgReceivedPreValidation:t.gauge({name:"gossipsub_msg_received_prevalidation_total",help:"Total count of recv msgs before any validation",labelNames:["topic"]}),msgReceivedStatus:t.gauge({name:"gossipsub_msg_received_status_total",help:"Tracks distribution of recv msgs by duplicate, invalid, valid",labelNames:["topic","status"]}),msgReceivedInvalid:t.gauge({name:"gossipsub_msg_received_invalid_total",help:"Tracks specific reason of invalid",labelNames:["topic","error"]}),duplicateMsgDeliveryDelay:t.histogram({name:"gossisub_duplicate_msg_delivery_delay_seconds",help:"Time since the 1st duplicated message validated",labelNames:["topic"],buckets:[.25*r.maxMeshMessageDeliveriesWindowSec,.5*r.maxMeshMessageDeliveriesWindowSec,1*r.maxMeshMessageDeliveriesWindowSec,2*r.maxMeshMessageDeliveriesWindowSec,4*r.maxMeshMessageDeliveriesWindowSec]}),duplicateMsgLateDelivery:t.gauge({name:"gossisub_duplicate_msg_late_delivery_total",help:"Total count of late duplicate message delivery by topic, which triggers P3 penalty",labelNames:["topic"]}),duplicateMsgIgnored:t.gauge({name:"gossisub_ignored_published_duplicate_msgs_total",help:"Total count of published duplicate message ignored by topic",labelNames:["topic"]}),scoreFnCalls:t.gauge({name:"gossipsub_score_fn_calls_total",help:"Total times score() is called"}),scoreFnRuns:t.gauge({name:"gossipsub_score_fn_runs_total",help:"Total times score() call actually computed computeScore(), no cache"}),scoreCachedDelta:t.histogram({name:"gossipsub_score_cache_delta",help:"Delta of score between cached values that expired",buckets:[10,100,1e3]}),peersByScoreThreshold:t.gauge({name:"gossipsub_peers_by_score_threshold_count",help:"Current count of peers by score threshold",labelNames:["threshold"]}),score:t.avgMinMax({name:"gossipsub_score",help:"Avg min max of gossip scores",labelNames:["topic","p"]}),scoreWeights:t.avgMinMax({name:"gossipsub_score_weights",help:"Separate score weights",labelNames:["topic","p"]}),scorePerMesh:t.avgMinMax({name:"gossipsub_score_per_mesh",help:"Histogram of the scores for each mesh topic",labelNames:["topic"]}),scoringPenalties:t.gauge({name:"gossipsub_scoring_penalties_total",help:"A counter of the kind of penalties being applied to peers",labelNames:["penalty"]}),behaviourPenalty:t.histogram({name:"gossipsub_peer_stat_behaviour_penalty",help:"Current peer stat behaviour_penalty at each scrape",buckets:[.25*r.behaviourPenaltyThreshold,.5*r.behaviourPenaltyThreshold,1*r.behaviourPenaltyThreshold,2*r.behaviourPenaltyThreshold,4*r.behaviourPenaltyThreshold]}),ihaveRcvIgnored:t.gauge({name:"gossipsub_ihave_rcv_ignored_total",help:"Total received IHAVE messages that we ignore for some reason",labelNames:["reason"]}),ihaveRcvMsgids:t.gauge({name:"gossipsub_ihave_rcv_msgids_total",help:"Total received IHAVE messages by topic",labelNames:["topic"]}),ihaveRcvNotSeenMsgids:t.gauge({name:"gossipsub_ihave_rcv_not_seen_msgids_total",help:"Total messages per topic we do not have, not actual requests",labelNames:["topic"]}),iwantRcvMsgids:t.gauge({name:"gossipsub_iwant_rcv_msgids_total",help:"Total received IWANT messages by topic",labelNames:["topic"]}),iwantRcvDonthaveMsgids:t.gauge({name:"gossipsub_iwant_rcv_dont_have_msgids_total",help:"Total requested messageIDs that we do not have"}),iwantPromiseStarted:t.gauge({name:"gossipsub_iwant_promise_sent_total",help:"Total count of started IWANT promises"}),iwantPromiseResolved:t.gauge({name:"gossipsub_iwant_promise_resolved_total",help:"Total count of resolved IWANT promises"}),iwantPromiseResolvedFromDuplicate:t.gauge({name:"gossipsub_iwant_promise_resolved_from_duplicate_total",help:"Total count of resolved IWANT promises from duplicate messages"}),iwantPromiseResolvedPeers:t.gauge({name:"gossipsub_iwant_promise_resolved_peers",help:"Total count of peers we have asked IWANT promises that are resolved"}),iwantPromiseBroken:t.gauge({name:"gossipsub_iwant_promise_broken",help:"Total count of broken IWANT promises"}),iwantMessagePruned:t.gauge({name:"gossipsub_iwant_message_pruned",help:"Total count of pruned IWANT messages"}),iwantPromiseDeliveryTime:t.histogram({name:"gossipsub_iwant_promise_delivery_seconds",help:"Histogram of delivery time of resolved IWANT promises",buckets:[.5*r.gossipPromiseExpireSec,1*r.gossipPromiseExpireSec,2*r.gossipPromiseExpireSec,4*r.gossipPromiseExpireSec]}),cacheSize:t.gauge({name:"gossipsub_cache_size",help:"Unbounded cache sizes",labelNames:["cache"]}),mcacheSize:t.gauge({name:"gossipsub_mcache_size",help:"Current mcache msg count"}),mcacheNotValidatedCount:t.gauge({name:"gossipsub_mcache_not_validated_count",help:"Current mcache msg count not validated"}),fastMsgIdCacheCollision:t.gauge({name:"gossipsub_fastmsgid_cache_collision_total",help:"Total count of key collisions on fastmsgid cache put"}),newConnectionCount:t.gauge({name:"gossipsub_new_connection_total",help:"Total new connection by status",labelNames:["status"]}),topicStrToLabel:e,toTopic(n){return this.topicStrToLabel.get(n)??n},onJoin(n){this.topicSubscriptionStatus.set({topicStr:n},1),this.meshPeerCounts.set({topicStr:n},0)},onLeave(n){this.topicSubscriptionStatus.set({topicStr:n},0),this.meshPeerCounts.set({topicStr:n},0)},onAddToMesh(n,s,i){let o=this.toTopic(n);this.meshPeerInclusionEvents.inc({topic:o,reason:s},i)},onRemoveFromMesh(n,s,i){let o=this.toTopic(n);this.meshPeerChurnEvents.inc({topic:o,reason:s},i)},onReportValidationMcacheHit(n){this.asyncValidationMcacheHit.inc({hit:n?"hit":"miss"})},onReportValidation(n,s){let i=this.toTopic(n);this.asyncValidationResult.inc({topic:i,acceptance:s})},onScorePenalty(n){this.scoringPenalties.inc({penalty:n},1)},onIhaveRcv(n,s,i){let o=this.toTopic(n);this.ihaveRcvMsgids.inc({topic:o},s),this.ihaveRcvNotSeenMsgids.inc({topic:o},i)},onIwantRcv(n,s){for(let[i,o]of n){let a=this.toTopic(i);this.iwantRcvMsgids.inc({topic:a},o)}this.iwantRcvDonthaveMsgids.inc(s)},onForwardMsg(n,s){let i=this.toTopic(n);this.msgForwardCount.inc({topic:i},1),this.msgForwardPeers.inc({topic:i},s)},onPublishMsg(n,s,i,o){let a=this.toTopic(n);this.msgPublishCount.inc({topic:a},1),this.msgPublishBytes.inc({topic:a},i*o),this.msgPublishPeers.inc({topic:a},i),this.msgPublishPeersByGroup.inc({topic:a,peerGroup:"direct"},s.direct),this.msgPublishPeersByGroup.inc({topic:a,peerGroup:"floodsub"},s.floodsub),this.msgPublishPeersByGroup.inc({topic:a,peerGroup:"mesh"},s.mesh),this.msgPublishPeersByGroup.inc({topic:a,peerGroup:"fanout"},s.fanout)},onMsgRecvPreValidation(n){let s=this.toTopic(n);this.msgReceivedPreValidation.inc({topic:s},1)},onMsgRecvResult(n,s){let i=this.toTopic(n);this.msgReceivedStatus.inc({topic:i,status:s})},onMsgRecvInvalid(n,s){let i=this.toTopic(n),o=s.reason===Ke.Error?s.error:s.reason;this.msgReceivedInvalid.inc({topic:i,error:o},1)},onDuplicateMsgDelivery(n,s,i){if(this.duplicateMsgDeliveryDelay.observe(s/1e3),i){let o=this.toTopic(n);this.duplicateMsgLateDelivery.inc({topic:o},1)}},onPublishDuplicateMsg(n){let s=this.toTopic(n);this.duplicateMsgIgnored.inc({topic:s},1)},onRpcRecv(n,s){this.rpcRecvBytes.inc(s),this.rpcRecvCount.inc(1),n.subscriptions&&this.rpcRecvSubscription.inc(n.subscriptions.length),n.messages&&this.rpcRecvMessage.inc(n.messages.length),n.control&&(this.rpcRecvControl.inc(1),n.control.ihave&&this.rpcRecvIHave.inc(n.control.ihave.length),n.control.iwant&&this.rpcRecvIWant.inc(n.control.iwant.length),n.control.graft&&this.rpcRecvGraft.inc(n.control.graft.length),n.control.prune&&this.rpcRecvPrune.inc(n.control.prune.length))},onRpcSent(n,s){if(this.rpcSentBytes.inc(s),this.rpcSentCount.inc(1),n.subscriptions&&this.rpcSentSubscription.inc(n.subscriptions.length),n.messages&&this.rpcSentMessage.inc(n.messages.length),n.control){let i=n.control.ihave?.length??0,o=n.control.iwant?.length??0,a=n.control.graft?.length??0,f=n.control.prune?.length??0;i>0&&this.rpcSentIHave.inc(i),o>0&&this.rpcSentIWant.inc(o),a>0&&this.rpcSentGraft.inc(a),f>0&&this.rpcSentPrune.inc(f),(i>0||o>0||a>0||f>0)&&this.rpcSentControl.inc(1)}},registerScores(n,s){let i=0,o=0,a=0,f=0;for(let u of n)u>=s.graylistThreshold&&i++,u>=s.publishThreshold&&o++,u>=s.gossipThreshold&&a++,u>=0&&f++;this.peersByScoreThreshold.set({threshold:Tn.graylist},i),this.peersByScoreThreshold.set({threshold:Tn.publish},o),this.peersByScoreThreshold.set({threshold:Tn.gossip},a),this.peersByScoreThreshold.set({threshold:Tn.mesh},f),this.score.set(n)},registerScoreWeights(n){for(let[s,i]of n.byTopic)this.scoreWeights.set({topic:s,p:"p1"},i.p1w),this.scoreWeights.set({topic:s,p:"p2"},i.p2w),this.scoreWeights.set({topic:s,p:"p3"},i.p3w),this.scoreWeights.set({topic:s,p:"p3b"},i.p3bw),this.scoreWeights.set({topic:s,p:"p4"},i.p4w);this.scoreWeights.set({p:"p5"},n.p5w),this.scoreWeights.set({p:"p6"},n.p6w),this.scoreWeights.set({p:"p7"},n.p7w)},registerScorePerMesh(n,s){let i=new Map;n.forEach((o,a)=>{let f=this.topicStrToLabel.get(a)??"unknown",u=i.get(f);u||(u=new Set,i.set(f,u)),o.forEach(c=>u?.add(c))});for(let[o,a]of i){let f=[];a.forEach(u=>{f.push(s.get(u)??0)}),this.scorePerMesh.set({topic:o},f)}}}}var c4=U(Fs(),1),ob=U(te(),1);var cb=U(Be(),1);var fb=U(Ho(),1),hb=U(Se(),1),lb=U(Be(),1);var Il=ye("libp2p-pubsub:");async function _l(t,e,r,n){switch(t.type){case mr.Signing:{let s={from:t.author.toBytes(),data:n,seqno:ar(8),topic:e,signature:void 0,key:void 0},i=me([Il,ys.Message.encode(s).finish()]);s.signature=await t.privateKey.sign(i),s.key=t.key;let o={type:"signed",from:t.author,data:r,sequenceNumber:BigInt(`0x${H(s.seqno,"base16")}`),topic:e,signature:s.signature,key:s.key};return{raw:s,msg:o}}case mr.Anonymous:return{raw:{from:void 0,data:n,seqno:void 0,topic:e,signature:void 0,key:void 0},msg:{type:"unsigned",data:r,topic:e}}}}async function Cl(t,e){switch(t){case Cn:return e.signature!=null?{valid:!1,error:Le.SignaturePresent}:e.seqno!=null?{valid:!1,error:Le.SeqnoPresent}:e.key!=null?{valid:!1,error:Le.FromPresent}:{valid:!0,message:{type:"unsigned",topic:e.topic,data:e.data??new Uint8Array(0)}};case Kr:{if(e.seqno==null)return{valid:!1,error:Le.InvalidSeqno};if(e.seqno.length!==8)return{valid:!1,error:Le.InvalidSeqno};if(e.signature==null)return{valid:!1,error:Le.InvalidSignature};if(e.from==null)return{valid:!1,error:Le.InvalidPeerId};let r;try{r=pr(e.from)}catch{return{valid:!1,error:Le.InvalidPeerId}}let n;if(e.key){if(n=ss(e.key),r.publicKey!==void 0&&!xe(n.bytes,r.publicKey))return{valid:!1,error:Le.InvalidPeerId}}else{if(r.publicKey==null)return{valid:!1,error:Le.InvalidPeerId};n=ss(r.publicKey)}let s={from:e.from,data:e.data,seqno:e.seqno,topic:e.topic,signature:void 0,key:void 0},i=me([Il,ys.Message.encode(s).finish()]);return await n.verify(i,e.signature)?{valid:!0,message:{type:"signed",from:r,data:e.data??new Uint8Array(0),sequenceNumber:BigInt(`0x${H(e.seqno,"base16")}`),topic:e.topic,signature:e.signature,key:e.key??Lh(n)}}:{valid:!1,error:Le.InvalidSignature}}}}var pb=U(Be(),1);var Al=(t,e)=>{let r=ye(e.toString(16).padStart(16,"0"),"base16"),n=new Uint8Array(t.length+r.length);return n.set(t,0),n.set(r,t.length),n};function Bl(t){if(t.type!=="signed")throw new Error("expected signed message type");if(t.sequenceNumber==null)throw Error("missing seqno field");return Al(t.from.toBytes(),t.sequenceNumber)}async function Tl(t){return await _e.encode(t.data)}function db(t,e,r,n,s){let i=0,o=new Map;if(Object.entries(e.topics).forEach(([l,d])=>{let p=s.get(l)??"unknown",g=r.topics[l];if(g===void 0)return;let m=o.get(p);m||(m={p1w:0,p2w:0,p3w:0,p3bw:0,p4w:0},o.set(p,m));let v=0,S=0,C=0,T=0,x=0;if(d.inMesh){let z=Math.max(d.meshTime/g.timeInMeshQuantum,g.timeInMeshCap);v+=z*g.timeInMeshWeight}let _=d.firstMessageDeliveries;if(_>g.firstMessageDeliveriesCap&&(_=g.firstMessageDeliveriesCap),S+=_*g.firstMessageDeliveriesWeight,d.meshMessageDeliveriesActive&&d.meshMessageDeliveries<g.meshMessageDeliveriesThreshold){let z=g.meshMessageDeliveriesThreshold-d.meshMessageDeliveries,oe=z*z;C+=oe*g.meshMessageDeliveriesWeight}let P=d.meshFailurePenalty;T+=P*g.meshFailurePenaltyWeight;let O=d.invalidMessageDeliveries*d.invalidMessageDeliveries;x+=O*g.invalidMessageDeliveriesWeight,i+=(v+S+C+T+x)*g.topicWeight,m.p1w+=v,m.p2w+=S,m.p3w+=C,m.p3bw+=T,m.p4w+=x}),r.topicScoreCap>0&&i>r.topicScoreCap){i=r.topicScoreCap;let l=r.topicScoreCap/i;for(let d of o.values())d.p1w*=l,d.p2w*=l,d.p3w*=l,d.p3bw*=l,d.p4w*=l}let a=0,f=0,u=0,c=r.appSpecificScore(t);a+=c*r.appSpecificWeight,e.knownIPs.forEach(l=>{if(r.IPColocationFactorWhitelist.has(l))return;let d=n.get(l),p=d?d.size:0;if(p>r.IPColocationFactorThreshold){let g=p-r.IPColocationFactorThreshold,m=g*g;f+=m*r.IPColocationFactorWeight}});let h=e.behaviourPenalty*e.behaviourPenalty;return u+=h*r.behaviourPenaltyWeight,i+=a+f+u,{byTopic:o,p5w:a,p6w:f,p7w:u,score:i}}function Pl(t,e,r,n,s){let i={byTopic:new Map,p5w:[],p6w:[],p7w:[],score:[]};for(let o of t){let a=e.get(o);if(a){let f=db(o,a,r,n,s);for(let[u,c]of f.byTopic){let h=i.byTopic.get(u);h||(h={p1w:[],p2w:[],p3w:[],p3bw:[],p4w:[]},i.byTopic.set(u,h)),h.p1w.push(c.p1w),h.p2w.push(c.p2w),h.p3w.push(c.p3w),h.p3bw.push(c.p3bw),h.p4w.push(c.p4w)}i.p5w.push(f.p5w),i.p6w.push(f.p6w),i.p7w.push(f.p7w),i.score.push(f.score)}else i.p5w.push(0),i.p6w.push(0),i.p7w.push(0),i.score.push(0)}return i}var ms=class extends Error{constructor(e,r){super(e??"The operation was aborted"),this.type="aborted",this.code=r??"ABORT_ERR"}};function Rl(t){if(t!=null){if(typeof t[Symbol.iterator]=="function")return t[Symbol.iterator]();if(typeof t[Symbol.asyncIterator]=="function")return t[Symbol.asyncIterator]();if(typeof t.next=="function")return t}throw new Error("argument is not an iterator or iterable")}function cc(t,e,r){let n=r??{},s=Rl(t);async function*i(){let o,a=()=>{o?.()};for(e.addEventListener("abort",a);;){let f;try{if(e.aborted){let{abortMessage:c,abortCode:h}=n;throw new ms(c,h)}let u=new Promise((c,h)=>{o=()=>{let{abortMessage:l,abortCode:d}=n;h(new ms(l,d))}});f=await Promise.race([u,s.next()]),o=null}catch(u){e.removeEventListener("abort",a);let c=u.type==="aborted"&&e.aborted;if(c&&n.onAbort!=null&&await n.onAbort(t),typeof s.return=="function")try{let h=s.return();h instanceof Promise&&h.catch(l=>{n.onReturnError!=null&&n.onReturnError(l)})}catch(h){n.onReturnError!=null&&n.onReturnError(h)}if(c&&n.returnOnAbort===!0)return;throw u}if(f.done===!0)break;yield f.value}e.removeEventListener("abort",a)}return i()}function Dl(t){return globalThis?.Buffer?.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}var Ti=t=>{let e=pt.encodingLength(t),r=Dl(e);return pt.encode(t,r),Ti.bytes=e,r};Ti.bytes=0;function Pi(t){t=t??{};let e=t.lengthEncoder??Ti;return async function*(n){for await(let s of n){let i=e(s.byteLength);i instanceof Uint8Array?yield i:yield*i,s instanceof Uint8Array?yield s:yield*s}}}Pi.single=(t,e)=>{e=e??{};let r=e.lengthEncoder??Ti;return new rt(r(t.byteLength),t)};var bs=U(Be(),1),gb=8,yb=1024*1024*4,qr;(function(t){t[t.LENGTH=0]="LENGTH",t[t.DATA=1]="DATA"})(qr||(qr={}));var uc=t=>{let e=pt.decode(t);return uc.bytes=pt.encodingLength(e),e};uc.bytes=0;function vs(t){return async function*(r){let n=new rt,s=qr.LENGTH,i=-1,o=t?.lengthDecoder??uc,a=t?.maxLengthLength??gb,f=t?.maxDataLength??yb;for await(let u of r)for(n.append(u);n.byteLength>0;){if(s===qr.LENGTH)try{if(i=o(n),i<0)throw(0,bs.default)(new Error("invalid message length"),"ERR_INVALID_MSG_LENGTH");if(i>f)throw(0,bs.default)(new Error("message length too long"),"ERR_MSG_DATA_TOO_LONG");let c=o.bytes;n.consume(c),t?.onLength!=null&&t.onLength(i),s=qr.DATA}catch(c){if(c instanceof RangeError){if(n.byteLength>a)throw(0,bs.default)(new Error("message length length too long"),"ERR_MSG_LENGTH_TOO_LONG");break}throw c}if(s===qr.DATA){if(n.byteLength<i)break;let c=n.sublist(0,i);n.consume(i),t?.onData!=null&&t.onData(c),yield c,s=qr.LENGTH}}if(n.byteLength>0)throw(0,bs.default)(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}}vs.fromReader=(t,e)=>{let r=1,n=async function*(){for(;;)try{let{done:i,value:o}=await t.next(r);if(i===!0)return;o!=null&&(yield o)}catch(i){if(i.code==="ERR_UNDER_READ")return{done:!0,value:null};throw i}finally{r=1}}();return vs({...e??{},onLength:i=>{r=i}})(n)};var Ri=class{constructor(e,r,n){this.rawStream=e,this.pushable=Nt({objectMode:!1}),this.closeController=new AbortController,this.maxBufferSize=n.maxBufferSize??1/0,Hr(cc(this.pushable,this.closeController.signal,{returnOnAbort:!0}),Pi(),this.rawStream).catch(r)}get protocol(){return this.rawStream.stat.protocol}push(e){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(e)}close(){this.closeController.abort(),this.pushable.return(),this.rawStream.close()}},Di=class{constructor(e,r={}){this.rawStream=e,this.closeController=new AbortController,this.source=cc(Hr(this.rawStream,vs(r)),this.closeController.signal,{returnOnAbort:!0})}close(){this.closeController.abort(),this.rawStream.close()}};var kl=U(nc(),1),Ml={maxSubscriptions:1/0,maxMessages:1/0,maxIhaveMessageIDs:1/0,maxIwantMessageIDs:1/0,maxControlMessages:1/0,maxPeerInfos:1/0};function Nl(t,e){e={...e};let r=kl.default.Reader.create(t),n=t.length,s=n===void 0?r.len:r.pos+n,i={};for(;r.pos<s;){let o=r.uint32();switch(o>>>3){case 1:i.subscriptions&&i.subscriptions.length||(i.subscriptions=[]),i.subscriptions.length<e.maxSubscriptions?i.subscriptions.push(mb(r,r.uint32())):r.skipType(o&7);break;case 2:i.messages&&i.messages.length||(i.messages=[]),i.messages.length<e.maxMessages?i.messages.push(bb(r,r.uint32())):r.skipType(o&7);break;case 3:i.control=vb(r,r.uint32(),e);break;default:r.skipType(o&7);break}}return i}function mb(t,e){let r=e===void 0?t.len:t.pos+e,n={};for(;t.pos<r;){let s=t.uint32();switch(s>>>3){case 1:n.subscribe=t.bool();break;case 2:n.topic=t.string();break;default:t.skipType(s&7);break}}return n}function bb(t,e){let r=e===void 0?t.len:t.pos+e,n={};for(;t.pos<r;){let s=t.uint32();switch(s>>>3){case 1:n.from=t.bytes();break;case 2:n.data=t.bytes();break;case 3:n.seqno=t.bytes();break;case 4:n.topic=t.string();break;case 5:n.signature=t.bytes();break;case 6:n.key=t.bytes();break;default:t.skipType(s&7);break}}if(!n.topic)throw Error("missing required 'topic'");return n}function vb(t,e,r){let n=e===void 0?t.len:t.pos+e,s={};for(;t.pos<n;){let i=t.uint32();switch(i>>>3){case 1:s.ihave&&s.ihave.length||(s.ihave=[]),s.ihave.length<r.maxControlMessages?s.ihave.push(xb(t,t.uint32(),r)):t.skipType(i&7);break;case 2:s.iwant&&s.iwant.length||(s.iwant=[]),s.iwant.length<r.maxControlMessages?s.iwant.push(wb(t,t.uint32(),r)):t.skipType(i&7);break;case 3:s.graft&&s.graft.length||(s.graft=[]),s.graft.length<r.maxControlMessages?s.graft.push(Sb(t,t.uint32())):t.skipType(i&7);break;case 4:s.prune&&s.prune.length||(s.prune=[]),s.prune.length<r.maxControlMessages?s.prune.push(Eb(t,t.uint32(),r)):t.skipType(i&7);break;default:t.skipType(i&7);break}}return s}function xb(t,e,r){let n=e===void 0?t.len:t.pos+e,s={};for(;t.pos<n;){let i=t.uint32();switch(i>>>3){case 1:s.topicID=t.string();break;case 2:s.messageIDs&&s.messageIDs.length||(s.messageIDs=[]),r.maxIhaveMessageIDs-- >0?s.messageIDs.push(t.bytes()):t.skipType(i&7);break;default:t.skipType(i&7);break}}return s}function wb(t,e,r){let n=e===void 0?t.len:t.pos+e,s={};for(;t.pos<n;){let i=t.uint32();switch(i>>>3){case 1:s.messageIDs&&s.messageIDs.length||(s.messageIDs=[]),r.maxIwantMessageIDs-- >0?s.messageIDs.push(t.bytes()):t.skipType(i&7);break;default:t.skipType(i&7);break}}return s}function Sb(t,e){let r=e===void 0?t.len:t.pos+e,n={};for(;t.pos<r;){let s=t.uint32();switch(s>>>3){case 1:n.topicID=t.string();break;default:t.skipType(s&7);break}}return n}function Eb(t,e,r){let n=e===void 0?t.len:t.pos+e,s={};for(;t.pos<n;){let i=t.uint32();switch(i>>>3){case 1:s.topicID=t.string();break;case 2:s.peers&&s.peers.length||(s.peers=[]),r.maxPeerInfos-- >0?s.peers.push(Ib(t,t.uint32())):t.skipType(i&7);break;case 3:s.backoff=t.uint64();break;default:t.skipType(i&7);break}}return s}function Ib(t,e){let r=e===void 0?t.len:t.pos+e,n={};for(;t.pos<r;){let s=t.uint32();switch(s>>>3){case 1:n.peerID=t.bytes();break;case 2:n.signedPeerRecord=t.bytes();break;default:t.skipType(s&7);break}}return n}var ki;(function(t){t[t.ip4=4]="ip4",t[t.ip6=41]="ip6"})(ki||(ki={}));function Ll(t){for(let e of t.tuples())switch(e[0]){case ki.ip4:case ki.ip6:return li(e[0],e[1])}return null}var Xb=Ei,Qe;(function(t){t[t.started=0]="started",t[t.stopped=1]="stopped"})(Qe||(Qe={}));var xs=class extends vi{constructor(e,r={}){super(),this.multicodecs=[Ei,ic],this.peers=new Set,this.streamsInbound=new Map,this.streamsOutbound=new Map,this.outboundInflightQueue=Nt({objectMode:!0}),this.direct=new Set,this.floodsubPeers=new Set,this.acceptFromWhitelist=new Map,this.topics=new Map,this.subscriptions=new Set,this.mesh=new Map,this.fanout=new Map,this.fanoutLastpub=new Map,this.gossip=new Map,this.control=new Map,this.peerhave=new Map,this.iasked=new Map,this.backoff=new Map,this.outbound=new Map,this.topicValidators=new Map,this.heartbeatTicks=0,this.directPeerInitial=null,this.status={code:Qe.stopped},this.heartbeatTimer=null,this.runHeartbeat=()=>{let s=this.metrics?.heartbeatDuration.startTimer();this.heartbeat().catch(i=>{this.log("Error running heartbeat",i)}).finally(()=>{if(s?.(),this.status.code===Qe.started){clearTimeout(this.status.heartbeatTimeout);let i=this.opts.heartbeatInterval-(Date.now()-this.status.hearbeatStartMs)%this.opts.heartbeatInterval;i<this.opts.heartbeatInterval*.25&&(i+=this.opts.heartbeatInterval,this.metrics?.heartbeatSkipped.inc()),this.status.heartbeatTimeout=setTimeout(this.runHeartbeat,i)}})};let n={fallbackToFloodsub:!0,floodPublish:!0,doPX:!1,directPeers:[],D:6,Dlo:4,Dhi:12,Dscore:4,Dout:2,Dlazy:6,heartbeatInterval:1e3,fanoutTTL:6e4,mcacheLength:5,mcacheGossip:3,seenTTL:12e4,gossipsubIWantFollowupMs:3e3,prunePeers:16,pruneBackoff:6e4,graftFloodThreshold:1e4,opportunisticGraftPeers:2,opportunisticGraftTicks:60,directConnectTicks:300,...r,scoreParams:dl(r.scoreParams),scoreThresholds:yl(r.scoreThresholds)};if(this.components=e,this.decodeRpcLimits=n.decodeRpcLimits??Ml,this.globalSignaturePolicy=n.globalSignaturePolicy??Kr,n.fallbackToFloodsub&&this.multicodecs.push(sc),this.log=bi(n.debugName??"libp2p:gossipsub"),this.opts=n,this.direct=new Set(n.directPeers.map(s=>s.id.toString())),this.seenCache=new Bn({validityMs:n.seenTTL}),this.publishedMessageIds=new Bn({validityMs:n.seenTTL}),r.msgIdFn)this.msgIdFn=r.msgIdFn;else switch(this.globalSignaturePolicy){case Kr:this.msgIdFn=Bl;break;case Cn:this.msgIdFn=Tl;break}if(r.fastMsgIdFn&&(this.fastMsgIdFn=r.fastMsgIdFn,this.fastMsgIdCache=new Bn({validityMs:n.seenTTL})),this.msgIdToStrFn=r.msgIdToStrFn??ll,this.mcache=r.messageCache||new xi(n.mcacheGossip,n.mcacheLength,this.msgIdToStrFn),r.dataTransform&&(this.dataTransform=r.dataTransform),r.metricsRegister){if(!r.metricsTopicStrToLabel)throw Error("Must set metricsTopicStrToLabel with metrics");let s=Math.max(...Object.values(n.scoreParams.topics).map(o=>o.meshMessageDeliveriesWindow),1e3),i=El(r.metricsRegister,r.metricsTopicStrToLabel,{gossipPromiseExpireSec:this.opts.gossipsubIWantFollowupMs/1e3,behaviourPenaltyThreshold:n.scoreParams.behaviourPenaltyThreshold,maxMeshMessageDeliveriesWindowSec:s/1e3});i.mcacheSize.addCollect(()=>this.onScrapeMetrics(i));for(let o of this.multicodecs)i.protocolsEnabled.set({protocol:o},1);this.metrics=i}else this.metrics=null;this.gossipTracer=new Bi(this.opts.gossipsubIWantFollowupMs,this.msgIdToStrFn,this.metrics),this.score=new Ai(this.opts.scoreParams,this.metrics,{scoreCacheValidityMs:n.heartbeatInterval}),this.maxInboundStreams=r.maxInboundStreams,this.maxOutboundStreams=r.maxOutboundStreams,this.allowedTopics=n.allowedTopics?new Set(n.allowedTopics):null}getPeers(){return[...this.peers.keys()].map(e=>Mr(e))}isStarted(){return this.status.code===Qe.started}async start(){if(this.isStarted())return;this.log("starting"),this.publishConfig=await ac(this.globalSignaturePolicy,this.components.peerId),this.outboundInflightQueue=Nt({objectMode:!0}),Hr(this.outboundInflightQueue,async i=>{for await(let{peerId:o,connection:a}of i)await this.createOutboundStream(o,a)}).catch(i=>this.log.error("outbound inflight queue error",i)),await Promise.all(this.opts.directPeers.map(async i=>{await this.components.peerStore.addressBook.add(i.id,i.addrs)}));let e=this.components.registrar;await Promise.all(this.multicodecs.map(i=>e.handle(i,this.onIncomingStream.bind(this),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams})));let r=P0({onConnect:this.onPeerConnected.bind(this),onDisconnect:this.onPeerDisconnected.bind(this)}),n=await Promise.all(this.multicodecs.map(i=>e.register(i,r))),s=setTimeout(this.runHeartbeat,100);this.status={code:Qe.started,registrarTopologyIds:n,heartbeatTimeout:s,hearbeatStartMs:Date.now()+100},this.score.start(),this.directPeerInitial=setTimeout(()=>{Promise.resolve().then(async()=>{await Promise.all(Array.from(this.direct).map(async i=>await this.connect(i)))}).catch(i=>{this.log(i)})},1e3),this.log("started")}async stop(){if(this.log("stopping"),this.status.code!==Qe.started)return;let{registrarTopologyIds:e}=this.status;this.status={code:Qe.stopped};let r=this.components.registrar;e.forEach(n=>r.unregister(n)),this.outboundInflightQueue.end();for(let n of this.streamsOutbound.values())n.close();this.streamsOutbound.clear();for(let n of this.streamsInbound.values())n.close();this.streamsInbound.clear(),this.peers.clear(),this.subscriptions.clear(),this.heartbeatTimer&&(this.heartbeatTimer.cancel(),this.heartbeatTimer=null),this.score.stop(),this.mesh.clear(),this.fanout.clear(),this.fanoutLastpub.clear(),this.gossip.clear(),this.control.clear(),this.peerhave.clear(),this.iasked.clear(),this.backoff.clear(),this.outbound.clear(),this.gossipTracer.clear(),this.seenCache.clear(),this.fastMsgIdCache&&this.fastMsgIdCache.clear(),this.directPeerInitial&&clearTimeout(this.directPeerInitial),this.log("stopped")}dumpPeerScoreStats(){return this.score.dumpPeerScoreStats()}onIncomingStream({stream:e,connection:r}){if(!this.isStarted())return;let n=r.remotePeer;this.addPeer(n,r.stat.direction,r.remoteAddr),this.createInboundStream(n,e),this.outboundInflightQueue.push({peerId:n,connection:r})}onPeerConnected(e,r){this.metrics?.newConnectionCount.inc({status:r.stat.status}),!(!this.isStarted()||r.stat.status!=="OPEN")&&(this.addPeer(e,r.stat.direction,r.remoteAddr),this.outboundInflightQueue.push({peerId:e,connection:r}))}onPeerDisconnected(e){this.log("connection ended %p",e),this.removePeer(e)}async createOutboundStream(e,r){if(!this.isStarted())return;let n=e.toString();if(this.peers.has(n)&&!this.streamsOutbound.has(n))try{let s=new Ri(await r.newStream(this.multicodecs),o=>this.log.error("outbound pipe error",o),{maxBufferSize:this.opts.maxOutboundBufferSize});this.log("create outbound stream %p",e),this.streamsOutbound.set(n,s);let i=s.protocol;i===sc&&this.floodsubPeers.add(n),this.metrics?.peersPerProtocol.inc({protocol:i},1),this.subscriptions.size>0&&(this.log("send subscriptions to",n),this.sendSubscriptions(n,Array.from(this.subscriptions),!0))}catch(s){this.log.error("createOutboundStream error",s)}}async createInboundStream(e,r){if(!this.isStarted())return;let n=e.toString();if(!this.peers.has(n))return;let s=this.streamsInbound.get(n);s!==void 0&&(this.log("replacing existing inbound steam %s",n),s.close()),this.log("create inbound stream %s",n);let i=new Di(r,{maxDataLength:this.opts.maxInboundDataLength});this.streamsInbound.set(n,i),this.pipePeerReadStream(e,i.source).catch(o=>this.log(o))}addPeer(e,r,n){let s=e.toString();if(!this.peers.has(s)){this.log("new peer %p",e),this.peers.add(s),this.score.addPeer(s);let i=Ll(n);i!==null?this.score.addIP(s,i):this.log("Added peer has no IP in current address %s %s",s,n.toString()),this.outbound.has(s)||this.outbound.set(s,r==="outbound")}}removePeer(e){let r=e.toString();if(!this.peers.has(r))return;this.log("delete peer %p",e),this.peers.delete(r);let n=this.streamsOutbound.get(r),s=this.streamsInbound.get(r);n&&this.metrics?.peersPerProtocol.inc({protocol:n.protocol},-1),n?.close(),s?.close(),this.streamsOutbound.delete(r),this.streamsInbound.delete(r);for(let i of this.topics.values())i.delete(r);for(let[i,o]of this.mesh)o.delete(r)===!0&&this.metrics?.onRemoveFromMesh(i,zr.Dc,1);for(let i of this.fanout.values())i.delete(r);this.floodsubPeers.delete(r),this.gossip.delete(r),this.control.delete(r),this.outbound.delete(r),this.score.removePeer(r),this.acceptFromWhitelist.delete(r)}get started(){return this.status.code===Qe.started}getMeshPeers(e){let r=this.mesh.get(e);return r?Array.from(r):[]}getSubscribers(e){let r=this.topics.get(e);return(r?Array.from(r):[]).map(n=>Mr(n))}getTopics(){return Array.from(this.subscriptions)}async pipePeerReadStream(e,r){try{await Hr(r,async n=>{for await(let s of n)try{let i=s.subarray(),o=Nl(i,this.decodeRpcLimits);this.metrics?.onRpcRecv(o,i.length),this.opts.awaitRpcHandler?await this.handleReceivedRpc(e,o):this.handleReceivedRpc(e,o).catch(a=>this.log(a))}catch(i){this.log(i)}})}catch(n){this.handlePeerReadStreamError(n,e)}}handlePeerReadStreamError(e,r){this.log.error(e),this.onPeerDisconnected(r)}async handleReceivedRpc(e,r){if(!this.acceptFrom(e.toString())){this.log("received message from unacceptable peer %p",e),this.metrics?.rpcRecvNotAccepted.inc();return}let n=r.subscriptions?r.subscriptions.length:0,s=r.messages?r.messages.length:0,i=0,o=0,a=0,f=0;if(r.control&&(i=r.control.ihave?r.control.ihave.length:0,o=r.control.iwant?r.control.iwant.length:0,a=r.control.graft?r.control.graft.length:0,f=r.control.prune?r.control.prune.length:0),this.log(`rpc.from ${e.toString()} subscriptions ${n} messages ${s} ihave ${i} iwant ${o} graft ${a} prune ${f}`),r.subscriptions&&r.subscriptions.length>0){let u=[];r.subscriptions.forEach(c=>{let h=c.topic,l=c.subscribe===!0;if(h!=null){if(this.allowedTopics&&!this.allowedTopics.has(h))return;this.handleReceivedSubscription(e,h,l),u.push({topic:h,subscribe:l})}}),this.dispatchEvent(new Or("subscription-change",{detail:{peerId:e,subscriptions:u}}))}if(r.messages)for(let u of r.messages){if(this.allowedTopics&&!this.allowedTopics.has(u.topic))continue;let c=this.handleReceivedMessage(e,u).catch(h=>this.log(h));this.opts.awaitRpcMessageHandler&&await c}r.control&&await this.handleControlMessage(e.toString(),r.control)}handleReceivedSubscription(e,r,n){this.log("subscription update from %p topic %s",e,r);let s=this.topics.get(r);s==null&&(s=new Set,this.topics.set(r,s)),n?s.add(e.toString()):s.delete(e.toString())}async handleReceivedMessage(e,r){this.metrics?.onMsgRecvPreValidation(r.topic);let n=await this.validateReceivedMessage(e,r);this.metrics?.onMsgRecvResult(r.topic,n.code);let s;switch(n.code){case it.duplicate:this.score.duplicateMessage(e.toString(),n.msgIdStr,r.topic),s=this.gossipTracer.deliverMessage(n.msgIdStr,!0),s!=null&&s>0&&this.log(`Received duplicate message ${n.msgIdStr} from ${e} after ${s}ms`),this.mcache.observeDuplicate(n.msgIdStr,e.toString());return;case it.invalid:if(n.msgIdStr){let i=n.msgIdStr;this.score.rejectMessage(e.toString(),i,r.topic,n.reason),this.gossipTracer.rejectMessage(i,n.reason)}else this.score.rejectInvalidMessage(e.toString(),r.topic);this.metrics?.onMsgRecvInvalid(r.topic,n);return;case it.valid:this.score.validateMessage(n.messageId.msgIdStr),s=this.gossipTracer.deliverMessage(n.messageId.msgIdStr),s!=null&&s>0&&this.log(`Received valid message ${n.messageId.msgIdStr} from ${e} after ${s}ms`),this.mcache.put(n.messageId,r,!this.opts.asyncValidation),this.subscriptions.has(r.topic)&&(!this.components.peerId.equals(e)||this.opts.emitSelf)&&(super.dispatchEvent(new Or("gossipsub:message",{detail:{propagationSource:e,msgId:n.messageId.msgIdStr,msg:n.msg}})),super.dispatchEvent(new Or("message",{detail:n.msg}))),this.opts.asyncValidation||this.forwardMessage(n.messageId.msgIdStr,r,e.toString())}}async validateReceivedMessage(e,r){let n=this.fastMsgIdFn?.(r),s=n!==void 0?this.fastMsgIdCache?.get(n):void 0;if(s)return{code:it.duplicate,msgIdStr:s};let i=await Cl(this.globalSignaturePolicy,r);if(!i.valid)return{code:it.invalid,reason:Ke.Error,error:i.error};let o=i.message;try{this.dataTransform&&(o.data=this.dataTransform.inboundTransform(r.topic,o.data))}catch(h){return this.log("Invalid message, transform failed",h),{code:it.invalid,reason:Ke.Error,error:Le.TransformFailed}}let a=await this.msgIdFn(o),f=this.msgIdToStrFn(a),u={msgId:a,msgIdStr:f};if(n!==void 0&&this.fastMsgIdCache&&this.fastMsgIdCache.put(n,f)&&this.metrics?.fastMsgIdCacheCollision.inc(),this.seenCache.has(f))return{code:it.duplicate,msgIdStr:f};this.seenCache.put(f);let c=this.topicValidators.get(r.topic);if(c!=null){let h;try{h=await c(e,o)}catch(l){let d=l.code;d===hl&&(h=yt.Ignore),d===fl?h=yt.Reject:h=yt.Ignore}if(h!==yt.Accept)return{code:it.invalid,reason:oc(h),msgIdStr:f}}return{code:it.valid,messageId:u,msg:o}}getScore(e){return this.score.score(e)}sendSubscriptions(e,r,n){this.sendRpc(e,{subscriptions:r.map(s=>({topic:s,subscribe:n}))})}async handleControlMessage(e,r){if(r===void 0)return;let n=r.ihave?this.handleIHave(e,r.ihave):[],s=r.iwant?this.handleIWant(e,r.iwant):[],i=r.graft?await this.handleGraft(e,r.graft):[];r.prune&&await this.handlePrune(e,r.prune),!(!n.length&&!s.length&&!i.length)&&this.sendRpc(e,{messages:s,control:{iwant:n,prune:i}})}acceptFrom(e){if(this.direct.has(e))return!0;let r=Date.now(),n=this.acceptFromWhitelist.get(e);if(n&&n.messagesAccepted<128&&n.acceptUntil>=r)return n.messagesAccepted+=1,!0;let s=this.score.score(e);return s>=0?this.acceptFromWhitelist.set(e,{messagesAccepted:0,acceptUntil:r+1e3}):this.acceptFromWhitelist.delete(e),s>=this.opts.scoreThresholds.graylistThreshold}handleIHave(e,r){if(!r.length)return[];let n=this.score.score(e);if(n<this.opts.scoreThresholds.gossipThreshold)return this.log("IHAVE: ignoring peer %s with score below threshold [ score = %d ]",e,n),this.metrics?.ihaveRcvIgnored.inc({reason:Rn.LowScore}),[];let s=(this.peerhave.get(e)??0)+1;if(this.peerhave.set(e,s),s>10)return this.log("IHAVE: peer %s has advertised too many times (%d) within this heartbeat interval; ignoring",e,s),this.metrics?.ihaveRcvIgnored.inc({reason:Rn.MaxIhave}),[];let i=this.iasked.get(e)??0;if(i>=5e3)return this.log("IHAVE: peer %s has already advertised too many messages (%d); ignoring",e,i),this.metrics?.ihaveRcvIgnored.inc({reason:Rn.MaxIasked}),[];let o=new Map;if(r.forEach(({topicID:u,messageIDs:c})=>{if(!u||!c||!this.mesh.has(u))return;let h=0;c.forEach(l=>{let d=this.msgIdToStrFn(l);this.seenCache.has(d)||(o.set(d,l),h++)}),this.metrics?.onIhaveRcv(u,c.length,h)}),!o.size)return[];let a=o.size;a+i>5e3&&(a=5e3-i),this.log("IHAVE: Asking for %d out of %d messages from %s",a,o.size,e);let f=Array.from(o.values());return Mt(f),f=f.slice(0,a),this.iasked.set(e,i+a),this.gossipTracer.addPromise(e,f),this.log(`IHAVE: Asking from peers ${e} message id ${f.map(u=>this.msgIdToStrFn(u)).join(" ")}`),[{messageIDs:f}]}handleIWant(e,r){if(!r.length)return[];let n=this.score.score(e);if(n<this.opts.scoreThresholds.gossipThreshold)return this.log("IWANT: ignoring peer %s with score below threshold [score = %d]",e,n),[];let s=new Map,i=new Map,o=0;return r.forEach(({messageIDs:a})=>{a&&a.forEach(f=>{let u=this.msgIdToStrFn(f),c=this.mcache.getWithIWantCount(u,e);if(c==null){o++;return}if(i.set(c.msg.topic,1+(i.get(c.msg.topic)??0)),c.count>3){this.log("IWANT: Peer %s has asked for message %s too many times: ignoring request",e,f);return}s.set(u,c.msg)})}),this.metrics?.onIwantRcv(i,o),s.size?(this.log("IWANT: Sending %d messages to %s",s.size,e),Array.from(s.values())):(this.log("IWANT: Could not provide any wanted messages to %s",e),[])}async handleGraft(e,r){let n=[],s=this.score.score(e),i=Date.now(),o=this.opts.doPX;return r.forEach(({topicID:a})=>{if(!a)return;let f=this.mesh.get(a);if(!f){o=!1;return}if(f.has(e))return;if(this.direct.has(e)){this.log("GRAFT: ignoring request from direct peer %s",e),n.push(a),o=!1;return}let u=this.backoff.get(a)?.get(e);if(typeof u=="number"&&i<u){this.log("GRAFT: ignoring backed off peer %s",e),this.score.addPenalty(e,1,Pn.GraftBackoff),o=!1;let c=u+this.opts.graftFloodThreshold-this.opts.pruneBackoff;i<c&&this.score.addPenalty(e,1,Pn.GraftBackoff),this.addBackoff(e,a),n.push(a);return}if(s<0){this.log("GRAFT: ignoring peer %s with negative score: score=%d, topic=%s",e,s,a),n.push(a),o=!1,this.addBackoff(e,a);return}if(f.size>=this.opts.Dhi&&!this.outbound.get(e)){n.push(a),this.addBackoff(e,a);return}this.log("GRAFT: Add mesh link from %s in %s",e,a),this.score.graft(e,a),f.add(e),this.metrics?.onAddToMesh(a,Yt.Subscribed,1)}),n.length?await Promise.all(n.map(a=>this.makePrune(e,a,o))):[]}async handlePrune(e,r){let n=this.score.score(e);for(let{topicID:s,backoff:i,peers:o}of r){if(s==null)continue;let a=this.mesh.get(s);if(!a)return;if(this.log("PRUNE: Remove mesh link to %s in %s",e,s),this.score.prune(e,s),a.has(e)&&(a.delete(e),this.metrics?.onRemoveFromMesh(s,zr.Unsub,1)),typeof i=="number"&&i>0?this.doAddBackoff(e,s,i*1e3):this.addBackoff(e,s),o&&o.length){if(n<this.opts.scoreThresholds.acceptPXThreshold){this.log("PRUNE: ignoring PX from peer %s with insufficient score [score = %d, topic = %s]",e,n,s);continue}await this.pxConnect(o)}}}addBackoff(e,r){this.doAddBackoff(e,r,this.opts.pruneBackoff)}doAddBackoff(e,r,n){let s=this.backoff.get(r);s||(s=new Map,this.backoff.set(r,s));let i=Date.now()+n;(s.get(e)??0)<i&&s.set(e,i)}applyIwantPenalties(){this.gossipTracer.getBrokenPromises().forEach((e,r)=>{this.log("peer %s didn't follow up in %s IWANT requests; adding penalty",r,e),this.score.addPenalty(r,e.length,Pn.BrokenPromise)})}clearBackoff(){if(this.heartbeatTicks%15!==0)return;let e=Date.now();this.backoff.forEach((r,n)=>{r.forEach((s,i)=>{s<e&&r.delete(i)}),r.size===0&&this.backoff.delete(n)})}async directConnect(){let e=[];this.direct.forEach(r=>{this.streamsOutbound.has(r)||e.push(r)}),await Promise.all(e.map(async r=>await this.connect(r)))}async pxConnect(e){e.length>this.opts.prunePeers&&(Mt(e),e=e.slice(0,this.opts.prunePeers));let r=[];await Promise.all(e.map(async n=>{if(!n.peerID)return;let s=pr(n.peerID).toString();if(!this.peers.has(s)){if(!n.signedPeerRecord){r.push(s);return}try{let i=await nt.openAndCertify(n.signedPeerRecord,"libp2p-peer-record"),o=i.peerId;if(!i.peerId.equals(s)){this.log("bogus peer record obtained through px: peer ID %p doesn't match expected peer %p",o,s);return}if(!await this.components.peerStore.addressBook.consumePeerRecord(i)){this.log("bogus peer record obtained through px: could not add peer record to address book");return}r.push(s)}catch{this.log("bogus peer record obtained through px: invalid signature or not a peer record")}}})),r.length&&await Promise.all(r.map(async n=>await this.connect(n)))}async connect(e){this.log("Initiating connection with %s",e);let r=Mr(e),n=await this.components.connectionManager.openConnection(r);for(let s of this.multicodecs)for(let i of this.components.registrar.getTopologies(s))i.onConnect(r,n)}subscribe(e){if(this.status.code!==Qe.started)throw new Error("Pubsub has not started");if(!this.subscriptions.has(e)){this.subscriptions.add(e);for(let r of this.peers.keys())this.sendSubscriptions(r,[e],!0)}this.join(e)}unsubscribe(e){if(this.status.code!==Qe.started)throw new Error("Pubsub is not started");let r=this.subscriptions.delete(e);if(this.log("unsubscribe from %s - am subscribed %s",e,r),r)for(let n of this.peers.keys())this.sendSubscriptions(n,[e],!1);this.leave(e)}join(e){if(this.status.code!==Qe.started)throw new Error("Gossipsub has not started");if(this.mesh.has(e))return;this.log("JOIN %s",e),this.metrics?.onJoin(e);let r=new Set,n=this.fanout.get(e);if(n&&(this.fanout.delete(e),this.fanoutLastpub.delete(e),n.forEach(s=>{!this.direct.has(s)&&this.score.score(s)>=0&&r.add(s)}),this.metrics?.onAddToMesh(e,Yt.Fanout,r.size)),r.size<this.opts.D){let s=r.size;this.getRandomGossipPeers(e,this.opts.D,o=>!r.has(o)&&!this.direct.has(o)&&this.score.score(o)>=0).forEach(o=>{r.add(o)}),this.metrics?.onAddToMesh(e,Yt.Random,r.size-s)}this.mesh.set(e,r),r.forEach(s=>{this.log("JOIN: Add mesh link to %s in %s",s,e),this.sendGraft(s,e)})}leave(e){if(this.status.code!==Qe.started)throw new Error("Gossipsub has not started");this.log("LEAVE %s",e),this.metrics?.onLeave(e);let r=this.mesh.get(e);r&&(Promise.all(Array.from(r).map(async n=>(this.log("LEAVE: Remove mesh link to %s in %s",n,e),await this.sendPrune(n,e)))).catch(n=>{this.log("Error sending prunes to mesh peers",n)}),this.mesh.delete(e))}selectPeersToForward(e,r,n){let s=new Set,i=this.topics.get(e);i&&(this.direct.forEach(a=>{i.has(a)&&r!==a&&!n?.has(a)&&s.add(a)}),this.floodsubPeers.forEach(a=>{i.has(a)&&r!==a&&!n?.has(a)&&this.score.score(a)>=this.opts.scoreThresholds.publishThreshold&&s.add(a)}));let o=this.mesh.get(e);return o&&o.size>0&&o.forEach(a=>{r!==a&&!n?.has(a)&&s.add(a)}),s}selectPeersToPublish(e){let r=new Set,n={direct:0,floodsub:0,mesh:0,fanout:0},s=this.topics.get(e);if(s)if(this.opts.floodPublish)s.forEach(i=>{this.direct.has(i)?(r.add(i),n.direct++):this.score.score(i)>=this.opts.scoreThresholds.publishThreshold&&(r.add(i),n.floodsub++)});else{this.direct.forEach(o=>{s.has(o)&&(r.add(o),n.direct++)}),this.floodsubPeers.forEach(o=>{s.has(o)&&this.score.score(o)>=this.opts.scoreThresholds.publishThreshold&&(r.add(o),n.floodsub++)});let i=this.mesh.get(e);if(i&&i.size>0)i.forEach(o=>{r.add(o),n.mesh++});else{let o=this.fanout.get(e);if(o&&o.size>0)o.forEach(a=>{r.add(a),n.fanout++});else{let a=this.getRandomGossipPeers(e,this.opts.D,f=>this.score.score(f)>=this.opts.scoreThresholds.publishThreshold);a.size>0&&(this.fanout.set(e,a),a.forEach(f=>{r.add(f),n.fanout++}))}this.fanoutLastpub.set(e,Date.now())}}return{tosend:r,tosendCount:n}}forwardMessage(e,r,n,s){n&&this.score.deliverMessage(n,e,r.topic);let i=this.selectPeersToForward(r.topic,n,s);i.forEach(o=>{this.sendRpc(o,{messages:[r]})}),this.metrics?.onForwardMsg(r.topic,i.size)}async publish(e,r,n){let s=this.dataTransform?this.dataTransform.outboundTransform(e,r):r;if(this.publishConfig==null)throw Error("PublishError.Uninitialized");let{raw:i,msg:o}=await _l(this.publishConfig,e,r,s),a=await this.msgIdFn(o),f=this.msgIdToStrFn(a),u=n?.ignoreDuplicatePublishError??this.opts.ignoreDuplicatePublishError;if(this.seenCache.has(f)){if(u)return this.metrics?.onPublishDuplicateMsg(e),{recipients:[]};throw Error("PublishError.Duplicate")}let{tosend:c,tosendCount:h}=this.selectPeersToPublish(e),l=this.opts.emitSelf===!0&&this.subscriptions.has(e),d=n?.allowPublishToZeroPeers??this.opts.allowPublishToZeroPeers;if(c.size===0&&!d&&!l)throw Error("PublishError.InsufficientPeers");this.seenCache.put(f),this.mcache.put({msgId:a,msgIdStr:f},i,!0),this.publishedMessageIds.put(f);for(let p of c)this.sendRpc(p,{messages:[i]})||c.delete(p);return this.metrics?.onPublishMsg(e,h,c.size,i.data!=null?i.data.length:0),l&&(c.add(this.components.peerId.toString()),super.dispatchEvent(new Or("gossipsub:message",{detail:{propagationSource:this.components.peerId,msgId:f,msg:o}})),super.dispatchEvent(new Or("message",{detail:o}))),{recipients:Array.from(c.values()).map(p=>Mr(p))}}reportMessageValidationResult(e,r,n){if(n===yt.Accept){let s=this.mcache.validate(e);if(this.metrics?.onReportValidationMcacheHit(s!==null),s!=null){let{message:i,originatingPeers:o}=s;this.score.deliverMessage(r.toString(),e,i.topic),this.forwardMessage(e,s.message,r.toString(),o),this.metrics?.onReportValidation(i.topic,n)}}else{let s=this.mcache.remove(e);if(this.metrics?.onReportValidationMcacheHit(s!==null),s){let i=oc(n),{message:o,originatingPeers:a}=s;this.score.rejectMessage(r.toString(),e,o.topic,i);for(let f of a)this.score.rejectMessage(f,e,o.topic,i);this.metrics?.onReportValidation(o.topic,n)}}}sendGraft(e,r){let n=[{topicID:r}];this.sendRpc(e,{control:{graft:n}})}async sendPrune(e,r){let n=[await this.makePrune(e,r,this.opts.doPX)];this.sendRpc(e,{control:{prune:n}})}sendRpc(e,r){let n=this.streamsOutbound.get(e);if(!n)return this.log(`Cannot send RPC to ${e} as there is no open stream to it available`),!1;let s=this.control.get(e);s&&(this.piggybackControl(e,r,s),this.control.delete(e));let i=this.gossip.get(e);i&&(this.piggybackGossip(e,r,i),this.gossip.delete(e));let o=ys.encode(r).finish();try{n.push(o)}catch(a){return this.log.error(`Cannot send rpc to ${e}`,a),s&&this.control.set(e,s),i&&this.gossip.set(e,i),!1}return this.metrics?.onRpcSent(r,o.length),!0}piggybackControl(e,r,n){if(n.graft){r.control||(r.control={}),r.control.graft||(r.control.graft=[]);for(let s of n.graft)s.topicID&&this.mesh.get(s.topicID)?.has(e)&&r.control.graft.push(s)}if(n.prune){r.control||(r.control={}),r.control.prune||(r.control.prune=[]);for(let s of n.prune)s.topicID&&!this.mesh.get(s.topicID)?.has(e)&&r.control.prune.push(s)}}piggybackGossip(e,r,n){r.control||(r.control={}),r.control.ihave=n}async sendGraftPrune(e,r,n){let s=this.opts.doPX;for(let[i,o]of e){let a=o.map(c=>({topicID:c})),f=[],u=r.get(i);u&&(f=await Promise.all(u.map(async c=>await this.makePrune(i,c,s&&!(n.get(i)??!1)))),r.delete(i)),this.sendRpc(i,{control:{graft:a,prune:f}})}for(let[i,o]of r){let a=await Promise.all(o.map(async f=>await this.makePrune(i,f,s&&!(n.get(i)??!1))));this.sendRpc(i,{control:{prune:a}})}}emitGossip(e){let r=this.mcache.getGossipIDs(new Set(e.keys()));for(let[n,s]of e)this.doEmitGossip(n,s,r.get(n)??[])}doEmitGossip(e,r,n){if(!n.length||(Mt(n),n.length>5e3&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",n.length),!r.size))return;let s=this.opts.Dlazy,i=.25*r.size,o=r;i>s&&(s=i),s>o.size?s=o.size:o=Mt(Array.from(o)).slice(0,s),o.forEach(a=>{let f=n;n.length>5e3&&(f=Mt(f.slice()).slice(0,5e3)),this.pushGossip(a,{topicID:e,messageIDs:f})})}flush(){for(let[e,r]of this.gossip.entries())this.gossip.delete(e),this.sendRpc(e,{control:{ihave:r}});for(let[e,r]of this.control.entries())this.control.delete(e),this.sendRpc(e,{control:{graft:r.graft,prune:r.prune}})}pushGossip(e,r){this.log("Add gossip to %s",e);let n=this.gossip.get(e)||[];this.gossip.set(e,n.concat(r))}async makePrune(e,r,n){if(this.score.prune(e,r),this.streamsOutbound.get(e).protocol===ic)return{topicID:r,peers:[]};let s=this.opts.pruneBackoff/1e3;if(!n)return{topicID:r,peers:[],backoff:s};let i=this.getRandomGossipPeers(r,this.opts.prunePeers,a=>a!==e&&this.score.score(a)>=0),o=await Promise.all(Array.from(i).map(async a=>{let f=Mr(a);return{peerID:f.toBytes(),signedPeerRecord:await this.components.peerStore.addressBook.getRawEnvelope(f)}}));return{topicID:r,peers:o,backoff:s}}async heartbeat(){let{D:e,Dlo:r,Dhi:n,Dscore:s,Dout:i,fanoutTTL:o}=this.opts;this.heartbeatTicks++;let a=new Map,f=p=>{let g=a.get(p);return g===void 0&&(g=this.score.score(p),a.set(p,g)),g},u=new Map,c=new Map,h=new Map;this.clearBackoff(),this.peerhave.clear(),this.metrics?.cacheSize.set({cache:"iasked"},this.iasked.size),this.iasked.clear(),this.applyIwantPenalties(),this.heartbeatTicks%this.opts.directConnectTicks===0&&await this.directConnect(),this.fastMsgIdCache?.prune(),this.seenCache.prune(),this.gossipTracer.prune(),this.publishedMessageIds.prune();let l=new Map;this.mesh.forEach((p,g)=>{let m=this.topics.get(g),v=new Set,S=new Set;if(l.set(g,S),m){let x=Mt(Array.from(m)),_=this.backoff.get(g);for(let P of x){let O=this.streamsOutbound.get(P);if(O&&this.multicodecs.includes(O.protocol)&&!p.has(P)&&!this.direct.has(P)){let z=f(P);(!_||!_.has(P))&&z>=0&&v.add(P),z>=this.opts.scoreThresholds.gossipThreshold&&S.add(P)}}}let C=(x,_)=>{this.log("HEARTBEAT: Remove mesh link to %s in %s",x,g),this.addBackoff(x,g),p.delete(x),f(x)>=this.opts.scoreThresholds.gossipThreshold&&S.add(x),this.metrics?.onRemoveFromMesh(g,_,1);let P=c.get(x);P?P.push(g):c.set(x,[g])},T=(x,_)=>{this.log("HEARTBEAT: Add mesh link to %s in %s",x,g),this.score.graft(x,g),p.add(x),S.delete(x),this.metrics?.onAddToMesh(g,_,1);let P=u.get(x);P?P.push(g):u.set(x,[g])};if(p.forEach(x=>{let _=f(x);_<0&&(this.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",x,_,g),C(x,zr.BadScore),h.set(x,!0))}),p.size<r){let x=e-p.size;wl(v,x).forEach(P=>{T(P,Yt.NotEnough)})}if(p.size>n){let x=Array.from(p);x.sort((P,O)=>f(O)-f(P)),x=x.slice(0,s).concat(Mt(x.slice(s)));let _=0;if(x.slice(0,e).forEach(P=>{this.outbound.get(P)&&_++}),_<i){let P=z=>{let oe=x[z];for(let Ae=z;Ae>0;Ae--)x[Ae]=x[Ae-1];x[0]=oe};if(_>0){let z=_;for(let oe=1;oe<e&&z>0;oe++)this.outbound.get(x[oe])&&(P(oe),z--)}let O=e-_;for(let z=e;z<x.length&&O>0;z++)this.outbound.get(x[z])&&(P(z),O--)}x.slice(e).forEach(P=>{C(P,zr.Excess)})}if(p.size>=r){let x=0;if(p.forEach(_=>{this.outbound.get(_)&&x++}),x<i){let _=i-x;Ci(v,_,O=>this.outbound.get(O)===!0).forEach(O=>{T(O,Yt.Outbound)})}}if(this.heartbeatTicks%this.opts.opportunisticGraftTicks===0&&p.size>1){let x=Array.from(p).sort((O,z)=>f(O)-f(z)),_=Math.floor(p.size/2),P=f(x[_]);if(P<this.opts.scoreThresholds.opportunisticGraftThreshold){let O=this.opts.opportunisticGraftPeers,z=Ci(v,O,oe=>f(oe)>P);for(let oe of z)this.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",oe,g),T(oe,Yt.Opportunistic)}}});let d=Date.now();this.fanoutLastpub.forEach((p,g)=>{p+o<d&&(this.fanout.delete(g),this.fanoutLastpub.delete(g))}),this.fanout.forEach((p,g)=>{let m=this.topics.get(g);p.forEach(T=>{(!m.has(T)||f(T)<this.opts.scoreThresholds.publishThreshold)&&p.delete(T)});let v=this.topics.get(g),S=[],C=new Set;if(l.set(g,C),v){let T=Mt(Array.from(v));for(let x of T){let _=this.streamsOutbound.get(x);if(_&&this.multicodecs.includes(_.protocol)&&!p.has(x)&&!this.direct.has(x)){let P=f(x);P>=this.opts.scoreThresholds.publishThreshold&&S.push(x),P>=this.opts.scoreThresholds.gossipThreshold&&C.add(x)}}}if(p.size<e){let T=e-p.size;S.slice(0,T).forEach(x=>{p.add(x),C?.delete(x)})}}),this.emitGossip(l),await this.sendGraftPrune(u,c,h),this.flush(),this.mcache.shift(),this.dispatchEvent(new Or("gossipsub:heartbeat"))}getRandomGossipPeers(e,r,n=()=>!0){let s=this.topics.get(e);if(!s)return new Set;let i=[];return s.forEach(o=>{let a=this.streamsOutbound.get(o);a&&this.multicodecs.includes(a.protocol)&&n(o)&&i.push(o)}),i=Mt(i),r>0&&i.length>r&&(i=i.slice(0,r)),new Set(i)}onScrapeMetrics(e){e.mcacheSize.set(this.mcache.size),e.mcacheNotValidatedCount.set(this.mcache.notValidatedCount),e.cacheSize.set({cache:"direct"},this.direct.size),e.cacheSize.set({cache:"seenCache"},this.seenCache.size),e.cacheSize.set({cache:"fastMsgIdCache"},this.fastMsgIdCache?.size??0),e.cacheSize.set({cache:"publishedMessageIds"},this.publishedMessageIds.size),e.cacheSize.set({cache:"mcache"},this.mcache.size),e.cacheSize.set({cache:"score"},this.score.size),e.cacheSize.set({cache:"gossipTracer.promises"},this.gossipTracer.size),e.cacheSize.set({cache:"gossipTracer.requests"},this.gossipTracer.requestMsByMsgSize),e.cacheSize.set({cache:"topics"},this.topics.size),e.cacheSize.set({cache:"subscriptions"},this.subscriptions.size),e.cacheSize.set({cache:"mesh"},this.mesh.size),e.cacheSize.set({cache:"fanout"},this.fanout.size),e.cacheSize.set({cache:"peers"},this.peers.size),e.cacheSize.set({cache:"streamsOutbound"},this.streamsOutbound.size),e.cacheSize.set({cache:"streamsInbound"},this.streamsInbound.size),e.cacheSize.set({cache:"acceptFromWhitelist"},this.acceptFromWhitelist.size),e.cacheSize.set({cache:"gossip"},this.gossip.size),e.cacheSize.set({cache:"control"},this.control.size),e.cacheSize.set({cache:"peerhave"},this.peerhave.size),e.cacheSize.set({cache:"outbound"},this.outbound.size);let r=0;for(let o of this.backoff.values())r+=o.size;e.cacheSize.set({cache:"backoff"},r);for(let[o,a]of this.topics)e.topicPeersCount.set({topicStr:o},a.size);for(let[o,a]of this.mesh)e.meshPeerCounts.set({topicStr:o},a.size);let n=[],s=new Map;e.behaviourPenalty.reset();for(let o of this.peers.keys()){let a=this.score.score(o);n.push(a),s.set(o,a),e.behaviourPenalty.observe(this.score.peerStats.get(o)?.behaviourPenalty??0)}e.registerScores(n,this.opts.scoreThresholds),e.registerScorePerMesh(this.mesh,s);let i=Pl(this.peers.keys(),this.score.peerStats,this.score.params,this.score.peerIPs,e.topicStrToLabel);e.registerScoreWeights(i)}};xs.multicodec=Ei;function Jb(t={}){return e=>new xs(e,t)}return Vl(e2);})();
/*! Bundled license information:

@noble/secp256k1/lib/esm/index.js:
  (*! noble-secp256k1 - MIT License (c) 2019 Paul Miller (paulmillr.com) *)

@noble/ed25519/lib/esm/index.js:
  (*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) *)
*/
return ChainsafeLibp2PGossipsub}));
